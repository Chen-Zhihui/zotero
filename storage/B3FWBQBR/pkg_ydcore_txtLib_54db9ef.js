define("ydcore:widget/ui/book_view/lib/tinyscrollbar/tinyscrollbar.js",function(t,o,e){var s=t("ydcommon:widget/ui/lib/jquery/jquery.js");!function(t){function o(o,e){function s(){return d.update(),a(),d}function n(){var t=g.toLowerCase();p.obj.css(w,y/f.ratio),h.obj.css(w,-y),z.start=p.obj.offset()[w],f.obj.css(t,j[e.axis]),j.obj.css(t,j[e.axis]),p.obj.css(t,p[e.axis])}function a(){D?x.obj[0].ontouchstart=function(t){1===t.touches.length&&(i(t.touches[0]),t.stopPropagation())}:(p.obj.bind("mousedown",i),j.obj.bind("mouseup",r)),e.scroll&&window.addEventListener?(m[0].addEventListener("DOMMouseScroll",u,!1),m[0].addEventListener("mousewheel",u,!1),m[0].addEventListener("MozMousePixelScroll",function(t){t.preventDefault()
},!1)):e.scroll&&(m[0].onmousewheel=u)}function i(o){t("body").addClass("noSelect"),l();var e=parseInt(p.obj.css(w),10);z.start=v?o.pageX:o.pageY,M.start="auto"==e?0:e,D?(document.ontouchmove=function(t){t.preventDefault(),r(t.touches[0])},document.ontouchend=c):(t(document).bind("mousemove",r),t(document).bind("mouseup",c),p.obj.bind("mouseup",c))}function u(o){if(h.ratio<1){var s=o||window.event,n=s.wheelDelta?s.wheelDelta/120:-s.detail/3;y-=n*e.wheel,y=Math.min(h[e.axis]-x[e.axis],Math.max(0,y)),p.obj.css(w,y/f.ratio),h.obj.css(w,-y),(e.lockscroll||y!==h[e.axis]-x[e.axis]&&0!==y)&&(s=t.event.fix(s),s.preventDefault())
}}function r(t){h.ratio<1&&(M.now=e.invertscroll&&D?Math.min(j[e.axis]-p[e.axis],Math.max(0,M.start+(z.start-(v?t.pageX:t.pageY)))):Math.min(j[e.axis]-p[e.axis],Math.max(0,M.start+((v?t.pageX:t.pageY)-z.start))),y=M.now*f.ratio,h.obj.css(w,-y),p.obj.css(w,M.now))}function c(){t("body").removeClass("noSelect"),t(document).unbind("mousemove",r),t(document).unbind("mouseup",c),p.obj.unbind("mouseup",c),document.ontouchmove=document.ontouchend=null,b()}function l(){document.onselectstart=function(t){return t.preventDefault(),!1
}}function b(){document.onselectstart=function(){return!0}}var d=this,m=o,x={obj:t(".viewport",o)},h={obj:t(".overview",o)},f={obj:t(".scrollbar",o)},j={obj:t(".track",f.obj)},p={obj:t(".thumb",f.obj)},v="x"===e.axis,w=v?"left":"top",g=v?"Width":"Height",y=0,M={start:0,now:0},z={},D="ontouchstart"in document.documentElement;return this.update=function(t){x[e.axis]=x.obj[0]["offset"+g],h[e.axis]=h.obj[0]["offset"+g],h.ratio=x[e.axis]/h[e.axis],f.obj.toggleClass("disable",h.ratio>=1),p.obj.toggleClass("disable",h.ratio>=1),j[e.axis]="auto"===e.size?x[e.axis]:e.size,p[e.axis]=Math.min(j[e.axis],Math.max(0,"auto"===e.sizethumb?j[e.axis]*h.ratio:e.sizethumb)),f.ratio="auto"===e.sizethumb?h[e.axis]/j[e.axis]:(h[e.axis]-x[e.axis])/(j[e.axis]-p[e.axis]),y="relative"===t&&h.ratio<=1?Math.min(h[e.axis]-x[e.axis],Math.max(0,y)):0,y="bottom"===t&&h.ratio<=1?h[e.axis]-x[e.axis]:isNaN(parseInt(t,10))?y:parseInt(t,10),n()
},s()}t.tiny=t.tiny||{},t.tiny.scrollbar={options:{axis:"y",wheel:40,scroll:!0,lockscroll:!0,size:"auto",sizethumb:"auto",invertscroll:!1}},t.fn.tinyscrollbar=function(e){var s=t.extend({},t.tiny.scrollbar.options,e);return this.each(function(){t(this).data("tsb",new o(t(this),s))}),this},t.fn.tinyscrollbar_update=function(o){return t(this).data("tsb").update(o)}}(s),e.exports=s});
;define("ydcore:widget/ui/book_view/lib/detect_zoom/detect_zoom.js",function(e,n,t){var i={};i.browser=e("ydcommon:widget/ui/lib/browser/browser.js");var o=i.browser.ie&&i.browser.ie<8;!function(e,n,i){t.exports.detectZoom=i(n,e)}(window,"detectZoom",function(){var e=function(){return window.devicePixelRatio||1},n=function(){return{zoom:1,devicePxPerCssPx:1}},t=function(){var n=Math.round(screen.deviceXDPI/screen.logicalXDPI*100)/100;return{zoom:n,devicePxPerCssPx:n*e()}},i=function(){var n=Math.round(document.documentElement.offsetHeight/window.innerHeight*100)/100;
return{zoom:n,devicePxPerCssPx:n*e()}},r=function(){var n=Math.round(window.outerWidth/window.innerWidth*100)/100;return{zoom:n,devicePxPerCssPx:n*e()}},d=function(){var n=Math.round(window.outerWidth/window.innerWidth*100)/100;return{zoom:n,devicePxPerCssPx:n*e()}},a=function(){var n=90==Math.abs(window.orientation)?screen.height:screen.width,t=n/window.innerWidth;return{zoom:t,devicePxPerCssPx:t*e()}},u=function(){var n=function(e){return e.replace(/;/g," !important;")},t=document.createElement("div");
t.innerHTML="1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>0",t.setAttribute("style",n("font: 100px/1em sans-serif; -webkit-text-size-adjust: none; text-size-adjust: none; height: auto; width: 1em; padding: 0; overflow: visible;"));var i=document.createElement("div");i.setAttribute("style",n("width:0; height:0; overflow:hidden; visibility:hidden; position: absolute;")),i.appendChild(t),document.body.appendChild(i);var o=1e3/t.clientHeight;return o=Math.round(100*o)/100,document.body.removeChild(i),{zoom:o,devicePxPerCssPx:o*e()}
},c=function(){var e=w("min--moz-device-pixel-ratio","",0,10,20,1e-4);return e=Math.round(100*e)/100,{zoom:e,devicePxPerCssPx:e}},s=function(){return{zoom:c().zoom,devicePxPerCssPx:e()}},m=function(){var n=window.top.outerWidth/window.top.innerWidth;return n=Math.round(100*n)/100,{zoom:n,devicePxPerCssPx:n*e()}},w=function(e,n,t,i,o,r){function d(t,i,o){var u=(t+i)/2;if(0>=o||r>i-t)return u;var c="("+e+":"+u+n+")";return a(c).matches?d(u,i,o-1):d(t,u,o-1)}var a,u,c,s;window.matchMedia?a=window.matchMedia:(u=document.getElementsByTagName("head")[0],c=document.createElement("style"),u.appendChild(c),s=document.createElement("div"),s.className="mediaQueryBinarySearch",s.style.display="none",document.body.appendChild(s),a=function(e){c.sheet.insertRule("@media "+e+"{.mediaQueryBinarySearch {text-decoration: underline} }",0);
var n="underline"==getComputedStyle(s,null).textDecoration;return c.sheet.deleteRule(0),{matches:n}});var m=d(t,i,o);return s&&(u.removeChild(c),document.body.removeChild(s)),m},v=function(){var e=n;return o||(isNaN(screen.logicalXDPI)||isNaN(screen.systemXDPI)?window.navigator.msMaxTouchPoints?e=i:window.chrome&&!(window.opera||navigator.userAgent.indexOf(" Opera")>=0)?e=r:Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0?e=d:"orientation"in window&&"webkitRequestAnimationFrame"in window?e=a:"webkitRequestAnimationFrame"in window?e=u:navigator.userAgent.indexOf("Opera")>=0?e=m:window.devicePixelRatio?e=s:c().zoom>.001&&(e=c):e=t),e
}();return{zoom:function(){return v().zoom},device:function(){return v().devicePxPerCssPx}}})});
;define("ydcore:widget/ui/book_view/lib/rangy/rangy-core.js",function(e,t,n){!function(e){function t(e,t){var n=typeof e[t];return n==N||!(n!=C||!e[t])||"unknown"==n}function n(e,t){return!(typeof e[t]!=C||!e[t])}function r(e,t){return typeof e[t]!=E}function o(e){return function(t,n){for(var r=n.length;r--;)if(!e(t,n[r]))return!1;return!0}}function i(e){return e&&T(e,O)&&D(e,y)}function a(e){return n(e,"body")?e.body:e.getElementsByTagName("body")[0]}function s(e){n(window,"console")&&t(window.console,"log")&&window.console.log(e)
}function c(e,t){t?window.alert(e):s(e)}function d(e){x.initialized=!0,x.supported=!1,c("Rangy is not supported on this page in your browser. Reason: "+e,x.config.alertOnFail)}function f(e){c("Rangy warning: "+e,x.config.alertOnWarn)}function u(e){return e.message||e.description||String(e)}function l(){if(!x.initialized){var e,n=!1,r=!1;t(document,"createRange")&&(e=document.createRange(),T(e,w)&&D(e,S)&&(n=!0),e.detach());var o=a(document);if(!o||"body"!=o.nodeName.toLowerCase())return void d("No body element found");
if(o&&t(o,"createTextRange")&&(e=o.createTextRange(),i(e)&&(r=!0)),!n&&!r)return void d("Neither Range nor TextRange are available");x.initialized=!0,x.features={implementsDomRange:n,implementsTextRange:r};var c,f;for(var l in A)(c=A[l])instanceof g&&c.init(c,x);for(var h=0,p=P.length;p>h;++h)try{P[h](x)}catch(m){f="Rangy init listener threw an exception. Continuing. Detail: "+u(m),s(f)}}}function h(e){e=e||window,l();for(var t=0,n=I.length;n>t;++t)I[t](e)}function g(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n
}function p(e,t,n,r){var o=new g(t,n,function(e){if(!e.initialized){e.initialized=!0;try{r(x,e),e.supported=!0}catch(n){var o="Module '"+t+"' failed to load: "+u(n);s(o)}}});A[t]=o}function m(){}function R(){}var v="function"==typeof e.define&&e.define.amd,C="object",N="function",E="undefined",S=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],w=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],y=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],O=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],T=o(t),_=o(n),D=o(r),A={},x={version:"1.3alpha.804",initialized:!1,supported:!0,util:{isHostMethod:t,isHostObject:n,isHostProperty:r,areHostMethods:T,areHostObjects:_,areHostProperties:D,isTextRange:i,getBody:a},features:{},modules:A,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1}};
x.fail=d,x.warn=f,{}.hasOwnProperty?x.util.extend=function(e,t,n){var r,o;for(var i in t)t.hasOwnProperty(i)&&(r=e[i],o=t[i],n&&null!==r&&"object"==typeof r&&null!==o&&"object"==typeof o&&x.util.extend(r,o,!0),e[i]=o);return e}:d("hasOwnProperty not supported"),function(){var e=document.createElement("div");e.appendChild(document.createElement("span"));var t,n=[].slice;try{1==n.call(e.childNodes,0)[0].nodeType&&(t=function(e){return n.call(e,0)})}catch(r){}t||(t=function(e){for(var t=[],n=0,r=e.length;r>n;++n)t[n]=e[n];
return t}),x.util.toArray=t}();var b;t(document,"addEventListener")?b=function(e,t,n){e.addEventListener(t,n,!1)}:t(document,"attachEvent")?b=function(e,t,n){e.attachEvent("on"+t,n)}:d("Document does not have required addEventListener or attachEvent method"),x.util.addListener=b;var P=[];x.init=l,x.addInitListener=function(e){x.initialized?e(x):P.push(e)};var I=[];x.addCreateMissingNativeApiListener=function(e){I.push(e)},x.createMissingNativeApi=h,g.prototype={init:function(){for(var e,t,n=this.dependencies||[],r=0,o=n.length;o>r;++r){if(t=n[r],e=A[t],!(e&&e instanceof g))throw new Error("required module '"+t+"' not found");
if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},warn:function(e){x.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){x.warn("DEPRECATED: "+e+" in module "+this.name+"is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},x.createModule=function(e){var t,n;
2==arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]),p(!1,e,n,t)},x.createCoreModule=function(e,t,n){p(!0,e,t,n)},x.RangePrototype=m,x.rangePrototype=new m,x.selectionPrototype=new R;var B=!1,H=function(){B||(B=!0,x.initialized||l())};return typeof window==E?void d("No window found"):typeof document==E?void d("No document found"):(t(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",H,!1),b(window,"load",H),v&&e.define(function(){return x.amd=!0,x}),void(e.rangy=x))
}(window),rangy.createCoreModule("DomUtil",[],function(e,t){function n(e){var t;return typeof e.namespaceURI==A||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function r(e){var t=e.parentNode;return 1==t.nodeType?t:null}function o(e){for(var t=0;e=e.previousSibling;)++t;return t}function i(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function a(e,t){var n,r=[];for(n=e;n;n=n.parentNode)r.push(n);for(n=t;n;n=n.parentNode)if(I(r,n))return n;
return null}function s(e,t,n){for(var r=n?t:t.parentNode;r;){if(r===e)return!0;r=r.parentNode}return!1}function c(e,t){return s(e,t,!0)}function d(e,t,n){for(var r,o=n?e:e.parentNode;o;){if(r=o.parentNode,r===t)return o;o=r}return null}function f(e){var t=e.nodeType;return 3==t||4==t||8==t}function u(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t}function l(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function h(e,t,n){var r=e.cloneNode(!1);if(r.deleteData(0,t),e.deleteData(t,e.length-t),l(r,e),n)for(var i,a=0;i=n[a++];)i.node==e&&i.offset>t?(i.node=r,i.offset-=t):i.node==e.parentNode&&i.offset>o(e)&&++i.offset;
return r}function g(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=A)return e.ownerDocument;if(typeof e.document!=A)return e.document;if(e.parentNode)return g(e.parentNode);throw t.createError("getDocument: no document found for node")}function p(e){var n=g(e);if(typeof n.defaultView!=A)return n.defaultView;if(typeof n.parentWindow!=A)return n.parentWindow;throw t.createError("Cannot get a window object for node")}function m(e){if(typeof e.contentDocument!=A)return e.contentDocument;if(typeof e.contentWindow!=A)return e.contentWindow.document;
throw t.createError("getIframeDocument: No Document object found for iframe element")}function R(e){if(typeof e.contentWindow!=A)return e.contentWindow;if(typeof e.contentDocument!=A)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function v(e){return e&&x.isHostMethod(e,"setTimeout")&&x.isHostObject(e,"document")}function C(e,t,n){var r;if(e?x.isHostProperty(e,"nodeType")?r=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?m(e):g(e):v(e)&&(r=e.document):r=document,!r)throw t.createError(n+"(): Parameter must be a Window object or DOM node");
return r}function N(e){for(var t;t=e.parentNode;)e=t;return e}function E(e,n,r,i){var s,c,f,u,l;if(e==r)return n===i?0:i>n?-1:1;if(s=d(r,e,!0))return n<=o(s)?-1:1;if(s=d(e,r,!0))return o(s)<i?-1:1;if(c=a(e,r),!c)throw new Error("comparePoints error: nodes have no common ancestor");if(f=e===c?c:d(e,c,!0),u=r===c?c:d(r,c,!0),f===u)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(l=c.firstChild;l;){if(l===f)return-1;if(l===u)return 1;l=l.nextSibling}}function S(e){try{return e.parentNode,!1
}catch(t){return!0}}function w(e){if(!e)return"[No node]";if(B&&S(e))return"[Broken node]";if(f(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+o(e)+"]["+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function y(e){for(var t,n=g(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}function O(e){this.root=e,this._next=e}function T(e){return new O(e)}function _(e,t){this.node=e,this.offset=t
}function D(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var A="undefined",x=e.util;x.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),x.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var b=document.createElement("div");x.areHostMethods(b,["insertBefore","appendChild","cloneNode"]||!x.areHostObjects(b,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),x.isHostProperty(b,"innerHTML")||t.fail("Element is missing innerHTML property");
var P=document.createTextNode("test");x.areHostMethods(P,["splitText","deleteData","insertData","appendData","cloneNode"]||!x.areHostObjects(b,["previousSibling","nextSibling","childNodes","parentNode"])||!x.areHostProperties(P,["data"]))||t.fail("Incomplete Text Node implementation");var I=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},B=!1;!function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br>",B=S(n),e.features.crashyTextNodes=B
}();var H;typeof window.getComputedStyle!=A?H=function(e,t){return p(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=A?H=function(e,t){return e.currentStyle[t]}:t.fail("No means of obtaining computed style properties found"),O.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current
},detach:function(){this._current=this._next=this.root=null}},_.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+w(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},D.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},D.prototype.toString=function(){return this.message},e.dom={arrayContains:I,isHtmlNamespace:n,parentElement:r,getNodeIndex:o,getNodeLength:i,getCommonAncestor:a,isAncestorOf:s,isOrIsAncestorOf:c,getClosestAncestorIn:d,isCharacterDataNode:f,isTextOrCommentNode:u,insertAfter:l,splitDataNode:h,getDocument:g,getWindow:p,getIframeWindow:R,getIframeDocument:m,getBody:x.getBody,isWindow:v,getContentDocument:C,getRootContainer:N,comparePoints:E,isBrokenNode:S,inspectNode:w,getComputedStyleProperty:H,fragmentFromNodeChildren:y,createIterator:T,DomPosition:_},e.DOMException=D
}),rangy.createCoreModule("DomRange",["DomUtil"],function(e){function t(e,t){return 3!=e.nodeType&&(j(e,t.startContainer)||j(e,t.endContainer))}function n(e){return e.document||V(e.startContainer)}function r(e){return new W(e.parentNode,U(e))}function o(e){return new W(e.parentNode,U(e)+1)}function i(e,t,n){var r=11==e.nodeType?e.firstChild:e;return F(t)?n==t.length?M.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:Y(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),r
}function a(e,t,r){if(T(e),T(t),n(t)!=n(e))throw new k("WRONG_DOCUMENT_ERR");var o=z(e.startContainer,e.startOffset,t.endContainer,t.endOffset),i=z(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return r?0>=o&&i>=0:0>o&&i>0}function s(e){for(var t,r,o,i=n(e.range).createDocumentFragment();r=e.next();){if(t=e.isPartiallySelectedSubtree(),r=r.cloneNode(!t),t&&(o=e.getSubtreeIterator(),r.appendChild(s(o)),o.detach(!0)),10==r.nodeType)throw new k("HIERARCHY_REQUEST_ERR");i.appendChild(r)}return i
}function c(e,t,n){var r,o;n=n||{stop:!1};for(var i,a;i=e.next();)if(e.isPartiallySelectedSubtree()){if(t(i)===!1)return void(n.stop=!0);if(a=e.getSubtreeIterator(),c(a,t,n),a.detach(!0),n.stop)return}else for(r=M.createIterator(i);o=r.next();)if(t(o)===!1)return void(n.stop=!0)}function d(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),d(t),t.detach(!0)):e.remove()}function f(e){for(var t,r,o=n(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),r=e.getSubtreeIterator(),t.appendChild(f(r)),r.detach(!0)):e.remove(),10==t.nodeType)throw new k("HIERARCHY_REQUEST_ERR");
o.appendChild(t)}return o}function u(e,t,n){var r,o=!(!t||!t.length),i=!!n;o&&(r=new RegExp("^("+t.join("|")+")$"));var a=[];return c(new h(e,!1),function(t){if(!(o&&!r.test(t.nodeType)||i&&!n(t))){var s=e.startContainer;if(t!=s||!F(s)||e.startOffset!=s.length){var c=e.endContainer;t==c&&F(c)&&0==e.endOffset||a.push(t)}}}),a}function l(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+M.inspectNode(e.startContainer)+":"+e.startOffset+", "+M.inspectNode(e.endContainer)+":"+e.endOffset+")]"
}function h(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&F(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||F(this.sc)?q(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||F(this.ec)?q(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function g(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName
}function p(e){return function(t,n){for(var r,o=n?t:t.parentNode;o;){if(r=o.nodeType,G(e,r))return o;o=o.parentNode}return null}}function m(e,t){if(ot(e,t))throw new g("INVALID_NODE_TYPE_ERR")}function R(e){if(!e.startContainer)throw new k("INVALID_STATE_ERR")}function v(e,t){if(!G(t,e.nodeType))throw new g("INVALID_NODE_TYPE_ERR")}function C(e,t){if(0>t||t>(F(e)?e.length:e.childNodes.length))throw new k("INDEX_SIZE_ERR")}function N(e,t){if(nt(e,!0)!==nt(t,!0))throw new k("WRONG_DOCUMENT_ERR")}function E(e){if(rt(e,!0))throw new k("NO_MODIFICATION_ALLOWED_ERR")
}function S(e,t){if(!e)throw new k(t)}function w(e){return Z&&M.isBrokenNode(e)||!G(J,e.nodeType)&&!nt(e,!0)}function y(e,t){return t<=(F(e)?e.length:e.childNodes.length)}function O(e){return!!e.startContainer&&!!e.endContainer&&!w(e.startContainer)&&!w(e.endContainer)&&y(e.startContainer,e.startOffset)&&y(e.endContainer,e.endOffset)}function T(e){if(R(e),!O(e))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function _(e,t){T(e);var n=e.startContainer,r=e.startOffset,o=e.endContainer,i=e.endOffset,a=n===o;
F(o)&&i>0&&i<o.length&&Y(o,i,t),F(n)&&r>0&&r<n.length&&(n=Y(n,r,t),a?(i-=r,o=n):o==n.parentNode&&i>=U(n)&&i++,r=0),e.setStartAndEnd(n,r,o,i)}function D(e){e.START_TO_START=ft,e.START_TO_END=ut,e.END_TO_END=lt,e.END_TO_START=ht,e.NODE_BEFORE=gt,e.NODE_AFTER=pt,e.NODE_BEFORE_AND_AFTER=mt,e.NODE_INSIDE=Rt}function A(e){D(e),D(e.prototype)}function x(e,t){return function(){T(this);var n,r,i=this.startContainer,a=this.startOffset,s=this.commonAncestorContainer,d=new h(this,!0);i!==s&&(n=q(i,s,!0),r=o(n),i=r.node,a=r.offset),c(d,E),d.reset();
var f=e(d);return d.detach(),t(this,i,a,i,a),f}}function b(n,i,a){function s(e,t){return function(n){R(this),v(n,$),v(X(n),J);var i=(e?r:o)(n);(t?c:u)(this,i.node,i.offset)}}function c(e,t,n){var r=e.endContainer,o=e.endOffset;(t!==e.startContainer||n!==e.startOffset)&&((X(t)!=X(r)||1==z(t,n,r,o))&&(r=t,o=n),i(e,t,n,r,o))}function u(e,t,n){var r=e.startContainer,o=e.startOffset;(t!==e.endContainer||n!==e.endOffset)&&((X(t)!=X(r)||-1==z(t,n,r,o))&&(r=t,o=n),i(e,r,o,t,n))}var l=function(){};l.prototype=e.rangePrototype,n.prototype=new l,L.extend(n.prototype,{setStart:function(e,t){R(this),m(e,!0),C(e,t),c(this,e,t)
},setEnd:function(e,t){R(this),m(e,!0),C(e,t),u(this,e,t)},setStartAndEnd:function(){R(this);var e=arguments,t=e[0],n=e[1],r=t,o=n;switch(e.length){case 3:o=e[2];break;case 4:r=e[2],o=e[3]}i(this,t,n,r,o)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:s(!0,!0),setStartAfter:s(!1,!0),setEndBefore:s(!0,!1),setEndAfter:s(!1,!1),collapse:function(e){T(this),e?i(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):i(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)
},selectNodeContents:function(e){R(this),m(e,!0),i(this,e,0,e,Q(e))},selectNode:function(e){R(this),m(e,!1),v(e,$);var t=r(e),n=o(e);i(this,t.node,t.offset,n.node,n.offset)},extractContents:x(f,i),deleteContents:x(d,i),canSurroundContents:function(){T(this),E(this.startContainer),E(this.endContainer);var e=new h(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},detach:function(){a(this)},splitBoundaries:function(){_(this)},splitBoundariesPreservingPositions:function(e){_(this,e)
},normalizeBoundaries:function(){T(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,r=this.endOffset,o=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(n=e,r=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},a=function(o){var i=o.previousSibling;if(i&&i.nodeType==o.nodeType){e=o;var a=o.length;if(t=i.length,o.insertData(0,i.data),i.parentNode.removeChild(i),e==n)r+=t,n=e;else if(n==o.parentNode){var s=U(o);r==s?(n=o,r=a):r>s&&r--}}},s=!0;if(F(n))n.length==r&&o(n);
else{if(r>0){var c=n.childNodes[r-1];c&&F(c)&&o(c)}s=!this.collapsed}if(s){if(F(e))0==t&&a(e);else if(t<e.childNodes.length){var d=e.childNodes[t];d&&F(d)&&a(d)}}else e=n,t=r;i(this,e,t,n,r)},collapseToPoint:function(e,t){R(this),m(e,!0),C(e,t),this.setStartAndEnd(e,t)}}),A(n)}function P(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:M.getCommonAncestor(e.startContainer,e.endContainer)}function I(e,t,n,r,o){e.startContainer=t,e.startOffset=n,e.endContainer=r,e.endOffset=o,e.document=M.getDocument(t),P(e)
}function B(e){R(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=e.document=null,e.collapsed=e.commonAncestorContainer=null}function H(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,P(this)}var M=e.dom,L=e.util,W=M.DomPosition,k=e.DOMException,F=M.isCharacterDataNode,U=M.getNodeIndex,j=M.isOrIsAncestorOf,V=M.getDocument,z=M.comparePoints,Y=M.splitDataNode,q=M.getClosestAncestorIn,Q=M.getNodeLength,G=M.arrayContains,X=M.getRootContainer,Z=e.features.crashyTextNodes;
h.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,F(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;
!F(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(e=n===this.sc?this.so:0,t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return t(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new H(n(this.range));var t=this._current,r=t,o=0,i=t,a=Q(t);j(t,this.sc)&&(r=this.sc,o=this.so),j(t,this.ec)&&(i=this.ec,a=this.eo),I(e,r,o,i,a)
}return new h(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},g.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},g.prototype.toString=function(){return this.message};var $=[1,3,4,5,7,8,10],J=[2,9,11],K=[5,6,10,12],et=[1,3,4,5,7,8,10,11],tt=[1,3,4,5,7,8],nt=p([9,11]),rt=p(K),ot=p([6,10,12]),it=document.createElement("style"),at=!1;try{it.innerHTML="<b>x</b>",at=3==it.firstChild.nodeType
}catch(st){}e.features.htmlParsingConforms=at;var ct=at?function(e){var t=this.startContainer,n=V(t);if(!t)throw new k("INVALID_STATE_ERR");var r=null;return 1==t.nodeType?r=t:F(t)&&(r=M.parentElement(t)),r=null===r||"HTML"==r.nodeName&&M.isHtmlNamespace(V(r).documentElement)&&M.isHtmlNamespace(r)?n.createElement("body"):r.cloneNode(!1),r.innerHTML=e,M.fragmentFromNodeChildren(r)}:function(e){R(this);var t=n(this),r=t.createElement("body");return r.innerHTML=e,M.fragmentFromNodeChildren(r)},dt=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ft=0,ut=1,lt=2,ht=3,gt=0,pt=1,mt=2,Rt=3;
L.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){T(this),N(this.startContainer,t.startContainer);var n,r,o,i,a=e==ht||e==ft?"start":"end",s=e==ut||e==ft?"start":"end";return n=this[a+"Container"],r=this[a+"Offset"],o=t[s+"Container"],i=t[s+"Offset"],z(n,r,o,i)},insertNode:function(e){if(T(this),v(e,et),E(this.startContainer),j(e,this.startContainer))throw new k("HIERARCHY_REQUEST_ERR");var t=i(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){T(this);
var e,t;if(this.collapsed)return n(this).createDocumentFragment();if(this.startContainer===this.endContainer&&F(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=n(this).createDocumentFragment(),t.appendChild(e),t;var r=new h(this,!0);return e=s(r),r.detach(),e},canSurroundContents:function(){T(this),E(this.startContainer),E(this.endContainer);var e=new h(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n
},surroundContents:function(e){if(v(e,tt),!this.canSurroundContents())throw new g("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);i(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){T(this);for(var e,t=new H(n(this)),r=dt.length;r--;)e=dt[r],t[e]=this[e];return t},toString:function(){T(this);var e=this.startContainer;if(e===this.endContainer&&F(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";
var t=[],n=new h(this,!0);return c(n,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){T(this);var t=e.parentNode,n=U(e);if(!t)throw new k("NOT_FOUND_ERR");var r=this.comparePoint(t,n),o=this.comparePoint(t,n+1);return 0>r?o>0?mt:gt:o>0?pt:Rt},comparePoint:function(e,t){return T(this),S(e,"HIERARCHY_REQUEST_ERR"),N(e,this.startContainer),z(e,t,this.startContainer,this.startOffset)<0?-1:z(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:ct,toHtml:function(){T(this);
var e=this.commonAncestorContainer.parentNode.cloneNode(!1);return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){if(T(this),S(e,"NOT_FOUND_ERR"),V(e)!==n(this))return!1;var r=e.parentNode,o=U(e);S(r,"NOT_FOUND_ERR");var i=z(r,o,this.endContainer,this.endOffset),a=z(r,o+1,this.startContainer,this.startOffset);return t?0>=i&&a>=0:0>i&&a>0},isPointInRange:function(e,t){return T(this),S(e,"HIERARCHY_REQUEST_ERR"),N(e,this.startContainer),z(e,t,this.startContainer,this.startOffset)>=0&&z(e,t,this.endContainer,this.endOffset)<=0
},intersectsRange:function(e){return a(this,e,!1)},intersectsOrTouchesRange:function(e){return a(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=z(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=z(this.endContainer,this.endOffset,e.endContainer,e.endOffset),r=this.cloneRange();return-1==t&&r.setStart(e.startContainer,e.startOffset),1==n&&r.setEnd(e.endContainer,e.endOffset),r}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();
return-1==z(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==z(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new g("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==Rt},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,Q(e))<=0},containsRange:function(e){var t=this.intersection(e);
return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();t.setEnd(r,r.length);var o=this.containsRange(t);return t.detach(),o}return this.containsNodeContents(e)},getNodes:function(e,t){return T(this),u(this,e,t)},getDocument:function(){return n(this)},collapseBefore:function(e){R(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){R(this),this.setStartAfter(e),this.collapse(!0)
},getBookmark:function(t){var r=n(this),o=e.createRange(r);t=t||M.getBody(r),o.selectNodeContents(t);var i=this.intersection(o),a=0,s=0;return i&&(o.setEnd(i.startContainer,i.startOffset),a=o.toString().length,s=a+i.toString().length,o.detach()),{start:a,end:s,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);for(var r,o,i,a,s=[t],c=!1,d=!1;!d&&(r=s.pop());)if(3==r.nodeType)o=n+r.length,!c&&e.start>=n&&e.start<=o&&(this.setStart(r,e.start-n),c=!0),c&&e.end>=n&&e.end<=o&&(this.setEnd(r,e.end-n),d=!0),n=o;
else for(a=r.childNodes,i=a.length;i--;)s.push(a[i])},getName:function(){return"DomRange"},equals:function(e){return H.rangesEqual(this,e)},isValid:function(){return O(this)},inspect:function(){return l(this)}}),b(H,I,B),L.extend(H,{rangeProperties:dt,RangeIterator:h,copyComparisonConstants:A,createPrototypeRange:b,inspect:l,getRangeDocument:n,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset
}}),e.DomRange=H,e.RangeException=g}),rangy.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,r,o=e.dom,i=e.util,a=o.DomPosition,s=e.DomRange,c=o.getBody,d=o.getContentDocument,f=o.isCharacterDataNode;if(e.features.implementsDomRange&&!function(){function r(e){for(var t,n=h.length;n--;)t=h[n],e[t]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function a(e,t,n,r,o){var i=e.startContainer!==t||e.startOffset!=n,a=e.endContainer!==r||e.endOffset!=o,s=!e.equals(e.nativeRange);
(i||a||s)&&(e.setEnd(r,o),e.setStart(t,n))}function f(e){e.nativeRange.detach(),e.detached=!0;for(var t=h.length;t--;)e[h[t]]=null}var u,l,h=s.rangeProperties;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,r(this)},s.createPrototypeRange(n,a,f),u=n.prototype,u.selectNode=function(e){this.nativeRange.selectNode(e),r(this)},u.cloneContents=function(){return this.nativeRange.cloneContents()},u.surroundContents=function(e){this.nativeRange.surroundContents(e),r(this)
},u.collapse=function(e){this.nativeRange.collapse(e),r(this)},u.cloneRange=function(){return new n(this.nativeRange.cloneRange())},u.refresh=function(){r(this)},u.toString=function(){return this.nativeRange.toString()};var g=document.createTextNode("test");c(document).appendChild(g);var p=document.createRange();p.setStart(g,0),p.setEnd(g,0);try{p.setStart(g,1),u.setStart=function(e,t){this.nativeRange.setStart(e,t),r(this)},u.setEnd=function(e,t){this.nativeRange.setEnd(e,t),r(this)},l=function(e){return function(t){this.nativeRange[e](t),r(this)
}}}catch(m){u.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}r(this)},u.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}r(this)},l=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(o){this.nativeRange[t](n),this.nativeRange[e](n)}r(this)}}}u.setStartBefore=l("setStartBefore","setEndBefore"),u.setStartAfter=l("setStartAfter","setEndAfter"),u.setEndBefore=l("setEndBefore","setStartBefore"),u.setEndAfter=l("setEndAfter","setStartAfter"),u.selectNodeContents=function(e){this.setStartAndEnd(e,0,o.getNodeLength(e))
},p.selectNodeContents(g),p.setEnd(g,3);var R=document.createRange();R.selectNodeContents(g),R.setEnd(g,4),R.setStart(g,2),u.compareBoundaryPoints=-1==p.compareBoundaryPoints(p.START_TO_END,R)&&1==p.compareBoundaryPoints(p.END_TO_START,R)?function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var v=document.createElement("div");
v.innerHTML="123";var C=v.firstChild,N=c(document);N.appendChild(v),p.setStart(C,1),p.setEnd(C,2),p.deleteContents(),"13"==C.data&&(u.deleteContents=function(){this.nativeRange.deleteContents(),r(this)},u.extractContents=function(){var e=this.nativeRange.extractContents();return r(this),e}),N.removeChild(v),N=null,i.isHostMethod(p,"createContextualFragment")&&(u.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),c(document).removeChild(g),p.detach(),R.detach(),u.getName=function(){return"WrappedRange"
},e.WrappedRange=n,e.createNativeRange=function(e){return e=d(e,t,"createNativeRange"),e.createRange()}}(),e.features.implementsTextRange){var u=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var r=n.parentElement();n=e.duplicate(),n.collapse(!1);var i=n.parentElement(),a=r==i?r:o.getCommonAncestor(r,i);return a==t?a:o.getCommonAncestor(t,a)},l=function(e){return 0==e.compareEndPoints("StartToEnd",e)},h=function(e,t,n,r,i){var s=e.duplicate();s.collapse(n);var c=s.parentElement();
if(o.isOrIsAncestorOf(t,c)||(c=t),!c.canHaveHTML){var d=new a(c.parentNode,o.getNodeIndex(c));return{boundaryPosition:d,nodeInfo:{nodeIndex:d.offset,containerElement:d.node}}}var u=o.getDocument(c).createElement("span");u.parentNode&&u.parentNode.removeChild(u);for(var l,h,g,p,m,R=n?"StartToStart":"StartToEnd",v=i&&i.containerElement==c?i.nodeIndex:0,C=c.childNodes.length,N=C,E=N;;){if(E==C?c.appendChild(u):c.insertBefore(u,c.childNodes[E]),s.moveToElementText(u),l=s.compareEndPoints(R,e),0==l||v==N)break;
if(-1==l){if(N==v+1)break;v=E}else N=N==v+1?v:E;E=Math.floor((v+N)/2),c.removeChild(u)}if(m=u.nextSibling,-1==l&&m&&f(m)){s.setEndPoint(n?"EndToStart":"EndToEnd",e);var S;if(/[\r\n]/.test(m.data)){var w=s.duplicate(),y=w.text.replace(/\r\n/g,"\r").length;for(S=w.moveStart("character",y);-1==(l=w.compareEndPoints("StartToEnd",w));)S++,w.moveStart("character",1)}else S=s.text.length;p=new a(m,S)}else h=(r||!n)&&u.previousSibling,g=(r||n)&&u.nextSibling,p=g&&f(g)?new a(g,0):h&&f(h)?new a(h,h.data.length):new a(c,o.getNodeIndex(u));
return u.parentNode.removeChild(u),{boundaryPosition:p,nodeInfo:{nodeIndex:E,containerElement:c}}},g=function(e,t){var n,r,i,a,s=e.offset,d=o.getDocument(e.node),u=c(d).createTextRange(),l=f(e.node);return l?(n=e.node,r=n.parentNode):(a=e.node.childNodes,n=s<a.length?a[s]:null,r=e.node),i=d.createElement("span"),i.innerHTML="&#feff;",n?r.insertBefore(i,n):r.appendChild(i),u.moveToElementText(i),u.collapse(!t),r.removeChild(i),l&&u[t?"moveStart":"moveEnd"]("character",s),u};if(r=function(e){this.textRange=e,this.refresh()
},r.prototype=new s(document),r.prototype.refresh=function(){var e,t,n,r=u(this.textRange);l(this.textRange)?t=e=h(this.textRange,r,!0,!0).boundaryPosition:(n=h(this.textRange,r,!0,!1),e=n.boundaryPosition,t=h(this.textRange,r,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},r.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(r),r.rangeToTextRange=function(e){if(e.collapsed)return g(new a(e.startContainer,e.startOffset),!0);
var t=g(new a(e.startContainer,e.startOffset),!0),n=g(new a(e.endContainer,e.endOffset),!1),r=c(s.getRangeDocument(e)).createTextRange();return r.setEndPoint("StartToStart",t),r.setEndPoint("EndToEnd",n),r},e.WrappedTextRange=r,!e.features.implementsDomRange||e.config.preferTextRange){var p=function(){return this}();"undefined"==typeof p.Range&&(p.Range=r),e.createNativeRange=function(e){return e=d(e,t,"createNativeRange"),c(e).createTextRange()},e.WrappedRange=r}}e.createRange=function(n){return n=d(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))
},e.createRangyRange=function(e){return e=d(e,t,"createRangyRange"),new s(e)},e.createIframeRange=function(n){return t.deprecationNotice("createIframeRange()","createRange(iframeEl)"),e.createRange(n)},e.createIframeRangyRange=function(n){return t.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),e.createRangyRange(n)},e.addCreateMissingNativeApiListener(function(t){var n=t.document;"undefined"==typeof n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null
})}),rangy.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function n(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function r(e,n){if(e){if(D.isWindow(e))return e;if(e instanceof R)return e.win;var r=D.getContentDocument(e,t,n);return D.getWindow(r)}return window}function o(e){return r(e,"getWinSelection").getSelection()}function i(e){return r(e,"getDocSelection").document.selection}function a(e){var t=!1;return e.anchorNode&&(t=1==D.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t
}function s(e,t,n){var r=n?"end":"start",o=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[o+"Container"],e.focusOffset=t[o+"Offset"]}function c(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function d(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function f(t){var n;return t instanceof b?(n=e.createNativeRange(t.getDocument()),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof P?n=t.nativeRange:H.implementsDomRange&&t instanceof D.getWindow(t.startContainer).Range&&(n=t),n
}function u(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;n>t;++t)if(!D.isAncestorOf(e[0],e[t]))return!1;return!0}function l(e){var n=e.getNodes();if(!u(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function h(e){return!!e&&"undefined"!=typeof e.text}function g(e,t){var n=new P(t);e._ranges=[n],s(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function p(t){if(t._ranges.length=0,"None"==t.docSelection.type)d(t);
else{var n=t.docSelection.createRange();if(h(n))g(t,n);else{t.rangeCount=n.length;for(var r,o=L(n.item(0)),i=0;i<t.rangeCount;++i)r=e.createRange(o),r.selectNode(n.item(i)),t._ranges.push(r);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,s(t,t._ranges[t.rangeCount-1],!1)}}}function m(e,n){for(var r=e.docSelection.createRange(),o=l(n),i=L(r.item(0)),a=W(i).createControlRange(),s=0,c=r.length;c>s;++s)a.add(r.item(s));try{a.add(o)}catch(d){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")
}a.select(),p(e)}function R(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function v(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function C(e,t){for(var n,r,o=tt.length;o--;)if(n=tt[o],r=n.selection,"deleteAll"==t)v(r);else if(n.win==e)return"delete"==t?(tt.splice(o,1),!0):r;return"deleteAll"==t&&(tt.length=0),null}function N(e,n){for(var r,o=L(n[0].startContainer),i=W(o).createControlRange(),a=0,s=n.length;s>a;++a){r=l(n[a]);
try{i.add(r)}catch(c){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}i.select(),p(e)}function E(e,t){if(e.win.document!=L(t))throw new I("WRONG_DOCUMENT_ERR")}function S(t){return function(n,r){var o;this.rangeCount?(o=this.getRangeAt(0),o["set"+(t?"Start":"End")](n,r)):(o=e.createRange(this.win.document),o.setStartAndEnd(n,r)),this.setSingleRange(o,this.isBackward())}}function w(e){var t=[],n=new B(e.anchorNode,e.anchorOffset),r=new B(e.focusNode,e.focusOffset),o="function"==typeof e.getName?e.getName():"Selection";
if("undefined"!=typeof e.rangeCount)for(var i=0,a=e.rangeCount;a>i;++i)t[i]=b.inspect(e.getRangeAt(i));return"["+o+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}e.config.checkSelectionRanges=!0;var y,O,T="boolean",_="number",D=e.dom,A=e.util,x=A.isHostMethod,b=e.DomRange,P=e.WrappedRange,I=e.DOMException,B=D.DomPosition,H=e.features,M="Control",L=D.getDocument,W=D.getBody,k=b.rangesEqual,F=x(window,"getSelection"),U=A.isHostObject(document,"selection");H.implementsWinGetSelection=F,H.implementsDocSelection=U;
var j=U&&(!F||e.config.preferTextRange);j?(y=i,e.isSelectionValid=function(e){var t=r(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||L(n.createRange().parentElement())==t}):F?(y=o,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=y;var V=y(),z=e.createNativeRange(document),Y=W(document),q=A.areHostProperties(V,["anchorNode","focusNode","anchorOffset","focusOffset"]);H.selectionHasAnchorAndFocus=q;
var Q=x(V,"extend");H.selectionHasExtend=Q;var G=typeof V.rangeCount==_;H.selectionHasRangeCount=G;var X=!1,Z=!0,$=Q?function(t,n){var r=b.getRangeDocument(n),o=e.createRange(r);o.collapseToPoint(n.endContainer,n.endOffset),t.addRange(f(o)),t.extend(n.startContainer,n.startOffset)}:null;A.areHostMethods(V,["addRange","getRangeAt","removeAllRanges"])&&typeof V.rangeCount==_&&H.implementsDomRange&&!function(){var t=window.getSelection();if(t){for(var n=t.rangeCount,r=n>1,o=[],i=a(t),s=0;n>s;++s)o[s]=t.getRangeAt(s);
var c=W(document),d=c.appendChild(document.createElement("div"));d.contentEditable="false";var f=d.appendChild(document.createTextNode("\xa0\xa0\xa0")),u=document.createRange();if(u.setStart(f,1),u.collapse(!0),t.addRange(u),Z=1==t.rangeCount,t.removeAllRanges(),!r){var l=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(l&&parseInt(l[1])>=36)X=!1;else{var h=u.cloneRange();u.setStart(f,0),h.setEnd(f,3),h.setStart(f,2),t.addRange(u),t.addRange(h),X=2==t.rangeCount}}for(c.removeChild(d),t.removeAllRanges(),u.detach(),s=0;n>s;++s)0==s&&i?$?$(t,o[s]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because browser does not support Selection.extend"),t.addRange(o[s])):t.addRange(o[s])
}}(),H.selectionSupportsMultipleRanges=X,H.collapsedNonEditableSelectionsSupported=Z;var J,K=!1;Y&&x(Y,"createControlRange")&&(J=Y.createControlRange(),A.areHostProperties(J,["item","add"])&&(K=!0)),H.implementsControlRange=K,O=q?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var et;x(V,"getRangeAt")?et=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:q&&(et=function(t){var n=L(t.anchorNode),r=e.createRange(n);
return r.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),r.collapsed!==this.isCollapsed&&r.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),r}),R.prototype=e.selectionPrototype;var tt=[],nt=function(e){if(e&&e instanceof R)return e.refresh(),e;e=r(e,"getNativeSelection");var t=C(e),n=y(e),o=U?i(e):null;return t?(t.nativeSelection=n,t.docSelection=o,t.refresh()):(t=new R(n,o,e),tt.push({win:e,selection:t})),t};e.getSelection=nt,e.getIframeSelection=function(n){return t.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),e.getSelection(D.getIframeWindow(n))
};var rt=R.prototype;if(!j&&q&&A.areHostMethods(V,["removeAllRanges","addRange"])){rt.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),d(this)};var ot=function(e,t){$(e.nativeSelection,t),e.refresh()};rt.addRange=G?function(t,r){if(K&&U&&this.docSelection.type==M)m(this,t);else if(n(r)&&Q)ot(this,t);else{var o;if(X?o=this.rangeCount:(this.removeAllRanges(),o=0),this.nativeSelection.addRange(f(t).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==o+1){if(e.config.checkSelectionRanges){var i=et(this.nativeSelection,this.rangeCount-1);
i&&!k(i,t)&&(t=new P(i))}this._ranges[this.rangeCount-1]=t,s(this,t,st(this.nativeSelection)),this.isCollapsed=O(this)}else this.refresh()}}:function(e,t){n(t)&&Q?ot(this,e):(this.nativeSelection.addRange(f(e)),this.refresh())},rt.setRanges=function(e){if(K&&e.length>1)N(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}}}else{if(!(x(V,"empty")&&x(z,"select")&&K&&j))return t.fail("No means of selecting a Range or TextRange was found"),!1;rt.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;
if(this.anchorNode)e=L(this.anchorNode);else if(this.docSelection.type==M){var t=this.docSelection.createRange();t.length&&(e=L(t.item(0)))}if(e){var n=W(e).createTextRange();n.select(),this.docSelection.empty()}}}catch(r){}d(this)},rt.addRange=function(t){this.docSelection.type==M?m(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,s(this,t,!1))},rt.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?N(this,e):t&&this.addRange(e[0])
}}rt.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new I("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var it;if(j)it=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=W(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==M?p(t):h(n)?g(t,n):d(t)};else if(x(V,"getRangeAt")&&typeof V.rangeCount==_)it=function(t){if(K&&U&&t.docSelection.type==M)p(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,r=t.rangeCount;r>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));
s(t,t._ranges[t.rangeCount-1],st(t.nativeSelection)),t.isCollapsed=O(t)}else d(t)};else{if(!q||typeof V.isCollapsed!=T||typeof z.collapsed!=T||!H.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;it=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=et(n,0),e._ranges=[t],e.rangeCount=1,c(e),e.isCollapsed=O(e)):d(e)}}rt.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,r=this.anchorOffset;if(it(this),e){var o=t.length;
if(o!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=r)return!0;for(;o--;)if(!k(t[o],this._ranges[o]))return!0;return!1}};var at=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var r=0,o=n.length;o>r;++r)k(t,n[r])||e.addRange(n[r]);e.rangeCount||d(e)};rt.removeRange=K?function(e){if(this.docSelection.type==M){for(var t,n=this.docSelection.createRange(),r=l(e),o=L(n.item(0)),i=W(o).createControlRange(),a=!1,s=0,c=n.length;c>s;++s)t=n.item(s),t!==r||a?i.add(n.item(s)):a=!0;
i.select(),p(this)}else at(this,e)}:function(e){at(this,e)};var st;!j&&q&&H.implementsDomRange?(st=a,rt.isBackward=function(){return st(this)}):st=rt.isBackward=function(){return!1},rt.isBackwards=rt.isBackward,rt.toString=function(){for(var e=[],t=0,n=this.rangeCount;n>t;++t)e[t]=""+this._ranges[t];return e.join("")},rt.collapse=function(t,n){E(this,t);var r=e.createRange(t);r.collapseToPoint(t,n),this.setSingleRange(r),this.isCollapsed=!0},rt.collapseToStart=function(){if(!this.rangeCount)throw new I("INVALID_STATE_ERR");
var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},rt.collapseToEnd=function(){if(!this.rangeCount)throw new I("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},rt.selectAllChildren=function(t){E(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},rt.deleteFromDocument=function(){if(K&&U&&this.docSelection.type==M){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),e.parentNode.removeChild(e);
this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var r=0,o=n.length;o>r;++r)n[r].deleteContents();this.addRange(n[o-1])}}},rt.eachRange=function(e,t){for(var n=0,r=this._ranges.length;r>n;++n)if(e(this.getRangeAt(n)))return t},rt.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},rt.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},rt.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(r){n.push(r[e].apply(r,t))
}),n},rt.setStart=S(!0),rt.setEnd=S(!1),e.rangePrototype.select=function(e){nt(this.getDocument()).setSingleRange(this,e)},rt.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},rt.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)},rt.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}
},rt.moveToBookmark=function(t){for(var n,r,o=[],i=0;n=t.rangeBookmarks[i++];)r=e.createRange(this.win),r.moveToBookmark(n),o.push(r);t.backward?this.setSingleRange(o[0],"backward"):this.setRanges(o)},rt.toHtml=function(){return this.callMethodOnEachRange("toHtml").join("")},rt.getName=function(){return"WrappedSelection"},rt.inspect=function(){return w(this)},rt.detach=function(){C(this.win,"delete"),v(this)},R.detachAll=function(){C(null,"deleteAll")},R.inspect=w,R.isDirectionBackward=n,e.Selection=R,e.selectionPrototype=rt,e.addCreateMissingNativeApiListener(function(e){"undefined"==typeof e.getSelection&&(e.getSelection=function(){return nt(e)
}),e=null})}),n.exports.rangy=rangy});
;define("ydcore:widget/ui/book_view/lib/rangy/rangy-cssclassapplier.js",function(e,t,n){var r=e("ydcore:widget/ui/book_view/lib/rangy/rangy-core.js").rangy;r.createModule("ClassApplier",["WrappedSelection"],function(e,t){function n(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(n,e[n])===!1)return!1;return!0}function r(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function i(e,t){return e.className&&new RegExp("(?:^|\\s)"+t+"(?:\\s|$)").test(e.className)}function s(e,t){e.className?i(e,t)||(e.className+=" "+t):e.className=t
}function o(e){return e.split(/\s+/).sort().join(" ")}function a(e){return o(e.className)}function l(e,t){return a(e)==a(t)}function d(e,t,n,r,i){var s=e.node,o=e.offset,a=s,l=o;s==r&&o>i&&++l,s!=t||o!=n&&o!=n+1||(a=r,l+=i-n),s==t&&o>n+1&&--l,e.node=a,e.offset=l}function u(e,t,n){e.node==t&&e.offset>n&&--e.offset}function f(e,t,n,r){-1==n&&(n=t.childNodes.length);for(var i,s=e.parentNode,o=M.getNodeIndex(e),a=0;i=r[a++];)d(i,s,o,t,n);t.childNodes.length==n?t.appendChild(e):t.insertBefore(e,t.childNodes[n])
}function p(e,t){for(var n,r=e.parentNode,i=M.getNodeIndex(e),s=0;n=t[s++];)u(n,r,i);e.parentNode.removeChild(e)}function c(e,t,n,r,i){for(var s,o=[];s=e.firstChild;)f(s,t,n++,i),o.push(s);return r&&e.parentNode.removeChild(e),o}function h(e,t){return c(e,e.parentNode,M.getNodeIndex(e),!0,t)}function g(e,t){var n=e.cloneRange();n.selectNodeContents(t);var r=n.intersection(e),i=r?r.toString():"";return n.detach(),""!=i}function m(e){for(var t,n=e.getNodes([3]),r=0;(t=n[r])&&!g(e,t);)++r;for(var i=n.length-1;(t=n[i])&&!g(e,t);)--i;
return n.slice(r,i+1)}function N(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n,r,i,s=0,o=e.attributes.length;o>s;++s)if(n=e.attributes[s],i=n.name,"class"!=i){if(r=t.attributes.getNamedItem(i),null===n!=(null===r))return!1;if(n.specified!=r.specified)return!1;if(n.specified&&n.nodeValue!==r.nodeValue)return!1}return!0}function v(e,t){for(var n,r=0,i=e.attributes.length;i>r;++r)if(n=e.attributes[r].name,(!t||!L(t,n))&&e.attributes[r].specified&&"class"!=n)return!0;return!1}function y(e,t){return n(t,function(t,n){if("object"==typeof n){if(!y(e[t],n))return!1
}else if(e[t]!==n)return!1}),!0}function C(e){var t;return e&&1==e.nodeType&&((t=e.parentNode)&&9==t.nodeType&&"on"==t.designMode||$(e)&&!$(e.parentNode))}function T(e){return($(e)||1!=e.nodeType&&$(e.parentNode))&&!C(e)}function E(e){return e&&1==e.nodeType&&!k.test(D(e,"display"))}function b(e){if(0==e.data.length)return!0;if(H.test(e.data))return!1;var t=D(e.parentNode,"whiteSpace");switch(t){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(e.data))return!1
}return E(e.previousSibling)||E(e.nextSibling)}function A(e){var t,n,r=[];for(t=0;n=e[t++];)r.push(new j(n.startContainer,n.startOffset),new j(n.endContainer,n.endOffset));return r}function S(e,t){for(var n,r,i,s=0,o=e.length;o>s;++s)n=e[s],r=t[2*s],i=t[2*s+1],n.setStartAndEnd(r.node,r.offset,i.node,i.offset)}function x(e,t){return M.isCharacterDataNode(e)?0==t?!!e.previousSibling:t==e.length?!!e.nextSibling:!0:t>0&&t<e.childNodes.length}function R(e,n,r,i){var s,o,a=0==r;if(M.isAncestorOf(n,e))return e;
if(M.isCharacterDataNode(n)){var l=M.getNodeIndex(n);if(0==r)r=l;else{if(r!=n.length)throw t.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+r+" in "+n.data);r=l+1}n=n.parentNode}if(x(n,r)){s=n.cloneNode(!1),o=n.parentNode,s.id&&s.removeAttribute("id");for(var d,u=0;d=n.childNodes[r];)f(d,s,u++,i);return f(s,o,M.getNodeIndex(n)+1,i),n==e?s:R(e,o,M.getNodeIndex(s),i)}if(e!=n){s=n.parentNode;var p=M.getNodeIndex(n);return a||p++,R(e,s,p,i)}return e}function w(e,t){return e.tagName==t.tagName&&l(e,t)&&N(e,t)&&"inline"==D(e,"display")&&"inline"==D(t,"display")
}function P(e){var t=e?"nextSibling":"previousSibling";return function(n,r){var i=n.parentNode,s=n[t];if(s){if(s&&3==s.nodeType)return s}else if(r&&(s=i[t],s&&1==s.nodeType&&w(i,s))){var o=s[e?"firstChild":"lastChild"];if(o&&3==o.nodeType)return o}return null}}function O(e){this.isElementMerge=1==e.nodeType,this.textNodes=[];var t=this.isElementMerge?e.lastChild:e;t&&(this.textNodes[0]=t)}function W(e,t,i){var s,o,a,l,d=this;d.cssClass=e;var u=null,f={};if("object"==typeof t&&null!==t){for(i=t.tagNames,u=t.elementProperties,f=t.elementAttributes,o=0;l=q[o++];)t.hasOwnProperty(l)&&(d[l]=t[l]);
s=t.normalize}else s=t;d.normalize="undefined"==typeof s?!0:s,d.attrExceptions=[];var p=document.createElement(d.elementTagName);d.elementProperties=d.copyPropertiesToElement(u,p,!0),n(f,function(e){d.attrExceptions.push(e)}),d.elementAttributes=f,d.elementSortedClassName=d.elementProperties.hasOwnProperty("className")?d.elementProperties.className:e,d.applyToAnyTagName=!1;var c=typeof i;if("string"==c)"*"==i?d.applyToAnyTagName=!0:d.tagNames=r(i.toLowerCase()).split(/\s*,\s*/);else if("object"==c&&"number"==typeof i.length)for(d.tagNames=[],o=0,a=i.length;a>o;++o)"*"==i[o]?d.applyToAnyTagName=!0:d.tagNames.push(i[o].toLowerCase());
else d.tagNames=[d.elementTagName]}function I(e,t,n){return new W(e,t,n)}var M=e.dom,j=M.DomPosition,L=M.arrayContains,z="span",B=function(){function e(e,t,n){return t&&n?" ":""}return function(t,n){t.className&&(t.className=t.className.replace(new RegExp("(^|\\s)"+n+"(\\s|$)"),e))}}(),D=M.getComputedStyleProperty,$=function(){var e=document.createElement("div");return"boolean"==typeof e.isContentEditable?function(e){return e&&1==e.nodeType&&e.isContentEditable}:function(e){return e&&1==e.nodeType&&"false"!=e.contentEditable?"true"==e.contentEditable||$(e.parentNode):!1
}}(),k=/^inline(-block|-table)?$/i,H=/[^\r\n\t\f \u200B]/,V=P(!1),_=P(!0);O.prototype={doMerge:function(e){var t=this.textNodes,n=t[0];if(t.length>1){for(var r,i,s,o,a=[],l=0,d=0,u=t.length;u>d;++d){if(r=t[d],i=r.parentNode,d>0&&(i.removeChild(r),i.hasChildNodes()||i.parentNode.removeChild(i),e))for(s=0;o=e[s++];)o.node==r&&(o.node=n,o.offset+=l);a[d]=r.data,l+=r.data.length}n.data=a.join("")}return n.data},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;
return t},toString:function(){for(var e=[],t=0,n=this.textNodes.length;n>t;++t)e[t]="'"+this.textNodes[t].data+"'";return"[Merge("+e.join(",")+")]"}};var q=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],F={};W.prototype={elementTagName:z,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(e,t,n){var r,i,a,l,d,u,f={};
for(var p in e)if(e.hasOwnProperty(p))if(l=e[p],d=t[p],"className"==p)s(t,l),s(t,this.cssClass),t[p]=o(t[p]),n&&(f[p]=t[p]);else if("style"==p){i=d,n&&(f[p]=a={});for(r in e[p])i[r]=l[r],n&&(a[r]=i[r]);this.attrExceptions.push(p)}else t[p]=l,n&&(f[p]=t[p],u=F.hasOwnProperty(p)?F[p]:p,this.attrExceptions.push(u));return n?f:""},copyAttributesToElement:function(e,t){for(var n in e)e.hasOwnProperty(n)&&t.setAttribute(n,e[n])},hasClass:function(e){return 1==e.nodeType&&L(this.tagNames,e.tagName.toLowerCase())&&i(e,this.cssClass)
},getSelfOrAncestorWithClass:function(e){for(;e;){if(this.hasClass(e))return e;e=e.parentNode}return null},isModifiable:function(e){return!this.applyToEditableOnly||T(e)},isIgnorableWhiteSpaceNode:function(e){return this.ignoreWhiteSpace&&e&&3==e.nodeType&&b(e)},postApply:function(e,t,n,r){for(var i,s,o,a=e[0],l=e[e.length-1],d=[],u=a,f=l,p=0,c=l.length,h=0,g=e.length;g>h;++h)s=e[h],o=V(s,!r),o?(i||(i=new O(o),d.push(i)),i.textNodes.push(s),s===a&&(u=i.textNodes[0],p=u.length),s===l&&(f=i.textNodes[0],c=i.getLength())):i=null;
var m=_(l,!r);if(m&&(i||(i=new O(l),d.push(i)),i.textNodes.push(m)),d.length){for(h=0,g=d.length;g>h;++h)d[h].doMerge(n);t.setStartAndEnd(u,p,f,c)}},createContainer:function(e){var t=e.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,t,!1),this.copyAttributesToElement(this.elementAttributes,t),s(t,this.cssClass),this.onElementCreate&&this.onElementCreate(t,this),t},applyToTextNode:function(e){var t=e.parentNode;if(1==t.childNodes.length&&this.useExistingElements&&L(this.tagNames,t.tagName.toLowerCase())&&y(t,this.elementProperties))s(t,this.cssClass);
else{var n=this.createContainer(M.getDocument(e));e.parentNode.insertBefore(n,e),n.appendChild(e)}},isRemovable:function(e){return e.tagName.toLowerCase()==this.elementTagName&&a(e)==this.elementSortedClassName&&y(e,this.elementProperties)&&!v(e,this.attrExceptions)&&this.isModifiable(e)},isEmptyContainer:function(e){var t=e.childNodes.length;return 1==e.nodeType&&this.isRemovable(e)&&(0==t||1==t&&this.isEmptyContainer(e.firstChild))},removeEmptyContainers:function(e){for(var t,n=this,r=e.getNodes([1],function(e){return n.isEmptyContainer(e)
}),i=[e],s=A(i),o=0;t=r[o++];)p(t,s);S(i,s)},undoToTextNode:function(e,t,n,r){if(!t.containsNode(n)){var i=t.cloneRange();i.selectNode(n),i.isPointInRange(t.endContainer,t.endOffset)&&(R(n,t.endContainer,t.endOffset,r),t.setEndAfter(n)),i.isPointInRange(t.startContainer,t.startOffset)&&(n=R(n,t.startContainer,t.startOffset,r))}this.isRemovable(n)?h(n,r):B(n,this.cssClass)},applyToRange:function(e,t){t=t||[];var n=A(t||[]);e.splitBoundariesPreservingPositions(n),this.removeEmptyElements&&this.removeEmptyContainers(e);
var r=m(e);if(r.length){for(var i,s=0;i=r[s++];)this.isIgnorableWhiteSpaceNode(i)||this.getSelfOrAncestorWithClass(i)||!this.isModifiable(i)||this.applyToTextNode(i,n);i=r[r.length-1],e.setStartAndEnd(r[0],0,i,i.length),this.normalize&&this.postApply(r,e,n,!1),S(t,n)}},applyToRanges:function(e){for(var t=e.length;t--;)this.applyToRange(e[t],e);return e},applyToSelection:function(t){var n=e.getSelection(t);n.setRanges(this.applyToRanges(n.getAllRanges()))},undoToRange:function(e,t){t=t||[];var n=A(t);
e.splitBoundariesPreservingPositions(n),this.removeEmptyElements&&this.removeEmptyContainers(e,n);var r,i,s=m(e),o=s[s.length-1];if(s.length){for(var a=0,l=s.length;l>a;++a)r=s[a],i=this.getSelfOrAncestorWithClass(r),i&&this.isModifiable(r)&&this.undoToTextNode(r,e,i,n),e.setStartAndEnd(s[0],0,o,o.length);this.normalize&&this.postApply(s,e,n,!0),S(t,n)}},undoToRanges:function(e){for(var t=e.length;t--;)this.undoToRange(e[t],e);return e},undoToSelection:function(t){var n=e.getSelection(t),r=e.getSelection(t).getAllRanges();
this.undoToRanges(r),n.setRanges(r)},isAppliedToRange:function(e){if(e.collapsed||""==e.toString())return!!this.getSelfOrAncestorWithClass(e.commonAncestorContainer);var t=e.getNodes([3]);if(t.length)for(var n,r=0;n=t[r++];)if(!this.isIgnorableWhiteSpaceNode(n)&&g(e,n)&&this.isModifiable(n)&&!this.getSelfOrAncestorWithClass(n))return!1;return!0},isAppliedToRanges:function(e){var t=e.length;if(0==t)return!1;for(;t--;)if(!this.isAppliedToRange(e[t]))return!1;return!0},isAppliedToSelection:function(t){var n=e.getSelection(t);
return this.isAppliedToRanges(n.getAllRanges())},toggleRange:function(e){this.isAppliedToRange(e)?this.undoToRange(e):this.applyToRange(e)},toggleSelection:function(e){this.isAppliedToSelection(e)?this.undoToSelection(e):this.applyToSelection(e)},getElementsWithClassIntersectingRange:function(e){var t=[],n=this;return e.getNodes([3],function(e){var r=n.getSelfOrAncestorWithClass(e);r&&!L(t,r)&&t.push(r)}),t},detach:function(){}},W.util={hasClass:i,addClass:s,removeClass:B,hasSameClasses:l,replaceWithOwnChildren:h,elementsHaveSameNonClassAttributes:N,elementHasNonClassAttributes:v,splitNodeAt:R,isEditableElement:$,isEditingHost:C,isEditable:T},e.CssClassApplier=e.ClassApplier=W,e.createCssClassApplier=e.createClassApplier=I
}),n.exports.rangy=r});
;define("ydcore:widget/ui/book_view/lib/rangy/rangy.js",function(i,r,e){var n=i("ydcore:widget/ui/book_view/lib/rangy/rangy-cssclassapplier.js").rangy;n.init(),e.exports.rangy=n});
;define("ydcore:widget/ui/book_view/lib/ZeroClipboard/ZeroClipboard.js",function(e,t,i){var s={version:"1.0.7",clients:{},moviePath:"ZeroClipboard.swf",nextId:1,$:function(e){return"string"==typeof e&&(e=document.getElementById(e)),e.addClass||(e.hide=function(){this.style.display="none"},e.show=function(){this.style.display=""},e.addClass=function(e){this.removeClass(e),this.className+=" "+e},e.removeClass=function(e){for(var t=this.className.split(/\s+/),i=-1,s=0;s<t.length;s++)t[s]==e&&(i=s,s=t.length);
return i>-1&&(t.splice(i,1),this.className=t.join(" ")),this},e.hasClass=function(e){return!!this.className.match(new RegExp("\\s*"+e+"\\s*"))}),e},setMoviePath:function(e){this.moviePath=e},dispatch:function(e,t,i){var s=this.clients[e];s&&s.receiveEvent(t,i)},register:function(e,t){this.clients[e]=t},getDOMObjectPosition:function(e,t){for(var i={left:0,top:0,width:e.width?e.width:e.offsetWidth,height:e.height?e.height:e.offsetHeight};e&&e!=t;)i.left+=e.offsetLeft,i.top+=e.offsetTop,e=e.offsetParent;
return i},Client:function(e){this.handlers={},this.id=s.nextId++,this.movieId="ZeroClipboardMovie_"+this.id,s.register(this.id,this),e&&this.glue(e)}};s.Client.prototype={id:0,ready:!1,movie:null,clipText:"",handCursorEnabled:!0,cssEffects:!0,handlers:null,disabled:!1,glue:function(e,t,i){this.domElement=s.$(e);var o=99;this.domElement.style.zIndex&&(o=parseInt(this.domElement.style.zIndex,10)+1),"string"==typeof t?t=s.$(t):"undefined"==typeof t&&(t=document.getElementsByTagName("body")[0]);var a=s.getDOMObjectPosition(this.domElement,t);
this.div=document.createElement("div");var n=this.div.style;if(n.position="absolute",n.left=""+a.left+"px",n.top=""+a.top+"px",n.width=""+a.width+"px",n.height=""+a.height+"px",n.zIndex=o,"object"==typeof i)for(addedStyle in i)n[addedStyle]=i[addedStyle];t.appendChild(this.div),this.div.innerHTML=this.getHTML(a.width,a.height)},getHTML:function(e,t){var i="",o="id="+this.id+"&width="+e+"&height="+t;if(navigator.userAgent.match(/MSIE/)){var a=location.href.match(/^https/i)?"https://":"http://";i+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+a+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+e+'" height="'+t+'" id="'+this.movieId+'" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+s.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+o+'"/><param name="wmode" value="transparent"/></object>'
}else i+='<embed id="'+this.movieId+'" src="'+s.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+e+'" height="'+t+'" name="'+this.movieId+'" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+o+'" wmode="transparent" />';return i},getDOM:function(){return this.div},hide:function(){this.div&&(this.div.style.left="-2000px")},show:function(){this.reposition()
},destroy:function(){if(this.domElement&&this.div){this.hide(),this.div.innerHTML="";var e=document.getElementsByTagName("body")[0];try{e.removeChild(this.div)}catch(t){}this.domElement=null,this.div=null}},reposition:function(e){if(e&&(this.domElement=s.$(e),this.domElement||this.hide()),this.domElement&&this.div){var t=s.getDOMObjectPosition(this.domElement),i=this.div.style;i.left=""+t.left+"px",i.top=""+t.top+"px"}},setText:function(e){this.clipText=e,console.log("newText",this.clipText),this.ready&&this.movie.setText(e),console.log("this.move.setText",this.movie.setText)
},addEventListener:function(e,t){e=e.toString().toLowerCase().replace(/^on/,""),this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(t)},setHandCursor:function(e){this.handCursorEnabled=e,this.ready&&this.movie.setHandCursor(e)},setCSSEffects:function(e){this.cssEffects=!!e},setDisabled:function(e){this.disabled=e},receiveEvent:function(e,t){switch(e=e.toString().toLowerCase().replace(/^on/,"")){case"load":if(this.movie=document.getElementById(this.movieId),!this.movie){var i=this;return void setTimeout(function(){i.receiveEvent("load",null)
},1)}if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/)){var i=this;return setTimeout(function(){i.receiveEvent("load",null)},100),void(this.ready=!0)}this.ready=!0,this.movie.setText(this.clipText),this.movie.setHandCursor(this.handCursorEnabled);break;case"mouseover":this.domElement&&this.cssEffects&&(this.domElement.addClass("hover"),this.recoverActive&&this.domElement.addClass("active"));break;case"mouseout":this.domElement&&this.cssEffects&&(this.recoverActive=!1,this.domElement.hasClass("active")&&(this.domElement.removeClass("active"),this.recoverActive=!0),this.domElement.removeClass("hover"));
break;case"mousedown":this.domElement&&this.cssEffects&&this.domElement.addClass("active");break;case"mouseup":this.domElement&&this.cssEffects&&(this.domElement.removeClass("active"),this.recoverActive=!1)}if(this.handlers[e])for(var s=0,o=this.handlers[e].length;o>s;s++){var a=this.handlers[e][s];"function"==typeof a?a(this,t):"object"==typeof a&&2==a.length?a[0][a[1]](this,t):"string"==typeof a&&window[a](this,t)}}},i.exports.ZeroClipboard=s});
;define("ydcore:widget/ui/book_view/lib/underscore/underscore.js",function(n,t,r){(function(){var n=this,t=n._,e=Array.prototype,u=Object.prototype,i=Function.prototype,a=e.push,o=e.slice,l=e.concat,c=u.toString,f=u.hasOwnProperty,s=Array.isArray,p=Object.keys,h=i.bind,g=function(n){return n instanceof g?n:this instanceof g?void(this._wrapped=n):new g(n)};"undefined"!=typeof r.exports?r.exports._=g:n._=g,g.VERSION="1.7.0";var v=function(n,t,r){if(void 0===t)return n;switch(null==r?3:r){case 1:return function(r){return n.call(t,r)
};case 2:return function(r,e){return n.call(t,r,e)};case 3:return function(r,e,u){return n.call(t,r,e,u)};case 4:return function(r,e,u,i){return n.call(t,r,e,u,i)}}return function(){return n.apply(t,arguments)}};g.iteratee=function(n,t,r){return null==n?g.identity:g.isFunction(n)?v(n,t,r):g.isObject(n)?g.matches(n):g.property(n)},g.each=g.forEach=function(n,t,r){if(null==n)return n;t=v(t,r);var e,u=n.length;if(u===+u)for(e=0;u>e;e++)t(n[e],e,n);else{var i=g.keys(n);for(e=0,u=i.length;u>e;e++)t(n[i[e]],i[e],n)
}return n},g.map=g.collect=function(n,t,r){if(null==n)return[];t=g.iteratee(t,r);for(var e,u=n.length!==+n.length&&g.keys(n),i=(u||n).length,a=Array(i),o=0;i>o;o++)e=u?u[o]:o,a[o]=t(n[e],e,n);return a};var m="Reduce of empty array with no initial value";g.reduce=g.foldl=g.inject=function(n,t,r,e){null==n&&(n=[]),t=v(t,e,4);var u,i=n.length!==+n.length&&g.keys(n),a=(i||n).length,o=0;if(arguments.length<3){if(!a)throw new TypeError(m);r=n[i?i[o++]:o++]}for(;a>o;o++)u=i?i[o]:o,r=t(r,n[u],u,n);return r
},g.reduceRight=g.foldr=function(n,t,r,e){null==n&&(n=[]),t=v(t,e,4);var u,i=n.length!==+n.length&&g.keys(n),a=(i||n).length;if(arguments.length<3){if(!a)throw new TypeError(m);r=n[i?i[--a]:--a]}for(;a--;)u=i?i[a]:a,r=t(r,n[u],u,n);return r},g.find=g.detect=function(n,t,r){var e;return t=g.iteratee(t,r),g.some(n,function(n,r,u){return t(n,r,u)?(e=n,!0):void 0}),e},g.filter=g.select=function(n,t,r){var e=[];return null==n?e:(t=g.iteratee(t,r),g.each(n,function(n,r,u){t(n,r,u)&&e.push(n)}),e)},g.reject=function(n,t,r){return g.filter(n,g.negate(g.iteratee(t)),r)
},g.every=g.all=function(n,t,r){if(null==n)return!0;t=g.iteratee(t,r);var e,u,i=n.length!==+n.length&&g.keys(n),a=(i||n).length;for(e=0;a>e;e++)if(u=i?i[e]:e,!t(n[u],u,n))return!1;return!0},g.some=g.any=function(n,t,r){if(null==n)return!1;t=g.iteratee(t,r);var e,u,i=n.length!==+n.length&&g.keys(n),a=(i||n).length;for(e=0;a>e;e++)if(u=i?i[e]:e,t(n[u],u,n))return!0;return!1},g.contains=g.include=function(n,t){return null==n?!1:(n.length!==+n.length&&(n=g.values(n)),g.indexOf(n,t)>=0)},g.invoke=function(n,t){var r=o.call(arguments,2),e=g.isFunction(t);
return g.map(n,function(n){return(e?t:n[t]).apply(n,r)})},g.pluck=function(n,t){return g.map(n,g.property(t))},g.where=function(n,t){return g.filter(n,g.matches(t))},g.findWhere=function(n,t){return g.find(n,g.matches(t))},g.max=function(n,t,r){var e,u,i=-1/0,a=-1/0;if(null==t&&null!=n){n=n.length===+n.length?n:g.values(n);for(var o=0,l=n.length;l>o;o++)e=n[o],e>i&&(i=e)}else t=g.iteratee(t,r),g.each(n,function(n,r,e){u=t(n,r,e),(u>a||u===-1/0&&i===-1/0)&&(i=n,a=u)});return i},g.min=function(n,t,r){var e,u,i=1/0,a=1/0;
if(null==t&&null!=n){n=n.length===+n.length?n:g.values(n);for(var o=0,l=n.length;l>o;o++)e=n[o],i>e&&(i=e)}else t=g.iteratee(t,r),g.each(n,function(n,r,e){u=t(n,r,e),(a>u||1/0===u&&1/0===i)&&(i=n,a=u)});return i},g.shuffle=function(n){for(var t,r=n&&n.length===+n.length?n:g.values(n),e=r.length,u=Array(e),i=0;e>i;i++)t=g.random(0,i),t!==i&&(u[i]=u[t]),u[t]=r[i];return u},g.sample=function(n,t,r){return null==t||r?(n.length!==+n.length&&(n=g.values(n)),n[g.random(n.length-1)]):g.shuffle(n).slice(0,Math.max(0,t))
},g.sortBy=function(n,t,r){return t=g.iteratee(t,r),g.pluck(g.map(n,function(n,r,e){return{value:n,index:r,criteria:t(n,r,e)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||void 0===r)return 1;if(e>r||void 0===e)return-1}return n.index-t.index}),"value")};var y=function(n){return function(t,r,e){var u={};return r=g.iteratee(r,e),g.each(t,function(e,i){var a=r(e,i,t);n(u,e,a)}),u}};g.groupBy=y(function(n,t,r){g.has(n,r)?n[r].push(t):n[r]=[t]}),g.indexBy=y(function(n,t,r){n[r]=t
}),g.countBy=y(function(n,t,r){g.has(n,r)?n[r]++:n[r]=1}),g.sortedIndex=function(n,t,r,e){r=g.iteratee(r,e,1);for(var u=r(t),i=0,a=n.length;a>i;){var o=i+a>>>1;r(n[o])<u?i=o+1:a=o}return i},g.toArray=function(n){return n?g.isArray(n)?o.call(n):n.length===+n.length?g.map(n,g.identity):g.values(n):[]},g.size=function(n){return null==n?0:n.length===+n.length?n.length:g.keys(n).length},g.partition=function(n,t,r){t=g.iteratee(t,r);var e=[],u=[];return g.each(n,function(n,r,i){(t(n,r,i)?e:u).push(n)}),[e,u]
},g.first=g.head=g.take=function(n,t,r){return null==n?void 0:null==t||r?n[0]:0>t?[]:o.call(n,0,t)},g.initial=function(n,t,r){return o.call(n,0,Math.max(0,n.length-(null==t||r?1:t)))},g.last=function(n,t,r){return null==n?void 0:null==t||r?n[n.length-1]:o.call(n,Math.max(n.length-t,0))},g.rest=g.tail=g.drop=function(n,t,r){return o.call(n,null==t||r?1:t)},g.compact=function(n){return g.filter(n,g.identity)};var d=function(n,t,r,e){if(t&&g.every(n,g.isArray))return l.apply(e,n);for(var u=0,i=n.length;i>u;u++){var o=n[u];
g.isArray(o)||g.isArguments(o)?t?a.apply(e,o):d(o,t,r,e):r||e.push(o)}return e};g.flatten=function(n,t){return d(n,t,!1,[])},g.without=function(n){return g.difference(n,o.call(arguments,1))},g.uniq=g.unique=function(n,t,r,e){if(null==n)return[];g.isBoolean(t)||(e=r,r=t,t=!1),null!=r&&(r=g.iteratee(r,e));for(var u=[],i=[],a=0,o=n.length;o>a;a++){var l=n[a];if(t)a&&i===l||u.push(l),i=l;else if(r){var c=r(l,a,n);g.indexOf(i,c)<0&&(i.push(c),u.push(l))}else g.indexOf(u,l)<0&&u.push(l)}return u},g.union=function(){return g.uniq(d(arguments,!0,!0,[]))
},g.intersection=function(n){if(null==n)return[];for(var t=[],r=arguments.length,e=0,u=n.length;u>e;e++){var i=n[e];if(!g.contains(t,i)){for(var a=1;r>a&&g.contains(arguments[a],i);a++);a===r&&t.push(i)}}return t},g.difference=function(n){var t=d(o.call(arguments,1),!0,!0,[]);return g.filter(n,function(n){return!g.contains(t,n)})},g.zip=function(n){if(null==n)return[];for(var t=g.max(arguments,"length").length,r=Array(t),e=0;t>e;e++)r[e]=g.pluck(arguments,e);return r},g.object=function(n,t){if(null==n)return{};
for(var r={},e=0,u=n.length;u>e;e++)t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];return r},g.indexOf=function(n,t,r){if(null==n)return-1;var e=0,u=n.length;if(r){if("number"!=typeof r)return e=g.sortedIndex(n,t),n[e]===t?e:-1;e=0>r?Math.max(0,u+r):r}for(;u>e;e++)if(n[e]===t)return e;return-1},g.lastIndexOf=function(n,t,r){if(null==n)return-1;var e=n.length;for("number"==typeof r&&(e=0>r?e+r+1:Math.min(e,r+1));--e>=0;)if(n[e]===t)return e;return-1},g.range=function(n,t,r){arguments.length<=1&&(t=n||0,n=0),r=r||1;
for(var e=Math.max(Math.ceil((t-n)/r),0),u=Array(e),i=0;e>i;i++,n+=r)u[i]=n;return u};var b=function(){};g.bind=function(n,t){var r,e;if(h&&n.bind===h)return h.apply(n,o.call(arguments,1));if(!g.isFunction(n))throw new TypeError("Bind must be called on a function");return r=o.call(arguments,2),e=function(){if(!(this instanceof e))return n.apply(t,r.concat(o.call(arguments)));b.prototype=n.prototype;var u=new b;b.prototype=null;var i=n.apply(u,r.concat(o.call(arguments)));return g.isObject(i)?i:u}
},g.partial=function(n){var t=o.call(arguments,1);return function(){for(var r=0,e=t.slice(),u=0,i=e.length;i>u;u++)e[u]===g&&(e[u]=arguments[r++]);for(;r<arguments.length;)e.push(arguments[r++]);return n.apply(this,e)}},g.bindAll=function(n){var t,r,e=arguments.length;if(1>=e)throw new Error("bindAll must be passed function names");for(t=1;e>t;t++)r=arguments[t],n[r]=g.bind(n[r],n);return n},g.memoize=function(n,t){var r=function(e){var u=r.cache,i=t?t.apply(this,arguments):e;return g.has(u,i)||(u[i]=n.apply(this,arguments)),u[i]
};return r.cache={},r},g.delay=function(n,t){var r=o.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},g.defer=function(n){return g.delay.apply(g,[n,1].concat(o.call(arguments,1)))},g.throttle=function(n,t,r){var e,u,i,a=null,o=0;r||(r={});var l=function(){o=r.leading===!1?0:g.now(),a=null,i=n.apply(e,u),a||(e=u=null)};return function(){var c=g.now();o||r.leading!==!1||(o=c);var f=t-(c-o);return e=this,u=arguments,0>=f||f>t?(clearTimeout(a),a=null,o=c,i=n.apply(e,u),a||(e=u=null)):a||r.trailing===!1||(a=setTimeout(l,f)),i
}},g.debounce=function(n,t,r){var e,u,i,a,o,l=function(){var c=g.now()-a;t>c&&c>0?e=setTimeout(l,t-c):(e=null,r||(o=n.apply(i,u),e||(i=u=null)))};return function(){i=this,u=arguments,a=g.now();var c=r&&!e;return e||(e=setTimeout(l,t)),c&&(o=n.apply(i,u),i=u=null),o}},g.wrap=function(n,t){return g.partial(t,n)},g.negate=function(n){return function(){return!n.apply(this,arguments)}},g.compose=function(){var n=arguments,t=n.length-1;return function(){for(var r=t,e=n[t].apply(this,arguments);r--;)e=n[r].call(this,e);
return e}},g.after=function(n,t){return function(){return--n<1?t.apply(this,arguments):void 0}},g.before=function(n,t){var r;return function(){return--n>0?r=t.apply(this,arguments):t=null,r}},g.once=g.partial(g.before,2),g.keys=function(n){if(!g.isObject(n))return[];if(p)return p(n);var t=[];for(var r in n)g.has(n,r)&&t.push(r);return t},g.values=function(n){for(var t=g.keys(n),r=t.length,e=Array(r),u=0;r>u;u++)e[u]=n[t[u]];return e},g.pairs=function(n){for(var t=g.keys(n),r=t.length,e=Array(r),u=0;r>u;u++)e[u]=[t[u],n[t[u]]];
return e},g.invert=function(n){for(var t={},r=g.keys(n),e=0,u=r.length;u>e;e++)t[n[r[e]]]=r[e];return t},g.functions=g.methods=function(n){var t=[];for(var r in n)g.isFunction(n[r])&&t.push(r);return t.sort()},g.extend=function(n){if(!g.isObject(n))return n;for(var t,r,e=1,u=arguments.length;u>e;e++){t=arguments[e];for(r in t)f.call(t,r)&&(n[r]=t[r])}return n},g.pick=function(n,t,r){var e,u={};if(null==n)return u;if(g.isFunction(t)){t=v(t,r);for(e in n){var i=n[e];t(i,e,n)&&(u[e]=i)}}else{var a=l.apply([],o.call(arguments,1));
n=new Object(n);for(var c=0,f=a.length;f>c;c++)e=a[c],e in n&&(u[e]=n[e])}return u},g.omit=function(n,t,r){if(g.isFunction(t))t=g.negate(t);else{var e=g.map(l.apply([],o.call(arguments,1)),String);t=function(n,t){return!g.contains(e,t)}}return g.pick(n,t,r)},g.defaults=function(n){if(!g.isObject(n))return n;for(var t=1,r=arguments.length;r>t;t++){var e=arguments[t];for(var u in e)void 0===n[u]&&(n[u]=e[u])}return n},g.clone=function(n){return g.isObject(n)?g.isArray(n)?n.slice():g.extend({},n):n},g.tap=function(n,t){return t(n),n
};var _=function(n,t,r,e){if(n===t)return 0!==n||1/n===1/t;if(null==n||null==t)return n===t;n instanceof g&&(n=n._wrapped),t instanceof g&&(t=t._wrapped);var u=c.call(n);if(u!==c.call(t))return!1;switch(u){case"[object RegExp]":case"[object String]":return""+n==""+t;case"[object Number]":return+n!==+n?+t!==+t:0===+n?1/+n===1/t:+n===+t;case"[object Date]":case"[object Boolean]":return+n===+t}if("object"!=typeof n||"object"!=typeof t)return!1;for(var i=r.length;i--;)if(r[i]===n)return e[i]===t;var a=n.constructor,o=t.constructor;
if(a!==o&&"constructor"in n&&"constructor"in t&&!(g.isFunction(a)&&a instanceof a&&g.isFunction(o)&&o instanceof o))return!1;r.push(n),e.push(t);var l,f;if("[object Array]"===u){if(l=n.length,f=l===t.length)for(;l--&&(f=_(n[l],t[l],r,e)););}else{var s,p=g.keys(n);if(l=p.length,f=g.keys(t).length===l)for(;l--&&(s=p[l],f=g.has(t,s)&&_(n[s],t[s],r,e)););}return r.pop(),e.pop(),f};g.isEqual=function(n,t){return _(n,t,[],[])},g.isEmpty=function(n){if(null==n)return!0;if(g.isArray(n)||g.isString(n)||g.isArguments(n))return 0===n.length;
for(var t in n)if(g.has(n,t))return!1;return!0},g.isElement=function(n){return!(!n||1!==n.nodeType)},g.isArray=s||function(n){return"[object Array]"===c.call(n)},g.isObject=function(n){var t=typeof n;return"function"===t||"object"===t&&!!n},g.each(["Arguments","Function","String","Number","Date","RegExp"],function(n){g["is"+n]=function(t){return c.call(t)==="[object "+n+"]"}}),g.isArguments(arguments)||(g.isArguments=function(n){return g.has(n,"callee")}),"function"!=typeof/./&&(g.isFunction=function(n){return"function"==typeof n||!1
}),g.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},g.isNaN=function(n){return g.isNumber(n)&&n!==+n},g.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"===c.call(n)},g.isNull=function(n){return null===n},g.isUndefined=function(n){return void 0===n},g.has=function(n,t){return null!=n&&f.call(n,t)},g.noConflict=function(){return n._=t,this},g.identity=function(n){return n},g.constant=function(n){return function(){return n}},g.noop=function(){},g.property=function(n){return function(t){return t[n]
}},g.matches=function(n){var t=g.pairs(n),r=t.length;return function(n){if(null==n)return!r;n=new Object(n);for(var e=0;r>e;e++){var u=t[e],i=u[0];if(u[1]!==n[i]||!(i in n))return!1}return!0}},g.times=function(n,t,r){var e=Array(Math.max(0,n));t=v(t,r,1);for(var u=0;n>u;u++)e[u]=t(u);return e},g.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))},g.now=Date.now||function(){return(new Date).getTime()};var w={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},j=g.invert(w),x=function(n){var t=function(t){return n[t]
},r="(?:"+g.keys(n).join("|")+")",e=RegExp(r),u=RegExp(r,"g");return function(n){return n=null==n?"":""+n,e.test(n)?n.replace(u,t):n}};g.escape=x(w),g.unescape=x(j),g.result=function(n,t){if(null==n)return void 0;var r=n[t];return g.isFunction(r)?n[t]():r};var A=0;g.uniqueId=function(n){var t=++A+"";return n?n+t:t},g.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var k=/(.)^/,O={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},F=/\\|'|\r|\n|\u2028|\u2029/g,E=function(n){return"\\"+O[n]
};g.template=function(n,t,r){!t&&r&&(t=r),t=g.defaults({},t,g.templateSettings);var e=RegExp([(t.escape||k).source,(t.interpolate||k).source,(t.evaluate||k).source].join("|")+"|$","g"),u=0,i="__p+='";n.replace(e,function(t,r,e,a,o){return i+=n.slice(u,o).replace(F,E),u=o+t.length,r?i+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'":e?i+="'+\n((__t=("+e+"))==null?'':__t)+\n'":a&&(i+="';\n"+a+"\n__p+='"),t}),i+="';\n",t.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";
try{var a=new Function(t.variable||"obj","_",i)}catch(o){throw o.source=i,o}var l=function(n){return a.call(this,n,g)},c=t.variable||"obj";return l.source="function("+c+"){\n"+i+"}",l},g.chain=function(n){var t=g(n);return t._chain=!0,t};var S=function(n){return this._chain?g(n).chain():n};g.mixin=function(n){g.each(g.functions(n),function(t){var r=g[t]=n[t];g.prototype[t]=function(){var n=[this._wrapped];return a.apply(n,arguments),S.call(this,r.apply(g,n))}})},g.mixin(g),g.each(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=e[n];
g.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!==n&&"splice"!==n||0!==r.length||delete r[0],S.call(this,r)}}),g.each(["concat","join","slice"],function(n){var t=e[n];g.prototype[n]=function(){return S.call(this,t.apply(this._wrapped,arguments))}}),g.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return g})}).call(this)});