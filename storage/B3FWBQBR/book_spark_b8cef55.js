define("ydcore:widget/book_view/book_spark/book_spark.js",function(o,n,e){var i=o("ydcommon:widget/ui/lib/jquery/jquery.js"),t=(o("ydcommon:widget/ui/js_core/login/login.js").login,o("ydcommon:widget/ui/js_core/log/log.js")),s=(o("ydcommon:widget/ui/lib/url/url.js"),o("ydcommon:widget/lib/fis/data/data.js")),c=o("ydcommon:widget/ui/payCheck/payCheck.js");o("ydcommon:widget/ui/js_core/countdown/countdown.js");var d={init:function(o){var n=this,e=n.$el=i("#book-spark");n.$closeBtn=e.find(".close-btn"),n.$clockTips=e.find(".countdown-tips"),n.$timeMin2=e.find(".min-count2"),n.$timeSec1=e.find(".sec-count1"),n.$timeSec2=e.find(".sec-count2"),n.$buyBtn=e.find(".rush-to-buy"),n.docId=o.docId,n.token=o.token,n.rand=o.rand,n.payStart=new c({goods_type:2,goods_id:n.docId}),n.rand||(n.rand=Math.floor(51*Math.random())),n.waitTime=1e4,n.lastTime=3e5,n.slideTime=400,"number"==typeof window.__yueduSparkWaitTime__&&window.__yueduSparkWaitTime__>0&&(n.waitTime=window.__yueduSparkWaitTime__),n.$closeBtn.click(i.proxy(n._closeTips,n)),n.$buyBtn.click(i.proxy(n._buyBtnClick,n)),n.$el.find(".js-count-num").html(n.rand);
var t=s.get("is_self_pub")||!1,d=s.get("canGetBookFree"),a=["2d35a24cbb68a98270fefa15"];t&&-1===i.inArray(n.docId,a)||!d||setTimeout(function(){n._show()},n.waitTime)},_show:function(){var o=this,n=(new Date).getTime()+o.lastTime;window.__yueduSparkHide!==!0&&(o.$el.slideDown(o.slideTime,function(){o.$clockTips.countdown(n,function(o){var n=o.offset.minutes+"",e=o.offset.seconds<10?"0"+o.offset.seconds:""+o.offset.seconds;i(this).html(['<span class="clock-icon"></span>','<span class="remind-prefix">\u8fd8\u5269</span>','<span class="min-count2">'+n+"</span>",'<span class="minute">\u5206</span>','<span class="sec-count1">'+e+"</span>",'<span class="second">\u79d2</span>'].join(""))
}).on("finish.countdown",function(){o._closeTips()})}),t.xsend(2,"200060"))},_closeTips:function(o){var n=this;o&&o.preventDefault(),o&&t.xsend(2,"200061"),n.$clockTips.countdown("stop"),n.$el.slideUp(n.slideTime,function(){n.$el.remove()})},_buyBtnClick:function(o){var n=this;o.preventDefault(),t.xsend(2,"200062"),setTimeout(function(){i.ajax({url:"/goods/interface/promotionprice",type:"POST",data:{book_id:n.docId,token:n.token}}).done(function(o){1==o.data.set_promotion_book_price&&n.payStart.start({})
}).always(function(){n._closeTips()})},200)}};e.exports=d});