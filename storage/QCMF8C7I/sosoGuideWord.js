function sosoGuide(obj){return new sosoGuide.prototype.init(obj)}sosoGuide.prototype={init:function(obj){var defaultO={fixWidth:0,fixTop:0,fixLeft:0,container:$("#sosoGuide"),url:"http://soso.nipic.com/Home/GetOther"},opt=$.extend(defaultO,obj);this.opts=opt;var _t=this;this.id=("ht"+Math.random()).replace(".",""),this.requestedKey=[],this.submit=function(){$(".J_searchSubmit").click()},this.opts.container.on({focus:function(){var isReq=_t.isReqested.call(_t);_t.isOrigNull(_t.getInputVal())||(isReq?_t.show(isReq):setTimeout(function(){_t.reqData.call(_t,_t.show)},100))},keydown:function(){_t.beforeKeyDownVal=_t.getInputVal()},keyup:function(e){var keycode=e.which;if(38==keycode)return void(_t.isDataNull.call(_t)&&_t.updownSelect.call(_t,!0));if(40==keycode)return void(_t.isDataNull.call(_t)&&_t.updownSelect.call(_t,!1));var isReq=(_t.getInputVal(),_t.isReqested.call(_t));isReq?_t.show(isReq):_t.reqData.call(_t,_t.show)}}),$(document).on({"click.htsug":function(e){var target=$(e.target);target.closest(_t.opts.container).length>0||_t.hide(),target.closest($("#btsch")).length>0&&_t.hide()}})},constructor:sosoGuide,getPara:function(){return{q:$(this.opts.container).val()||"",page:1}},isReqested:function(){var _t=this,inputKey=_t.getInputVal(),result=!1;return $.each(_t.requestedKey,function(i,n){if(n.key==inputKey)return void(result=n.result)}),result},getInputVal:function(){return $.trim(this.opts.container.val())},isOrigNull:function(){return""==$.trim(this.getInputVal())},isDataNull:function(){return!!(this.reqLatestData&&this.reqLatestData.words&&this.reqLatestData.words.length)},reqData:function(callback){var _t=this,key=_t.getPara().q;$.ajax({url:_t.opts.url,dataType:"jsonp",cache:!0,data:_t.getPara()}).done(function(r){_t.requestedKey.push({key:key,result:r}),_t.reqLatestData=r,callback.call(_t,r)})},updownSelect:function(upDown){if(this.box&&this.box.find("li")){var $li=this.box.find("li"),$liOn=this.box.find(".item-hover"),length=$li.length;if($liOn&&(index=$liOn.index()),index==-1)this.origKey=this.opts.container.val(),index=upDown?length-1:0;else if(upDown)if(0==index){if(this.origKey)return $li.removeClass("item-hover"),void this.opts.container.val(this.origKey)}else index-=1;else if(index==length-1){if(this.origKey)return $li.removeClass("item-hover"),void this.opts.container.val(this.origKey)}else index+=1;if(index!=-1){var hoverDom=$li.eq(index);this.liHoverFunc(hoverDom),this.setInputVal(hoverDom.attr("key"))}}},isFirstInit:function(){return!($("#"+this.id).length>0)},show:function(r){var _t=this;if(_t.isFirstInit())_t.firstInitHtml(r);else{_t.showHtml(r);var pos=this.getPos();this.$box.css({width:pos.width+"px",top:pos.top+"px",left:pos.left+"px"})}},firstInitHtml:function(r){var pos=this.getPos(),$str=this.$box=$('<div class="htsug" id='+this.id+' style="display:none;z-index:15;height:auto;position:absolute;width:'+pos.width+"px;top:"+pos.top+"px;left:"+pos.left+'px;"><ul></ul></div>');this.box=$str.find("ul"),this.boxW=$str,$str.appendTo($("body"));var _t=this,liStr="#"+_t.id+" li";_t.showHtml(r),$(document).on("mouseover.htsughover",liStr,function(){_t.liHoverFunc($(this))}).on("mouseout.htsugout",liStr,function(){_t.liHoverFunc($(this),1)}).on("click.htsugclick",liStr,function(){_t.setInputVal($(this).attr("key")),_t.submit(),_t.hide()})},setInputVal:function(val){this.opts.container.val(val)},liHoverFunc:function($dom,out){$dom&&(out?$dom.removeClass("item-hover").siblings().removeClass("item-hover"):$dom.addClass("item-hover").siblings().removeClass("item-hover"))},getLiHtml:function(r){var str="";return r&&r.words.length&&$.each(r.words,function(i,n){var obj=n;str+='<li key="'+obj.Kw+'">'+obj.Kw+"</li>"}),str},showHtml:function(r){this.box?r&&r.words&&(r.words.length?this.boxW.show():this.boxW.hide(),this.box.html(this.getLiHtml(r))):this.firstInitHtml()},hide:function(){this.boxW&&this.boxW.hide()},setBoxCss:function(cssObj){this.boxW&&this.boxW.css(cssObj)},getPos:function(){var $input=this.opts.container.offset();return{width:this.opts.container.width()+15+this.opts.fixWidth,top:$input.top+this.opts.container.height()+1+this.opts.fixTop,left:$input.left+this.opts.fixLeft}}},sosoGuide.prototype.init.prototype=sosoGuide.prototype;