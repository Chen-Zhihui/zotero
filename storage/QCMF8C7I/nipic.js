!function(window){function ready(fn){readyBound||_bindReady(),isReady?fn.call(win,this):readyList.push(fn)}function _bindReady(){function domReady(){doc.removeEventListener(eventType,domReady,!1),fire()}function stateChange(){doc.readyState===COMPLETE&&(doc.detachEvent(eventType,stateChange),fire())}function readyScroll(){try{doScroll("left"),fire()}catch(ex){setTimeout(readyScroll,1)}}var doScroll=doc.documentElement.doScroll,eventType=doScroll?"onreadystatechange":"DOMContentLoaded",COMPLETE="complete",fire=function(){_fireReady()};if(readyBound=!0,doc.readyState===COMPLETE)return fire();doc.addEventListener?(doc.addEventListener(eventType,domReady,!1),win.addEventListener("load",fire,!1)):(doc.attachEvent(eventType,stateChange),win.attachEvent("onload",fire),win==win.top&&readyScroll())}function _fireReady(){if(!isReady&&(isReady=!0,readyList)){for(var fn,i=0;fn=readyList[i++];)fn.call(win,this);readyList=null}}function loadJS(url,callback){var script=doc.createElement("script"),scriptAttrs={type:"text/javascript",src:url,defer:"defer",async:!0,charset:"utf-8"};for(var property in scriptAttrs)script[property]=scriptAttrs[property];script.onload=script.onreadystatechange=function(){script.readyState&&"loaded"!==script.readyState&&"complete"!==script.readyState||(script.onload=script.onreadystatechange=null,callback&&"function"==typeof callback&&callback())},doc.getElementsByTagName("head")[0].appendChild(script)}function loadCSS(url,id,charset){var css=doc.createElement("link"),cssAttr={type:"text/css",rel:"stylesheet",href:url};for(var property in cssAttr)css[property]=cssAttr[property];id&&(css.id=id),charset&&(css.charset=charset);var head=doc.head||doc.getElementsByTagName("head")[0]||doc.documentElement,target=head.getElementsByTagName("script")[0]?head.getElementsByTagName("script")[0]:head.firstChild;return head.insertBefore(css,target),css}function extend(destination,source,override){void 0===override&&(override=!0);for(var property in source)!override&&property in destination||(destination[property]=source[property]);return destination}function getElement(selector,context){var idExpr=/^#([\w\-]*)$/,classExpr=/^\.([\w\-_]*)$/,tagExpr=/^[a-zA-Z]+$/,nameExpr=/^(?:\[name=)(\w*)(?:\])$/;if(selector.nodeType)return selector;if("string"==typeof selector){if(idExpr.test(selector))return document.getElementById(selector.match(idExpr)[1]);if(classExpr.test(selector)){for(var element,theClass=selector.match(classExpr)[1],hasClassName=new RegExp("(?:^|\\s)"+theClass+"(?:$|\\s)"),allElements=document.getElementsByTagName("*"),results=[],i=0;null!=(element=allElements[i]);i++){var elementClass=element.className;elementClass&&elementClass.indexOf(theClass)!=-1&&hasClassName.test(elementClass)&&results.push(element)}return results}if(tagExpr.test(selector))return document.getElementsByTagName(selector.match(tagExpr)[0]);if(nameExpr.test(selector))return document.getElementsByName(selector.match(nameExpr)[1])}return null}function getScrollTopLeft(node){var document=node?node.ownerDocument:document;return{top:document.documentElement.scrollTop||document.body.scrollTop,left:document.documentElement.scrollLeft||document.body.scrollLeft}}function getWindowWidthHeight(){var w=window;if(w.innerHeight)return{width:w.innerWidth,height:w.innerHeight};var doc=document;if("BackCompat"==doc.compatMode){var db=doc.body;return{width:db.clientWidth,height:db.clientHeight}}var dd=doc.documentElement;return{width:dd.clientWidth,height:dd.clientHeight}}function getOffset(elem){for(var top=elem.offsetTop,left=elem.offsetLeft;elem=elem.offsetParent;)top+=elem.offsetTop,left+=elem.offsetLeft;return{top:top,left:left}}function isPlainObject(o){return o&&"[object Object]"===o.toString()&&!o.nodeType&&!o.setInterval}function isArray(obj){return"[object Array]"===object_to_string.call(obj)}function isString(o){return"[object String]"===object_to_string.call(o)}function isNull(o){return null===o}function isUndefined(o){return void 0===o}function isEmptyObject(o){for(var p in o)if(void 0!==p)return!1;return!0}function isWindow(obj){return null!=obj&&obj==obj.window}function isAllNumber(str){return trim(str).search(/^[0-9]*$/)>=0}function isInChinese(str){return str.length!=str.replace(/[^\x00-\xff]/g,"**").length}function isChinese(str){return trim(str).search(/^([\u4e00-\u9fa5])+$/)>=0}function isEmail(str){return/^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/.test(str)}function isSendEmail(str){return/^((([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?))|[0-9]{5,})$/.test(str)}function setCookie(name,value,options){var expires="",path="",domain="",secure="";if(options){if(options.expires&&("number"==typeof options.expires||options.expires.toUTCString)){var exp;"number"==typeof options.expires?(exp=new Date,exp.setTime(exp.getTime()+24*options.expires*60*60*1e3)):exp=options.expires,expires=";expires="+exp.toUTCString()}path=options.path?"; path="+options.path:"",domain=options.domain?";domain="+options.domain:"",secure=options.secure?";secure":""}document.cookie=[name,"=",encodeURIComponent(value),expires,path,domain,secure].join("")}function getCookie(name){var arr=document.cookie.match(new RegExp("(^| )"+name+"=([^;]*)(;|$)"));return null!=arr?decodeURIComponent(arr[2]):null}function getChildCookie(cookies,name,split1,split2){if(null===cookies)return null;var split1=split1?split1:"&",split2=split2?split2:"=",arr=cookies.match(new RegExp("(^|"+split1+")"+name+split2+"([^"+split1+"]*)("+split1+"|$)"));return null!=arr?decodeURIComponent(arr[2]):null}function delCookie(name){var exp=new Date;exp.setTime(exp.getTime()-1);var cval=getCookie(name);null!=cval&&(document.cookie=name+"="+cval+";expires="+exp.toGMTString())}function getUrlParaValue(url,key){if("string"!=typeof url)return null;var sValue=url.match(new RegExp("[?&]"+key+"=([^&]*)(&?)","i"));return sValue?sValue[1]:sValue}function getDelParaRemainUrl(url,params){if("string"!=typeof url||url.indexOf("?")==-1||"string"!=typeof params&&"[object Array]"!=Object.prototype.toString.call(params)||0==params.length)return url;var params="string"==typeof params?params.split(","):params,anchorPattern=/.*#.+$/,urlSplit=url.split("#"),anchorStr=anchorPattern.test(url)?"#"+urlSplit[1]:"",url=anchorPattern.test(url)?urlSplit[0]:url,urlList=url.split("?"),baseUrl=urlList[0],searchsList=urlList[1].split("&"),expr=new RegExp("^("+params.join("|")+")=[^&]*$"),remainSearchs=$.grep(searchsList,function(val){return expr.test(val)},!0);return 0==remainSearchs.length?baseUrl+anchorStr:baseUrl+"?"+remainSearchs.join("&")+anchorStr}function queryString(type){return getUrlParaValue(location.href,type)}function inArray(array,elt){if([].indexOf)return array.indexOf(elt);for(var i=0,len=array.length;i<len;i++)if(array[i]===elt)return i;return-1}function lastIndexOf(array,elt,from){if([].lastIndexOf)return isNaN(from)?array.lastIndexOf(elt):array.lastIndexOf(elt,from);var len=array.length;for(from=isNaN(from)||from>=len-1?len-1:from<0?Math.ceil(from)+len:Math.floor(from);from>-1;from--)if(array[from]===elt)return from;return-1}function trim(str){return str.replace(/(^\s*)|(\s*$)/g,"")}function makeArray(o){if(null==o)return[];if(isArray(o))return o;var lengthType=typeof o.length,oType=typeof o;if("number"!==lengthType||o.alert||"string"===oType||"function"===oType&&!("item"in o&&"number"===lengthType))return[o];for(var ret=[],i=0,l=o.length;i<l;i++)ret[i]=o[i];return ret}function each(object,callback){if(void 0===object.length){for(var name in object)if(!1===callback(object[name],name,object))break}else for(var i=0,len=object.length;i<len&&!(i in object&&!1===callback(object[i],i,object));i++);}function grep(elems,callback,inv){var retVal,ret=[],i=0,length=elems.length;for(inv=!!inv;i<length;i++)retVal=!!callback(elems[i],i),inv!==retVal&&ret.push(elems[i]);return ret}function merge(first,second){var l=second.length,i=first.length,j=0;if("number"==typeof l)for(;j<l;j++)first[i++]=second[j];else for(;void 0!==second[j];)first[i++]=second[j++];return first.length=i,first}function addEvent(oTarget,eType,funcHandle){oTarget.addEventListener?oTarget.addEventListener(eType,funcHandle,!1):oTarget.attachEvent?oTarget.attachEvent("on"+eType,funcHandle):oTarget["on"+eType]=funcHandle}function removeEvent(oTarget,eType,funcHandle){oTarget.removeEventListener?oTarget.removeEventListener(eType,funcHandle,!1):oTarget.detachEvent?oTarget.detachEvent("on"+eType,funcHandle):oTarget["on"+eType]=null}function Upload(opts){var defaults={$file:null,$img:null,dragAdd:!0,$tip:null,allowFormat:["jpg","jpeg","bmp"],checkFile:function(file){var t=this,fileEl=file[0],fileSize=fileEl.files[0].size;if(null==fileEl||0==fileSize)return alert("请正确选择文件"),!1;if(fileSize>5242880)return alert("文件不能超过5M"),!1;for(var fileName=$(fileEl).val(),sExp=fileName.substring(fileName.lastIndexOf(".")+1,fileName.length).toLowerCase(),formatOk=!1,i=0;i<t.o.allowFormat.length;i++)if(sExp==t.o.allowFormat[i]){formatOk=!0;break}return!!formatOk||(alert("上传格式必须是jpg、jpeg或者bmp！"),!1)},afterUpload:function(data){var t=this;t.o.$fileParent.find("img").before(t.o.$file);var _data={};try{_data=JSON.parse(data.replace(/&amp;/g,"&")),1==_data.code?(t.o.$fileParent.find("img").attr("src",_data.url).css("margin","0"),t.o.$fileParent.find("span").hide(),t.o.$tip[0]&&t.o.$tip.hide()):alert(_data.message)}catch(e){new Error(data)}t.o.$load.hide()},beforeUpload:function(){var t=this,$load=t.o.$fileParent.find(".upload-load");0==$load.length?(t.o.$load=$('<div class="upload-load pa" style="top: 0px; border-radius: 5px; text-align: center; color: rgb(132, 132, 132); left: 0px; border: 1px solid rgb(198, 214, 229); background: #fff; width: 158px; height: 158px; line-height:158px;cursor: text;">正在上传...</div>'),t.o.$fileParent.append(t.o.$load)):$load.show()}};this.o=$.extend(defaults,opts),this.init()}var win=window,doc=win.document,ua=win.navigator.userAgent.toLowerCase(),isReady=!1,readyList=[],readyBound=!1,object_to_string=Object.prototype.toString,contains=document.defaultView?function(a,b){return!!(16&a.compareDocumentPosition(b))}:function(a,b){return a!=b&&a.contains(b)},bind=function(object,fun){return function(){return fun.apply(object,arguments)}},bindAsEventListener=function(object,fun){var args=Array.prototype.slice.call(arguments).slice(2);return function(event){return fun.apply(object,[event||window.event].concat(args))}},browser=function(ua){var b={msie:/msie/.test(ua)&&!/opera/.test(ua),opera:/opera/.test(ua),safari:/webkit/.test(ua)&&!/chrome/.test(ua),firefox:/firefox/.test(ua),chrome:/chrome/.test(ua)},documentElement=doc&&doc.documentElement,className="",vMark="";for(var i in b)if(b[i]){vMark="safari"==i?"version":i;break}if(b.version=vMark&&RegExp("(?:"+vMark+")[\\/: ]([\\d.]+)").test(ua)?RegExp.$1:"0",documentElement){for(var key in b)"version"!==key&&b[key]&&(className+=key,className+=" "+key+parseInt(b.version));trim(className)&&(documentElement.className=trim(documentElement.className+className))}return b}(ua),advancedUpload=window.File&&window.FileReader&&!!window.FormData;Upload.prototype={init:function(){var t=this;t.o.$fileParent=t.o.$file.parent(),t.o.$file.on("change",function(){t.upload()})},getFile:function(){return this.o.$file.val()},getFileInfo:function(){},upload:function(){var t=this;if(advancedUpload&&!t.o.checkFile.call(t,t.o.$file))return!1;t.o.beforeUpload.call(t);var _tempName=("up-"+Math.random()).replace(".",""),$form=$('<form action="'+t.o.postUrl+'" enctype="multipart/form-data" method="post" target="'+_tempName+'"></form>'),$iframe=$("<iframe name='"+_tempName+"' style='display:none'></iframe>");$("body").append($form),$form.append(t.o.$file),$("body").append($iframe),$($iframe).on("load",function(){var data=$(this).contents().find("body").html();t.o.afterUpload.call(t,data),$form.remove(),$iframe.remove()}),$form.submit()}};var NI={ready:ready,loadJS:loadJS,loadCSS:loadCSS,extend:extend,getElement:getElement,getScrollTopLeft:getScrollTopLeft,contains:contains,getWindowWidthHeight:getWindowWidthHeight,getOffset:getOffset,isPlainObject:isPlainObject,isArray:isArray,isString:isString,isNull:isNull,isUndefined:isUndefined,isEmptyObject:isEmptyObject,isWindow:isWindow,isAllNumber:isAllNumber,isInChinese:isInChinese,isChinese:isChinese,isEmail:isEmail,isSendEmail:isSendEmail,setCookie:setCookie,getCookie:getCookie,getChildCookie:getChildCookie,delCookie:delCookie,getUrlParaValue:getUrlParaValue,getDelParaRemainUrl:getDelParaRemainUrl,queryString:queryString,inArray:inArray,lastIndexOf:lastIndexOf,trim:trim,each:each,grep:grep,makeArray:makeArray,merge:merge,addEvent:addEvent,removeEvent:removeEvent,bind:bind,bindAsEventListener:bindAsEventListener,browser:browser,fileUpload:Upload};window.NIPIC=window.NI=NI}(this),function(NIPIC){"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(n){return n<10?"0"+n:n}function quote(string){return escapable.lastIndex=0,escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,partial,mind=gap,value=holder[key];switch(value&&"object"==typeof value&&"function"==typeof value.toJSON&&(value=value.toJSON(key)),"function"==typeof rep&&(value=rep.call(holder,key,value)),typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value)return"null";if(gap+=indent,partial=[],"[object Array]"===object_to_string.apply(value)){for(length=value.length,i=0;i<length;i+=1)partial[i]=str(i,value)||"null";return v=0===partial.length?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]",gap=mind,v}if(rep&&"object"==typeof rep)for(length=rep.length,i=0;i<length;i+=1)"string"==typeof rep[i]&&(k=rep[i],(v=str(k,value))&&partial.push(quote(k)+(gap?": ":":")+v));else for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=str(k,value))&&partial.push(quote(k)+(gap?": ":":")+v);return v=0===partial.length?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}",gap=mind,v}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(value,replacer,space){var i;if(gap="",indent="","number"==typeof space)for(i=0;i<space;i+=1)indent+=" ";else"string"==typeof space&&(indent=space);if(rep=replacer,replacer&&"function"!=typeof replacer&&("object"!=typeof replacer||"number"!=typeof replacer.length))throw new Error("JSON.stringify");return str("",{"":value})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(holder,key){var k,v,value=holder[key];if(value&&"object"==typeof value)for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=walk(value,k),void 0!==v?value[k]=v:delete value[k]);return reviver.call(holder,key,value)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),NIPIC.parseJSON=JSON.parse,NIPIC.stringify=JSON.stringify}(NIPIC);