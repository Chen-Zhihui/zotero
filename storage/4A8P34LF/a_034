KISSY.add("malldetail/recommend/waterfall",function(e,t,a,i,n){function o(a,o){var l=setTimeout(function(){t.hide(u)},2e3);t.show(u);var c=g_config.isDaily?"13975762416":window.g_config.itemId,d=s.itemDO;f.product.onLoad("config",function(f){e.use("ajax",function(e,v){var b={"appId":"03067","itemId":c,"vid":0,"curPage":g,"step":100,"categoryId":d.categoryId,"sellerId":d.userId,"shopId":s.rstShopId,"brandId":d.brandId,"refer":h.referrer};if(f.detail&&f.detail.site_en){var y=f.detail.site_en;b.currency=y,b.site=y}var T=f.detail.currency||"&yen;";s.isTwView&&(b.filterTw=1),v({"url":"//aldcdn.tmall.com/recommend.htm","dataType":"jsonp","data":b,"cache":!0,"jsonpCallback":"jsonpAldTabWaterfall","success":function(c){if(c=c[0]?c[0]:c,r(c.acurl),l&&clearTimeout(l),t.hide(u),TShop.aldPreprocess(c.list),!c.list||0==c.list.length)return void o();g++;var s=[];return e.each(c.list,function(e){e.macketPrice=e.macketPrice||"",e.comments=e.comments||[],e.currency2=T,s.push(i(k).render(e))}),a(s),codeTrack("recomm.waterfall.show","recomm.waterfall.init"),g>=c.maxPage?void o():"description"==n.curIndex()?(m.pause(),void(p=!0)):void 0}})})})}function r(e){b||(TShop.sendImg(e),b=!0)}function l(e){return new a.Loader({"container":e,"load":function(e,t){return o(e,t)},"minColCount":3,"colWidth":240,"effect":""})}function c(){var e=t.create('<ul id="J_TjWaterfall" class="clearfix ald-03040"></ul>');d?t.remove(t.children(d)):d=t.create('<div id="J_Tjwrap"></div>'),t.append(e,d)}var s,d,u,m,p,f,h=document,v={},g=1,b=!1,y=!1,k='<li class="ald-wf-li">\t\t<a href="{{url}}" class="ald-wf-pic" target="_blank">\t\t\t<img height="220" src="{{img}}_250x250.jpg">\t\t\t{{#if activityTag}}<img class="act-tag" src="{{icon}}" />{{/if}}\t\t\t<em class="ald-wf-em"></em>\t\t\t{{#if price}}<span class="ui-price"><span class="ui-price-icon">{{currency2}}</span>{{price}}</span>{{/if}}\t\t\t{{#if macketPrice}}<span class="ui-price-original"><span class="ui-price-icon">{{currency2}}</span><del>{{macketPrice}}</del></span>{{/if}}\t\t</a>\t\t{{#each comments as comment}}\t\t\t{{#if comment.content.length<60}}<p><b>{{comment.nick}}</b>{{comment.content}}</p>{{/if}}\t\t{{/each}}\t\t</li>';return e.mix(v,{"init":function(e){codeTrack("recomm.waterfall.init","view.mainBody.init"),s=e,f=e.config,n.onSwitch(function(e){"J_TabRecommends"==e&&p&&(m.resume(),p=!1)}),c(),u=t.create('<div style="height:200px;background-color:#fff" class="ui-loading"></div>'),t.append(d,"#J_TabRecommends"),t.append(u,"#J_TabRecommends"),m=l("#J_TjWaterfall")},"reload":function(){g=1,y=!1,m&&(m.destroy(),c()),m=l("#J_TjWaterfall")}}),v},{"requires":["dom","waterfall","malldetail/common/template","malldetail/tabbar/tabbar","malldetail/recommend/waterfall.css"]});