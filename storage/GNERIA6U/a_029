define("kg/detail-item-recommend/0.0.10/lib/c/heart-election/index",["node","base","io","json","cookie","kg/detail-item-recommend/0.0.10/lib/c/heart-election/index.css","kg/detail-item-recommend/0.0.10/lib/c/heart-election/tpl/draw.xtpl","kg/detail-item-recommend/0.0.10/lib/c/heart-election/tpl/swaps.xtpl","kg/detail-item-recommend/0.0.10/lib/c/heart-election/tpl/photo.xtpl","kg/detail-item-recommend/0.0.10/lib/c/heart-election/tpl/recommend.xtpl","kg/detail-item-recommend/0.0.10/lib/c/heart-election/tpl/recom.xtpl"],function(e,t,a){var i=(KISSY,e("node")),r=e("base"),n=e("io"),d=e("json"),l=e("cookie");e("kg/detail-item-recommend/0.0.10/lib/c/heart-election/index.css");var o,c=i.all;o={},o.draw=e("kg/detail-item-recommend/0.0.10/lib/c/heart-election/tpl/draw.xtpl"),o.swaps=e("kg/detail-item-recommend/0.0.10/lib/c/heart-election/tpl/swaps.xtpl"),o.photo=e("kg/detail-item-recommend/0.0.10/lib/c/heart-election/tpl/photo.xtpl"),o.recommend=e("kg/detail-item-recommend/0.0.10/lib/c/heart-election/tpl/recommend.xtpl"),o.recom=e("kg/detail-item-recommend/0.0.10/lib/c/heart-election/tpl/recom.xtpl");var s=!!~location.href.indexOf("daily"),g=!1,m=!1,f=s?"//tad.daily.taobao.net":"//tad.taobao.com",u=s?"//tui.taobao.com/recommend?sellerid=737329&itemid=18813881279&buyerid=392063273&catid=50005818&cna=HbuVDIAPMg4CASp4Ss%20W2ffQ&areaid=tad_first_area&_ksTS=1414137448224_804&callback=jsonp805&appid=152":"//tui.taobao.com/recommend?appid=152",_=r.extend({init:function(){var e=this,t=e.get("data");t?e.render():e.load(),e.bindEvent()},render:function(){var e,t,a,i,r,n,l,s,f,u,_=this,h=_.get("data"),p=[],v=_.get("container"),b=_.get("errorFn"),k=_.get("successFn");if(h.guide)return g_config&&g_config.sellerDetail&&g_config.sellerDetail.buyerDetail?void c("#tad_first_area").hide():(location.host&&location.host.indexOf("daily")>-1?c(v).html('<div class="tad_guide_area" data-spm="1998223148"><div class="tad_guide_info"></div><div class="tad_guide_ope"><a href="//tte.daily.taobao.net/activity/default" target="_blank" class="tad_now_setbtn">\u7acb\u5373\u8bbe\u7f6e</a><a href="//bbs.taobao.com/catalog/thread/16029511-270773839.htm?scm=1212.30.1.31" target="_blank" class="tad_help_link">\u5e2e\u52a9</a></div></div>'):c(v).html('<div class="tad_guide_area" data-spm="1998223148"><div class="tad_guide_info"></div><div class="tad_guide_ope"><a href="//xin.mai.taobao.com/activity/default" target="_blank" class="tad_now_setbtn">\u7acb\u5373\u8bbe\u7f6e</a><a href="//bbs.taobao.com/catalog/thread/16029511-270773839.htm?scm=1212.30.1.31" target="_blank" class="tad_help_link">\u5e2e\u52a9</a></div></div>'),void(k&&k()));for(t in h)if("guide"!==t&&"tad_12"!==t&&"xin1212"!==t){var w=h[t],y=c("#"+t);if(w[0])if(w[0].redirect)p.push(t),m=!0;else if(w[0].success&&""!=w[0].content){for(g=!0,i="",n=0,s=w.length;n<s;n++)if(e="string"==typeof w[n].content?d.parse(w[n].content):w[n].content){for(r=o[e.name],e.style=_.getStyle(e.style),u=e.data,l=0,f=u.length;l<f;l++)a=u[l],a.style&&(a.style=_.getStyle(a.style));i+=r(e)}i.length>0&&e.data.length>0&&("tad_first_area"==t&&(y=c(v)||y),y.html(i),y.attr({taskid:e.taskID,templatetype:e.name,whichplan:"custom"}),y.show(),k&&k())}else"tad_first_area"==t&&b&&b()}m&&_.renderRedirect(p)},bindEvent:function(){var e=this;e.resize(),c(window).on("resize",function(){e.resize()})},resize:function(){c("#tad_first_area").parent().width()>990?c("#J_TadHeartElection").length&&c("#J_TadHeartElection").removeClass("tad_small_width"):c("#J_TadHeartElection").length&&c("#J_TadHeartElection").addClass("tad_small_width")},load:function(){var e=this,t=e.get("args"),a={},i=e.get("errorFn");e.get("successFn");a.sellerid=t.sellerId,a.buyerid=t.userId,a.appid=1,a.itemid=t.objectId,a.catid=t.catid,a.cna=t.cna,a.areaid="tad_first_area",g_config&&g_config.sellerDetail&&g_config.sellerDetail.show&&(a.self=1);var r=f+"/api/list";return new n({url:r,type:"get",dataType:"jsonp",data:a,timeout:3e3,error:function(){i&&i()},jsonp:"callback",success:function(t){return t?(e.set("data",t),void e.render()):void(i&&i())}})},renderRedirect:function(e){var t,a=this,i=a.get("args"),r={},d=a.get("container"),l=a.get("errorFn"),g=a.get("successFn");return r.sellerid=i.sellerId,r.itemid=i.objectId,r.buyerid=i.userId,r.catid=i.catid,r.cna=i.cna,r.areaid=i.targetId.toString(),s&&(r={}),new n({url:u,type:"get",data:r,dataType:"jsonp",timeout:3e3,jsonp:"callback",error:function(){l&&l()},success:function(a){if(!a)return void(l&&l());if(a&&!a.result)return void(l&&l());if(a&&a.result&&0==a.result.length)return void(l&&l());for(var i=0;i<e.length;i++){var r=e[i],n=c("#"+r);if(!a)return void(l&&l());var s="",m=a.result[0][r];if(m.success&&0!=m.data.length){var f={caption:m.caption,data:m.data};if(t=o.recommend,s+=t(f),"tad_first_area"==r&&(n=c(d)||n),n.html(s),n.attr({whichplan:"default"}),n.show(),g&&g(),"tad_second_area"===r){var u="//log.mmstat.com/shopflow.4?&t="+(new Date).getTime(),_=new Image;_.src=u}}else"tad_first_area"==r&&l&&l()}}})},getStyle:function(e){var t,a,i,r,n;if(!e)return"";r="";for(a in e)n=e[a],i=a.match(/[A-Z]/),i&&i.length>0&&(t=i[0],a=a.replace(t,"-"+t.toLowerCase())),r+=a+":"+n+";";return r}},{ATTRS:{args:{valueFn:function(){var e={};return e.targetId=["tad_first_area"],g_config.vdata&&g_config.vdata.viewer&&g_config.vdata.viewer.id?e.userId=g_config.vdata.viewer.id:e.userId=l.get("cna"),e.cna=l.get("cna"),e.objectId=g_config.itemId,e.sellerId=g_config.sellerId,e.shopId=g_config.shopId,e.catid=g_config.idata.item.cid,e}},data:{value:""},container:{value:""},successFn:{valueFn:function(){}},errorFn:{valueFn:function(){}}}});a.exports=_});define("kg/detail-item-recommend/0.0.10/lib/c/matching-combo/index",["kg/detail-item-recommend/0.0.10/lib/c/matching-combo/index.css","node","base","dom","kg/detail-item-recommend/0.0.10/lib/c/matching-combo/page","io","event-custom","kg/detail-item-recommend/0.0.10/lib/c/matching-combo/tpl/combo.xtpl","kg/detail-item-recommend/0.0.10/lib/c/matching-combo/tpl/comboItem.xtpl"],function(e,t,n){e("kg/detail-item-recommend/0.0.10/lib/c/matching-combo/index.css");var a=e("node"),o=e("base"),i=e("dom"),m=e("kg/detail-item-recommend/0.0.10/lib/c/matching-combo/page"),l=e("io"),c=KISSY,d=a.all,r=a.all("body"),g="loadDefaultData",s="tb-hidden",u=e("event-custom"),p=c.merge({},u.Target),f=o.extend({init:function(){this.render()},show:function(){i.removeClass(this.get("el"),s)},hide:function(){i.addClass(this.get("el"),s)},render:function(){var e=this,t=e.get("api"),n=e.get("data");p.on(g,function(e){new m({api:t,dataBox:"#J_BundleData",pageBox:"#J_BundlePage",meals:e.meals})}),r.on("load",function(t){var n=t.api,a=g_config.tadComponetCdn,o={url:n,type:"get",dataType:"jsonp",success:function(t){e.renderDefault(t)},error:function(){r.fire("track",{msg:{url:location.href,category:"recommend:request:false:matchingcombo"}});var t=e.get("errorFn");t&&t()}};a&&c.mix(o,{jsonpCallback:"fromCdn",cache:!0}),new l(o)}),e.renderDefault(n)},renderDefault:function(e){if(c.isPlainObject(e)&&e.data&&e.data.mealComponentBO){var t=this,n=t.get("container"),o=t.get("el"),i=[],m=[],l=t.get("renderDefault");l||(i=t.get("tpl"),m=e.data.mealComponentBO.meals,a.one(n).append(i({mealComponentBO:e.data.mealComponentBO})),n&&a.one(n).append(a.one(o)),t.set("renderDefault",!0)),i=t.get("tplCombo"),a.one("#J_BundleData").html(i({mealComponentBO:e.data.mealComponentBO})),t.show(),m.length&&p.fire(g,{meals:m}),window.DT&&DT.Messenger.fire("ui:tabbar:checkStick");var d=this.get("successFn");d&&d(),r.fire("loadsuccess")}else{var s=this.get("errorFn");s&&s(),r.fire("loaderror")}}},{ATTRS:{renderDefault:{value:!1},container:{value:""},errorFn:{valueFn:function(){}},successFn:{valueFn:function(){}},data:{value:""},el:{valueFn:function(){return d("#matching-combo")}},tpl:{value:e("kg/detail-item-recommend/0.0.10/lib/c/matching-combo/tpl/combo.xtpl")},tplCombo:{value:e("kg/detail-item-recommend/0.0.10/lib/c/matching-combo/tpl/comboItem.xtpl")},api:{valueFn:function(){var e=this,t=(e.get("daily"),e.get("userId")),n=e.get("itemId"),a=e.get("tadComponetCdn");return a?"//otds.alicdn.com/json/MMComponent.htm?meal=1&userId="+t+"&itemId="+n:"//detailskip.taobao.com/json/MMComponent.htm?meal=1&userId="+t+"&itemId="+n}},daily:{valueFn:function(){var e=!!~location.href.indexOf("daily");return e?"daily.taobao.net":"taobao.com"}},userId:{value:g_config.idata&&g_config.idata.seller&&g_config.idata.seller.id},itemId:{value:g_config.itemId},tadComponetCdn:{value:g_config.tadComponetCdn}}});n.exports=f});define("kg/detail-item-recommend/0.0.10/lib/c/1212/index",["kg/detail-item-recommend/0.0.10/lib/c/1212/index.css","node","base","json","kg/detail-item-recommend/0.0.10/lib/c/1212/mods/feast"],function(a,e,t){a("kg/detail-item-recommend/0.0.10/lib/c/1212/index.css");var i=(KISSY,a("node").all),s=a("base"),d=a("json"),n=a("kg/detail-item-recommend/0.0.10/lib/c/1212/mods/feast"),c=!!~location.href.indexOf("daily"),l=c?"//tte.daily.taobao.net/activity/xin12?src=3":"//xin.mai.taobao.com/activity/xin12?src=3";t.exports=s.extend({init:function(){var a=this;a.render()},render:function(){var a=this,e=a.get("data"),t=a.get("successFn"),s=a.get("errorFn"),c=a.get("container");if("undefined"==typeof e.tad_12)s&&s();else if(e.tad_12.length>0){var o=e.tad_12[0],_=o.content;if(!o.success||!_)return void(s&&s());if(_="string"==typeof _?d.parse(_):_,void 0==_.xin1212){var r=_;n.init(r,i(c))}else _.xin1212?i(c).html('<div class="tad12_guide_area" data-spm="1998223148"><div class="tad12_guide_info"></div><div class="tad12_guide_ope"><a href="'+l+'" target="_blank" class="tad12_now_setbtn">\u7acb\u5373\u8bbe\u7f6e</a><a href="//bbs.taobao.com/catalog/thread/17180510-277372963.htm?scm=1212.30.2.1" target="_blank" class="tad12_help_link">\u5e2e\u52a9</a></div></div>'):i(c).html('<p class="tad12_guide_success_tip">\u5927\u4fc3\u671f\u95f4(\u9884\u552e\u3001\u9884\u70ed\u53ca12.12\u5f53\u5929)\uff0c\u5982\u60a8\u6709\u5546\u54c1\u62a5\u540d\u5ba1\u6838\u6210\u529f\uff0c\u5219\u663e\u793a1212\u4e07\u80fd\u76db\u5178\uff0c\u6837\u5f0f\u5982\u4e0b:</p><div class="tad12_guide_success"><img src="//img.alicdn.com/tps/i2/TB1WN6wGFXXXXaiXXXXk00J9FXX-1124-309.png" class="tad_guide_success_sample" alt=""/></div>');t&&t()}else 0==e.tad_12.length&&(void 0!=e.xin1212?(e.xin1212?i(c).html('<div class="tad12_guide_area" data-spm="1998223148"><div class="tad12_guide_info"></div><div class="tad12_guide_ope"><a href="'+l+'" target="_blank" class="tad12_now_setbtn">\u7acb\u5373\u8bbe\u7f6e</a><a href="//bbs.taobao.com/catalog/thread/17180510-277372963.htm?scm=1212.30.2.1" target="_blank" class="tad12_help_link">\u5e2e\u52a9</a></div></div>'):i(c).html('<p class="tad12_guide_success_tip">\u5927\u4fc3\u671f\u95f4(\u9884\u552e\u3001\u9884\u70ed\u53ca12.12\u5f53\u5929)\uff0c\u5982\u60a8\u6709\u5546\u54c1\u62a5\u540d\u5ba1\u6838\u6210\u529f\uff0c\u5219\u663e\u793a1212\u4e07\u80fd\u76db\u5178\uff0c\u6837\u5f0f\u5982\u4e0b:</p><div class="tad12_guide_success"><img src="//img.alicdn.com/tps/i2/TB1WN6wGFXXXXaiXXXXk00J9FXX-1124-309.png" class="tad_guide_success_sample" alt=""/></div>'),t&&t()):s&&s())},resize:function(){i("#tad_first_area").parent().width()>990?i("#J_TadHeartElection").length&&i("#J_TadHeartElection").removeClass("tad_small_width"):i("#J_TadHeartElection").length&&i("#J_TadHeartElection").addClass("tad_small_width")}},{ATTRS:{data:{value:""},container:{value:""},successFn:{valueFn:function(){}},errorFn:{valueFn:function(){}}}})});define("kg/xtemplate/4.5.0/runtime",[],function(n,r,t){var e;e=function(n){var r,t,e,i,o;return r=function(n){function r(){var n="";for(var r in e)n+=r+"|";return n=n.slice(0,-1),o=new RegExp(n,"g")}var t,e={"&":"&amp;",">":"&gt;","<":"&lt;","`":"&#x60;","/":"&#x2F;",'"':"&quot;","'":"&#x27;"},i=/[&<>"'`]/,o=r(),a=/\\?\{([^{}]+)\}/g,f="undefined"!=typeof global?global:window,u=Object.prototype.toString;return n=t={isArray:Array.isArray||function(n){return"[object Array]"===u.call(n)},keys:Object.keys||function(n){var r,t=[];for(r in n)n.hasOwnProperty(r)&&t.push(r);return t},each:function(n,r,e){if(n){var i,o,a,f=0,u=n&&n.length,s=void 0===u||"[object Function]"===Object.prototype.toString.call(n);if(e=e||null,s)for(a=t.keys(n);f<a.length&&(i=a[f],r.call(e,n[i],i,n)!==!1);f++);else for(o=n[0];f<u&&r.call(e,o,f,n)!==!1;o=n[++f]);}return n},mix:function(n,r){if(r)for(var t in r)n[t]=r[t];return n},globalEval:function(n){f.execScript?f.execScript(n):!function(n){f.eval.call(f,n)}(n)},substitute:function(n,r,t){return"string"==typeof n&&r?n.replace(t||a,function(n,t){return"\\"===n.charAt(0)?n.slice(1):void 0===r[t]?"":r[t]}):n},escapeHtml:function(n){return n=""+n,i.test(n)?(n+"").replace(o,function(n){return e[n]}):n},merge:function(){for(var n=0,r=arguments.length,e={};n<r;n++){var i=arguments[n];i&&t.mix(e,i)}return e}}}(),t=function(n){function r(n,r,t){void 0!==n?this.data=n:this.data={},t?(this.parent=t,this.root=t.root):(this.parent=void 0,this.root=this),this.affix=r||{},this.ready=!1}return r.prototype={isScope:1,constructor:r,setParent:function(n){this.parent=n,this.root=n.root},set:function(n,r){this.affix[n]=r},setData:function(n){this.data=n},getData:function(){return this.data},mix:function(n){var r=this.affix;for(var t in n)r[t]=n[t]},get:function(n){var r,t=this.data,e=this.affix;return null!=t&&(r=t[n]),void 0!==r?r:e[n]},resolveInternalOuter:function(n){var r,t=n[0],e=this,i=e;if("this"===t)r=e.data;else if("root"===t)i=i.root,r=i.data;else{if(!t)return[i.data];do r=i.get(t);while(void 0===r&&(i=i.parent))}return[void 0,r]},resolveInternal:function(n){var r=this.resolveInternalOuter(n);if(1===r.length)return r[0];var t,e=n.length,i=r[1];if(void 0!==i){for(t=1;t<e;t++){if(null==i)return i;i=i[n[t]]}return i}},resolveLooseInternal:function(n){var r=this.resolveInternalOuter(n);if(1===r.length)return r[0];var t,e=n.length,i=r[1];for(t=1;null!=i&&t<e;t++)i=i[n[t]];return i},resolveUp:function(n){return this.parent&&this.parent.resolveInternal(n)},resolveLooseUp:function(n){return this.parent&&this.parent.resolveLooseInternal(n)},resolveOuter:function(n,r){var t,e=this,i=e;if(!r&&1===n.length){if(t=e.get(n[0]),void 0!==t)return[t];r=1}if(r)for(;i&&r--;)i=i.parent;return i?[void 0,i]:[void 0]},resolveLoose:function(n,r){var t=this.resolveOuter(n,r);return 1===t.length?t[0]:t[1].resolveLooseInternal(n)},resolve:function(n,r){var t=this.resolveOuter(n,r);return 1===t.length?t[0]:t[1].resolveInternal(n)}},n=r}(),e=function(n){function t(n,r,t){this.list=n,this.init(),this.next=r,this.ready=!1,this.tpl=t}function e(n,r){var e=this;e.config=r,e.head=new t(e,(void 0)),e.callback=n,this.init()}var i=r;return t.prototype={constructor:t,isBuffer:1,init:function(){this.data=""},append:function(n){return this.data+=n,this},write:function(n){if(null!=n){if(n.isBuffer)return n;this.data+=n}return this},writeEscaped:function(n){if(null!=n){if(n.isBuffer)return n;this.data+=i.escapeHtml(n)}return this},insert:function(){var n=this,r=n.list,e=n.tpl,i=new t(r,n.next,e),o=new t(r,i,e);return n.next=o,n.ready=!0,o},async:function(n){var r=this.insert(),t=r.next;return n(r),t},error:function(n){var r=this.list.callback;if(r){var t=this.tpl;if(t){n instanceof Error||(n=new Error(n));var e=t.name,i=t.pos.line,o="XTemplate error in file: "+e+" at line "+i+": ";n.stack=o+n.stack,n.message=o+n.message,n.xtpl={pos:{line:i},name:e}}this.list.callback=null,r(n,void 0)}},end:function(){var n=this;return n.list.callback&&(n.ready=!0,n.list.flush()),n}},e.prototype={constructor:e,init:function(){this.data=""},append:function(n){this.data+=n},end:function(){this.callback(null,this.data),this.callback=null},flush:function(){for(var n=this,r=n.head;r;){if(!r.ready)return void(n.head=r);this.data+=r.data,r=r.next}n.end()}},e.Buffer=t,n=e}(),i=function(n){var e=t,i=r,o={range:function(n,r){var t=r.params,e=t[0],i=t[1],o=t[2];o?(e>i&&o>0||e<i&&o<0)&&(o=-o):o=e>i?-1:1;for(var a=[],f=e;e<i?f<i:f>i;f+=o)a.push(f);return a},"void":function(){},foreach:function(n,r,t){var i,o,a,f,u=r.params,s=u[0],l=u[2]||"xindex",c=u[1];if(s)for(i=s.length,f=0;f<i;f++)o=new e(s[f],{xcount:i,xindex:f},n),a=o.affix,"xindex"!==l&&(a[l]=f,a.xindex=void 0),c&&(a[c]=s[f]),t=r.fn(o,t);return t},forin:function(n,r,t){var i,o,a,f=r.params,u=f[0],s=f[2]||"xindex",l=f[1];if(u)for(a in u)i=new e(u[a],{xindex:a},n),o=i.affix,"xindex"!==s&&(o[s]=a,o.xindex=void 0),l&&(o[l]=u[a]),t=r.fn(i,t);return t},each:function(n,r,t){var e=r.params,a=e[0];return a?i.isArray(a)?o.foreach(n,r,t):o.forin(n,r,t):t},"with":function(n,r,t){var i=r.params,o=i[0];if(o){var a=new e(o,(void 0),n);t=r.fn(a,t)}return t},"if":function(n,r,t){var e=r.params,i=e[0];if(i){var o=r.fn;o&&(t=o(n,t))}else{var a=!1,f=r.elseIfs,u=r.inverse;if(f)for(var s=0,l=f.length;s<l;s++){var c=f[s];if(a=c.test(n)){t=c.fn(n,t);break}}!a&&u&&(t=u(n,t))}return t},set:function(n,r,t){for(var e=r.hash,i=e.length,o=0;o<i;o++){var a=e[o],f=a.key,u=a.depth,s=a.value;if(1===f.length){for(var l=n.root;u&&l!==n;)n=n.parent,--u;n.set(f[0],s)}else{var c=n.resolve(f.slice(0,-1),u);c&&(c[f[f.length-1]]=s)}}return t},include:1,parse:1,extend:1,block:function(n,r,t){var e,i=this,o=i.runtime,a=r.params,f=a[0];2===a.length&&(e=a[0],f=a[1]);var u,s=o.blocks=o.blocks||{},l=s[f],c={fn:r.fn,type:e};if(l){if(l.type)if("append"===l.type)c.next=l,s[f]=c;else if("prepend"===l.type){var v;for(u=l;u&&"prepend"===u.type;)v=u,u=u.next;c.next=u,v.next=c}}else s[f]=c;if(!o.extendTpl)for(u=s[f];u;)u.fn&&(t=u.fn.call(i,n,t)),u=u.next;return t},macro:function(n,r,t){var i=r.hash,o=r.params,a=o[0],f=o.slice(1),u=this,s=u.runtime,l=s.macros=s.macros||{},c=l[a];if(r.fn)l[a]={paramNames:f,hash:i,fn:r.fn};else if(c){var v,d=c.hash||{};if(v=c.paramNames)for(var h=0,p=v.length;h<p;h++){var m=v[h];d[m]=f[h]}if(i)for(var g in i)d[g]=i[g];var x=new e(d);x.root=n.root,t=c.fn.call(u,x,t)}else{var y="can not find macro: "+a;t.error(y)}return t}};return o["debugger"]=function(){i.globalEval("debugger")},n=o}(),o=function(n){function o(n,r,t,e,i,o,a,f){this.name=n,this.originalName=o||n,this.runtime=r,this.root=t,this.pos={line:1},this.scope=e,this.buffer=i,this.fn=a,this.parent=f}function a(n,r,t){var e=t[0],i=n&&n[e]||r&&r[e]||x[e];if(1===t.length)return i;if(i)for(var o=t.length,a=1;a<o;a++)if(i=i[t[a]],!i)return!1;return i}function f(n,r){var t=n.split("/"),e=r.split("/");t.pop();for(var i=0,o=e.length;i<o;i++){var a=e[i];"."===a||(".."===a?t.pop():t.push(a))}return t.join("/")}function u(n,r,t,e,i,o){var f,u,s;if(o||(s=a(n.runtime.commands,n.root.config.commands,i)),s)return s.call(n,r,t,e);if(s!==!1){var l=i.slice(0,-1);if(f=r.resolve(l,o),null==f)return e.error("Execute function `"+i.join(".")+"` Error: "+l.join(".")+" is undefined or null"),e;if(u=f[i[i.length-1]])try{return u.apply(f,t.params||[])}catch(c){return e.error("Execute function `"+i.join(".")+"` Error: "+c.message),e}}return e.error("Command Not Found: "+i.join(".")),e}function s(n,r){var t=this;t.fn=n,t.config=m.merge(s.globalConfig,r),this.subNameResolveCache={}}function l(n,r,t){if("."!==r.charAt(0))return r;var e=t+"_ks_"+r,i=n.subNameResolveCache,o=i[e];return o?o:r=i[e]=f(t,r)}function c(n,r,t,e,i,o){var a=l(n,o,i.name),f=e.insert(),u=f.next;return d(n,a,i.runtime,r,f,o,t,e.tpl),u}function v(n,r,t,e,i){var a=t.insert(),f=a.next,u=new o(i.TPL_NAME,e.runtime,n,r,a,(void 0),i,t.tpl);return a.tpl=u,h(u),f}function d(n,r,t,e,i,a,f,u){var s=new o(r,t,n,e,i,a,(void 0),u);i.tpl=s,n.config.loader.load(s,function(n,r){"function"==typeof r?(s.fn=r,h(s)):n?i.error(n):(r=r||"",f?i.writeEscaped(r):i.data+=r,i.end())})}function h(n){var r=n.fn();if(r){var t,e=n.runtime,i=e.extendTpl;if(i&&(t=i.params[0],!t))return r.error("extend command required a non-empty parameter");var o=e.extendTplFn,a=e.extendTplBuffer;return o?(e.extendTpl=null,e.extendTplBuffer=null,e.extendTplFn=null,v(n.root,n.scope,a,n,o).end()):t&&(e.extendTpl=null,e.extendTplBuffer=null,c(n.root,n.scope,0,a,n,t).end()),r.end()}}function p(n,r,t){var e=r.params;if(!e[0])return t.error("include command required a non-empty parameter");var i=n,o=e[1],a=r.hash;return a&&(o=o?m.mix({},o):{},m.mix(o,a)),o&&(i=new y(o,(void 0),n)),i}var m=r,g=i,x={},y=t,b=e,w={callFn:u,callDataFn:function(n,r){for(var t=r[0],e=t,i=1;i<r.length;i++){var o=r[i];if(!e||null==e[o])return"";t=e,e=e[o]}return e.apply(t,n||[])},callCommand:function(n,r,t,e,i){return u(n,r,t,e,i)}};return m.mix(s,{config:function(n,r){var t=this.globalConfig=this.globalConfig||{};return arguments.length?void(void 0!==r?t[n]=r:m.mix(t,n)):t},nativeCommands:g,utils:w,util:m,addCommand:function(n,r){x[n]=r},removeCommand:function(n){delete x[n]}}),s.prototype={constructor:s,Scope:y,nativeCommands:g,utils:w,removeCommand:function(n){var r=this.config;r.commands&&delete r.commands[n]},addCommand:function(n,r){var t=this.config;t.commands=t.commands||{},t.commands[n]=r},include:function(n,r,t,e){return c(this,p(n,r,t),r.escape,t,e,r.params[0])},includeModule:function(n,r,t,e){return v(this,p(n,r,t),t,e,r.params[0])},render:function(n,r,t){var e="",i=this,a=i.fn,f=i.config;"function"==typeof r&&(t=r,r=null),r=r||{},t=t||function(n,r){if(n)throw n instanceof Error||(n=new Error(n)),n;e=r};var u=i.config.name;!u&&a&&a.TPL_NAME&&(u=a.TPL_NAME);var l;l=n instanceof y?n:new y(n);var c=new s.LinkedBuffer(t,f).head,v=new o(u,{commands:r.commands},i,l,c,u,a);return c.tpl=v,a?(h(v),e):(f.loader.load(v,function(n,r){r?(v.fn=i.fn=r,h(v)):n&&c.error(n)}),e)}},s.Scope=y,s.LinkedBuffer=b,n=s}(),n=o}(),t.exports=e});