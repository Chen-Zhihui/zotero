define("ydcore:widget/yd_send_mobile/yd_send_mobile.js",function(e,o,n){{var t=e("ydcommon:widget/ui/lib/jquery/jquery.js"),i=e("ydcommon:widget/ui/js_core/_dialog/_dialog.js"),c=e("ydcommon:widget/ui/js_core/qrcode/qrcode.js"),d=e("ydcommon:widget/ui/lib/lang/lang.js");e("ydcommon:widget/ui/js_core/countdown/countdown.js")}Log=e("ydcommon:widget/ui/js_core/log/log.js");var s=d.createClass(function(e){this._init(e)}).extend({_init:function(e){var o,n=this;n.mobiTimer=null,n.vcodeTimer=null,n.correctMobi=!1,n.correctVcode=!0,n.isSending=!1,n.btnOpen=!1,n.book_id=e.book_id,n.from_page=e.from,n.midway_type=e.midway_type,t(document).ready(function(t){e.onShowAfter=function(){n.changeVcode();
var o=location.protocol+"//yd.baidu.com/apps?dynamicqrcode=1&actionType=unlimited_present&fr=1052&present_bookid="+n.book_id+"&qrt=0&did="+n.book_id;"ps_midway"==e.from&&(o+="&midway_type"+e.midway_type);var i=t("#yd-send-mobi-content").find(".qcode-img");if(i.length){new c(i.get(0),{text:o,width:150,height:150,colorDark:"#000000",colorLight:"#ffffff",correctLevel:c.CorrectLevel.L})}n._afterSendMsgShow.apply(this),n.showCountdown()},e.title="\u514d\u8d39\u4e0b\u8f7d\u300a"+(e.docTitle||"")+"\u300b\u5168\u672c\u5230\u624b\u673a",e.closeSelector=".js-empty-hook",e.minimizeSelector=".js-empty-hook",e.confirmSelector=".js-empty-hook",e.onCloseBefore=n._beforeSendMsgClose,"ps_midway"===e.from||"book_index_cover"===e.from?t("body").on("click",e.monitorClass,function(n){n.preventDefault(),o&&o.close(),o=new i.dialogCreate(e)
}):o=new i.dialogCreate(e),t("body").on("click","#yd-send-to-mobi .dialog-head .close",function(e){e.preventDefault(),o&&o.close(),o=null})}),n.bindEvent()},bindEvent:function(){var e=this;t("body").on("keyup","#send-to-mobi-num",function(o){o.preventDefault(),clearTimeout(e.mobiTimer),t(o.currentTarget).nextAll(".number-err-tips").html(""),e.mobiTimer=setTimeout(function(){var o=t("#send-to-mobi-num"),n=t(".vcode-line"),i=o.nextAll(".number-err-tips"),c=o.nextAll(".number-correct-icon"),d=o.val()||"",s=/^((\+86)|(86))?\d{11}$/i;
s.test(d)?(e.correctMobi=!0,i.html(""),n.show(),c.css("display","inline-block")):""==d?(e.correctMobi=!1,c.hide(),i.html("\u8f93\u5165\u6709\u8bef")):(e.correctMobi=!1,c.hide(),i.html("\u8f93\u5165\u6709\u8bef")),e.checkBtnStatus()},300)}),t("body").on("click","#yd-send-mobi-content .change-vcode-text",function(o){o.preventDefault(),e.changeVcode()}),t("body").on("click","#yd-send-mobi-content .chang-vcode-wrap",function(o){o.preventDefault(),e.changeVcode()}),t("body").on("click","#yd-send-mobi-content .confirm-send-mobi",function(o){o.preventDefault(),t("#send-to-mobi-num").trigger("keyup"),t("#send-to-mobi-vcode").trigger("keyup"),e.submitForm()
})},changeVcode:function(){{var e=this,o=t("#yd-send-mobi-content .chang-vcode-wrap .vcode-img");t("#yd-send-mobi-content .act-line .number-err-tips")}return t.ajax({url:"/browse/interface/sendurl",cache:!1,dataType:"json",data:{book_id:e.book_id,type:1}}).done(function(e){o.attr({src:e.data.imgurl})}),e},showCountdown:function(){var e=t("#yd-send-to-mobi").find(".dialog-head"),o=t(['<p class="qrcode-countdown-wrap">','<span class="minute f"></span>','<span class="minute s"></span>',"\u5206",'<span class="second f"></span>','<span class="second s"></span>',"\u79d2\u5185\u6709\u6548","</p>"].join(""));
e.append(o);var n=t("#yd-send-to-mobi").find(".qrcode-countdown-wrap");if(n.length){var i=new Date,c=+i.setMinutes(i.getMinutes()+5);n.countdown(c,function(e){var o="0",n=+e.offset.minutes%10,i=Math.floor(+e.offset.seconds/10),c=+e.offset.seconds%10,d=t("#yd-send-to-mobi").find(".qrcode-countdown-wrap");0==e.offset.minutes&&0==e.offset.seconds&&t("#yd-send-to-mobi .dialog-close").trigger("click"),d.find(".minute.f").html(o),d.find(".minute.s").html(n),d.find(".second.f").html(i),d.find(".second.s").html(c)
})}},submitForm:function(){var e,o=this,n=t("#send-to-mobi-num"),c=t("#send-to-mobi-vcode"),d=t("#yd-send-mobi-content .act-line .number-err-tips");o.btnOpen&&(o.isSending=!0,t.ajax({url:"/browse/interface/sendurl",type:"POST",dataType:"json",cache:!1,data:{book_id:o.book_id,mobile:n.val(),vcode:c.val()}}).done(function(n){e=n.status.code,0==e?(t("#yd-send-to-mobi .dialog-close").trigger("click"),new i.dialogCreate({innerId:"yd-msg-send-success",title:"\u53d1\u9001\u6210\u529f",content:['<div class="send-success-content">','<div class="position-hack">','<div class="content-wrap">','<p class="book-success">','<span class="ic ic-right"></span>',"<span>\u53d1\u9001\u6210\u529f\uff0c\u5feb\u53bb\u9605\u8bfb\u5427\uff01</span>","</p>","</div>","</div>","</div>"].join(""),width:377,height:150,draggable:!1,closeWithEsc:!1}),setTimeout(function(){t("#yd-msg-send-success").addClass("force-reflow").removeClass("force-reflow")
},0),"ps_midway"==o.from_page?Log.xsend(2,"200086",{midway_type:o.midway_type}):Log.xsend(2,"200247",{from:o.from_page})):1==e?d.html("\u7f3a\u5c11\u56fe\u4e66\u53c2\u6570"):2==e?(d.html("\u9a8c\u8bc1\u7801\u4e0d\u5b58\u5728"),o.changeVcode()):3==e?d.html("\u624b\u673a\u53f7\u4e0d\u6b63\u786e"):4==e?(d.html("\u9a8c\u8bc1\u7801\u9519\u8bef"),o.changeVcode()):5==e?d.html("\u5df2\u53d1\u9001\u8fc7\u4e86~"):6==e&&d.html("\u53d1\u9001\u5931\u8d25"),o.isSending=!1}))},checkBtnStatus:function(){var e=this;
e.btnOpen=e.correctMobi&&e.correctVcode&&!e.isSending?!0:!1},_afterSendMsgShow:function(){var e=this,o=t(e.getElement()),n=o.find("#send-to-mobi-num"),i=o.find(".number-placeholder"),c=o.find("#send-to-mobi-vcode"),d=o.find(".vcode-placeholder");n.focus(function(){i.hide()}),i.click(function(){n.focus()}),n.blur(function(){""==t.trim(t(this).val())&&i.show()}),c.focus(function(){d.hide()}),d.click(function(){c.focus()}),c.blur(function(){""==t.trim(t(this).val())&&d.show()})},_beforeSendMsgClose:function(){var e=this,o=t(e.getElement()),n=o.find("#send-to-mobi-num"),i=o.find(".number-placeholder"),c=o.find("#send-to-mobi-vcode"),d=o.find(".vcode-placeholder");
n.off(),i.off(),c.off(),d.off()}});n.exports=s});