define("ydcommon:widget/ui/read/drop_ax/drop_ax.js",function(o,e,n){var t=o("ydcommon:widget/ui/lib/jquery/jquery.js"),i=o("ydcommon:widget/ui/js_core/widget/widget.js").widget,a=o("ydcommon:widget/ui/lib/cookie/cookie.js"),s=i({Options:{backgroundImage:"",startTime:null,endTime:null,link:"",container:".drop-ax-container",id:"",className:"",dropHeight:356,staticHeight:40,dropDuring:500,showTime:5e3,cookieName:"drop_ad",cookieExpireTime:"auto",needTimeCountDown:!0,needClose:!1,onClick:t.noop,onLoad:t.noop,onDropped:t.noop,pathRegExp:[/^\/$/,/^\/book\/list/,/^\/rank/,/^\/vip/,/^\/ebook/,/^\/search/,/^\/promotion\/activity/,/^\/yd/]},_init:function(){var o=this,e=+new Date;
o.$container=t(o.container),o._isDropping=!1,o.$container.length>0&&o._isShowPath()&&o.startTime&&o.endTime&&e>o.startTime&&e<o.endTime&&(o._initDom(),o._initEvent(),o.$backgroundImage.load(function(){o.$backgroundImage.css("margin-left",-(parseInt(this.width)/2)).appendTo(o.$el),o.open(),o.fire("onload")}).attr("src",o.backgroundImage))},_initDom:function(){var o=this;o.$el=t("<div></div>").hide().addClass(o.className+" drop-ax").attr({id:o.id}).css({position:"relative"}).appendTo(o.$container),o.el=o.$el[0],o.$backgroundImage=t("<img>").addClass("drop-ax-background").css({position:"absolute",top:0,left:"50%","z-index":0}),o.$contentEl=t("<div>").addClass("drop-ax-content").css({position:"relative","z-index":2}).appendTo(o.$el),o.$page=t("#doc"),o.needClose&&(o.$closeEl=t("<span>").addClass("drop-ax-close").appendTo(o.$contentEl))
},_initEvent:function(){var o=this;o.$el.click(function(){o.link&&window.open(o.link),o.onClick&&o.onClick.call(o.el,o)}),o.$el.on("click",".drop-ax-close",function(){return o.close(),!1}),o.on("onload",function(){o.onLoad&&o.onLoad(o)}),o.on("ondropped",function(){o.onDropped&&o.onDropped(o)})},_isShowPath:function(){for(var o,e=this,n=location.pathname,t=e.pathRegExp,i=!1,a=0;a<t.length;a++)o=t[a],o&&"function"==typeof o.test&&o.test(n)&&(i=!0);return i},open:function(){var o=this;o._getExpire()?(o._setStatus("dropped"),o._isDropping=!1,o.$el.show(),o.fire("ondropped")):(o._setExpire(),o._setStatus("dropping"),o._isDropping=!0,o.$el.show(),o._expand(function(){}),o._closeTimeout=setTimeout(function(){o.close()
},o.showTime)),o.needTimeCountDown&&o._startTimeCount()},_expand:function(o){var e=this;o||(o=t.noop),e.$el.css("height",0).animate({height:e.dropHeight},e.dropDuring,function(){e.$page.css("zoom",0).css("zoom",1),o()})},close:function(){var o=this;o._isDropping&&(o._closeTimeout&&(clearTimeout(o._closeTimeout),o._closeTimeout=null),o._isDropping=!1,o._collapse(function(){o._setStatus("dropped"),o.fire("ondropped")}))},_startTimeCount:function(){function o(){var o=(new Date).getTime(),t=n-o,i=6e4,a=60*i,s=24*a,d=Math.floor(t/s),r=Math.floor((t-d*s)/a);
leaveMinutes=Math.floor((t-d*s-r*a)/i),e.$dayCountDown.html(d),e.$hourCountDown.html(r),e.$minuteCountDown.html(leaveMinutes)}var e=this,n=e.endTime;e.$dayCountDown=t("<span>").addClass("drop-ax-countdown drop-ax-countdown-day").appendTo(e.$contentEl),e.$hourCountDown=t("<span>").addClass("drop-ax-countdown drop-ax-countdown-hour").appendTo(e.$contentEl),e.$minuteCountDown=t("<span>").addClass("drop-ax-countdown drop-ax-countdown-minute").appendTo(e.$contentEl),e._timeCountInterval=setInterval(o,6e4),o()
},_collapse:function(o){var e=this;o||(o=t.noop),e.$el.animate({height:e.staticHeight},e.dropDuring,function(){e.$page.css("zoom",0).css("zoom",1),o()})},_setStatus:function(o){var e=this;o&&(e.$el.removeClass("dropping dropped"),"dropping"===o?(e.$backgroundImage.css({top:0}),e.$contentEl.css({height:parseInt(e.dropHeight)}),e.$el.addClass(o)):"dropped"===o&&(e.$backgroundImage.css({top:-parseInt(e.dropHeight)}),e.$contentEl.css({height:parseInt(e.staticHeight)}),e.$el.addClass(o)))},_setExpire:function(){var o="number"==typeof this.cookieExpireTime?this.cookieExpireTime:this.endTime-this.startTime+1;
a.set(this.cookieName,1,{path:"/",expires:o})},_getExpire:function(){return!!a.get(this.cookieName)},isOpen:function(){return this._isDropping}},{type:"drop-ax"});n.exports=s});