<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
  <link rel="dns-prefetch" href="https://assets-cdn.github.com/">
  <link rel="dns-prefetch" href="https://avatars0.githubusercontent.com/">
  <link rel="dns-prefetch" href="https://avatars1.githubusercontent.com/">
  <link rel="dns-prefetch" href="https://avatars2.githubusercontent.com/">
  <link rel="dns-prefetch" href="https://avatars3.githubusercontent.com/">
  <link rel="dns-prefetch" href="https://github-cloud.s3.amazonaws.com/">
  <link rel="dns-prefetch" href="https://user-images.githubusercontent.com/">



  <link crossorigin="anonymous" media="all" integrity="sha512-KDZfnHRZjn4xEe2VuPe5iA8c+O1aNoowrYTe3DQQR97UQDzf5HZ15My/ytImCLmX5X6kBM8kwtuUVj5H+DOZbA==" rel="stylesheet" href="frameworks-7d09971c51977b60c6626362003ef38a.css">
  <link crossorigin="anonymous" media="all" integrity="sha512-8VnmS7+S4UIxsIz2BC4F/c3YYbRNB/GEcCQ6AssRT3F3s6sObMSaw8K9ijW0SyurkWRxN/dPT/DV/+4GjWcFrA==" rel="stylesheet" href="github-324331281b788158086ad9201d9c0804.css">
  
  
  
  

  <meta name="viewport" content="width=device-width">
  
  <title>facebook/watchman: Watches files and records, or triggers actions, when they change.</title>
    <meta name="description" content="GitHub is where people build software. More than 27 million people use GitHub to discover, fork, and contribute to over 80 million projects.">
  <link rel="search" type="application/opensearchdescription+xml" href="https://github.com/opensearch.xml" title="GitHub">
  <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub">
  <meta property="fb:app_id" content="1401488693436528">

    
    <meta property="og:image" content="https://avatars0.githubusercontent.com/u/69631?s=400&amp;v=4"><meta property="og:site_name" content="GitHub"><meta property="og:type" content="object"><meta property="og:title" content="facebook/watchman"><meta property="og:url" content="https://github.com/facebook/watchman"><meta property="og:description" content="watchman - Watches files and records, or triggers actions, when they change. ">

  <link rel="assets" href="https://assets-cdn.github.com/">
  <link rel="web-socket" href="wss://live.github.com/_sockets/VjI6MjU2ODMxODg5OmQzYjBjZGMzMmNhZjQxMzU3MjgzY2Q1NTU2NWExN2E0MmFlMTk5OWNkMzI1NTBiOWMxZjQzMDZmNjNhZjhlMzY=--aa7a0f95ed99ee1d638b7d73d3d53b7d15a6614c">
  <meta name="pjax-timeout" content="1000">
  <link rel="sudo-modal" href="https://github.com/sessions/sudo_modal">
  <meta name="request-id" content="6D6F:6518:D75C19:1340FFB:5AC0FD26" data-pjax-transient="">


  

  <meta name="selected-link" value="repo_source" data-pjax-transient="">

    <meta name="google-site-verification" content="KT5gs8h0wvaagLKAVWq8bbeNwnZZK1r1XQysX3xurLU">
  <meta name="google-site-verification" content="ZzhVyEFwb7w3e0-uOTltm8Jsck2F5StVihD0exw2fsA">
  <meta name="google-site-verification" content="GXs5KoUUkNCoaAZn7wPN-t01Pywp9M3sEjnt_3_ZWPc">
    <meta name="google-analytics" content="UA-3769691-2">

<meta name="octolytics-host" content="collector.githubapp.com"><meta name="octolytics-app-id" content="github"><meta name="octolytics-event-url" content="https://collector.githubapp.com/github-external/browser_event"><meta name="octolytics-dimension-request_id" content="6D6F:6518:D75C19:1340FFB:5AC0FD26"><meta name="octolytics-dimension-region_edge" content="1"><meta name="octolytics-dimension-region_render" content="iad"><meta name="octolytics-actor-id" content="12552758"><meta name="octolytics-actor-login" content="Chen-Zhihui"><meta name="octolytics-actor-hash" content="756830ef2832c7e92e50d9938104614afc1e7c27bc0e459eba383a82c53fb868">
<meta name="hydro-events-url" content="https://github.com/hydro_browser_events">
<meta name="analytics-location" content="/&lt;user-name&gt;/&lt;repo-name&gt;" data-pjax-transient="true">




  <meta class="js-ga-set" name="dimension1" content="Logged In">


  

      <meta name="hostname" content="github.com">
    <meta name="user-login" content="Chen-Zhihui">

      <meta name="expected-hostname" content="github.com">
    <meta name="js-proxy-site-detection-payload" content="MWYwYWEwYjI2YTEzODllMTVhY2JhYmMyNzY4ODhiZjEwNGZmOTY1NWQ3MzdiN2MwZWFjYzcwMWQ5YzQyOWNkZnx7InJlbW90ZV9hZGRyZXNzIjoiMTA2LjQ3LjE2NS4yNDUiLCJyZXF1ZXN0X2lkIjoiNkQ2Rjo2NTE4OkQ3NUMxOToxMzQwRkZCOjVBQzBGRDI2IiwidGltZXN0YW1wIjoxNTIyNTk3MTYwLCJob3N0IjoiZ2l0aHViLmNvbSJ9">

    <meta name="enabled-features" content="UNIVERSE_BANNER,FREE_TRIALS,MARKETPLACE_INSIGHTS,MARKETPLACE_INSIGHTS_CONVERSION_PERCENTAGES">

  <meta name="html-safe-nonce" content="bc2c4eddcd7ead974c2214e14aa47089f1ee4bb2">

  <meta http-equiv="x-pjax-version" content="2a8622940bb010d0ebdd41ecb8362bdb">
  

      <link href="https://github.com/facebook/watchman/commits/master.atom" rel="alternate" title="Recent Commits to watchman:master" type="application/atom+xml">

  <meta name="description" content="watchman - Watches files and records, or triggers actions, when they change. ">
  <meta name="go-import" content="github.com/facebook/watchman git https://github.com/facebook/watchman.git">

  <meta name="octolytics-dimension-user_id" content="69631"><meta name="octolytics-dimension-user_login" content="facebook"><meta name="octolytics-dimension-repository_id" content="6930489"><meta name="octolytics-dimension-repository_nwo" content="facebook/watchman"><meta name="octolytics-dimension-repository_public" content="true"><meta name="octolytics-dimension-repository_is_fork" content="false"><meta name="octolytics-dimension-repository_network_root_id" content="6930489"><meta name="octolytics-dimension-repository_network_root_nwo" content="facebook/watchman"><meta name="octolytics-dimension-repository_explore_github_marketplace_ci_cta_shown" content="false">


    <link rel="canonical" href="https://github.com/facebook/watchman" data-pjax-transient="">


  <meta name="browser-stats-url" content="https://api.github.com/_private/browser/stats">

  <meta name="browser-errors-url" content="https://api.github.com/_private/browser/errors">

  <link rel="mask-icon" href="https://assets-cdn.github.com/pinned-octocat.svg" color="#000000">
  <link rel="icon" type="image/x-icon" class="js-site-favicon" href="https://assets-cdn.github.com/favicon.ico">

<meta name="theme-color" content="#1e2327">



<link rel="manifest" href="https://github.com/manifest.json" crossorigin="use-credentials">

  </head>

  <body class="logged-in env-production">
    

  <div class="position-relative js-header-wrapper ">
    <a href="#start-of-content" tabindex="1" class="bg-black text-white p-3 show-on-focus js-skip-to-content">Skip to content</a>
    <div id="js-pjax-loader-bar" class="pjax-loader-bar"><div class="progress"></div></div>

    
    
    



        
<header class="Header  f5" role="banner">
  <div class="d-flex flex-justify-between px-3 container-lg">
    <div class="d-flex flex-justify-between ">
      <div class="">
        <a class="header-logo-invertocat" href="https://github.com/" data-hotkey="g d" aria-label="Homepage" data-ga-click="Header, go to dashboard, icon:logo">
  <svg height="32" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg>
</a>

      </div>

    </div>

    <div class="HeaderMenu d-flex flex-justify-between flex-auto">
      <div class="d-flex">
            <div class="">
              <div class="header-search scoped-search site-scoped-search js-site-search" role="search">
  <!-- '"` --><!-- </textarea></xmp> --><form class="js-site-search-form" data-scoped-search-url="/facebook/watchman/search" data-unscoped-search-url="/search" action="/facebook/watchman/search" accept-charset="UTF-8" method="get"><input name="utf8" value="✓" type="hidden">
    <label class="form-control header-search-wrapper  js-chromeless-input-container">
        <a class="header-search-scope no-underline" href="https://github.com/facebook/watchman">This repository</a>
      <input class="form-control header-search-input  js-site-search-focus js-site-search-field is-clearable" data-hotkey="s,/" name="q" placeholder="Search" aria-label="Search this repository" data-unscoped-placeholder="Search GitHub" data-scoped-placeholder="Search" autocapitalize="off" type="text">
        <input class="js-site-search-type-field" name="type" type="hidden">
    </label>
</form></div>

            </div>

          <ul class="d-flex pl-2 flex-items-center text-bold list-style-none" role="navigation">
            <li>
              <a class="js-selected-navigation-item HeaderNavlink px-2" data-hotkey="g p" data-ga-click="Header, click, Nav menu - item:pulls context:user" aria-label="Pull requests you created" data-selected-links="/pulls /pulls/assigned /pulls/mentioned /pulls" href="https://github.com/pulls">
                Pull requests
</a>            </li>
            <li>
              <a class="js-selected-navigation-item HeaderNavlink px-2" data-hotkey="g i" data-ga-click="Header, click, Nav menu - item:issues context:user" aria-label="Issues you created" data-selected-links="/issues /issues/assigned /issues/mentioned /issues" href="https://github.com/issues">
                Issues
</a>            </li>
                <li>
                  <a class="js-selected-navigation-item HeaderNavlink px-2" data-ga-click="Header, click, Nav menu - item:marketplace context:user" data-selected-links=" /marketplace" href="https://github.com/marketplace">
                    Marketplace
</a>                </li>
            <li>
              <a class="js-selected-navigation-item HeaderNavlink px-2" data-ga-click="Header, click, Nav menu - item:explore" data-selected-links="/explore /trending /trending/developers /integrations /integrations/feature/code /integrations/feature/collaborate /integrations/feature/ship showcases showcases_search showcases_landing /explore" href="https://github.com/explore">
                Explore
</a>            </li>
          </ul>
      </div>

      <div class="d-flex">
        
<ul class="user-nav d-flex flex-items-center list-style-none" id="user-links">
  <li class="dropdown js-menu-container">
    <span class="d-inline-block  px-2">
      
    <a aria-label="You have unread notifications" class="notification-indicator tooltipped tooltipped-s  js-socket-channel js-notification-indicator" data-hotkey="g n" data-ga-click="Header, go to notifications, icon:unread" data-channel="notification-changed:12552758" href="https://github.com/notifications">
        <span class="mail-status unread"></span>
        <svg class="octicon octicon-bell" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M14 12v1H0v-1l.73-.58c.77-.77.81-2.55 1.19-4.42C2.69 3.23 6 2 6 2c0-.55.45-1 1-1s1 .45 1 1c0 0 3.39 1.23 4.16 5 .38 1.88.42 3.66 1.19 4.42l.66.58H14zm-7 4c1.11 0 2-.89 2-2H5c0 1.11.89 2 2 2z"></path></svg>
</a>
    </span>
  </li>

  <li class="dropdown js-menu-container">
    <details class="dropdown-details details-reset js-dropdown-details d-flex px-2 flex-items-center">
      <summary class="HeaderNavlink" aria-label="Create new…" data-ga-click="Header, create new, icon:add">
        <svg class="octicon octicon-plus float-left mr-1 mt-1" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 9H7v5H5V9H0V7h5V2h2v5h5z"></path></svg>
        <span class="dropdown-caret mt-1"></span>
      </summary>

      <ul class="dropdown-menu dropdown-menu-sw">
        
<a class="dropdown-item" href="https://github.com/new" data-ga-click="Header, create new repository">
  New repository
</a>

  <a class="dropdown-item" href="https://github.com/new/import" data-ga-click="Header, import a repository">
    Import repository
  </a>

<a class="dropdown-item" href="https://gist.github.com/" data-ga-click="Header, create new gist">
  New gist
</a>

  <a class="dropdown-item" href="https://github.com/organizations/new" data-ga-click="Header, create new organization">
    New organization
  </a>



  <div class="dropdown-divider"></div>
  <div class="dropdown-header">
    <span title="facebook/watchman">This repository</span>
  </div>
    <a class="dropdown-item" href="https://github.com/facebook/watchman/issues/new" data-ga-click="Header, create new issue">
      New issue
    </a>

      </ul>
    </details>
  </li>

  <li class="dropdown js-menu-container">

    <details class="dropdown-details details-reset js-dropdown-details d-flex pl-2 flex-items-center">
      <summary class="HeaderNavlink name mt-1" aria-label="View profile and more" data-ga-click="Header, show menu, icon:avatar">
        <img alt="@Chen-Zhihui" class="avatar float-left mr-1" src="12552758.png" width="20" height="20">
        <span class="dropdown-caret"></span>
      </summary>

      <ul class="dropdown-menu dropdown-menu-sw">
        <li class="dropdown-header header-nav-current-user css-truncate">
          Signed in as <strong class="css-truncate-target">Chen-Zhihui</strong>
        </li>

        <li class="dropdown-divider"></li>

        <li><a class="dropdown-item" href="https://github.com/Chen-Zhihui" data-ga-click="Header, go to profile, text:your profile">
          Your profile
        </a></li>
        <li><a class="dropdown-item" href="https://github.com/Chen-Zhihui?tab=stars" data-ga-click="Header, go to starred repos, text:your stars">
          Your stars
        </a></li>
          <li><a class="dropdown-item" href="https://gist.github.com/" data-ga-click="Header, your gists, text:your gists">Your gists</a></li>

        <li class="dropdown-divider"></li>

        <li><a class="dropdown-item" href="https://help.github.com/" data-ga-click="Header, go to help, text:help">
          Help
        </a></li>

        <li><a class="dropdown-item" href="https://github.com/settings/profile" data-ga-click="Header, go to settings, icon:settings">
          Settings
        </a></li>

        <li><!-- '"` --><!-- </textarea></xmp> --><form class="logout-form" action="/logout" accept-charset="UTF-8" method="post"><input name="utf8" value="✓" type="hidden"><input name="authenticity_token" value="iwX2DfumanxBugMF2f3zO3GrvmYlXJvPSvBcG34rATA/hp+SjKBlVwDEDQCCo5znnub4KNjhoZnxOq5qNyz4Dw==" type="hidden">
          <button type="submit" class="dropdown-item dropdown-signout" data-ga-click="Header, sign out, icon:logout">
            Sign out
          </button>
        </form></li>
      </ul>
    </details>
  </li>
</ul>



        <!-- '"` --><!-- </textarea></xmp> --><form class="sr-only right-0" action="/logout" accept-charset="UTF-8" method="post"><input name="utf8" value="✓" type="hidden"><input name="authenticity_token" value="qa0Tq/UhSNVYDsdRECFZvokiyKgxhpqhaOBt2mA2aWwdLno0gidH/hlwyVRLfzZiZm+O5sw7oPfTKp+rKTGQUw==" type="hidden">
          <button type="submit" class="dropdown-item dropdown-signout" data-ga-click="Header, sign out, icon:logout">
            Sign out
          </button>
</form>      </div>
    </div>
  </div>
</header>

      

  </div>

  <div id="start-of-content" class="show-on-focus"></div>

    <div id="js-flash-container">
</div>



  <div role="main" class="application-main ">
        <div itemscope="" itemtype="http://schema.org/SoftwareSourceCode" class="">
    <div id="js-repo-pjax-container" data-pjax-container="">
      



  



  <div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav  ">
    <div class="repohead-details-container clearfix container">

      <ul class="pagehead-actions">
  <li>
        <!-- '"` --><!-- </textarea></xmp> --><form data-autosubmit="true" data-remote="true" class="js-social-container" action="/notifications/subscribe" accept-charset="UTF-8" method="post"><input name="utf8" value="✓" type="hidden"><input name="authenticity_token" value="eMGzNGz34HKddk7spa7WRDrQ/HSL6Ms4GW8Btzk5KuHM8EQkabU+9XVnVDsVvuk52lQ6bxZnbbjKoW0IDvbf3A==" type="hidden">      <input name="repository_id" id="repository_id" value="6930489" class="form-control" type="hidden">

        <div class="select-menu js-menu-container js-select-menu">
          <a href="https://github.com/facebook/watchman/subscription" class="btn btn-sm btn-with-count select-menu-button js-menu-target" role="button" aria-haspopup="true" aria-expanded="false" aria-label="Toggle repository notifications menu" data-ga-click="Repository, click Watch settings, action:files#disambiguate">
            <span class="js-select-button">
                <svg class="octicon octicon-eye" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8.06 2C3 2 0 8 0 8s3 6 8.06 6C13 14 16 8 16 8s-3-6-7.94-6zM8 12c-2.2 0-4-1.78-4-4 0-2.2 1.8-4 4-4 2.22 0 4 1.8 4 4 0 2.22-1.78 4-4 4zm2-4c0 1.11-.89 2-2 2-1.11 0-2-.89-2-2 0-1.11.89-2 2-2 1.11 0 2 .89 2 2z"></path></svg>
                Watch
            </span>
          </a>
          <a class="social-count js-social-count" href="https://github.com/facebook/watchman/watchers" aria-label="258 users are watching this repository">
            258
          </a>

        <div class="select-menu-modal-holder">
          <div class="select-menu-modal subscription-menu-modal js-menu-content">
            <div class="select-menu-header js-navigation-enable" tabindex="-1">
              <svg class="octicon octicon-x js-menu-close" role="img" aria-label="Close" viewBox="0 0 12 16" version="1.1" width="12" height="16"><path fill-rule="evenodd" d="M7.48 8l3.75 3.75-1.48 1.48L6 9.48l-3.75 3.75-1.48-1.48L4.52 8 .77 4.25l1.48-1.48L6 6.52l3.75-3.75 1.48 1.48z"></path></svg>
              <span class="select-menu-title">Notifications</span>
            </div>

              <div class="select-menu-list js-navigation-container" role="menu">

                <div class="select-menu-item js-navigation-item selected" role="menuitem" tabindex="0">
                  <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
                  <div class="select-menu-item-text">
                    <input name="do" id="do_included" value="included" checked="checked" type="radio">
                    <span class="select-menu-item-heading">Not watching</span>
                    <span class="description">Be notified when participating or @mentioned.</span>
                    <span class="js-select-button-text hidden-select-button-text">
                      <svg class="octicon octicon-eye" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8.06 2C3 2 0 8 0 8s3 6 8.06 6C13 14 16 8 16 8s-3-6-7.94-6zM8 12c-2.2 0-4-1.78-4-4 0-2.2 1.8-4 4-4 2.22 0 4 1.8 4 4 0 2.22-1.78 4-4 4zm2-4c0 1.11-.89 2-2 2-1.11 0-2-.89-2-2 0-1.11.89-2 2-2 1.11 0 2 .89 2 2z"></path></svg>
                      Watch
                    </span>
                  </div>
                </div>

                <div class="select-menu-item js-navigation-item " role="menuitem" tabindex="0">
                  <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
                  <div class="select-menu-item-text">
                    <input name="do" id="do_subscribed" value="subscribed" type="radio">
                    <span class="select-menu-item-heading">Watching</span>
                    <span class="description">Be notified of all conversations.</span>
                    <span class="js-select-button-text hidden-select-button-text">
                      <svg class="octicon octicon-eye" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8.06 2C3 2 0 8 0 8s3 6 8.06 6C13 14 16 8 16 8s-3-6-7.94-6zM8 12c-2.2 0-4-1.78-4-4 0-2.2 1.8-4 4-4 2.22 0 4 1.8 4 4 0 2.22-1.78 4-4 4zm2-4c0 1.11-.89 2-2 2-1.11 0-2-.89-2-2 0-1.11.89-2 2-2 1.11 0 2 .89 2 2z"></path></svg>
                        Unwatch
                    </span>
                  </div>
                </div>

                <div class="select-menu-item js-navigation-item " role="menuitem" tabindex="0">
                  <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
                  <div class="select-menu-item-text">
                    <input name="do" id="do_ignore" value="ignore" type="radio">
                    <span class="select-menu-item-heading">Ignoring</span>
                    <span class="description">Never be notified.</span>
                    <span class="js-select-button-text hidden-select-button-text">
                      <svg class="octicon octicon-mute" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 2.81v10.38c0 .67-.81 1-1.28.53L3 10H1c-.55 0-1-.45-1-1V7c0-.55.45-1 1-1h2l3.72-3.72C7.19 1.81 8 2.14 8 2.81zm7.53 3.22l-1.06-1.06-1.97 1.97-1.97-1.97-1.06 1.06L11.44 8 9.47 9.97l1.06 1.06 1.97-1.97 1.97 1.97 1.06-1.06L13.56 8l1.97-1.97z"></path></svg>
                        Stop ignoring
                    </span>
                  </div>
                </div>

              </div>

            </div>
          </div>
        </div>
</form>
  </li>

  <li>
    
  <div class="js-toggler-container js-social-container starring-container ">
    <!-- '"` --><!-- </textarea></xmp> --><form class="starred js-social-form" action="/facebook/watchman/unstar" accept-charset="UTF-8" method="post"><input name="utf8" value="✓" type="hidden"><input name="authenticity_token" value="Io6Y3VCreuqIyqB8Cusqtg2Qom1KAgsiHCBImAagBWZVoxn3FDhWpwJ3AFJ0lnG+dcInSyrIv0OP7HnJvstZ/Q==" type="hidden">
      <input name="context" value="repository" type="hidden">
      <button type="submit" class="btn btn-sm btn-with-count js-toggler-target" aria-label="Unstar this repository" title="Unstar facebook/watchman" data-ga-click="Repository, click unstar button, action:files#disambiguate; text:Unstar">
        <svg class="octicon octicon-star" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M14 6l-4.9-.64L7 1 4.9 5.36 0 6l3.6 3.26L2.67 14 7 11.67 11.33 14l-.93-4.74z"></path></svg>
        Unstar
      </button>
        <a class="social-count js-social-count" href="https://github.com/facebook/watchman/stargazers" aria-label="6438 users starred this repository">
          6,438
        </a>
</form>
    <!-- '"` --><!-- </textarea></xmp> --><form class="unstarred js-social-form" action="/facebook/watchman/star" accept-charset="UTF-8" method="post"><input name="utf8" value="✓" type="hidden"><input name="authenticity_token" value="eCkwfTphr8y8Z6V5l9uXsiz9R3LAq4gczi/UTgX4AuCVCYkTOH1emOnDkUsSI0p+KRcnZJ+crs4lCjXuoT1p1A==" type="hidden">
      <input name="context" value="repository" type="hidden">
      <button type="submit" class="btn btn-sm btn-with-count js-toggler-target" aria-label="Star this repository" title="Star facebook/watchman" data-ga-click="Repository, click star button, action:files#disambiguate; text:Star">
        <svg class="octicon octicon-star" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M14 6l-4.9-.64L7 1 4.9 5.36 0 6l3.6 3.26L2.67 14 7 11.67 11.33 14l-.93-4.74z"></path></svg>
        Star
      </button>
        <a class="social-count js-social-count" href="https://github.com/facebook/watchman/stargazers" aria-label="6438 users starred this repository">
          6,438
        </a>
</form>  </div>

  </li>

  <li>
          <a href="#fork-destination-box" class="btn btn-sm btn-with-count" title="Fork your own copy of facebook/watchman to your account" aria-label="Fork your own copy of facebook/watchman to your account" rel="facebox" data-ga-click="Repository, show fork modal, action:files#disambiguate; text:Fork">
              <svg class="octicon octicon-repo-forked" viewBox="0 0 10 16" version="1.1" width="10" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 1a1.993 1.993 0 0 0-1 3.72V6L5 8 3 6V4.72A1.993 1.993 0 0 0 2 1a1.993 1.993 0 0 0-1 3.72V6.5l3 3v1.78A1.993 1.993 0 0 0 5 15a1.993 1.993 0 0 0 1-3.72V9.5l3-3V4.72A1.993 1.993 0 0 0 8 1zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zm3 10c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zm3-10c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
            Fork
          </a>

          <div id="fork-destination-box" style="display: none;">
            <h2 class="facebox-header" data-facebox-id="facebox-header">Where should we fork this repository?</h2>
            <include-fragment src="" class="js-fork-select-fragment fork-select-fragment" data-url="/facebook/watchman/fork?fragment=1">
              <img alt="Loading" src="octocat-spinner-128.gif" width="64" height="64">
            </include-fragment>
          </div>

    <a href="https://github.com/facebook/watchman/network" class="social-count" aria-label="511 users forked this repository">
      511
    </a>
  </li>
</ul>

      <h1 class="public ">
  <svg class="octicon octicon-repo" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9H3V8h1v1zm0-3H3v1h1V6zm0-2H3v1h1V4zm0-2H3v1h1V2zm8-1v12c0 .55-.45 1-1 1H6v2l-1.5-1.5L3 16v-2H1c-.55 0-1-.45-1-1V1c0-.55.45-1 1-1h10c.55 0 1 .45 1 1zm-1 10H1v2h2v-1h3v1h5v-2zm0-10H2v9h9V1z"></path></svg>
  <span class="author" itemprop="author"><a class="url fn" rel="author" href="https://github.com/facebook">facebook</a></span><!--
--><span class="path-divider">/</span><!--
--><strong itemprop="name"><a data-pjax="#js-repo-pjax-container" href="https://github.com/facebook/watchman">watchman</a></strong>

</h1>

    </div>
    
<nav class="reponav js-repo-nav js-sidenav-container-pjax container" itemscope="" itemtype="http://schema.org/BreadcrumbList" role="navigation" data-pjax="#js-repo-pjax-container">

  <span itemscope="" itemtype="http://schema.org/ListItem" itemprop="itemListElement">
    <a class="js-selected-navigation-item selected reponav-item" itemprop="url" data-hotkey="g c" data-selected-links="repo_source repo_downloads repo_commits repo_releases repo_tags repo_branches repo_packages /facebook/watchman" href="https://github.com/facebook/watchman">
      <svg class="octicon octicon-code" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M9.5 3L8 4.5 11.5 8 8 11.5 9.5 13 14 8 9.5 3zm-5 0L0 8l4.5 5L6 11.5 2.5 8 6 4.5 4.5 3z"></path></svg>
      <span itemprop="name">Code</span>
      <meta itemprop="position" content="1">
</a>  </span>

    <span itemscope="" itemtype="http://schema.org/ListItem" itemprop="itemListElement">
      <a itemprop="url" data-hotkey="g i" class="js-selected-navigation-item reponav-item" data-selected-links="repo_issues repo_labels repo_milestones /facebook/watchman/issues" href="https://github.com/facebook/watchman/issues">
        <svg class="octicon octicon-issue-opened" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
        <span itemprop="name">Issues</span>
        <span class="Counter">41</span>
        <meta itemprop="position" content="2">
</a>    </span>

  <span itemscope="" itemtype="http://schema.org/ListItem" itemprop="itemListElement">
    <a data-hotkey="g p" itemprop="url" class="js-selected-navigation-item reponav-item" data-selected-links="repo_pulls checks /facebook/watchman/pulls" href="https://github.com/facebook/watchman/pulls">
      <svg class="octicon octicon-git-pull-request" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
      <span itemprop="name">Pull requests</span>
      <span class="Counter">4</span>
      <meta itemprop="position" content="3">
</a>  </span>

    <a data-hotkey="g b" class="js-selected-navigation-item reponav-item" data-selected-links="repo_projects new_repo_project repo_project /facebook/watchman/projects" href="https://github.com/facebook/watchman/projects">
      <svg class="octicon octicon-project" viewBox="0 0 15 16" version="1.1" width="15" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M10 12h3V2h-3v10zm-4-2h3V2H6v8zm-4 4h3V2H2v12zm-1 1h13V1H1v14zM14 0H1a1 1 0 0 0-1 1v14a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1z"></path></svg>
      Projects
      <span class="Counter">0</span>
</a>
    <a class="js-selected-navigation-item reponav-item" data-hotkey="g w" data-selected-links="repo_wiki /facebook/watchman/wiki" href="https://github.com/facebook/watchman/wiki">
      <svg class="octicon octicon-book" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M3 5h4v1H3V5zm0 3h4V7H3v1zm0 2h4V9H3v1zm11-5h-4v1h4V5zm0 2h-4v1h4V7zm0 2h-4v1h4V9zm2-6v9c0 .55-.45 1-1 1H9.5l-1 1-1-1H2c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h5.5l1 1 1-1H15c.55 0 1 .45 1 1zm-8 .5L7.5 3H2v9h6V3.5zm7-.5H9.5l-.5.5V12h6V3z"></path></svg>
      Wiki
</a>

  <a class="js-selected-navigation-item reponav-item" data-selected-links="repo_graphs repo_contributors dependency_graph pulse /facebook/watchman/pulse" href="https://github.com/facebook/watchman/pulse">
    <svg class="octicon octicon-graph" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M16 14v1H0V0h1v14h15zM5 13H3V8h2v5zm4 0H7V3h2v10zm4 0h-2V6h2v7z"></path></svg>
    Insights
</a>

</nav>


  </div>

<div class="container new-discussion-timeline experiment-repo-nav  ">
  <div class="repository-content ">

    
  

  <div class="js-repo-meta-container">
  <div class="repository-meta mb-0 mb-3 js-repo-meta-edit js-details-container ">
    <div class="repository-meta-content col-11 mb-1">
          <span class="col-11 text-gray-dark mr-2" itemprop="about">
            Watches files and records, or triggers actions, when they change. 
          </span>
          <span itemprop="url"><a rel="nofollow" href="https://facebook.github.io/watchman/">https://facebook.github.io/watchman/</a></span>
    </div>

  </div>

</div>



  <div class="overall-summary overall-summary-bottomless">
    <div class="stats-switcher-viewport js-stats-switcher-viewport">
      <div class="stats-switcher-wrapper">
      <ul class="numbers-summary">
        <li class="commits">
          <a data-pjax="" href="https://github.com/facebook/watchman/commits/master">
              <svg class="octicon octicon-history" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 13H6V6h5v2H8v5zM7 1C4.81 1 2.87 2.02 1.59 3.59L0 2v4h4L2.5 4.5C3.55 3.17 5.17 2.3 7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-.34.03-.67.09-1H.08C.03 7.33 0 7.66 0 8c0 3.86 3.14 7 7 7s7-3.14 7-7-3.14-7-7-7z"></path></svg>
              <span class="num text-emphasized">
                1,900
              </span>
              commits
          </a>
        </li>
        <li>
          <a data-pjax="" href="https://github.com/facebook/watchman/branches">
            <svg class="octicon octicon-git-branch" viewBox="0 0 10 16" version="1.1" width="10" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M10 5c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v.3c-.02.52-.23.98-.63 1.38-.4.4-.86.61-1.38.63-.83.02-1.48.16-2 .45V4.72a1.993 1.993 0 0 0-1-3.72C.88 1 0 1.89 0 3a2 2 0 0 0 1 1.72v6.56c-.59.35-1 .99-1 1.72 0 1.11.89 2 2 2 1.11 0 2-.89 2-2 0-.53-.2-1-.53-1.36.09-.06.48-.41.59-.47.25-.11.56-.17.94-.17 1.05-.05 1.95-.45 2.75-1.25S8.95 7.77 9 6.73h-.02C9.59 6.37 10 5.73 10 5zM2 1.8c.66 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2C1.35 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2zm0 12.41c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zm6-8c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
            <span class="num text-emphasized">
              2
            </span>
            branches
          </a>
        </li>

        <li>
          <a href="https://github.com/facebook/watchman/releases">
            <svg class="octicon octicon-tag" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.73 1.73C7.26 1.26 6.62 1 5.96 1H3.5C2.13 1 1 2.13 1 3.5v2.47c0 .66.27 1.3.73 1.77l6.06 6.06c.39.39 1.02.39 1.41 0l4.59-4.59a.996.996 0 0 0 0-1.41L7.73 1.73zM2.38 7.09c-.31-.3-.47-.7-.47-1.13V3.5c0-.88.72-1.59 1.59-1.59h2.47c.42 0 .83.16 1.13.47l6.14 6.13-4.73 4.73-6.13-6.15zM3.01 3h2v2H3V3h.01z"></path></svg>
            <span class="num text-emphasized">
              69
            </span>
            releases
          </a>
        </li>

        <li>
            <a href="https://github.com/facebook/watchman/graphs/contributors">
  <svg class="octicon octicon-organization" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M16 12.999c0 .439-.45 1-1 1H7.995c-.539 0-.994-.447-.995-.999H1c-.54 0-1-.561-1-1 0-2.634 3-4 3-4s.229-.409 0-1c-.841-.621-1.058-.59-1-3 .058-2.419 1.367-3 2.5-3s2.442.58 2.5 3c.058 2.41-.159 2.379-1 3-.229.59 0 1 0 1s1.549.711 2.42 2.088C9.196 9.369 10 8.999 10 8.999s.229-.409 0-1c-.841-.62-1.058-.59-1-3 .058-2.419 1.367-3 2.5-3s2.437.581 2.495 3c.059 2.41-.158 2.38-1 3-.229.59 0 1 0 1s3.005 1.366 3.005 4"></path></svg>
    <span class="num text-emphasized">
      87
    </span>
    contributors
</a>

        </li>
          <li>
            <a href="https://github.com/facebook/watchman/blob/master/LICENSE">
              <svg class="octicon octicon-law" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7 4c-.83 0-1.5-.67-1.5-1.5S6.17 1 7 1s1.5.67 1.5 1.5S7.83 4 7 4zm7 6c0 1.11-.89 2-2 2h-1c-1.11 0-2-.89-2-2l2-4h-1c-.55 0-1-.45-1-1H8v8c.42 0 1 .45 1 1h1c.42 0 1 .45 1 1H3c0-.55.58-1 1-1h1c0-.55.58-1 1-1h.03L6 5H5c0 .55-.45 1-1 1H3l2 4c0 1.11-.89 2-2 2H2c-1.11 0-2-.89-2-2l2-4H1V5h3c0-.55.45-1 1-1h4c.55 0 1 .45 1 1h3v1h-1l2 4zM2.5 7L1 10h3L2.5 7zM13 10l-1.5-3-1.5 3h3z"></path></svg>
                Apache-2.0
            </a>
          </li>
      </ul>

        <div class="repository-lang-stats">
          <ol class="repository-lang-stats-numbers">
            <li>
                <a href="https://github.com/facebook/watchman/search?l=c%2B%2B" data-ga-click="Repository, language stats search click, location:repo overview">
                  <span class="color-block language-color" style="background-color:#f34b7d;"></span>
                  <span class="lang">C++</span>
                  <span class="percent">52.3%</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/facebook/watchman/search?l=python" data-ga-click="Repository, language stats search click, location:repo overview">
                  <span class="color-block language-color" style="background-color:#3572A5;"></span>
                  <span class="lang">Python</span>
                  <span class="percent">22.1%</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/facebook/watchman/search?l=java" data-ga-click="Repository, language stats search click, location:repo overview">
                  <span class="color-block language-color" style="background-color:#b07219;"></span>
                  <span class="lang">Java</span>
                  <span class="percent">8.7%</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/facebook/watchman/search?l=c" data-ga-click="Repository, language stats search click, location:repo overview">
                  <span class="color-block language-color" style="background-color:#555555;"></span>
                  <span class="lang">C</span>
                  <span class="percent">3.6%</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/facebook/watchman/search?l=rust" data-ga-click="Repository, language stats search click, location:repo overview">
                  <span class="color-block language-color" style="background-color:#dea584;"></span>
                  <span class="lang">Rust</span>
                  <span class="percent">2.7%</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/facebook/watchman/search?l=css" data-ga-click="Repository, language stats search click, location:repo overview">
                  <span class="color-block language-color" style="background-color:#563d7c;"></span>
                  <span class="lang">CSS</span>
                  <span class="percent">2.2%</span>
                </a>
            </li>
            <li>
                <span>
                  <span class="color-block language-color" style="background-color:#ededed;"></span>
                  <span class="lang">Other</span>
                  <span class="percent">8.4%</span>
                </span>
            </li>
          </ol>
        </div>
      </div>
    </div>
  </div>

    <div class="repository-lang-stats-graph js-toggle-lang-stats" title="Click for language details" data-ga-click="Repository, language bar stats toggle, location:repo overview">
      <span class="language-color" aria-label="C++ 52.3%" style="width:52.3%; background-color:#f34b7d;" itemprop="keywords">C++</span>
      <span class="language-color" aria-label="Python 22.1%" style="width:22.1%; background-color:#3572A5;" itemprop="keywords">Python</span>
      <span class="language-color" aria-label="Java 8.7%" style="width:8.7%; background-color:#b07219;" itemprop="keywords">Java</span>
      <span class="language-color" aria-label="C 3.6%" style="width:3.6%; background-color:#555555;" itemprop="keywords">C</span>
      <span class="language-color" aria-label="Rust 2.7%" style="width:2.7%; background-color:#dea584;" itemprop="keywords">Rust</span>
      <span class="language-color" aria-label="CSS 2.2%" style="width:2.2%; background-color:#563d7c;" itemprop="keywords">CSS</span>
      <span class="language-color" aria-label="Other 8.4%" style="width:8.4%; background-color:#ededed;" itemprop="keywords">Other</span>
    </div>


    <include-fragment src="/facebook/watchman/show_partial?partial=tree%2Frecently_touched_branches_list"></include-fragment>

  <div class="file-navigation in-mid-page">

    <details class="get-repo-select-menu js-get-repo-select-menu float-right position-relative dropdown-details details-reset">
  <summary class="btn btn-sm btn-primary">
    Clone or download
    <span class="dropdown-caret"></span>
  </summary>
  <div class="position-relative">
    <div class="get-repo-modal dropdown-menu dropdown-menu-sw pb-0 js-toggler-container  js-get-repo-modal">

      <div class="get-repo-modal-options">
          <div class="clone-options https-clone-options">
              <!-- '"` --><!-- </textarea></xmp> --><form data-remote="true" action="/users/set_protocol?protocol_selector=ssh&amp;protocol_type=clone" accept-charset="UTF-8" method="post"><input name="utf8" value="✓" type="hidden"><input name="authenticity_token" value="0W82jD7JxOUVNmgmbwkoAq3WvUlWyUy+RH4a9I7kfpAmfqApISef3ITrC2dBvXMDrEgxW+Ysxe3ahH5oLwy86Q==" type="hidden"><button type="submit" class="btn-link btn-change-protocol js-toggler-target float-right">Use SSH</button></form>

            <h4 class="mb-1">
              Clone with HTTPS
              <a class="muted-link" href="https://help.github.com/articles/which-remote-url-should-i-use" target="_blank" title="Which remote URL should I use?">
                <svg class="octicon octicon-question" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 10h2v2H6v-2zm4-3.5C10 8.64 8 9 8 9H6c0-.55.45-1 1-1h.5c.28 0 .5-.22.5-.5v-1c0-.28-.22-.5-.5-.5h-1c-.28 0-.5.22-.5.5V7H4c0-1.5 1.5-3 3-3s3 1 3 2.5zM7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7z"></path></svg>
              </a>
            </h4>
            <p class="mb-2 get-repo-decription-text">
              Use Git or checkout with SVN using the web URL.
            </p>

            <div class="input-group">
  <input class="form-control input-monospace input-sm js-url-field" value="https://github.com/facebook/watchman.git" aria-label="Clone this repository at https://github.com/facebook/watchman.git" readonly="readonly" type="text">
  <div class="input-group-button">
    <clipboard-copy value="https://github.com/facebook/watchman.git" aria-label="Copy to clipboard" class="btn btn-sm tooltipped tooltipped-s" copied-label="Copied!">
      <svg class="octicon octicon-clippy" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M2 13h4v1H2v-1zm5-6H2v1h5V7zm2 3V8l-3 3 3 3v-2h5v-2H9zM4.5 9H2v1h2.5V9zM2 12h2.5v-1H2v1zm9 1h1v2c-.02.28-.11.52-.3.7-.19.18-.42.28-.7.3H1c-.55 0-1-.45-1-1V4c0-.55.45-1 1-1h3c0-1.11.89-2 2-2 1.11 0 2 .89 2 2h3c.55 0 1 .45 1 1v5h-1V6H1v9h10v-2zM2 5h8c0-.55-.45-1-1-1H8c-.55 0-1-.45-1-1s-.45-1-1-1-1 .45-1 1-.45 1-1 1H3c-.55 0-1 .45-1 1z"></path></svg>
    </clipboard-copy>
  </div>
</div>

          </div>

          <div class="clone-options ssh-clone-options">
              <!-- '"` --><!-- </textarea></xmp> --><form data-remote="true" action="/users/set_protocol?protocol_selector=https&amp;protocol_type=clone" accept-charset="UTF-8" method="post"><input name="utf8" value="✓" type="hidden"><input name="authenticity_token" value="ErsKtWvUv2gHCyUagBDmE0UFsY8KLM46c9rxr92U8/flqpwQdDrkUZbWRluupL0SRJs9nbrJR2ntIJUzfHwxjg==" type="hidden"><button type="submit" class="btn-link btn-change-protocol js-toggler-target float-right">Use HTTPS</button></form>

              <h4 class="mb-1">
                Clone with SSH
                <a class="muted-link" href="https://help.github.com/articles/which-remote-url-should-i-use" target="_blank" title="Which remote URL should I use?">
                  <svg class="octicon octicon-question" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 10h2v2H6v-2zm4-3.5C10 8.64 8 9 8 9H6c0-.55.45-1 1-1h.5c.28 0 .5-.22.5-.5v-1c0-.28-.22-.5-.5-.5h-1c-.28 0-.5.22-.5.5V7H4c0-1.5 1.5-3 3-3s3 1 3 2.5zM7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7z"></path></svg>
                </a>
              </h4>
              <p class="mb-2 get-repo-decription-text">
                Use an SSH key and passphrase from account.
              </p>

              <div class="input-group">
  <input class="form-control input-monospace input-sm js-url-field" value="git@github.com:facebook/watchman.git" aria-label="Clone this repository at git@github.com:facebook/watchman.git" readonly="readonly" type="text">
  <div class="input-group-button">
    <clipboard-copy value="git@github.com:facebook/watchman.git" aria-label="Copy to clipboard" class="btn btn-sm tooltipped tooltipped-s" copied-label="Copied!">
      <svg class="octicon octicon-clippy" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M2 13h4v1H2v-1zm5-6H2v1h5V7zm2 3V8l-3 3 3 3v-2h5v-2H9zM4.5 9H2v1h2.5V9zM2 12h2.5v-1H2v1zm9 1h1v2c-.02.28-.11.52-.3.7-.19.18-.42.28-.7.3H1c-.55 0-1-.45-1-1V4c0-.55.45-1 1-1h3c0-1.11.89-2 2-2 1.11 0 2 .89 2 2h3c.55 0 1 .45 1 1v5h-1V6H1v9h10v-2zM2 5h8c0-.55-.45-1-1-1H8c-.55 0-1-.45-1-1s-.45-1-1-1-1 .45-1 1-.45 1-1 1H3c-.55 0-1 .45-1 1z"></path></svg>
    </clipboard-copy>
  </div>
</div>

          </div>
        <div class="mt-2">
          
<a href="https://github.com/facebook/watchman/archive/master.zip" class="btn btn-outline get-repo-btn
" rel="nofollow" data-ga-click="Repository, download zip, location:repo overview">
  Download ZIP
</a>

        </div>
      </div>

      <div class="js-modal-download-mac py-2 px-3 d-none">
        <h4 class="lh-condensed mb-3">Launching GitHub Desktop<span class="animated-ellipsis-container"><span class="animated-ellipsis">...</span></span></h4>
        <p class="text-gray">If nothing happens, <a href="https://desktop.github.com/">download GitHub Desktop</a> and try again.</p>
        <p><button class="btn-link js-get-repo-modal-download-back">Go back</button></p>
      </div>

      <div class="js-modal-download-windows py-2 px-3 d-none">
        <h4 class="lh-condensed mb-3">Launching GitHub Desktop<span class="animated-ellipsis-container"><span class="animated-ellipsis">...</span></span></h4>
        <p class="text-gray">If nothing happens, <a href="https://desktop.github.com/">download GitHub Desktop</a> and try again.</p>
        <p><button class="btn-link js-get-repo-modal-download-back">Go back</button></p>
      </div>

      <div class="js-modal-download-xcode py-2 px-3 d-none">
        <h4 class="lh-condensed mb-3">Launching Xcode<span class="animated-ellipsis-container"><span class="animated-ellipsis">...</span></span></h4>
        <p class="text-gray">If nothing happens, <a href="https://developer.apple.com/xcode/">download Xcode</a> and try again.</p>
        <p><button class="btn-link js-get-repo-modal-download-back">Go back</button></p>
      </div>

      <div class="js-modal-download-visual-studio py-2 px-3 d-none">
        <h4 class="lh-condensed mb-3">Launching Visual Studio<span class="animated-ellipsis-container"><span class="animated-ellipsis">...</span></span></h4>
        <p class="text-gray">If nothing happens, <a href="https://visualstudio.github.com/">download the GitHub extension for Visual Studio</a> and try again.</p>
        <p><button class="btn-link js-get-repo-modal-download-back">Go back</button></p>
      </div>

    </div>
  </div>
</details>


  <div class="BtnGroup float-right">
      
  <!-- '"` --><!-- </textarea></xmp> --><form class="BtnGroup-form" action="/facebook/watchman/new/master" accept-charset="UTF-8" method="post"><input name="utf8" value="✓" type="hidden"><input name="authenticity_token" value="8Gm6U2t0SIgIDO3hdKqhLtYHd5b/xVTJAq1K3XsfBygJhSySgnOEPgWK9KtXIHmO6T4SESvuHCIhFWMqiELlkQ==" type="hidden">
    <button class="btn btn-sm BtnGroup-item" type="submit" data-disable-with="Creating file…">
      Create new file
    </button>
</form>

      
  <a href="https://github.com/facebook/watchman/upload/master" class="btn btn-sm BtnGroup-item">
    Upload files
  </a>


    <a href="https://github.com/facebook/watchman/find/master" class="btn btn-sm empty-icon float-right BtnGroup-item" data-pjax="" data-hotkey="t" data-ga-click="Repository, find file, location:repo overview">
      Find file
    </a>
  </div>

  
<div class="select-menu branch-select-menu js-menu-container js-select-menu float-left">
  <button class=" btn btn-sm select-menu-button js-menu-target css-truncate" data-hotkey="w" type="button" aria-label="Switch branches or tags" aria-expanded="false" aria-haspopup="true">
      <i>Branch:</i>
      <span class="js-select-button css-truncate-target">master</span>
  </button>

  <div class="select-menu-modal-holder js-menu-content js-navigation-container" data-pjax="">

    <div class="select-menu-modal">
      <div class="select-menu-header">
        <svg class="octicon octicon-x js-menu-close" role="img" aria-label="Close" viewBox="0 0 12 16" version="1.1" width="12" height="16"><path fill-rule="evenodd" d="M7.48 8l3.75 3.75-1.48 1.48L6 9.48l-3.75 3.75-1.48-1.48L4.52 8 .77 4.25l1.48-1.48L6 6.52l3.75-3.75 1.48 1.48z"></path></svg>
        <span class="select-menu-title">Switch branches/tags</span>
      </div>

      <div class="select-menu-filters">
        <div class="select-menu-text-filter">
          <input aria-label="Filter branches/tags" id="context-commitish-filter-field" class="form-control js-filterable-field js-navigation-enable" placeholder="Filter branches/tags" type="text">
        </div>
        <div class="select-menu-tabs">
          <ul>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="branches" data-filter-placeholder="Filter branches/tags" class="js-select-menu-tab" role="tab">Branches</a>
            </li>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="tags" data-filter-placeholder="Find a tag…" class="js-select-menu-tab" role="tab">Tags</a>
            </li>
          </ul>
        </div>
      </div>

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="branches" role="menu">

        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/gh-pages" data-name="gh-pages" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target js-select-menu-filter-text">
                gh-pages
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open selected" href="https://github.com/facebook/watchman/tree/master" data-name="master" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target js-select-menu-filter-text">
                master
              </span>
            </a>
        </div>

          <div class="select-menu-no-results">Nothing to show</div>
      </div>

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="tags">
        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v4.9.0" data-name="v4.9.0" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v4.9.0">
                v4.9.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v4.9.0-rc1" data-name="v4.9.0-rc1" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v4.9.0-rc1">
                v4.9.0-rc1
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v4.8.0-rc1" data-name="v4.8.0-rc1" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v4.8.0-rc1">
                v4.8.0-rc1
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v4.7.0" data-name="v4.7.0" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v4.7.0">
                v4.7.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v4.7.0-rc1" data-name="v4.7.0-rc1" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v4.7.0-rc1">
                v4.7.0-rc1
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v4.6.0" data-name="v4.6.0" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v4.6.0">
                v4.6.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v4.6.0-rc14" data-name="v4.6.0-rc14" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v4.6.0-rc14">
                v4.6.0-rc14
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v4.6.0-rc13" data-name="v4.6.0-rc13" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v4.6.0-rc13">
                v4.6.0-rc13
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v4.6.0-rc12" data-name="v4.6.0-rc12" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v4.6.0-rc12">
                v4.6.0-rc12
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v4.6.0-rc11" data-name="v4.6.0-rc11" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v4.6.0-rc11">
                v4.6.0-rc11
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v4.6.0-rc9" data-name="v4.6.0-rc9" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v4.6.0-rc9">
                v4.6.0-rc9
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v4.6.0-rc2" data-name="v4.6.0-rc2" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v4.6.0-rc2">
                v4.6.0-rc2
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v4.6.0-rc1" data-name="v4.6.0-rc1" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v4.6.0-rc1">
                v4.6.0-rc1
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v4.5.0" data-name="v4.5.0" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v4.5.0">
                v4.5.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v4.4.0" data-name="v4.4.0" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v4.4.0">
                v4.4.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v4.4.0_rc1" data-name="v4.4.0_rc1" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v4.4.0_rc1">
                v4.4.0_rc1
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v4.4.0-rc1" data-name="v4.4.0-rc1" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v4.4.0-rc1">
                v4.4.0-rc1
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v4.3.0" data-name="v4.3.0" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v4.3.0">
                v4.3.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v4.2.0" data-name="v4.2.0" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v4.2.0">
                v4.2.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v4.1.0" data-name="v4.1.0" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v4.1.0">
                v4.1.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v4.0.0" data-name="v4.0.0" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v4.0.0">
                v4.0.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v3.9.0" data-name="v3.9.0" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v3.9.0">
                v3.9.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v3.9.0-rc1" data-name="v3.9.0-rc1" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v3.9.0-rc1">
                v3.9.0-rc1
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v3.8.0" data-name="v3.8.0" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v3.8.0">
                v3.8.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v3.7.0" data-name="v3.7.0" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v3.7.0">
                v3.7.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v3.7.0-brew" data-name="v3.7.0-brew" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v3.7.0-brew">
                v3.7.0-brew
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v3.5.0" data-name="v3.5.0" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v3.5.0">
                v3.5.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v3.4.0" data-name="v3.4.0" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v3.4.0">
                v3.4.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v3.3.0" data-name="v3.3.0" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v3.3.0">
                v3.3.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v3.2.0" data-name="v3.2.0" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v3.2.0">
                v3.2.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v3.1" data-name="v3.1" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v3.1">
                v3.1
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v3.0.0" data-name="v3.0.0" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v3.0.0">
                v3.0.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.9.9" data-name="v2.9.9" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.9.9">
                v2.9.9
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.9.8" data-name="v2.9.8" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.9.8">
                v2.9.8
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.9.6" data-name="v2.9.6" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.9.6">
                v2.9.6
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.9.5" data-name="v2.9.5" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.9.5">
                v2.9.5
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.9.4" data-name="v2.9.4" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.9.4">
                v2.9.4
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.9.3" data-name="v2.9.3" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.9.3">
                v2.9.3
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.9.1" data-name="v2.9.1" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.9.1">
                v2.9.1
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.9" data-name="v2.9" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.9">
                v2.9
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.8.2" data-name="v2.8.2" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.8.2">
                v2.8.2
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.8.1" data-name="v2.8.1" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.8.1">
                v2.8.1
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.8" data-name="v2.8" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.8">
                v2.8
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.7" data-name="v2.7" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.7">
                v2.7
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.6.1" data-name="v2.6.1" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.6.1">
                v2.6.1
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.6" data-name="v2.6" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.6">
                v2.6
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.5.1" data-name="v2.5.1" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.5.1">
                v2.5.1
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.5" data-name="v2.5" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.5">
                v2.5
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.4.1" data-name="v2.4.1" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.4.1">
                v2.4.1
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.4" data-name="v2.4" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.4">
                v2.4
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.3.1" data-name="v2.3.1" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.3.1">
                v2.3.1
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.3" data-name="v2.3" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.3">
                v2.3
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.2" data-name="v2.2" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.2">
                v2.2
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.1" data-name="v2.1" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.1">
                v2.1
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v2.0" data-name="v2.0" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v2.0">
                v2.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v1.9" data-name="v1.9" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.9">
                v1.9
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v1.8" data-name="v1.8" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.8">
                v1.8
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v1.7" data-name="v1.7" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.7">
                v1.7
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v1.6" data-name="v1.6" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.6">
                v1.6
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v1.5.1" data-name="v1.5.1" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.5.1">
                v1.5.1
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v1.5" data-name="v1.5" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.5">
                v1.5
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v1.4" data-name="v1.4" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.4">
                v1.4
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v1.3" data-name="v1.3" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.3">
                v1.3
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v1.2.1" data-name="v1.2.1" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.2.1">
                v1.2.1
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v1.2" data-name="v1.2" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.2">
                v1.2
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v1.1" data-name="v1.1" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.1">
                v1.1
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/v1.0" data-name="v1.0" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.0">
                v1.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/mlion_2" data-name="mlion_2" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="mlion_2">
                mlion_2
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/facebook/watchman/tree/mlion_1" data-name="mlion_1" data-skip-pjax="true" rel="nofollow">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="mlion_1">
                mlion_1
              </span>
            </a>
        </div>

        <div class="select-menu-no-results">Nothing to show</div>
      </div>

    </div>
  </div>
</div>


        <a href="https://github.com/facebook/watchman/pull/new/master" class="btn btn-sm new-pull-request-btn" data-pjax="" data-ga-click="Repository, new pull request, location:repo overview">
          New pull request
        </a>

  <div class="breadcrumb">
    
  </div>
</div>


  

<include-fragment src="/facebook/watchman/tree-commit/e6350f9cf59cdce46cb25c2c78dddc11a0a0a1f6" class="commit-tease commit-loader">
  <div class="blank">
    <img alt="" class="loader" src="octocat-spinner-32-EAF2F5.gif" width="16" height="16">
    Fetching latest commit…
  </div>
  <div class="loader-error">
    Cannot retrieve the latest commit at this time.
  </div>
</include-fragment>


<div class="file-wrap">

  <a class="d-none js-permalink-shortcut" data-hotkey="y" href="https://github.com/facebook/watchman/tree/e6350f9cf59cdce46cb25c2c78dddc11a0a0a1f6">Permalink</a>

  <table class="files js-navigation-container js-active-navigation-container" data-pjax="">


    <tbody>
      <tr class="warning include-fragment-error">
        <td class="icon"><svg class="octicon octicon-alert" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8.865 1.52c-.18-.31-.51-.5-.87-.5s-.69.19-.87.5L.275 13.5c-.18.31-.18.69 0 1 .19.31.52.5.87.5h13.7c.36 0 .69-.19.86-.5.17-.31.18-.69.01-1L8.865 1.52zM8.995 13h-2v-2h2v2zm0-3h-2V6h2v4z"></path></svg></td>
        <td class="content" colspan="3">Failed to load latest commit information.</td>
      </tr>

        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title=".circleci" id="df4a0e327b62c8cc393e4f285d1d86e4-5eced4fdfafdfb6b00d29f377026d775bcdbcfc9" href="https://github.com/facebook/watchman/tree/master/.circleci">.circleci</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="add cmake build

Summary:
This is a reasonably functional cmake implementation
of the watchman build system.  Notably missing is support for
detecting pcre and linking it in; that can be done in a follow-up
diff.

This replaces the hand-rolled windows build bits completely,
but does not remove the autoconf bits.  I will likely remove
autoconf once we have parity.

The intent is that this is a stepping stone to adding a dependency
on folly.

When testing the windows build, I found that watchman was missing most of its
registered commands.

It appears as though the relatively tricky constructor attributes that we're
using (which were targeting the `C` compiler) no longer stick; the symbols are
not included in the build and the commands are missing.

The resolution is to use C++ constructor syntax for these instead.

I also tried this on Linux and Mac because it is appealing to
simplify everything, but various versions of gcc/clang on the OSS
CI failed to link in all the commands.

I've adjusted the configuration for the various CI systems so that
we run both autoconf and cmake based builds and tests.  In the longer
run I will remove the autoconf version of the build.

Reviewed By: simpkins

Differential Revision: D7363633

Pulled By: wez

fbshipit-source-id: ac00ae0cd7af5bc51cdcf72c0595c280a4a3f977" class="message" href="https://github.com/facebook/watchman/commit/e6350f9cf59cdce46cb25c2c78dddc11a0a0a1f6">add cmake build</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-29T18:58:14Z">Mar 30, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="cmds" id="b02e953333a82648b5a801671822ad98-e31c26058e50dd705a67311fd9868abbf09e4da0" href="https://github.com/facebook/watchman/tree/master/cmds">cmds</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="handle scm aware query errors during subscriptions

Summary:
This is likely what was the cause of the blocked client_thread
in D7363065.  I saw this in our coredumper data set:

```
2018-03-22T14:30:20,932: [client=0x7f7b1fd41fd0:stm=0x7f7b1fc42b70:pid=3414331] std::terminate was called. Exception: failed query for the merge base; command returned with status 65280, output= error=.
```

```
(gdb) bt
    at watchman/Logging.h:52
    at ../../.././libstdc++-v3/libsupc++/eh_personality.cc:676
```

from the blacbox log of the user:

```
2018/03/22 14:30:20 user 91113b24fcfd300702f12c81d6ae6738b84313fd (3236283)&gt; killed!
 exited -1 after 2.57 seconds
2018/03/22 14:30:25 user 91113b24fcfd300702f12c81d6ae6738b84313fd (3236618)&gt; killed!
 exited -1 after 6.22 seconds
2018/03/22 14:30:30 user 91113b24fcfd300702f12c81d6ae6738b84313fd (3101237)&gt; killed!
 exited -1 after 2673.23 seconds
```

I suspected that something may have oomed (this is on a devvm), but dmesg
doesn't show any ooming around that time.  The triple kill is an artifact
of the way that chg handles fatal errors (any one child will kill all others
if something breaks), so we need to isolate ourselves from that.

We also need to handle this class of error in a reasonable way.  The
approach here is to swallow the error and continue.  In this code path we
update the query position based on the result of running the query, so if we
get an exception we won't move its cursor forward.  That sounds &quot;ok&quot; to me; the
next time something in the filesystem changes we will effectively retry that
query and perhaps it will succeed.  I don't think there is another reasonable
alternative short of cancelling the subscription, which is a pretty heavy blow.

Reviewed By: simpkins

Differential Revision: D7373808

fbshipit-source-id: c576c3038d5483daf1f31d6f42c3ea311d2e975a" class="message" href="https://github.com/facebook/watchman/commit/d8501b724f25d16a7b3aa078be78ec8d7e4c1bdf">handle scm aware query errors during subscriptions</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-27T22:11:45Z">Mar 28, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="cppclient" id="16453fb361f6fb6573018400de5ecb4d-f548ee229b54f8165304493b180fb9056493a3d2" href="https://github.com/facebook/watchman/tree/master/cppclient">cppclient</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="Add missing folly deps to all TARGETS

Summary:
```
$ buck query 'buildfile(%s)' $(buck run contbuild:targets) | xargs -P 32 -n 24 autodeps --keep-going --add-only --dep-regex '//folly.*'
```

Reviewed By: yfeldblum

Differential Revision: D6985916

fbshipit-source-id: 42201ad6b415829b05e23761252f0e23d2f1cf84" class="message" href="https://github.com/facebook/watchman/commit/fed72ac6faf75fe89a98821526c0b98db76a6293">Add missing folly deps to all TARGETS</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-02-14T20:43:00Z">Feb 15, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="facebook" id="26cae7718c32180a7a0f8e19d6d40a59-63d687658edc882f6e60039b344cae3556a37adf" href="https://github.com/facebook/watchman/tree/master/facebook">facebook</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="Python TARGETS Codemod Part 2 REPACK REAL

Summary:
Modifying all python targets so deps= are always known python targets
cpp_libraries are moved to cpp_deps
binaries/genrules are moved to runtime_deps

Used hg backout this time
removed all unicorn target changes will move them to their own diff
removed any targets that failed to merge

Reviewed By: yfeldblum, ngie-eign

Differential Revision: D7049308

fbshipit-source-id: 94cd27b69623a7529b5a953d1150e34798f69e83" class="message" href="https://github.com/facebook/watchman/commit/68a823f1f4cad515371321dfba559441fecbfcff">Python TARGETS Codemod Part 2 REPACK REAL</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-02-22T20:00:08Z">Feb 23, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="java" id="93f725a07423fe1c889f448b33d21f46-d33043802e202e6da012cafcfe509f28409b6c60" href="https://github.com/facebook/watchman/tree/master/java">java</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="fix various linter issues

Summary: Fix various linter issues

Reviewed By: wez

Differential Revision: D6821870

fbshipit-source-id: 9895cd0a2a55f5557d9f78ae8c0afd10d53d2a07" class="message" href="https://github.com/facebook/watchman/commit/9e2fdde27255cae6d815ec39ffcfc1a3d7dc950c">fix various linter issues</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-01-27T05:20:09Z">Jan 27, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="node" id="36c4536996ca5615dcf9911f068786dc-5cf707568110e644c073f16e1dd9b9370fedd7ea" href="https://github.com/facebook/watchman/tree/master/node">node</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="fix various linter issues

Summary: Fix various linter issues

Reviewed By: wez

Differential Revision: D6821870

fbshipit-source-id: 9895cd0a2a55f5557d9f78ae8c0afd10d53d2a07" class="message" href="https://github.com/facebook/watchman/commit/9e2fdde27255cae6d815ec39ffcfc1a3d7dc950c">fix various linter issues</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-01-27T05:20:09Z">Jan 27, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="python" id="23eeeb4347bdd26bfc6b7ee9a3b755dd-22cd2194fa672a548777dfc8c2e700465a5e0f83" href="https://github.com/facebook/watchman/tree/master/python">python</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="add cmake build

Summary:
This is a reasonably functional cmake implementation
of the watchman build system.  Notably missing is support for
detecting pcre and linking it in; that can be done in a follow-up
diff.

This replaces the hand-rolled windows build bits completely,
but does not remove the autoconf bits.  I will likely remove
autoconf once we have parity.

The intent is that this is a stepping stone to adding a dependency
on folly.

When testing the windows build, I found that watchman was missing most of its
registered commands.

It appears as though the relatively tricky constructor attributes that we're
using (which were targeting the `C` compiler) no longer stick; the symbols are
not included in the build and the commands are missing.

The resolution is to use C++ constructor syntax for these instead.

I also tried this on Linux and Mac because it is appealing to
simplify everything, but various versions of gcc/clang on the OSS
CI failed to link in all the commands.

I've adjusted the configuration for the various CI systems so that
we run both autoconf and cmake based builds and tests.  In the longer
run I will remove the autoconf version of the build.

Reviewed By: simpkins

Differential Revision: D7363633

Pulled By: wez

fbshipit-source-id: ac00ae0cd7af5bc51cdcf72c0595c280a4a3f977" class="message" href="https://github.com/facebook/watchman/commit/e6350f9cf59cdce46cb25c2c78dddc11a0a0a1f6">add cmake build</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-29T18:58:14Z">Mar 30, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="query" id="1b1cc7f086b3f074da452bc3129981eb-0e0a6968eab7086c64c23267541dc97a157e4e07" href="https://github.com/facebook/watchman/tree/master/query">query</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="static_assert json_int_t vs time_t

Summary:
It is important that we're able to represent the full range
of a `time_t` in a `json_int_t`.  This `static_assert` spells that
out.

This is important to check because a later change in this cmake stack
broke detection of `strtoll` for jansson on Windows, and the presence of that
function is what enables 64-bit integer types.

`time_t` is 64-bit by default on Windows.

Reviewed By: chadaustin

Differential Revision: D7366201

fbshipit-source-id: 195b5387d37493a56fc33058f722285d95f80b2c" class="message" href="https://github.com/facebook/watchman/commit/1cb8f4e90c4f1a444e06439008a4a114fde42656">static_assert json_int_t vs time_t</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-22T18:58:06Z">Mar 23, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="root" id="63a9f0ea7bb98050796b649e85481845-4cd85deb3e88a36e436126209f046fb83727c46b" href="https://github.com/facebook/watchman/tree/master/root">root</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="defer reading of symlink targets

Summary:
I've seen a few problem reports where cold cache situations on laptops
take a very long time to perform an initial crawl.  This diff changes the
recording of symlink targets so that it is no performed eagerly and instead
changes things to use the LRU cache infrastructure that we added for content
hash caching.

Another nice side benefit of this diff is that we save some memory (1x
`w_string` instance per symlink).

Reviewed By: simpkins

Differential Revision: D7341642

fbshipit-source-id: 6c632da6b557667baece71837883567d7cd5abbf" class="message" href="https://github.com/facebook/watchman/commit/ff819f71762781339b2d6cbeb1531073241c1772">defer reading of symlink targets</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-21T05:44:35Z">Mar 21, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="This path skips through empty directories" id="f3163dfaca84a47fd704b33dc68bd19e-d64e55e44680a29ba8f0a8b738964aa544c96453" href="https://github.com/facebook/watchman/tree/master/ruby/ruby-watchman"><span class="simplified-path">ruby/</span>ruby-watchman</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="Fix (spurious) test failure on big-endian architectures

Our example includes a int_64_t value (the PDU's length prefix), which
is endian-sensitive and so needs to be asserted using native endianness.

Originally reported as a bug on the upstream project where I initially
prototyped the Watchman protocol Ruby implementation. References:

  https://github.com/wincent/Command-T/issues/101
  https://bugzilla.redhat.com/show_bug.cgi?id=1130079" class="message" href="https://github.com/facebook/watchman/commit/d924624677e9662216f79cf5e456ddeafc79005e">Fix (spurious) test failure on big-endian architectures</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2014-08-22T18:01:56Z">Aug 23, 2014</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="This path skips through empty directories" id="af3285102f54db02a0e0cc82e82f5827-6410dda4c1993a2d3bce75367dcdddce4d421092" href="https://github.com/facebook/watchman/tree/master/rust/serde_bser"><span class="simplified-path">rust/</span>serde_bser</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="add rust support

Summary:
This isn't complete yet -- just putting this up so we can iterate.

Closes https://github.com/facebook/watchman/pull/459

Differential Revision: D6875583

Pulled By: wez

fbshipit-source-id: cb388d92f8ac0a227adda16d19d92f65b495cba9" class="message" href="https://github.com/facebook/watchman/commit/a47bd93e8eb43821b0f7493295e886ff3476b959">add rust support</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-29T15:33:20Z">Mar 29, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="scm" id="7b3a7a628c6e84b2b00d8089edb3b4b1-32df36e91310346bf2ca762ee59929dbdcbc3156" href="https://github.com/facebook/watchman/tree/master/scm">scm</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="handle scm aware query errors during subscriptions

Summary:
This is likely what was the cause of the blocked client_thread
in D7363065.  I saw this in our coredumper data set:

```
2018-03-22T14:30:20,932: [client=0x7f7b1fd41fd0:stm=0x7f7b1fc42b70:pid=3414331] std::terminate was called. Exception: failed query for the merge base; command returned with status 65280, output= error=.
```

```
(gdb) bt
    at watchman/Logging.h:52
    at ../../.././libstdc++-v3/libsupc++/eh_personality.cc:676
```

from the blacbox log of the user:

```
2018/03/22 14:30:20 user 91113b24fcfd300702f12c81d6ae6738b84313fd (3236283)&gt; killed!
 exited -1 after 2.57 seconds
2018/03/22 14:30:25 user 91113b24fcfd300702f12c81d6ae6738b84313fd (3236618)&gt; killed!
 exited -1 after 6.22 seconds
2018/03/22 14:30:30 user 91113b24fcfd300702f12c81d6ae6738b84313fd (3101237)&gt; killed!
 exited -1 after 2673.23 seconds
```

I suspected that something may have oomed (this is on a devvm), but dmesg
doesn't show any ooming around that time.  The triple kill is an artifact
of the way that chg handles fatal errors (any one child will kill all others
if something breaks), so we need to isolate ourselves from that.

We also need to handle this class of error in a reasonable way.  The
approach here is to swallow the error and continue.  In this code path we
update the query position based on the result of running the query, so if we
get an exception we won't move its cursor forward.  That sounds &quot;ok&quot; to me; the
next time something in the filesystem changes we will effectively retry that
query and perhaps it will succeed.  I don't think there is another reasonable
alternative short of cancelling the subscription, which is a pretty heavy blow.

Reviewed By: simpkins

Differential Revision: D7373808

fbshipit-source-id: c576c3038d5483daf1f31d6f42c3ea311d2e975a" class="message" href="https://github.com/facebook/watchman/commit/d8501b724f25d16a7b3aa078be78ec8d7e4c1bdf">handle scm aware query errors during subscriptions</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-27T22:11:45Z">Mar 28, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="tests" id="b61a6d542f9036550ba9c401c80f00ef-060207efadf0d1ff11310350abfdffe70001b5ff" href="https://github.com/facebook/watchman/tree/master/tests">tests</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="add cmake build

Summary:
This is a reasonably functional cmake implementation
of the watchman build system.  Notably missing is support for
detecting pcre and linking it in; that can be done in a follow-up
diff.

This replaces the hand-rolled windows build bits completely,
but does not remove the autoconf bits.  I will likely remove
autoconf once we have parity.

The intent is that this is a stepping stone to adding a dependency
on folly.

When testing the windows build, I found that watchman was missing most of its
registered commands.

It appears as though the relatively tricky constructor attributes that we're
using (which were targeting the `C` compiler) no longer stick; the symbols are
not included in the build and the commands are missing.

The resolution is to use C++ constructor syntax for these instead.

I also tried this on Linux and Mac because it is appealing to
simplify everything, but various versions of gcc/clang on the OSS
CI failed to link in all the commands.

I've adjusted the configuration for the various CI systems so that
we run both autoconf and cmake based builds and tests.  In the longer
run I will remove the autoconf version of the build.

Reviewed By: simpkins

Differential Revision: D7363633

Pulled By: wez

fbshipit-source-id: ac00ae0cd7af5bc51cdcf72c0595c280a4a3f977" class="message" href="https://github.com/facebook/watchman/commit/e6350f9cf59cdce46cb25c2c78dddc11a0a0a1f6">add cmake build</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-29T18:58:14Z">Mar 30, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="thirdparty" id="5d103215c550d260388af0b3789a91c5-6a025bbb2aecb8de53b2b230d1fb5113f1afdc7d" href="https://github.com/facebook/watchman/tree/master/thirdparty">thirdparty</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="remove stack based w_string hack

Summary:
the hot paths now use the code that uses string_piece
for keys.  There was one code path in the json bits that was
using it, but it is not in the hot path: we would use it only
during parsing of commands so relatively speaking it is cheap
to do without.

We can always add overloads that take w_String for that if
needed.

Reviewed By: chadaustin

Differential Revision: D7209342

fbshipit-source-id: 7403a1bbe750a06dd43123b18f970c2d995b6dd9" class="message" href="https://github.com/facebook/watchman/commit/642f8df91b5cf083432acfa966ae061282fbb348">remove stack based w_string hack</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-10T16:52:03Z">Mar 11, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="travis" id="7985139ae9b6efb45373e3e36e444224-f43b0aa3d6f7a6c67d17f69d1304120372bbd228" href="https://github.com/facebook/watchman/tree/master/travis">travis</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="add cmake build

Summary:
This is a reasonably functional cmake implementation
of the watchman build system.  Notably missing is support for
detecting pcre and linking it in; that can be done in a follow-up
diff.

This replaces the hand-rolled windows build bits completely,
but does not remove the autoconf bits.  I will likely remove
autoconf once we have parity.

The intent is that this is a stepping stone to adding a dependency
on folly.

When testing the windows build, I found that watchman was missing most of its
registered commands.

It appears as though the relatively tricky constructor attributes that we're
using (which were targeting the `C` compiler) no longer stick; the symbols are
not included in the build and the commands are missing.

The resolution is to use C++ constructor syntax for these instead.

I also tried this on Linux and Mac because it is appealing to
simplify everything, but various versions of gcc/clang on the OSS
CI failed to link in all the commands.

I've adjusted the configuration for the various CI systems so that
we run both autoconf and cmake based builds and tests.  In the longer
run I will remove the autoconf version of the build.

Reviewed By: simpkins

Differential Revision: D7363633

Pulled By: wez

fbshipit-source-id: ac00ae0cd7af5bc51cdcf72c0595c280a4a3f977" class="message" href="https://github.com/facebook/watchman/commit/e6350f9cf59cdce46cb25c2c78dddc11a0a0a1f6">add cmake build</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-29T18:58:14Z">Mar 30, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watcher" id="ed3aa79daf8e991adda33b8b0eef5284-17b4e797a1145de06d33f862d95f0376ba3bba7a" href="https://github.com/facebook/watchman/tree/master/watcher">watcher</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="terminate process without running destructors on FATAL

Summary:
For better or worse... I've seen this trace in the wild,
and its been lingering for 4 days!  Strangely, the process is almost
fully functional, except for flushing subscriptions.

I suspect that we have an uncaught exception in the client thread because the
logs look like this; these indicate that the terminating thread was a client
thread.  We can see that it handled a query 2 seconds prior to the fault:

```
2018-03-17T04:52:48,510: [client=0x7f7f39d3e1d0:stm=0x7f7f39c75840:pid=1819024] PERF: {&quot;system_time&quot;: 0.081978999999999996, &quot;user_time&quot;: 0.0055560000000000002, &quot;elapsed_time&quot;: 1.2319009999999999, &quot;description&quot;: &quot;que
ry_execute&quot;, &quot;meta&quot;: {&quot;query_execute&quot;: {&quot;query&quot;: {&quot;expression&quot;: [&quot;allof&quot;, [&quot;not&quot;, [&quot;anyof&quot;, [&quot;dirname&quot;, &quot;.hg&quot;], [&quot;dirname&quot;, &quot;.git&quot;], [&quot;dirname&quot;, &quot;.svn&quot;]]]], &quot;since&quot;: {&quot;drop&quot;: [&quot;hg.update&quot;], &quot;scm&quot;: {&quot;mergebase-with&quot;:
 &quot;master&quot;}}, &quot;relative_root&quot;: &quot;&quot;, &quot;empty_on_fresh_instance&quot;: true, &quot;fields&quot;: [&quot;name&quot;]}, &quot;fresh_instance&quot;: false, &quot;num_deduped&quot;: 0, &quot;num_results&quot;: 1, &quot;num_walked&quot;: 11}, &quot;root&quot;: {&quot;watcher&quot;: &quot;inotify&quot;, &quot;path&quot;: &quot;/data/u
sers/akramer/www-hg&quot;, &quot;case_sensitive&quot;: true, &quot;recrawl_count&quot;: 0}}, &quot;start_time&quot;: 1521287567.278764, &quot;pid&quot;: 3700551, &quot;version&quot;: &quot;4.9.0&quot;}
2018-03-17T04:52:50,116: [client=0x7f7f39d3e1d0:stm=0x7f7f39c75840:pid=1819024] std::terminate was called
Fatal error detected at:
/usr/local/bin/watchman() [0x411507]
/usr/local/bin/watchman() [0x6c12f6]
/usr/local/bin/watchman() [0x443620]
/usr/local/bin/watchman() [0x6c2525]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8cd95) [0x7f7f3b8ded95]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(_ZSt9terminatev+0x10) [0x7f7f3b8dede0]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0xc7227) [0x7f7f3b919227]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libpthread.so.0(+0x77a8) [0x7f7f3b0157a8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libc.so.6(clone+0x6c) [0x7f7f3a931a7c]
```

There was not a lot of useful additional information available from the process
(I captured a core file and poked around).  Here's the trace of the stuck
thread.  None of the other threads are waiting on locks; all threads appear to
be waiting for requests and operating reasonably; other requests for the same
root will succeed and so on.

```
Thread 75 (Thread 0x7f7f1ab7e700 (LWP 1819033)):
```

I've expanded our termination handler to attempt to print out the current
exception.  This seems to be present for the obvious cases; the trace doesn't
provide a huge amount of context but at least we can divine the thread name
from the existing logging, and can also resolve to the thread function when
attaching to the gdb core file.

```
2018-03-22T09:52:05,164: [perflog] std::terminate was called. Exception: boop.
Fatal error detected at:
./buck-out/gen/watchman/watchman() [0x69ccd4]
./buck-out/gen/watchman/watchman() [0x69e7fc]
./buck-out/gen/watchman/watchman() [0x443ee0]
./buck-out/gen/watchman/watchman() [0x6a062d]
./buck-out/gen/watchman/watchman() [0x6a07f8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8cd95) [0x7fc441cabd95]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8b9d8) [0x7fc441caa9d8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(__gxx_personality_v0+0x387) [0x7fc441cab357]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libgcc_s.so.1(+0xff0c) [0x7fc4404cdf0c]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libgcc_s.so.1(_Unwind_RaiseException+0x1ac) [0x7fc4404ce44c]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(__cxa_throw+0x63) [0x7fc441cac053]
./buck-out/gen/watchman/watchman() [0x488dad]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0xc7170) [0x7fc441ce6170]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libpthread.so.0(+0x77a8) [0x7fc4413e27a8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libc.so.6(clone+0x6c) [0x7fc440cfea7c]
[1]    1237117 abort (core dumped)  ./buck-out/gen/watchman/watchman --foreground --logfile=/dev/stdout
```

I also cleaned up the handling of the `send_ok` variable.  It appeared to be
possible for this to get set but then nothing would ever terminate the main
loop.  That code was added back before much of the supporting bits had been
converted to C++.

I've changed the `exit()` call to `_exit()` to avoid calling `atexit`
handlers and destructors.  We used to `abort()` here, but there are a number of
cases where we don't want that to generate a core file so it was recently
changed to exit.   I've added an explicit `ABORT` error level to accomodate
this class of problem.

Reviewed By: simpkins

Differential Revision: D7354472

fbshipit-source-id: 846f93b568beb1e7b00dc91f02e71c40678c86b6" class="message" href="https://github.com/facebook/watchman/commit/4232c70fdc11ba642311633ea38a3d5dd5506dcf">terminate process without running destructors on FATAL</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-22T18:18:53Z">Mar 23, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="website" id="d1befa03c79ca0b84ecc488dea96bc68-c07183ce67177c079789b50a01e27399dbd01e62" href="https://github.com/facebook/watchman/tree/master/website">website</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="fix windows download link and linux install deps

Summary:
Explicitly filter out pull requests from the possible set of downloads!

Refs: https://github.com/facebook/watchman/issues/583
Refs: https://github.com/facebook/watchman/pull/584

Also explicitly state the libssl-dev dep.
Closes https://github.com/facebook/watchman/issues/585

Reviewed By: chadaustin

Differential Revision: D7241584

fbshipit-source-id: 44f8d7058144b5064c41c650ba79573386be0047" class="message" href="https://github.com/facebook/watchman/commit/94e66865386e844f2cffe52e355a94c96562d2e3">fix windows download link and linux install deps</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-12T19:58:02Z">Mar 13, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file-directory" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="winbuild" id="ae75b8399252b009142282eae8687a62-8c075b369460739daa7d92dc0585d4e0c5eea227" href="https://github.com/facebook/watchman/tree/master/winbuild">winbuild</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="add cmake build

Summary:
This is a reasonably functional cmake implementation
of the watchman build system.  Notably missing is support for
detecting pcre and linking it in; that can be done in a follow-up
diff.

This replaces the hand-rolled windows build bits completely,
but does not remove the autoconf bits.  I will likely remove
autoconf once we have parity.

The intent is that this is a stepping stone to adding a dependency
on folly.

When testing the windows build, I found that watchman was missing most of its
registered commands.

It appears as though the relatively tricky constructor attributes that we're
using (which were targeting the `C` compiler) no longer stick; the symbols are
not included in the build and the commands are missing.

The resolution is to use C++ constructor syntax for these instead.

I also tried this on Linux and Mac because it is appealing to
simplify everything, but various versions of gcc/clang on the OSS
CI failed to link in all the commands.

I've adjusted the configuration for the various CI systems so that
we run both autoconf and cmake based builds and tests.  In the longer
run I will remove the autoconf version of the build.

Reviewed By: simpkins

Differential Revision: D7363633

Pulled By: wez

fbshipit-source-id: ac00ae0cd7af5bc51cdcf72c0595c280a4a3f977" class="message" href="https://github.com/facebook/watchman/commit/e6350f9cf59cdce46cb25c2c78dddc11a0a0a1f6">add cmake build</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-29T18:58:14Z">Mar 30, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title=".clang-format" id="69a68f7ce1ea3687a38d8e4705e6fa48-b1828cbbaf0c37924f3df4313519022921e82fda" href="https://github.com/facebook/watchman/blob/master/.clang-format">.clang-format</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="add escaping for mixed strings

Summary:
This is based on dhruvsinghal's work:

https://github.com/facebook/watchman/commit/0577568c641b6dcceeca6d52f1f82133b99141cd

I added a whole bunch of tests to make sure nothing goes wrong.

Modulo bugs, I believe this is the final thing we need before we can expose this and start making our tests better.

Reviewed By: wez

Differential Revision: D4325642

fbshipit-source-id: d0186d2dbcc0778c1f802be62b24071a4a5e3c1d" class="message" href="https://github.com/facebook/watchman/commit/f8390953d22ea7a51d7d30cd13ed8cc25213c11d">add escaping for mixed strings</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-12-15T17:04:28Z">Dec 16, 2016</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title=".gitattributes" id="fc723d30b02a4cca7a534518111c1a66-d0c0c4c1dc29e90549cf4f36a2d8a0c397c3a8e6" href="https://github.com/facebook/watchman/blob/master/.gitattributes">.gitattributes</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="Fix favicon in website" class="message" href="https://github.com/facebook/watchman/commit/3f52401d60a9916e344edfc84e4a8548ed0dea21">Fix favicon in website</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2015-08-07T20:03:16Z">Aug 8, 2015</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title=".gitignore" id="a084b794bc0759e7a6b77810e01874f2-7ec94325213e268e87f3b432f426b1adf82b4206" href="https://github.com/facebook/watchman/blob/master/.gitignore">.gitignore</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="add cmake build

Summary:
This is a reasonably functional cmake implementation
of the watchman build system.  Notably missing is support for
detecting pcre and linking it in; that can be done in a follow-up
diff.

This replaces the hand-rolled windows build bits completely,
but does not remove the autoconf bits.  I will likely remove
autoconf once we have parity.

The intent is that this is a stepping stone to adding a dependency
on folly.

When testing the windows build, I found that watchman was missing most of its
registered commands.

It appears as though the relatively tricky constructor attributes that we're
using (which were targeting the `C` compiler) no longer stick; the symbols are
not included in the build and the commands are missing.

The resolution is to use C++ constructor syntax for these instead.

I also tried this on Linux and Mac because it is appealing to
simplify everything, but various versions of gcc/clang on the OSS
CI failed to link in all the commands.

I've adjusted the configuration for the various CI systems so that
we run both autoconf and cmake based builds and tests.  In the longer
run I will remove the autoconf version of the build.

Reviewed By: simpkins

Differential Revision: D7363633

Pulled By: wez

fbshipit-source-id: ac00ae0cd7af5bc51cdcf72c0595c280a4a3f977" class="message" href="https://github.com/facebook/watchman/commit/e6350f9cf59cdce46cb25c2c78dddc11a0a0a1f6">add cmake build</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-29T18:58:14Z">Mar 30, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title=".travis.yml" id="354f30a63fb0907d4ad57269548329e3-f460af3dafac9c93cf7e3f2bac4041f045e9a877" href="https://github.com/facebook/watchman/blob/master/.travis.yml">.travis.yml</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="add cmake build

Summary:
This is a reasonably functional cmake implementation
of the watchman build system.  Notably missing is support for
detecting pcre and linking it in; that can be done in a follow-up
diff.

This replaces the hand-rolled windows build bits completely,
but does not remove the autoconf bits.  I will likely remove
autoconf once we have parity.

The intent is that this is a stepping stone to adding a dependency
on folly.

When testing the windows build, I found that watchman was missing most of its
registered commands.

It appears as though the relatively tricky constructor attributes that we're
using (which were targeting the `C` compiler) no longer stick; the symbols are
not included in the build and the commands are missing.

The resolution is to use C++ constructor syntax for these instead.

I also tried this on Linux and Mac because it is appealing to
simplify everything, but various versions of gcc/clang on the OSS
CI failed to link in all the commands.

I've adjusted the configuration for the various CI systems so that
we run both autoconf and cmake based builds and tests.  In the longer
run I will remove the autoconf version of the build.

Reviewed By: simpkins

Differential Revision: D7363633

Pulled By: wez

fbshipit-source-id: ac00ae0cd7af5bc51cdcf72c0595c280a4a3f977" class="message" href="https://github.com/facebook/watchman/commit/e6350f9cf59cdce46cb25c2c78dddc11a0a0a1f6">add cmake build</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-29T18:58:14Z">Mar 30, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="CMakeLists.txt" id="af3b638bc2a3e6c650974192a53c7291-019cac58f73ccfdf77cd1620b4553060c37ef381" href="https://github.com/facebook/watchman/blob/master/CMakeLists.txt">CMakeLists.txt</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="add cmake build

Summary:
This is a reasonably functional cmake implementation
of the watchman build system.  Notably missing is support for
detecting pcre and linking it in; that can be done in a follow-up
diff.

This replaces the hand-rolled windows build bits completely,
but does not remove the autoconf bits.  I will likely remove
autoconf once we have parity.

The intent is that this is a stepping stone to adding a dependency
on folly.

When testing the windows build, I found that watchman was missing most of its
registered commands.

It appears as though the relatively tricky constructor attributes that we're
using (which were targeting the `C` compiler) no longer stick; the symbols are
not included in the build and the commands are missing.

The resolution is to use C++ constructor syntax for these instead.

I also tried this on Linux and Mac because it is appealing to
simplify everything, but various versions of gcc/clang on the OSS
CI failed to link in all the commands.

I've adjusted the configuration for the various CI systems so that
we run both autoconf and cmake based builds and tests.  In the longer
run I will remove the autoconf version of the build.

Reviewed By: simpkins

Differential Revision: D7363633

Pulled By: wez

fbshipit-source-id: ac00ae0cd7af5bc51cdcf72c0595c280a4a3f977" class="message" href="https://github.com/facebook/watchman/commit/e6350f9cf59cdce46cb25c2c78dddc11a0a0a1f6">add cmake build</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-29T18:58:14Z">Mar 30, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="CODE_OF_CONDUCT.md" id="a1ee87dafebc22cbd96979f1b2b7e837-0a45f9bd5f05ad74f3a90c92c964ce87dbc57150" href="https://github.com/facebook/watchman/blob/master/CODE_OF_CONDUCT.md">CODE_OF_CONDUCT.md</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="Add Code of Conduct

Summary:
**Edit:** We updated the existing Contributing page on the docs - see below~
&lt;img width=&quot;1371&quot; alt=&quot;screen shot 2017-12-03 at 5 44 37 pm&quot; src=&quot;https://user-images.githubusercontent.com/1114467/33532828-d4661628-d851-11e7-9ba3-9c376e001a98.png&quot;&gt;
 ---

In the past Facebook didn't promote including a Code of Conduct when creating new projects, and many projects skipped this important document. Let's fix it. :)

**why make this change?:**
Facebook Open Source provides a Code of Conduct statement for all
projects to follow, to promote a welcoming and safe open source community.

Exposing the COC via a separate markdown file is a standard being
promoted by Github via the Community Profile in order to meet their Open
Source Guide's recommended community standards.

As you can see, adding this file will improve [the watchman community profile](https://github.com/facebook/watchman/community)
checklist and increase the visibility of our COC.

**test plan:**
Viewing it on my branch -
&lt;img width=&quot;1011&quot; alt=&quot;screen shot 2017-12-03 at 4 25 34 pm&quot; src=&quot;https://user-images.githubusercontent.com/1114467/33531781-dc4e1b98-d846-11e7-8e6d-5ed9e02f25bb.png&quot;&gt;

**issue:**
internal task t23481323
Closes https://github.com/facebook/watchman/pull/555

Reviewed By: wez

Differential Revision: D6487028

Pulled By: eamonnkent

fbshipit-source-id: 4433aa782900008da8a5c973e8e0231987c11fa6" class="message" href="https://github.com/facebook/watchman/commit/2f9359ffb1a271f316ab335293a55ded1dac1359">Add Code of Conduct</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-12-07T03:32:42Z">Dec 7, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="ChildProcess.cpp" id="a36118a1d11d03094ab50f4d756b06fc-499efbce1e19510d3d3e2a4ec7fb6f6cb1bf51ae" href="https://github.com/facebook/watchman/blob/master/ChildProcess.cpp">ChildProcess.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="terminate process without running destructors on FATAL

Summary:
For better or worse... I've seen this trace in the wild,
and its been lingering for 4 days!  Strangely, the process is almost
fully functional, except for flushing subscriptions.

I suspect that we have an uncaught exception in the client thread because the
logs look like this; these indicate that the terminating thread was a client
thread.  We can see that it handled a query 2 seconds prior to the fault:

```
2018-03-17T04:52:48,510: [client=0x7f7f39d3e1d0:stm=0x7f7f39c75840:pid=1819024] PERF: {&quot;system_time&quot;: 0.081978999999999996, &quot;user_time&quot;: 0.0055560000000000002, &quot;elapsed_time&quot;: 1.2319009999999999, &quot;description&quot;: &quot;que
ry_execute&quot;, &quot;meta&quot;: {&quot;query_execute&quot;: {&quot;query&quot;: {&quot;expression&quot;: [&quot;allof&quot;, [&quot;not&quot;, [&quot;anyof&quot;, [&quot;dirname&quot;, &quot;.hg&quot;], [&quot;dirname&quot;, &quot;.git&quot;], [&quot;dirname&quot;, &quot;.svn&quot;]]]], &quot;since&quot;: {&quot;drop&quot;: [&quot;hg.update&quot;], &quot;scm&quot;: {&quot;mergebase-with&quot;:
 &quot;master&quot;}}, &quot;relative_root&quot;: &quot;&quot;, &quot;empty_on_fresh_instance&quot;: true, &quot;fields&quot;: [&quot;name&quot;]}, &quot;fresh_instance&quot;: false, &quot;num_deduped&quot;: 0, &quot;num_results&quot;: 1, &quot;num_walked&quot;: 11}, &quot;root&quot;: {&quot;watcher&quot;: &quot;inotify&quot;, &quot;path&quot;: &quot;/data/u
sers/akramer/www-hg&quot;, &quot;case_sensitive&quot;: true, &quot;recrawl_count&quot;: 0}}, &quot;start_time&quot;: 1521287567.278764, &quot;pid&quot;: 3700551, &quot;version&quot;: &quot;4.9.0&quot;}
2018-03-17T04:52:50,116: [client=0x7f7f39d3e1d0:stm=0x7f7f39c75840:pid=1819024] std::terminate was called
Fatal error detected at:
/usr/local/bin/watchman() [0x411507]
/usr/local/bin/watchman() [0x6c12f6]
/usr/local/bin/watchman() [0x443620]
/usr/local/bin/watchman() [0x6c2525]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8cd95) [0x7f7f3b8ded95]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(_ZSt9terminatev+0x10) [0x7f7f3b8dede0]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0xc7227) [0x7f7f3b919227]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libpthread.so.0(+0x77a8) [0x7f7f3b0157a8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libc.so.6(clone+0x6c) [0x7f7f3a931a7c]
```

There was not a lot of useful additional information available from the process
(I captured a core file and poked around).  Here's the trace of the stuck
thread.  None of the other threads are waiting on locks; all threads appear to
be waiting for requests and operating reasonably; other requests for the same
root will succeed and so on.

```
Thread 75 (Thread 0x7f7f1ab7e700 (LWP 1819033)):
```

I've expanded our termination handler to attempt to print out the current
exception.  This seems to be present for the obvious cases; the trace doesn't
provide a huge amount of context but at least we can divine the thread name
from the existing logging, and can also resolve to the thread function when
attaching to the gdb core file.

```
2018-03-22T09:52:05,164: [perflog] std::terminate was called. Exception: boop.
Fatal error detected at:
./buck-out/gen/watchman/watchman() [0x69ccd4]
./buck-out/gen/watchman/watchman() [0x69e7fc]
./buck-out/gen/watchman/watchman() [0x443ee0]
./buck-out/gen/watchman/watchman() [0x6a062d]
./buck-out/gen/watchman/watchman() [0x6a07f8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8cd95) [0x7fc441cabd95]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8b9d8) [0x7fc441caa9d8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(__gxx_personality_v0+0x387) [0x7fc441cab357]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libgcc_s.so.1(+0xff0c) [0x7fc4404cdf0c]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libgcc_s.so.1(_Unwind_RaiseException+0x1ac) [0x7fc4404ce44c]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(__cxa_throw+0x63) [0x7fc441cac053]
./buck-out/gen/watchman/watchman() [0x488dad]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0xc7170) [0x7fc441ce6170]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libpthread.so.0(+0x77a8) [0x7fc4413e27a8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libc.so.6(clone+0x6c) [0x7fc440cfea7c]
[1]    1237117 abort (core dumped)  ./buck-out/gen/watchman/watchman --foreground --logfile=/dev/stdout
```

I also cleaned up the handling of the `send_ok` variable.  It appeared to be
possible for this to get set but then nothing would ever terminate the main
loop.  That code was added back before much of the supporting bits had been
converted to C++.

I've changed the `exit()` call to `_exit()` to avoid calling `atexit`
handlers and destructors.  We used to `abort()` here, but there are a number of
cases where we don't want that to generate a core file so it was recently
changed to exit.   I've added an explicit `ABORT` error level to accomodate
this class of problem.

Reviewed By: simpkins

Differential Revision: D7354472

fbshipit-source-id: 846f93b568beb1e7b00dc91f02e71c40678c86b6" class="message" href="https://github.com/facebook/watchman/commit/4232c70fdc11ba642311633ea38a3d5dd5506dcf">terminate process without running destructors on FATAL</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-22T18:18:53Z">Mar 23, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="ChildProcess.h" id="4e16a5bcd13974c6528e9de3cf1b110d-79b9d49aee66f845d13dbd2333f21edd6aa1255c" href="https://github.com/facebook/watchman/blob/master/ChildProcess.h">ChildProcess.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="merge Win32Handle into FileDescriptor

Summary:
I've kept Win32Handle.cpp and some of the functions it
holds for the moment; since I have a number of modifications in
a stack of changes that is pending review, I'm anticipating that
resolving merge conflicts across a rename will be a PITA, so I'm
deferring moving those around until after the stack is landed.

This is a pretty straight forward change with just a little bit
of fan-out to the heavier weight stream layer.

Reviewed By: simpkins

Differential Revision: D5124899

fbshipit-source-id: 14b9cd76ec67881c5d26edc5ee98f31e75c453d4" class="message" href="https://github.com/facebook/watchman/commit/39742c4378b80fa1200f81e34091668037f96d63">merge Win32Handle into FileDescriptor</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-06-02T15:21:43Z">Jun 2, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="ContentHash.cpp" id="f7ca7066272dc8e646090e01d35434af-2384d3a78635aefb8243f674cdfb7852d5714a48" href="https://github.com/facebook/watchman/blob/master/ContentHash.cpp">ContentHash.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="fix existential issue with SCM aware queries

Summary:
This was a bit of a thorny issue to run down.  What was happening was
this: when source control aware mode is enabled we subvert the normal recency
index and use the `pathGenerator` rather than the `timeGenerator`.

We pass the list of files that we got back from the source control system to
the path generator and let it evaluate the query based on information that
we've observed in the InMemoryView.

If watchman has never observed some components of the paths returned by the
source control query, such as in the case where watchman was restarted after
checking out the revision, and we're asked about changes since an earlier hash,
the `pathGenerator` will not be able to furnish information about the paths
returned by source control.   This means that we are potentially inaccurate for
files that exist on the filesystem (although we will likely soon observe the
current state of those files), but more critically, we cannot return
information about files that were deleted in between the commits in the query
range.

The resolution is not to use the InMemoryView as the source of information
about these files.

This diff adds a LocalFileResult for just this purpose; this is an
implementation of the FileResult class that knows how to stat the local
filesystem as needed to furnish the metadata that may be needed by the query.
I'm not thrilled that it needs to stat the files, but this the simplest way to
obtain correct results and we can figure out if we need to do better than this
in practice as a follow up.

I've also broken out the guts of `ContentHashCache::computeHashImmediate`
as a static function so that we can call it from `LocalFileResult`.
Ideally we'd find a way to plumb in the cache that is held in the
`InMemoryView`, but we're operating at a different layer and cannot
guarantee that it is present; it isn't present for Eden and we still
need to solve the hash computation issue for Eden.  Those are out of
scope wrt. resolving this issue in the short term.

Reviewed By: simpkins

Differential Revision: D7142088

fbshipit-source-id: 35b7d7745e30adabb8b9a7b3713d6ba3500b3552" class="message" href="https://github.com/facebook/watchman/commit/72950c283a6b2d57ada6b8ab54ac4478a9fe6f32">fix existential issue with SCM aware queries</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-06T03:45:09Z">Mar 6, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="ContentHash.h" id="0c661b05d76738d055de73cd19d74d99-9132028835add8458cef974fba10345647c8a597" href="https://github.com/facebook/watchman/blob/master/ContentHash.h">ContentHash.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="fix existential issue with SCM aware queries

Summary:
This was a bit of a thorny issue to run down.  What was happening was
this: when source control aware mode is enabled we subvert the normal recency
index and use the `pathGenerator` rather than the `timeGenerator`.

We pass the list of files that we got back from the source control system to
the path generator and let it evaluate the query based on information that
we've observed in the InMemoryView.

If watchman has never observed some components of the paths returned by the
source control query, such as in the case where watchman was restarted after
checking out the revision, and we're asked about changes since an earlier hash,
the `pathGenerator` will not be able to furnish information about the paths
returned by source control.   This means that we are potentially inaccurate for
files that exist on the filesystem (although we will likely soon observe the
current state of those files), but more critically, we cannot return
information about files that were deleted in between the commits in the query
range.

The resolution is not to use the InMemoryView as the source of information
about these files.

This diff adds a LocalFileResult for just this purpose; this is an
implementation of the FileResult class that knows how to stat the local
filesystem as needed to furnish the metadata that may be needed by the query.
I'm not thrilled that it needs to stat the files, but this the simplest way to
obtain correct results and we can figure out if we need to do better than this
in practice as a follow up.

I've also broken out the guts of `ContentHashCache::computeHashImmediate`
as a static function so that we can call it from `LocalFileResult`.
Ideally we'd find a way to plumb in the cache that is held in the
`InMemoryView`, but we're operating at a different layer and cannot
guarantee that it is present; it isn't present for Eden and we still
need to solve the hash computation issue for Eden.  Those are out of
scope wrt. resolving this issue in the short term.

Reviewed By: simpkins

Differential Revision: D7142088

fbshipit-source-id: 35b7d7745e30adabb8b9a7b3713d6ba3500b3552" class="message" href="https://github.com/facebook/watchman/commit/72950c283a6b2d57ada6b8ab54ac4478a9fe6f32">fix existential issue with SCM aware queries</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-06T03:45:09Z">Mar 6, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="CookieSync.cpp" id="bac33456cf2b71bdfcad5ed3dc02bcd5-4cff5fea3a13d34173682626f13e0b182b2a82ea" href="https://github.com/facebook/watchman/blob/master/CookieSync.cpp">CookieSync.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="work harder to surface sync errors more accurately

Summary:
This rearranges things a little to make it easier to propagate the
reason and context behind a cookie sync timeout; we now use an exception for
this so that we can include data about the recrawl state of the repo too.

While testing this I noticed that we would block for a long time even if we set
the sync_timeout to be super short and I traced this to the perf sampling code;
it was collecting the current clock information from the root, but this data is
locked during a recrawl and this meant that our wonderfully short timeout
wasn't being respected.

In practice, I've never needed to look at the current clock position in the
data that we sample to scuba so I've simply removed it to unblock things.  This
should help to avoid situations like this one that was reported in the group:

https://fb.facebook.com/groups/scm/permalink/1572802659436015

Reviewed By: simpkins

Differential Revision: D7075600

fbshipit-source-id: 2b70a814a55d7b5d5d0d60d204ee0d6cc825f3c6" class="message" href="https://github.com/facebook/watchman/commit/b6427288a016012c862f2c6153f7a8fc9d5479a3">work harder to surface sync errors more accurately</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-02-24T08:09:17Z">Feb 24, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="CookieSync.h" id="8fad937a09103c8e23fe71b2ad08527a-8989f14a4f396e9d22b537bb89eaaeabad1a8f89" href="https://github.com/facebook/watchman/blob/master/CookieSync.h">CookieSync.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="work harder to surface sync errors more accurately

Summary:
This rearranges things a little to make it easier to propagate the
reason and context behind a cookie sync timeout; we now use an exception for
this so that we can include data about the recrawl state of the repo too.

While testing this I noticed that we would block for a long time even if we set
the sync_timeout to be super short and I traced this to the perf sampling code;
it was collecting the current clock information from the root, but this data is
locked during a recrawl and this meant that our wonderfully short timeout
wasn't being respected.

In practice, I've never needed to look at the current clock position in the
data that we sample to scuba so I've simply removed it to unblock things.  This
should help to avoid situations like this one that was reported in the group:

https://fb.facebook.com/groups/scm/permalink/1572802659436015

Reviewed By: simpkins

Differential Revision: D7075600

fbshipit-source-id: 2b70a814a55d7b5d5d0d60d204ee0d6cc825f3c6" class="message" href="https://github.com/facebook/watchman/commit/b6427288a016012c862f2c6153f7a8fc9d5479a3">work harder to surface sync errors more accurately</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-02-24T08:09:17Z">Feb 24, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="FileDescriptor.cpp" id="7626342ad7b9e97f1915b867ba290aeb-b92d410d7e3658be5d2bccdf8684d12d72169c08" href="https://github.com/facebook/watchman/blob/master/FileDescriptor.cpp">FileDescriptor.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="win32: ERROR_BROKEN_PIPE -&gt; EOF on read

Summary:
while working on the cmake-ification on Windows, I ran
into a strange error where ChildProcess would always cause the
watchman process to terminate in the trigger tests.  I traced
part of that to problems with assumptions around `echo.exe` being
available; in the case that the system doesn't resolve `echo.exe` the pipe to the child process is broken.

Windows will return ERROR_BROKEN_PIPE for both reads and writes,
whereas posix systems yield EOF on read and EPIPE (assuming that
that SIGPIPE is disabled) on write.

Our default mapping is performed in winbuild/errmap.cpp.

In the integration test scenario, the threaded pipe reading code
will translate EPIPE into an exception and bubble it up.

For reads only we want to map this to EOF.

Reviewed By: simpkins

Differential Revision: D7366197

fbshipit-source-id: dd9bd66c0c714755f672ec0379abb967ae5afb50" class="message" href="https://github.com/facebook/watchman/commit/804242011419703eba1ea450022310b6f5f0c349">win32: ERROR_BROKEN_PIPE -&gt; EOF on read</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-28T21:38:27Z">Mar 29, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="FileDescriptor.h" id="32e59473e1f9cec8749ce5d336176a31-ee6c3e9b2130e31dc2417907d5b2b06df06505c9" href="https://github.com/facebook/watchman/blob/master/FileDescriptor.h">FileDescriptor.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="migrate the remains of Win32Handle.cpp -&gt; FileDescriptor.cpp

Summary:
As promised in an earlier diff, this completes the move of
Win32Handle into FileDescriptor.

I've also cleaned up a couple of of the higher level stream functions
so that that the prototypes of w_stm_open and w_stm_fdopen are less
repeaty.

Reviewed By: simpkins

Differential Revision: D5171647

fbshipit-source-id: 6fb92a93d5a2fc38d4815e8353318290c9df7ab8" class="message" href="https://github.com/facebook/watchman/commit/3efa30e766923e9cd0901c30803b43c98fe322a4">migrate the remains of Win32Handle.cpp -&gt; FileDescriptor.cpp</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-06-06T22:21:03Z">Jun 7, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="FileInformation.cpp" id="b198e171121d8c53dd2f2b0d6535b1b6-b4dd378b34aecd9a7b1fd0c2b8949b48f23dd74b" href="https://github.com/facebook/watchman/blob/master/FileInformation.cpp">FileInformation.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="improve existential SCM aware query handling

Summary:
D7142088 made a valiant attempt but there were a couple
of holes in the implementation that were missed because there
were some gaps in our testing:

* The absolute path that we constructed in LocalFileResult was
  not consistently using the prefix from the root, so we were
  falsely considering a number of files as deleted.  This squeaked
  through in the prior diff because the test case for this feature
  was explicitly checking only for deleted files.  The integration
  test has been added to check for a file existing this time around.
* The FileInformation instance that got generated for a file that
  didn't exist was simply zeroed out.  This meant that none of the
  query expression syntax that matched on file type would ever
  successfully select a result.  I've expanded the integration test
  to include a `[&quot;type&quot;: &quot;f&quot;]` expression to make sure that we're
  exercising this.
* I've added a helper method to `FileInformation` to construct a
  special *I was a file but I've been deleted* instance that we
  construct in `LocalFileResult::getInfo` in that case.
* The `LocalFileResult::dirname` method is supposed to return
  the complete absolute path to the file, minus its basename.
  We were only returning the path relative to the root.  This
  happened to pass the last rounds of tests because they were
  looking only at files contained directly within the root,
  and that just happened to work out.  When the files have multiple
  path components what was happening was that they would get
  truncated at nonsensical (but memory-safe) offsets.  I've
  expanded the test to include multiple directory levels to
  tickle this case also.

Reviewed By: simpkins

Differential Revision: D7180898

fbshipit-source-id: ecbe6466f15ce3c8e5c0886b2945b15f3a7d2665" class="message" href="https://github.com/facebook/watchman/commit/aed1711316df263c69a220825e17026f227b5a13">improve existential SCM aware query handling</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-07T23:21:02Z">Mar 8, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="FileInformation.h" id="2f6d474e3affcccd21e3d7633f9dc54e-d1e02f562a6456d8de2d4599cb3f1aa339cb4958" href="https://github.com/facebook/watchman/blob/master/FileInformation.h">FileInformation.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="improve existential SCM aware query handling

Summary:
D7142088 made a valiant attempt but there were a couple
of holes in the implementation that were missed because there
were some gaps in our testing:

* The absolute path that we constructed in LocalFileResult was
  not consistently using the prefix from the root, so we were
  falsely considering a number of files as deleted.  This squeaked
  through in the prior diff because the test case for this feature
  was explicitly checking only for deleted files.  The integration
  test has been added to check for a file existing this time around.
* The FileInformation instance that got generated for a file that
  didn't exist was simply zeroed out.  This meant that none of the
  query expression syntax that matched on file type would ever
  successfully select a result.  I've expanded the integration test
  to include a `[&quot;type&quot;: &quot;f&quot;]` expression to make sure that we're
  exercising this.
* I've added a helper method to `FileInformation` to construct a
  special *I was a file but I've been deleted* instance that we
  construct in `LocalFileResult::getInfo` in that case.
* The `LocalFileResult::dirname` method is supposed to return
  the complete absolute path to the file, minus its basename.
  We were only returning the path relative to the root.  This
  happened to pass the last rounds of tests because they were
  looking only at files contained directly within the root,
  and that just happened to work out.  When the files have multiple
  path components what was happening was that they would get
  truncated at nonsensical (but memory-safe) offsets.  I've
  expanded the test to include multiple directory levels to
  tickle this case also.

Reviewed By: simpkins

Differential Revision: D7180898

fbshipit-source-id: ecbe6466f15ce3c8e5c0886b2945b15f3a7d2665" class="message" href="https://github.com/facebook/watchman/commit/aed1711316df263c69a220825e17026f227b5a13">improve existential SCM aware query handling</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-07T23:21:02Z">Mar 8, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="FileSystem.h" id="91d151c2728d71938ab593ebddd7b9b3-f950b0bc41421cea493d354eba5e5c5303ecef2b" href="https://github.com/facebook/watchman/blob/master/FileSystem.h">FileSystem.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="turn off strict symlink check in OpenFileHandleOptions.openDir().

Summary:
Use OpenFileHandleOptions.strictOpenDir() to enable the strict symlink
rules explicitly.

Before this change, `watchman::openFileHandle()` always enforces strict
symlink rules because `strictNameChecks` is true even in
`OpenFileHandleOptions.openDir()`.
Closes https://github.com/facebook/watchman/pull/478

Differential Revision: D5180611

Pulled By: wez

fbshipit-source-id: b04c8e12328325dffe2752414f4795d56aebd851" class="message" href="https://github.com/facebook/watchman/commit/98b6d8191121bd8af46a54d5c4249dfab686711e">turn off strict symlink check in OpenFileHandleOptions.openDir().</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-06-04T18:05:01Z">Jun 5, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="Future.h" id="510eb16567951eff4567522a3bf94734-f7c5a22f37008d7fc895bc3489eca368d5229d7d" href="https://github.com/facebook/watchman/blob/master/Future.h">Future.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="use eden thrift endpoint for getFilesChangedBetweenCommits

Summary:
When we need to understand the set of changed files, kick off
concurrent queries against eden and mercurial.

In many cases eden will complete in significantly less time than mercurial, but
in some pathological cases (eg: `hg pull ; hg co master ; buck build` across a
bit distance), eden can be significantly slower than mercurial.

We discussed some ways to improve things here:

* change the watchman SCM abstraction so that we can give eden some contextual paths when it performs the &quot;status&quot; query
* change the eden storage layering so that we can avoid writing trees that we already have in tree manifest form

To compensate for this in the short term we race the two methods and take the
winner.

Reviewed By: eamonnkent

Differential Revision: D6305845

fbshipit-source-id: 6f7d271909cf7073011015fd8422ab671325a45d" class="message" href="https://github.com/facebook/watchman/commit/2f163e2651c694d8be6cc997bea07169b53d5f0a">use eden thrift endpoint for getFilesChangedBetweenCommits</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-11-29T03:42:31Z">Nov 29, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="InMemoryView.cpp" id="ee62393f43d2aaa2a8fd32984276bd47-9047fc56174f3c590726986ab66c767995c91ba5" href="https://github.com/facebook/watchman/blob/master/InMemoryView.cpp">InMemoryView.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="use otime rather than timestamps for symlink cache

Summary:
While timestamps seemed to work reliably on our internal CI, they're
pretty flaky on the open source CI and also on my laptop.

Switch the cache key to use the `otime` field instead; this holds
the watchman clock value from the last time we observed a change
for a given file node and isn't subject to timestamp granularity
or clock drift concerns.
Closes https://github.com/facebook/watchman/pull/588

Differential Revision: D7363065

Pulled By: wez

fbshipit-source-id: 7370510a90b006a70f7cd208190ac0571304870d" class="message" href="https://github.com/facebook/watchman/commit/e32d8d2e41f0f2948efb67fd306668a1592e0985">use otime rather than timestamps for symlink cache</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-22T05:10:25Z">Mar 22, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="InMemoryView.h" id="6a284e8b67f3cd8fd4e4dc6f442544cb-c33133e2d553fde6f067b902b88370bad3ad64e3" href="https://github.com/facebook/watchman/blob/master/InMemoryView.h">InMemoryView.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="defer reading of symlink targets

Summary:
I've seen a few problem reports where cold cache situations on laptops
take a very long time to perform an initial crawl.  This diff changes the
recording of symlink targets so that it is no performed eagerly and instead
changes things to use the LRU cache infrastructure that we added for content
hash caching.

Another nice side benefit of this diff is that we save some memory (1x
`w_string` instance per symlink).

Reviewed By: simpkins

Differential Revision: D7341642

fbshipit-source-id: 6c632da6b557667baece71837883567d7cd5abbf" class="message" href="https://github.com/facebook/watchman/commit/ff819f71762781339b2d6cbeb1531073241c1772">defer reading of symlink targets</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-21T05:44:35Z">Mar 21, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="LICENSE" id="9879d6db96fd29134fc802214163b95a-f433b1a53f5b830a205fd2df78e2b34974656c7b" itemprop="license" href="https://github.com/facebook/watchman/blob/master/LICENSE">LICENSE</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="initial commit

Summary:
See discussion on D642771.
This is the diff to get it situated in the github repo.

Test Plan:
to build:

     ./autogen.sh
     ./configure
     make

CC: fugalh, agallagher, scottg, shilin

Differential Revision: https://phabricator.fb.com/D643850

Reviewed By: keegancsmith" class="message" href="https://github.com/facebook/watchman/commit/77c0f51a1bf6f10162452304bf9a51718d4dda4a">initial commit</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2012-11-30T01:48:14Z">Nov 30, 2012</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="LRUCache.h" id="1c0a1d76addcf266f59bf4143f3db8d4-d34f4c14a39719dd5ff0d5144eb74cd64a1f72a5" href="https://github.com/facebook/watchman/blob/master/LRUCache.h">LRUCache.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="add content hash cache warming heuristics

Summary:
Adds some simple heuristics for warming up the cache:

1. Enable/disable warming
2. If enabled, limit to the N most recently changed files at
   settle time.
3. Optionally defer settling pending completion of hashing
   the file contents.

I've added some diagnostics to the cache so that we can verify
that the operations are happening when we think they are.

Reviewed By: farnz

Differential Revision: D4505780

fbshipit-source-id: ba6b6aecbf75a56a0f9ae71221e60b17a508623f" class="message" href="https://github.com/facebook/watchman/commit/802d37abe570fef81547cac3d346eef69b3ec93b">add content hash cache warming heuristics</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-02-04T02:03:07Z">Feb 4, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="LocalFileResult.cpp" id="fc99c8513a2b04ab548c2b70763406cf-462b68e7f94a8b58040e797e9a49aa2af6d2d91e" href="https://github.com/facebook/watchman/blob/master/LocalFileResult.cpp">LocalFileResult.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="defer reading of symlink targets

Summary:
I've seen a few problem reports where cold cache situations on laptops
take a very long time to perform an initial crawl.  This diff changes the
recording of symlink targets so that it is no performed eagerly and instead
changes things to use the LRU cache infrastructure that we added for content
hash caching.

Another nice side benefit of this diff is that we save some memory (1x
`w_string` instance per symlink).

Reviewed By: simpkins

Differential Revision: D7341642

fbshipit-source-id: 6c632da6b557667baece71837883567d7cd5abbf" class="message" href="https://github.com/facebook/watchman/commit/ff819f71762781339b2d6cbeb1531073241c1772">defer reading of symlink targets</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-21T05:44:35Z">Mar 21, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="LocalFileResult.h" id="98580030168166dae737468c02326f97-14865369478d712954fee0f2e80f2708b01afc8d" href="https://github.com/facebook/watchman/blob/master/LocalFileResult.h">LocalFileResult.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="defer reading of symlink targets

Summary:
I've seen a few problem reports where cold cache situations on laptops
take a very long time to perform an initial crawl.  This diff changes the
recording of symlink targets so that it is no performed eagerly and instead
changes things to use the LRU cache infrastructure that we added for content
hash caching.

Another nice side benefit of this diff is that we save some memory (1x
`w_string` instance per symlink).

Reviewed By: simpkins

Differential Revision: D7341642

fbshipit-source-id: 6c632da6b557667baece71837883567d7cd5abbf" class="message" href="https://github.com/facebook/watchman/commit/ff819f71762781339b2d6cbeb1531073241c1772">defer reading of symlink targets</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-21T05:44:35Z">Mar 21, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="Logging.h" id="9ab9c4abb7aae6580dad46a9d3257d90-9a1415f2d05e5b01135a9662ce7898365b818a0e" href="https://github.com/facebook/watchman/blob/master/Logging.h">Logging.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="terminate process without running destructors on FATAL

Summary:
For better or worse... I've seen this trace in the wild,
and its been lingering for 4 days!  Strangely, the process is almost
fully functional, except for flushing subscriptions.

I suspect that we have an uncaught exception in the client thread because the
logs look like this; these indicate that the terminating thread was a client
thread.  We can see that it handled a query 2 seconds prior to the fault:

```
2018-03-17T04:52:48,510: [client=0x7f7f39d3e1d0:stm=0x7f7f39c75840:pid=1819024] PERF: {&quot;system_time&quot;: 0.081978999999999996, &quot;user_time&quot;: 0.0055560000000000002, &quot;elapsed_time&quot;: 1.2319009999999999, &quot;description&quot;: &quot;que
ry_execute&quot;, &quot;meta&quot;: {&quot;query_execute&quot;: {&quot;query&quot;: {&quot;expression&quot;: [&quot;allof&quot;, [&quot;not&quot;, [&quot;anyof&quot;, [&quot;dirname&quot;, &quot;.hg&quot;], [&quot;dirname&quot;, &quot;.git&quot;], [&quot;dirname&quot;, &quot;.svn&quot;]]]], &quot;since&quot;: {&quot;drop&quot;: [&quot;hg.update&quot;], &quot;scm&quot;: {&quot;mergebase-with&quot;:
 &quot;master&quot;}}, &quot;relative_root&quot;: &quot;&quot;, &quot;empty_on_fresh_instance&quot;: true, &quot;fields&quot;: [&quot;name&quot;]}, &quot;fresh_instance&quot;: false, &quot;num_deduped&quot;: 0, &quot;num_results&quot;: 1, &quot;num_walked&quot;: 11}, &quot;root&quot;: {&quot;watcher&quot;: &quot;inotify&quot;, &quot;path&quot;: &quot;/data/u
sers/akramer/www-hg&quot;, &quot;case_sensitive&quot;: true, &quot;recrawl_count&quot;: 0}}, &quot;start_time&quot;: 1521287567.278764, &quot;pid&quot;: 3700551, &quot;version&quot;: &quot;4.9.0&quot;}
2018-03-17T04:52:50,116: [client=0x7f7f39d3e1d0:stm=0x7f7f39c75840:pid=1819024] std::terminate was called
Fatal error detected at:
/usr/local/bin/watchman() [0x411507]
/usr/local/bin/watchman() [0x6c12f6]
/usr/local/bin/watchman() [0x443620]
/usr/local/bin/watchman() [0x6c2525]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8cd95) [0x7f7f3b8ded95]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(_ZSt9terminatev+0x10) [0x7f7f3b8dede0]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0xc7227) [0x7f7f3b919227]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libpthread.so.0(+0x77a8) [0x7f7f3b0157a8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libc.so.6(clone+0x6c) [0x7f7f3a931a7c]
```

There was not a lot of useful additional information available from the process
(I captured a core file and poked around).  Here's the trace of the stuck
thread.  None of the other threads are waiting on locks; all threads appear to
be waiting for requests and operating reasonably; other requests for the same
root will succeed and so on.

```
Thread 75 (Thread 0x7f7f1ab7e700 (LWP 1819033)):
```

I've expanded our termination handler to attempt to print out the current
exception.  This seems to be present for the obvious cases; the trace doesn't
provide a huge amount of context but at least we can divine the thread name
from the existing logging, and can also resolve to the thread function when
attaching to the gdb core file.

```
2018-03-22T09:52:05,164: [perflog] std::terminate was called. Exception: boop.
Fatal error detected at:
./buck-out/gen/watchman/watchman() [0x69ccd4]
./buck-out/gen/watchman/watchman() [0x69e7fc]
./buck-out/gen/watchman/watchman() [0x443ee0]
./buck-out/gen/watchman/watchman() [0x6a062d]
./buck-out/gen/watchman/watchman() [0x6a07f8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8cd95) [0x7fc441cabd95]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8b9d8) [0x7fc441caa9d8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(__gxx_personality_v0+0x387) [0x7fc441cab357]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libgcc_s.so.1(+0xff0c) [0x7fc4404cdf0c]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libgcc_s.so.1(_Unwind_RaiseException+0x1ac) [0x7fc4404ce44c]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(__cxa_throw+0x63) [0x7fc441cac053]
./buck-out/gen/watchman/watchman() [0x488dad]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0xc7170) [0x7fc441ce6170]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libpthread.so.0(+0x77a8) [0x7fc4413e27a8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libc.so.6(clone+0x6c) [0x7fc440cfea7c]
[1]    1237117 abort (core dumped)  ./buck-out/gen/watchman/watchman --foreground --logfile=/dev/stdout
```

I also cleaned up the handling of the `send_ok` variable.  It appeared to be
possible for this to get set but then nothing would ever terminate the main
loop.  That code was added back before much of the supporting bits had been
converted to C++.

I've changed the `exit()` call to `_exit()` to avoid calling `atexit`
handlers and destructors.  We used to `abort()` here, but there are a number of
cases where we don't want that to generate a core file so it was recently
changed to exit.   I've added an explicit `ABORT` error level to accomodate
this class of problem.

Reviewed By: simpkins

Differential Revision: D7354472

fbshipit-source-id: 846f93b568beb1e7b00dc91f02e71c40678c86b6" class="message" href="https://github.com/facebook/watchman/commit/4232c70fdc11ba642311633ea38a3d5dd5506dcf">terminate process without running destructors on FATAL</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-22T18:18:53Z">Mar 23, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="Makefile.am" id="c949f93d03f44a4217d7a138f9e2e54a-5af3c0521df92d05f1fe565b83375b17baf54c18" href="https://github.com/facebook/watchman/blob/master/Makefile.am">Makefile.am</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="defer reading of symlink targets

Summary:
I've seen a few problem reports where cold cache situations on laptops
take a very long time to perform an initial crawl.  This diff changes the
recording of symlink targets so that it is no performed eagerly and instead
changes things to use the LRU cache infrastructure that we added for content
hash caching.

Another nice side benefit of this diff is that we save some memory (1x
`w_string` instance per symlink).

Reviewed By: simpkins

Differential Revision: D7341642

fbshipit-source-id: 6c632da6b557667baece71837883567d7cd5abbf" class="message" href="https://github.com/facebook/watchman/commit/ff819f71762781339b2d6cbeb1531073241c1772">defer reading of symlink targets</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-21T05:44:35Z">Mar 21, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="MapUtil.h" id="1fc960ca9395431a48c51ee5d9a3583f-9c965f1ef0c1a5895368564cb2d9b35a17f8a6e9" href="https://github.com/facebook/watchman/blob/master/MapUtil.h">MapUtil.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="Add utility method and tests

Summary:
This commit provides a utility template method to check if a map contains any
of a list of keys. The keys are provided using start/end pointers (iterator).
Included are a number of test cases to exercise the new code and validate the
implementation.

There is a need for these changes (in stacked commits).

Reviewed By: wez

Differential Revision: D6203377

fbshipit-source-id: 9afe0f0cf8a4d4a82e94009c53a500a67a159976" class="message" href="https://github.com/facebook/watchman/commit/50982500ee5a156ea9b20afad83de18b36fa3461">Add utility method and tests</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-11-06T22:51:47Z">Nov 7, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="Pipe.cpp" id="4eaeb1bfef1639e38573fb46c1b9b7d7-750c45d62aaabf8e4459fb0c798a6e732e40aa82" href="https://github.com/facebook/watchman/blob/master/Pipe.cpp">Pipe.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="Re-worked replacement of memset with proper init to make it gcc 4.8 compliant.

Summary: Closes https://github.com/facebook/watchman/pull/565

Reviewed By: wez

Differential Revision: D6827004

Pulled By: zhupanov

fbshipit-source-id: 9515eebd7aa48528a10245030e46b6cb37a6d7c2" class="message" href="https://github.com/facebook/watchman/commit/a202311e948868ea2c81377a4a6889d8c97e8105">Re-worked replacement of memset with proper init to make it gcc 4.8 c…</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-01-27T03:52:49Z">Jan 27, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="Pipe.h" id="d09fc34c14a0e56dfef3c9e2201bf457-6c06942035266aab943f30a9313d26617dbd014a" href="https://github.com/facebook/watchman/blob/master/Pipe.h">Pipe.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="merge Win32Handle into FileDescriptor

Summary:
I've kept Win32Handle.cpp and some of the functions it
holds for the moment; since I have a number of modifications in
a stack of changes that is pending review, I'm anticipating that
resolving merge conflicts across a rename will be a PITA, so I'm
deferring moving those around until after the stack is landed.

This is a pretty straight forward change with just a little bit
of fan-out to the heavier weight stream layer.

Reviewed By: simpkins

Differential Revision: D5124899

fbshipit-source-id: 14b9cd76ec67881c5d26edc5ee98f31e75c453d4" class="message" href="https://github.com/facebook/watchman/commit/39742c4378b80fa1200f81e34091668037f96d63">merge Win32Handle into FileDescriptor</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-06-02T15:21:43Z">Jun 2, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="PubSub.cpp" id="caae3aed3cc60c65af0f18d08a295b94-082b0d1e6c103e9623167615cead8ae4a9f6c002" href="https://github.com/facebook/watchman/blob/master/PubSub.cpp">PubSub.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="fix deadlock in subscription teardown

Summary:
In speaking with jbower earlier today, he said that he'd
noticed correlation between this fault and the webserver crashing.
Since the webserver may have multiple subscriptions this gave me
some inspiration for the integration test to try to reproduce this.

The issue is a race condition: if multiple different client sessions
are terminated at the same time then it is possible for the `~Subscriber`
destructor to end up holding the final reference to some other `Subscriber`
instance and thus end up recursing into its `~Subscriber` and deadlock
while attempting to re-acquire the wlock that is already held by the
current thread.

Reviewed By: chadaustin

Differential Revision: D7178797

fbshipit-source-id: 540728d76ade29ea0bcf4716a71b7055966e401e" class="message" href="https://github.com/facebook/watchman/commit/5dfcdd908d02ad1f60e701072f41dfe4fbf5bbec">fix deadlock in subscription teardown</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-07T20:00:03Z">Mar 8, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="PubSub.h" id="e31b33424c3b42b544160c82857ef614-cea42272c1fea45e25340823d750a2184466fcce" href="https://github.com/facebook/watchman/blob/master/PubSub.h">PubSub.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="Enhance the watchman debug-get-subscriptions command

Summary:
Enhanced the watchman debug-get-subscriptions command to return information on
the query associated with the subscription.

watchman/ekent-state/alt.sock
{
    &quot;version&quot;: &quot;2017-08-25T08:03:24Z&quot;,
    &quot;next_serial&quot;: 29,
    &quot;items&quot;: [
        {
            &quot;serial&quot;: 27,
            &quot;payload&quot;: {
                &quot;settled&quot;: true
            }
        },
        {
            &quot;serial&quot;: 28,
            &quot;payload&quot;: {
                &quot;settled&quot;: true
            }
        }
    ],
    &quot;subscribers&quot;: [
        {
            &quot;serial&quot;: 28,
            &quot;info&quot;: {
                &quot;name&quot;: &quot;hg_monitor2&quot;,
                &quot;query&quot;: {
                    &quot;since&quot;: {
                        &quot;scm&quot;: {
                            &quot;mergebase-with&quot;: &quot;master&quot;
                        }
                    },
                    &quot;defer&quot;: [
                        &quot;hg.update&quot;
                    ],
                    &quot;expression&quot;: [
                        &quot;allof&quot;,
                        [
                            &quot;type&quot;,
                            &quot;f&quot;
                        ],
                        [
                            &quot;anyof&quot;,
                            [
                                &quot;allof&quot;,
                                [
                                    &quot;dirname&quot;,
                                    &quot;.hg&quot;
                                ],
                                [
                                    &quot;name&quot;,
                                    &quot;dirstate&quot;
                                ]
                            ],
                            [
                                &quot;suffix&quot;,
                                &quot;php&quot;
                            ],
                            [
                                &quot;suffix&quot;,
                                &quot;js&quot;
                            ],
                            [
                                &quot;suffix&quot;,
                                &quot;py&quot;
                            ],
                            [
                                &quot;suffix&quot;,
                                &quot;sh&quot;
                            ]
                        ]
                    ],
                    &quot;fields&quot;: [
                        &quot;name&quot;,
                        &quot;exists&quot;,
                        &quot;oclock&quot;,
                        &quot;mtime_ms&quot;,
                        &quot;size&quot;,
                        &quot;uid&quot;,
                        &quot;content.sha1hex&quot;
                    ]
                },
                &quot;pid&quot;: 2177435,
                &quot;is_owner&quot;: true,
                &quot;stm&quot;: &quot;0x7f92d3389840&quot;,
                &quot;client&quot;: &quot;0x7f92d3464290&quot;
            }
        }
    ]
}

Reviewed By: wez

Differential Revision: D5700179

fbshipit-source-id: f2d25a848a230989dfc69f8f40b5b91827f2f25b" class="message" href="https://github.com/facebook/watchman/commit/09999d207ec28f45cb7243b8d68e46f7d92f25be">Enhance the watchman debug-get-subscriptions command</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-08-27T04:39:12Z">Aug 27, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="QueryableView.cpp" id="02808dbd2ecead41ecf4b749240d32db-19f40e4e9085e2515f14d4b47b642360c3ee1242" href="https://github.com/facebook/watchman/blob/master/QueryableView.cpp">QueryableView.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="recrawls no longer recreate the view instance

Summary:
The primary problem I'm shooting to address here is what appears to be a race
condition with queries being placed at the same time as a recrawl is detected.
When our query lock was giant and always exclusive this was never a problem,
but in moving to finer grained locking we've opened ourselves up to this.

The race is around the view instance being recycled.  This occurred in some
thorny code that originated from some clever C code when it was originally
added and that has morphed into some tricksy placement new/placement delete
code in the codebase today.  Over time the members touched by the
tearDown/reinit flow have been reduced in volume, and we've reached the point
where we no longer require or benefit from this complication.

This diff removes the view reset at recrawl, which should eliminate all
possible recrawl/teardown related races.

It has the following implications:

* Recrawls no longer directly lead to a fresh instance result set.
  This is a positive move for all consumers; it changes the
  recrawl behavior from causing a higher latency and very large
  response to a higher latency response with smaller volume.
  This extends to triggers: we'll only run the trigger if
  we've detected files as having changed, whereas we would
  previously always run the trigger again on recrawl.

* Sync cookies were traditionally completely abandoned by a
  recrawl.  We can now abort them at recrawl time (actually,
  at the end of the recrawl) so that waiters are signalled
  about the issue rather than having to fully timeout.

  syncToNow will catch the cookie abort and retry with
  another cookie until the total timeout period has elapsed.

The heart of this change is to move the `handleShouldRecrawl` method from being
acted on in the kernel notification thread to the IO/observation thread in the
InMemoryView class.  When scheduling a recrawl, the recrawlInfo is updated to
reflect the request, and then the IO thread is pinged (via the new
`wakeThreads` method) to wake up and perform the recursive crawl.

I'm going to make a follow up diff to move the members from the `inner` struct
up to the main level in the `root`; I didn't want to inflate this diff with
that rather mechanical change.

Reviewed By: simpkins

Differential Revision: D5132237

fbshipit-source-id: 6b1dcb1cbb90beb690a0f13ea0c6bf0c89be0695" class="message" href="https://github.com/facebook/watchman/commit/b1c03bd385414afd5f9f89a5771b4a1b48d1a97a">recrawls no longer recreate the view instance</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-06-20T17:41:31Z">Jun 21, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="QueryableView.h" id="7ac36000d8fcef7cc0805e96d5f342fa-41f057060b4bbb0bc64a4365ec2f022a85543bb9" href="https://github.com/facebook/watchman/blob/master/QueryableView.h">QueryableView.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="work harder to surface sync errors more accurately

Summary:
This rearranges things a little to make it easier to propagate the
reason and context behind a cookie sync timeout; we now use an exception for
this so that we can include data about the recrawl state of the repo too.

While testing this I noticed that we would block for a long time even if we set
the sync_timeout to be super short and I traced this to the perf sampling code;
it was collecting the current clock information from the root, but this data is
locked during a recrawl and this meant that our wonderfully short timeout
wasn't being respected.

In practice, I've never needed to look at the current clock position in the
data that we sample to scuba so I've simply removed it to unblock things.  This
should help to avoid situations like this one that was reported in the group:

https://fb.facebook.com/groups/scm/permalink/1572802659436015

Reviewed By: simpkins

Differential Revision: D7075600

fbshipit-source-id: 2b70a814a55d7b5d5d0d60d204ee0d6cc825f3c6" class="message" href="https://github.com/facebook/watchman/commit/b6427288a016012c862f2c6153f7a8fc9d5479a3">work harder to surface sync errors more accurately</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-02-24T08:09:17Z">Feb 24, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="README.markdown" id="0a369498a5a8db3ac8fa606b544c9810-5389c2581b557b4f9b5822b237651674f4c521e5" href="https://github.com/facebook/watchman/blob/master/README.markdown">README.markdown</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="Add Code of Conduct

Summary:
**Edit:** We updated the existing Contributing page on the docs - see below~
&lt;img width=&quot;1371&quot; alt=&quot;screen shot 2017-12-03 at 5 44 37 pm&quot; src=&quot;https://user-images.githubusercontent.com/1114467/33532828-d4661628-d851-11e7-9ba3-9c376e001a98.png&quot;&gt;
 ---

In the past Facebook didn't promote including a Code of Conduct when creating new projects, and many projects skipped this important document. Let's fix it. :)

**why make this change?:**
Facebook Open Source provides a Code of Conduct statement for all
projects to follow, to promote a welcoming and safe open source community.

Exposing the COC via a separate markdown file is a standard being
promoted by Github via the Community Profile in order to meet their Open
Source Guide's recommended community standards.

As you can see, adding this file will improve [the watchman community profile](https://github.com/facebook/watchman/community)
checklist and increase the visibility of our COC.

**test plan:**
Viewing it on my branch -
&lt;img width=&quot;1011&quot; alt=&quot;screen shot 2017-12-03 at 4 25 34 pm&quot; src=&quot;https://user-images.githubusercontent.com/1114467/33531781-dc4e1b98-d846-11e7-8e6d-5ed9e02f25bb.png&quot;&gt;

**issue:**
internal task t23481323
Closes https://github.com/facebook/watchman/pull/555

Reviewed By: wez

Differential Revision: D6487028

Pulled By: eamonnkent

fbshipit-source-id: 4433aa782900008da8a5c973e8e0231987c11fa6" class="message" href="https://github.com/facebook/watchman/commit/2f9359ffb1a271f316ab335293a55ded1dac1359">Add Code of Conduct</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-12-07T03:32:42Z">Dec 7, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="Result.h" id="39d957c505e89e741c1ce9d6547aca46-de1eec5025edb762fae80d4400e5beb575af5adb" href="https://github.com/facebook/watchman/blob/master/Result.h">Result.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="merge Win32Handle into FileDescriptor

Summary:
I've kept Win32Handle.cpp and some of the functions it
holds for the moment; since I have a number of modifications in
a stack of changes that is pending review, I'm anticipating that
resolving merge conflicts across a rename will be a PITA, so I'm
deferring moving those around until after the stack is landed.

This is a pretty straight forward change with just a little bit
of fan-out to the heavier weight stream layer.

Reviewed By: simpkins

Differential Revision: D5124899

fbshipit-source-id: 14b9cd76ec67881c5d26edc5ee98f31e75c453d4" class="message" href="https://github.com/facebook/watchman/commit/39742c4378b80fa1200f81e34091668037f96d63">merge Win32Handle into FileDescriptor</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-06-02T15:21:43Z">Jun 2, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="SymlinkTargets.cpp" id="00915a0b3bef6e536983ef85fb6bf213-e8d6ef32865ecd92d7efa6676fd34aabec8dd77e" href="https://github.com/facebook/watchman/blob/master/SymlinkTargets.cpp">SymlinkTargets.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="use otime rather than timestamps for symlink cache

Summary:
While timestamps seemed to work reliably on our internal CI, they're
pretty flaky on the open source CI and also on my laptop.

Switch the cache key to use the `otime` field instead; this holds
the watchman clock value from the last time we observed a change
for a given file node and isn't subject to timestamp granularity
or clock drift concerns.
Closes https://github.com/facebook/watchman/pull/588

Differential Revision: D7363065

Pulled By: wez

fbshipit-source-id: 7370510a90b006a70f7cd208190ac0571304870d" class="message" href="https://github.com/facebook/watchman/commit/e32d8d2e41f0f2948efb67fd306668a1592e0985">use otime rather than timestamps for symlink cache</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-22T05:10:25Z">Mar 22, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="SymlinkTargets.h" id="a1fea6a4f4756f2421e0c94d02e31b1a-1aec9745411b9fd3a72cd1227483b60f395e385a" href="https://github.com/facebook/watchman/blob/master/SymlinkTargets.h">SymlinkTargets.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="use otime rather than timestamps for symlink cache

Summary:
While timestamps seemed to work reliably on our internal CI, they're
pretty flaky on the open source CI and also on my laptop.

Switch the cache key to use the `otime` field instead; this holds
the watchman clock value from the last time we observed a change
for a given file node and isn't subject to timestamp granularity
or clock drift concerns.
Closes https://github.com/facebook/watchman/pull/588

Differential Revision: D7363065

Pulled By: wez

fbshipit-source-id: 7370510a90b006a70f7cd208190ac0571304870d" class="message" href="https://github.com/facebook/watchman/commit/e32d8d2e41f0f2948efb67fd306668a1592e0985">use otime rather than timestamps for symlink cache</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-22T05:10:25Z">Mar 22, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="TARGETS" id="25ca2925c669fb9025f484ff8f63d455-9b6934a71fa20c5b8f83a4414416212d0d38dd51" href="https://github.com/facebook/watchman/blob/master/TARGETS">TARGETS</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="fixup internal version reporting

Summary:
This got broken along the way, most likely by some
TARGETS file refactoring.  Since we're moving to cmake for
the open source build, we can simplify the TARGETS file a bit
too.

This removes the probing stuff that sort of helped with building
with opensource buck, and enables the preprocessor define that
pulls in the fbcode build information.

Reviewed By: simpkins

Differential Revision: D7368121

fbshipit-source-id: b5afec3a2dbd70ec9d481a53df0892bd4b978654" class="message" href="https://github.com/facebook/watchman/commit/32a29463e47e39a167a5cb792ab4c1a9dd37eac7">fixup internal version reporting</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-28T21:38:27Z">Mar 29, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="ThreadPool.cpp" id="59a3079dd9d1746aae7e2b2f7e3c9fb1-2aadbe8501b30e3c8e9135a1adf7d67b7ae8cf7e" href="https://github.com/facebook/watchman/blob/master/ThreadPool.cpp">ThreadPool.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="terminate process without running destructors on FATAL

Summary:
For better or worse... I've seen this trace in the wild,
and its been lingering for 4 days!  Strangely, the process is almost
fully functional, except for flushing subscriptions.

I suspect that we have an uncaught exception in the client thread because the
logs look like this; these indicate that the terminating thread was a client
thread.  We can see that it handled a query 2 seconds prior to the fault:

```
2018-03-17T04:52:48,510: [client=0x7f7f39d3e1d0:stm=0x7f7f39c75840:pid=1819024] PERF: {&quot;system_time&quot;: 0.081978999999999996, &quot;user_time&quot;: 0.0055560000000000002, &quot;elapsed_time&quot;: 1.2319009999999999, &quot;description&quot;: &quot;que
ry_execute&quot;, &quot;meta&quot;: {&quot;query_execute&quot;: {&quot;query&quot;: {&quot;expression&quot;: [&quot;allof&quot;, [&quot;not&quot;, [&quot;anyof&quot;, [&quot;dirname&quot;, &quot;.hg&quot;], [&quot;dirname&quot;, &quot;.git&quot;], [&quot;dirname&quot;, &quot;.svn&quot;]]]], &quot;since&quot;: {&quot;drop&quot;: [&quot;hg.update&quot;], &quot;scm&quot;: {&quot;mergebase-with&quot;:
 &quot;master&quot;}}, &quot;relative_root&quot;: &quot;&quot;, &quot;empty_on_fresh_instance&quot;: true, &quot;fields&quot;: [&quot;name&quot;]}, &quot;fresh_instance&quot;: false, &quot;num_deduped&quot;: 0, &quot;num_results&quot;: 1, &quot;num_walked&quot;: 11}, &quot;root&quot;: {&quot;watcher&quot;: &quot;inotify&quot;, &quot;path&quot;: &quot;/data/u
sers/akramer/www-hg&quot;, &quot;case_sensitive&quot;: true, &quot;recrawl_count&quot;: 0}}, &quot;start_time&quot;: 1521287567.278764, &quot;pid&quot;: 3700551, &quot;version&quot;: &quot;4.9.0&quot;}
2018-03-17T04:52:50,116: [client=0x7f7f39d3e1d0:stm=0x7f7f39c75840:pid=1819024] std::terminate was called
Fatal error detected at:
/usr/local/bin/watchman() [0x411507]
/usr/local/bin/watchman() [0x6c12f6]
/usr/local/bin/watchman() [0x443620]
/usr/local/bin/watchman() [0x6c2525]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8cd95) [0x7f7f3b8ded95]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(_ZSt9terminatev+0x10) [0x7f7f3b8dede0]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0xc7227) [0x7f7f3b919227]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libpthread.so.0(+0x77a8) [0x7f7f3b0157a8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libc.so.6(clone+0x6c) [0x7f7f3a931a7c]
```

There was not a lot of useful additional information available from the process
(I captured a core file and poked around).  Here's the trace of the stuck
thread.  None of the other threads are waiting on locks; all threads appear to
be waiting for requests and operating reasonably; other requests for the same
root will succeed and so on.

```
Thread 75 (Thread 0x7f7f1ab7e700 (LWP 1819033)):
```

I've expanded our termination handler to attempt to print out the current
exception.  This seems to be present for the obvious cases; the trace doesn't
provide a huge amount of context but at least we can divine the thread name
from the existing logging, and can also resolve to the thread function when
attaching to the gdb core file.

```
2018-03-22T09:52:05,164: [perflog] std::terminate was called. Exception: boop.
Fatal error detected at:
./buck-out/gen/watchman/watchman() [0x69ccd4]
./buck-out/gen/watchman/watchman() [0x69e7fc]
./buck-out/gen/watchman/watchman() [0x443ee0]
./buck-out/gen/watchman/watchman() [0x6a062d]
./buck-out/gen/watchman/watchman() [0x6a07f8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8cd95) [0x7fc441cabd95]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8b9d8) [0x7fc441caa9d8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(__gxx_personality_v0+0x387) [0x7fc441cab357]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libgcc_s.so.1(+0xff0c) [0x7fc4404cdf0c]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libgcc_s.so.1(_Unwind_RaiseException+0x1ac) [0x7fc4404ce44c]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(__cxa_throw+0x63) [0x7fc441cac053]
./buck-out/gen/watchman/watchman() [0x488dad]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0xc7170) [0x7fc441ce6170]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libpthread.so.0(+0x77a8) [0x7fc4413e27a8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libc.so.6(clone+0x6c) [0x7fc440cfea7c]
[1]    1237117 abort (core dumped)  ./buck-out/gen/watchman/watchman --foreground --logfile=/dev/stdout
```

I also cleaned up the handling of the `send_ok` variable.  It appeared to be
possible for this to get set but then nothing would ever terminate the main
loop.  That code was added back before much of the supporting bits had been
converted to C++.

I've changed the `exit()` call to `_exit()` to avoid calling `atexit`
handlers and destructors.  We used to `abort()` here, but there are a number of
cases where we don't want that to generate a core file so it was recently
changed to exit.   I've added an explicit `ABORT` error level to accomodate
this class of problem.

Reviewed By: simpkins

Differential Revision: D7354472

fbshipit-source-id: 846f93b568beb1e7b00dc91f02e71c40678c86b6" class="message" href="https://github.com/facebook/watchman/commit/4232c70fdc11ba642311633ea38a3d5dd5506dcf">terminate process without running destructors on FATAL</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-22T18:18:53Z">Mar 23, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="ThreadPool.h" id="63649797151087372be359ada58a210f-40b5c1be07c54f6abf4ffd8462f773c314e17e21" href="https://github.com/facebook/watchman/blob/master/ThreadPool.h">ThreadPool.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="apply clang-tidy modernize-use-override

Summary:
This is generated by applying clang-tidy -checks=modernize-use-override to all .cpp files under watchman.
It enforces the use of the keywords virtual, override and final in a way compliant to the style guide.

Reviewed By: igorsugak

Differential Revision: D5108868

fbshipit-source-id: bf13ba8b49b1c888f8fa120bfaba21f2f32c6e38" class="message" href="https://github.com/facebook/watchman/commit/b55f44721e9e53ef85b31fd480242572d706ce85">apply clang-tidy modernize-use-override</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-05-23T19:35:35Z">May 24, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="acinclude.m4" id="a5522b90382504dc530177f63ced5209-58937aa715a00d5a557c2a3d295f09baa4166337" href="https://github.com/facebook/watchman/blob/master/acinclude.m4">acinclude.m4</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="Add configure checks for C++11 compiler

Summary: as above

Reviewed By: sid0

fbshipit-source-id: c393307652e1d8f36d37e0f244dcc49c960bc320" class="message" href="https://github.com/facebook/watchman/commit/686f4a58e564b6a06c0b3862fdb44ab4535aaab6">Add configure checks for C++11 compiler</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-09-16T20:50:28Z">Sep 17, 2016</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="appveyor.yml" id="180360612c6b8c4ed830919bbb4dd459-5e76bfc29b753897464182f830fe966214e70f32" href="https://github.com/facebook/watchman/blob/master/appveyor.yml">appveyor.yml</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="add cmake build

Summary:
This is a reasonably functional cmake implementation
of the watchman build system.  Notably missing is support for
detecting pcre and linking it in; that can be done in a follow-up
diff.

This replaces the hand-rolled windows build bits completely,
but does not remove the autoconf bits.  I will likely remove
autoconf once we have parity.

The intent is that this is a stepping stone to adding a dependency
on folly.

When testing the windows build, I found that watchman was missing most of its
registered commands.

It appears as though the relatively tricky constructor attributes that we're
using (which were targeting the `C` compiler) no longer stick; the symbols are
not included in the build and the commands are missing.

The resolution is to use C++ constructor syntax for these instead.

I also tried this on Linux and Mac because it is appealing to
simplify everything, but various versions of gcc/clang on the OSS
CI failed to link in all the commands.

I've adjusted the configuration for the various CI systems so that
we run both autoconf and cmake based builds and tests.  In the longer
run I will remove the autoconf version of the build.

Reviewed By: simpkins

Differential Revision: D7363633

Pulled By: wez

fbshipit-source-id: ac00ae0cd7af5bc51cdcf72c0595c280a4a3f977" class="message" href="https://github.com/facebook/watchman/commit/e6350f9cf59cdce46cb25c2c78dddc11a0a0a1f6">add cmake build</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-29T18:58:14Z">Mar 30, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="autogen.sh" id="f88e95eed7716507cfe3a54a2c9dd382-a06ff30906004289a941deaaa668de5d26e7edc2" href="https://github.com/facebook/watchman/blob/master/autogen.sh">autogen.sh</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="Open source Watchman C++ client library

Summary:
Move the Watchman C++ client library out of HHVM and into the Watchman distribution proper and tidy up for open-sourcing.

The open-source build of Watchman should only include the client library by default only if Folly is available. Configure will hard fail if `--enable-cppclient` is used and folly is not present.

The open-source build of Watchman has now gained a hard dependency on libtool. This could kind of be softened but the dependency would still be present when running `autogen.sh` and this will probably spit out a bunch of whiney error messages with such a setup.

Reviewed By: wez

Differential Revision: D4292974

fbshipit-source-id: 589b5b25bb9487117e7a2b03d86c2e58b74d062f" class="message" href="https://github.com/facebook/watchman/commit/37822086f20f40e14d2c8777af489c23e00bff41">Open source Watchman C++ client library</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-02-01T20:33:37Z">Feb 2, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="bser.cpp" id="cb93b5b42da4cd42e557c9fd0af43d29-4c85872446dd61eb50a4531b9f9aaa88db231729" href="https://github.com/facebook/watchman/blob/master/bser.cpp">bser.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="add escaping for mixed strings

Summary:
This is based on dhruvsinghal's work:

https://github.com/facebook/watchman/commit/0577568c641b6dcceeca6d52f1f82133b99141cd

I added a whole bunch of tests to make sure nothing goes wrong.

Modulo bugs, I believe this is the final thing we need before we can expose this and start making our tests better.

Reviewed By: wez

Differential Revision: D4325642

fbshipit-source-id: d0186d2dbcc0778c1f802be62b24071a4a5e3c1d" class="message" href="https://github.com/facebook/watchman/commit/f8390953d22ea7a51d7d30cd13ed8cc25213c11d">add escaping for mixed strings</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-12-15T17:04:28Z">Dec 16, 2016</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="cfg.cpp" id="094418376145dc4e1919b7b76b6fafd7-97a35c43c404410cd4f5420f8f45aa4ca78aa6d3" href="https://github.com/facebook/watchman/blob/master/cfg.cpp">cfg.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="fix error message in the watch case too

Summary:
I noticed from some logs in production that D6935592 overlooked this
other place with similar error messaging.  Factor out the fiddly bit and make
the error messages more similar, and test them.

Reviewed By: simpkins

Differential Revision: D7060027

fbshipit-source-id: 491beccd92161618a3cdafedaaff70b58779a118" class="message" href="https://github.com/facebook/watchman/commit/a606ff703697835faa25399c5d2a26b23c12f94e">fix error message in the watch case too</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-02-23T23:37:56Z">Feb 24, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="checksock.cpp" id="636145a5647ad2582e41089de946ee3b-323f82c2f9da8bb905ff9b712bfb5be221476c23" href="https://github.com/facebook/watchman/blob/master/checksock.cpp">checksock.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="terminate process without running destructors on FATAL

Summary:
For better or worse... I've seen this trace in the wild,
and its been lingering for 4 days!  Strangely, the process is almost
fully functional, except for flushing subscriptions.

I suspect that we have an uncaught exception in the client thread because the
logs look like this; these indicate that the terminating thread was a client
thread.  We can see that it handled a query 2 seconds prior to the fault:

```
2018-03-17T04:52:48,510: [client=0x7f7f39d3e1d0:stm=0x7f7f39c75840:pid=1819024] PERF: {&quot;system_time&quot;: 0.081978999999999996, &quot;user_time&quot;: 0.0055560000000000002, &quot;elapsed_time&quot;: 1.2319009999999999, &quot;description&quot;: &quot;que
ry_execute&quot;, &quot;meta&quot;: {&quot;query_execute&quot;: {&quot;query&quot;: {&quot;expression&quot;: [&quot;allof&quot;, [&quot;not&quot;, [&quot;anyof&quot;, [&quot;dirname&quot;, &quot;.hg&quot;], [&quot;dirname&quot;, &quot;.git&quot;], [&quot;dirname&quot;, &quot;.svn&quot;]]]], &quot;since&quot;: {&quot;drop&quot;: [&quot;hg.update&quot;], &quot;scm&quot;: {&quot;mergebase-with&quot;:
 &quot;master&quot;}}, &quot;relative_root&quot;: &quot;&quot;, &quot;empty_on_fresh_instance&quot;: true, &quot;fields&quot;: [&quot;name&quot;]}, &quot;fresh_instance&quot;: false, &quot;num_deduped&quot;: 0, &quot;num_results&quot;: 1, &quot;num_walked&quot;: 11}, &quot;root&quot;: {&quot;watcher&quot;: &quot;inotify&quot;, &quot;path&quot;: &quot;/data/u
sers/akramer/www-hg&quot;, &quot;case_sensitive&quot;: true, &quot;recrawl_count&quot;: 0}}, &quot;start_time&quot;: 1521287567.278764, &quot;pid&quot;: 3700551, &quot;version&quot;: &quot;4.9.0&quot;}
2018-03-17T04:52:50,116: [client=0x7f7f39d3e1d0:stm=0x7f7f39c75840:pid=1819024] std::terminate was called
Fatal error detected at:
/usr/local/bin/watchman() [0x411507]
/usr/local/bin/watchman() [0x6c12f6]
/usr/local/bin/watchman() [0x443620]
/usr/local/bin/watchman() [0x6c2525]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8cd95) [0x7f7f3b8ded95]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(_ZSt9terminatev+0x10) [0x7f7f3b8dede0]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0xc7227) [0x7f7f3b919227]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libpthread.so.0(+0x77a8) [0x7f7f3b0157a8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libc.so.6(clone+0x6c) [0x7f7f3a931a7c]
```

There was not a lot of useful additional information available from the process
(I captured a core file and poked around).  Here's the trace of the stuck
thread.  None of the other threads are waiting on locks; all threads appear to
be waiting for requests and operating reasonably; other requests for the same
root will succeed and so on.

```
Thread 75 (Thread 0x7f7f1ab7e700 (LWP 1819033)):
```

I've expanded our termination handler to attempt to print out the current
exception.  This seems to be present for the obvious cases; the trace doesn't
provide a huge amount of context but at least we can divine the thread name
from the existing logging, and can also resolve to the thread function when
attaching to the gdb core file.

```
2018-03-22T09:52:05,164: [perflog] std::terminate was called. Exception: boop.
Fatal error detected at:
./buck-out/gen/watchman/watchman() [0x69ccd4]
./buck-out/gen/watchman/watchman() [0x69e7fc]
./buck-out/gen/watchman/watchman() [0x443ee0]
./buck-out/gen/watchman/watchman() [0x6a062d]
./buck-out/gen/watchman/watchman() [0x6a07f8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8cd95) [0x7fc441cabd95]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8b9d8) [0x7fc441caa9d8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(__gxx_personality_v0+0x387) [0x7fc441cab357]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libgcc_s.so.1(+0xff0c) [0x7fc4404cdf0c]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libgcc_s.so.1(_Unwind_RaiseException+0x1ac) [0x7fc4404ce44c]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(__cxa_throw+0x63) [0x7fc441cac053]
./buck-out/gen/watchman/watchman() [0x488dad]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0xc7170) [0x7fc441ce6170]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libpthread.so.0(+0x77a8) [0x7fc4413e27a8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libc.so.6(clone+0x6c) [0x7fc440cfea7c]
[1]    1237117 abort (core dumped)  ./buck-out/gen/watchman/watchman --foreground --logfile=/dev/stdout
```

I also cleaned up the handling of the `send_ok` variable.  It appeared to be
possible for this to get set but then nothing would ever terminate the main
loop.  That code was added back before much of the supporting bits had been
converted to C++.

I've changed the `exit()` call to `_exit()` to avoid calling `atexit`
handlers and destructors.  We used to `abort()` here, but there are a number of
cases where we don't want that to generate a core file so it was recently
changed to exit.   I've added an explicit `ABORT` error level to accomodate
this class of problem.

Reviewed By: simpkins

Differential Revision: D7354472

fbshipit-source-id: 846f93b568beb1e7b00dc91f02e71c40678c86b6" class="message" href="https://github.com/facebook/watchman/commit/4232c70fdc11ba642311633ea38a3d5dd5506dcf">terminate process without running destructors on FATAL</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-22T18:18:53Z">Mar 23, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="clientmode.cpp" id="a65274357a4a84d5470cc40e0a33af10-398e781841d8314e91c4eff4a36aa547d0f1fc98" href="https://github.com/facebook/watchman/blob/master/clientmode.cpp">clientmode.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="re-jigger log subscriptions

Summary:
while analyzing the TSAN output for the build, it became apparent that
we have some potential lock inversion code paths around how we inject data into
the client response streams.

This diff is the first part of resolving that issue.  There will be a follow-up
diff that changes the file change subscriber and state-enter plumbing to use
PubSub too.

Previously, if client had turned up debugging logging on their subscription, we
would discover this by locking the set of clients and walking them.  This opens
up to risk of lock inversion if we are running a command that locks the client
list and then takes some other action (or even just logs something).

To resolve this, this commit introduces a PubSub helper class.  The purpose of
this class is to record a stream of json objects to be consumed by some number
of subscribers.  If there are no subscribers, nothing needs to be recorded.

If there are subscribers, an immutable Item is logged to the stream and tagged
with a new serial number.

Each Subscriber remembers the last serial number that it has observed, allowing
the `getNext` method to return the next un-observed item on each subsequent
call.

Subscribers are registered along with a callback that is intended to &quot;wake up&quot;
the subscriber so that it can process the newly arrived items.

This diff cuts logging over to this new PubSub scheme.  The new Log class
maintains two separate Publishers; one for debug level events and another for
error level events.

It also establishes subscriber(s) for these dependent on the global log level
flag.  These subscribers have a &quot;notification&quot; callback that sorts and logs any
pending items to the stderr stream, optionally aborting the process if we saw a
FATAL level log.

Each connected watchman client also establishes subscribers for the debug and
error streams if the client issues a `log-level` command.  The notify callback
for these pings the client so that it can wake up and translate the log items
into its queue of responses to send to the peer.

There are a couple of important properties:

* wlocks are needed only to amend the subscriber list or to append a new item.
* rlocks are held when a subscriber consumes items from the stream.
* The critical sections are short, non-interleaved and non-recursive.

There are some bonus side effects:

* We can avoid formatting the bulk of the log string if there are no
  subscribers for a given level.

There's a bit of fan-out from these changes:

* We now track clients via shared_ptr so that we can safely manage
  the Subscriber -&gt; client flow that is required for the notify
  routine for the clients.  Without this we would hit a use-after-free
  each time that we tear down a client.
* To facilitate this, we need to use std::thread to spawn the client
  threads.  There's a slightly gross bit of code to capture
  pthread_self() at the start of the client thread to allow the
  pthread_kill(SIGUSR1) stuff to work.  I want to remove this
  at some point as it is not a portable way to wake up a thread.
* There's some circular log -&gt; json -&gt; string dependencies that mean
  that we can't use the logging functions in some lower level
  classes and helpers, so those had to be adjusted.

Reviewed By: farnz

Differential Revision: D4108737

fbshipit-source-id: e69bbfa13f42c28939855e7c19e84c0d4a5854e1" class="message" href="https://github.com/facebook/watchman/commit/43f3ff4c2cbca823ac0a2d15f9551b81872326b0">re-jigger log subscriptions</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-11-03T16:49:25Z">Nov 4, 2016</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="clockspec.cpp" id="6996ff72651f33836ef5094741a2ba3f-1678743c391eaa55ca4a57444044c27dfc2ce3fb" href="https://github.com/facebook/watchman/blob/master/clockspec.cpp">clockspec.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="fixup some gcc 7.1 issues

Summary:
We've had reports that gcc has a new warning about case
statements that fall through.  In addition, something has changed
in the implicit dependencies that require us to explicitly include
`&lt;functional&gt;`.

There are some attribute-y things we could do to annotate this
more deliberately, but I'm punting on that for the moment.

Refs: https://github.com/facebook/watchman/issues/467

Reviewed By: farnz

Differential Revision: D5087816

fbshipit-source-id: 45392a769c063966291ad4ab6b4347bbb2867802" class="message" href="https://github.com/facebook/watchman/commit/d17a4d6336b4d1dabf8f3f210eed24501d93d3f4">fixup some gcc 7.1 issues</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-05-18T18:56:12Z">May 19, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="configure.ac" id="67e997bcfdac55191033d57a16d1408a-78c8b5b46f332f465e307b997aefdd9bd96e06e6" href="https://github.com/facebook/watchman/blob/master/configure.ac">configure.ac</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="Fix autogen issue

Summary:
Refs: https://github.com/facebook/watchman/issues/579
Closes https://github.com/facebook/watchman/pull/580

Differential Revision: D7190473

Pulled By: wez

fbshipit-source-id: 183a934fe3f427e11de371956c6dc056b056703e" class="message" href="https://github.com/facebook/watchman/commit/f62e30d5248e760f8898d773d6c335f6f11be58f">Fix autogen issue</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-08T02:45:09Z">Mar 8, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="error_category.cpp" id="27c4fca34195df6c3702955b61bd43c0-0d7352e8c1ab89becb1adea76682358b32652841" href="https://github.com/facebook/watchman/blob/master/error_category.cpp">error_category.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="connect crawl errors to the watch failure reason

Summary:
This is a bit of a clean up in preparation for sharing
and knowing more about the reasons behind a failure of this
and cookie sync timeouts.

During crawling with inotify, if we hit the inotify system limits,
we have logic to set us in a poisoned state and fail new requests
until we are restarted.

An external user reported a problem where the `watch` project
command would appear to succeed when it hit the limits rather
than surface the error.

https://github.com/facebook/watchman/issues/525

The root of this problem is that we weren't populating the
`failure_reason` field to bubble up the error and that is the
core of this diff; with that set, the error is reported in
the result of the `watch` command.

While looking at this I noticed that we had a couple of stale
bits that needed cleanup:

- inotify.cpp had legacy code for setting the poison state itself,
  rather than letting the logic in warnerr.cpp handle it.
- the error_category stuff needed to be educated about the system
  limit errnos that the legacy code above was using
- the code in warnerr.cpp is now responsible for setting the
  `failure_reason` if it wasn't already set, and it now will take
  the poison reason if it is set (it's a global variable).
- When we encountered an error on the root of the watch we had
  a notion of whether the issue was transient or not.  I don't
  recall why that matters there, and all the errors that we can
  experience in practice are sufficient that we should bail
  out on watching that root, so I've removed the transient flag
  and revised the error messaging.

Reviewed By: simpkins

Differential Revision: D7063735

fbshipit-source-id: 1da4ad5f53b8fb9eb8daeb4c36ab953a1a75f0b5" class="message" href="https://github.com/facebook/watchman/commit/77bb9e9d0d638899b1b50ebd78e2872f2b3ad96c">connect crawl errors to the watch failure reason</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-02-23T23:37:57Z">Feb 24, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="expflags.cpp" id="5cf9937eb7b4ef9efc5b99add69ed402-f213b4ba68ace62e144b436df63025f34f3b2826" href="https://github.com/facebook/watchman/blob/master/expflags.cpp">expflags.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="remove MIN, MAX defines

Summary: We're using std::min, std::max

Reviewed By: farnz

Differential Revision: D4123733

fbshipit-source-id: 07b59e738808f61975b936a12f9699226a01a9f1" class="message" href="https://github.com/facebook/watchman/commit/fb88b403ed1506e48f59cd9105fcc6cf2ba88d69">remove MIN, MAX defines</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-11-04T15:04:23Z">Nov 4, 2016</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="fstype.cpp" id="18ecfc333187ca23d59787089dcdcf19-82196590ef7c088f8ee64126520f82105d111530" href="https://github.com/facebook/watchman/blob/master/fstype.cpp">fstype.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="merge Win32Handle into FileDescriptor

Summary:
I've kept Win32Handle.cpp and some of the functions it
holds for the moment; since I have a number of modifications in
a stack of changes that is pending review, I'm anticipating that
resolving merge conflicts across a rename will be a PITA, so I'm
deferring moving those around until after the stack is landed.

This is a pretty straight forward change with just a little bit
of fan-out to the heavier weight stream layer.

Reviewed By: simpkins

Differential Revision: D5124899

fbshipit-source-id: 14b9cd76ec67881c5d26edc5ee98f31e75c453d4" class="message" href="https://github.com/facebook/watchman/commit/39742c4378b80fa1200f81e34091668037f96d63">merge Win32Handle into FileDescriptor</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-06-02T15:21:43Z">Jun 2, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="hash.cpp" id="fff348bd7c37379f420f0905dd45138a-c005eb8c3928ab8f3c5814052274a183dbf26667" href="https://github.com/facebook/watchman/blob/master/hash.cpp">hash.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="fixup some gcc 7.1 issues

Summary:
We've had reports that gcc has a new warning about case
statements that fall through.  In addition, something has changed
in the implicit dependencies that require us to explicitly include
`&lt;functional&gt;`.

There are some attribute-y things we could do to annotate this
more deliberately, but I'm punting on that for the moment.

Refs: https://github.com/facebook/watchman/issues/467

Reviewed By: farnz

Differential Revision: D5087816

fbshipit-source-id: 45392a769c063966291ad4ab6b4347bbb2867802" class="message" href="https://github.com/facebook/watchman/commit/d17a4d6336b4d1dabf8f3f210eed24501d93d3f4">fixup some gcc 7.1 issues</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-05-18T18:56:12Z">May 19, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="ignore.cpp" id="3cc7bee642161a94147bdf8d9b00e78d-5af4666f9abb812ad4c2b5a50d10c47647dcde7e" href="https://github.com/facebook/watchman/blob/master/ignore.cpp">ignore.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="standardize on / dir separators on all platforms

Summary:
This removes the WATCHMAN_DIR_SEP constant and instead just forces us
to use / as a directory separator, even on Windows.

This is for our internal representation of paths only; when we translate our
internal multi-byte string to WCHAR we will replace the separators with the
typical windows backslash.

In the future, I want to clean up our suite of functions that operate on
paths and introduce a more strongly typed way of working with them.

For now, this seems sufficient to catch the edges.

Note that this causes watchman to always emit relative file lists with forward
slashes on Windows.  Previously those paths would use backslashes.  I believe
that this is benign because Windows doesn't really care, but may tickle
overzealously pedantic path libraries in some environments.  I don't know if
such a thing exists.

Adding mostafaeweda for Nuclide as the most likely client that might care about this

Reviewed By: farnz

Differential Revision: D4334456

fbshipit-source-id: c05ddf30a6808179cceb5869dccf739feaed8953" class="message" href="https://github.com/facebook/watchman/commit/f25723337b13ffacaaa12ce5e1bfe1d2a31db0c9">standardize on / dir separators on all platforms</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-12-15T22:18:21Z">Dec 16, 2016</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="ioprio.cpp" id="a600984ccc2a015d498812708009d988-68865174a734eb7a626c2971438e4db2bf7de4e5" href="https://github.com/facebook/watchman/blob/master/ioprio.cpp">ioprio.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="mostly rename .c -&gt; .cpp

Summary:
This is roughly speaking the minimal change required to get the
majority of the code building with a C++11 compiler.

It's still largely C code; a few type casts were needed to satisfy
the C++ compiler.

Reviewed By: sid0

fbshipit-source-id: dcbc61fdf8b455055db203c45633f723a8af4648" class="message" href="https://github.com/facebook/watchman/commit/bfb41aa61a9b9af752bcca315626df91e7e94700">mostly rename .c -&gt; .cpp</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-09-16T20:50:28Z">Sep 17, 2016</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="json.cpp" id="45e24f5c6f05002852129e4efec4b369-257ec795bfa99c1c0708ceed6b0e97d418135f31" href="https://github.com/facebook/watchman/blob/master/json.cpp">json.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="Replaced memset calls with appopriate C++11 init or assignment.

Summary: Replaced memset calls with appropriate C++ init or assignment to default-constructed struct.

Reviewed By: wez

Differential Revision: D6770919

fbshipit-source-id: 7d623da7935b54cf00c4775f56298845c528c9f1" class="message" href="https://github.com/facebook/watchman/commit/8ab92d2d307066f3aa44f13be0e4ac7c11c740ca">Replaced memset calls with appopriate C++11 init or assignment.</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-01-25T23:06:59Z">Jan 26, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="launchd.cpp" id="720c303af883ef97558e201132de786b-980571c3eb2ab7004910bcf8b5a0f071a1d277bf" href="https://github.com/facebook/watchman/blob/master/launchd.cpp">launchd.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="remove client shutdown hack

Summary:
Don't try to send a signal to a blocked client thread,
or the listener thread.

This was a hacky attempt at working around a blocking problem
during shutdown that we (can) now solve a different way.

This is part of it: knock the listener out of the accept loop
on shutdown.  The remaining part is not requiring that we
enable blocking mode when we write data from the serializer
layer.  I've seen a few stack traces where this signalling
approach clearly wasn't working anyway, so it's not terrible
to remove that portion without proposing a better fix in
the same diff.

Reviewed By: farnz

Differential Revision: D4203947

fbshipit-source-id: f33226f67251494e1d1acfbaf007df627aeaa7da" class="message" href="https://github.com/facebook/watchman/commit/3e310bd4a65f7939a830e5e1e927b32c8fe53ff9">remove client shutdown hack</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-11-30T03:03:56Z">Nov 30, 2016</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="listener-user.cpp" id="0d58bb82aa2a1b2437cc1f4ee7236176-c3a32a2baa01adde21fe6e3270a9407de39eb2db" href="https://github.com/facebook/watchman/blob/master/listener-user.cpp">listener-user.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="Fix problem where watch implicitly created.

Summary:
A user that runs the following commands will implicitly create a watch:
- state-enter
- state-leave
- subscribe
- trigger
- watch
This change will limit the watch creation to the watch command (explicit).
This will make behaviors more intuitive and prevent future issues.
We separate commands for the resolve_root and resolve_root_create - as a defensive measure.

Reviewed By: wez

Differential Revision: D5829679

fbshipit-source-id: 06995044b48fdadde02dece1624322a6e8b160bc" class="message" href="https://github.com/facebook/watchman/commit/e02729e5e1ad8373d00a601d1ccfd0e1ea2b6fa8">Fix problem where watch implicitly created.</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-09-15T18:35:06Z">Sep 16, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="listener.cpp" id="9e44190add744ef8ac5d5a11e71e6848-9ed587431de7c8103d7510ccb806e80b5b95d72e" href="https://github.com/facebook/watchman/blob/master/listener.cpp">listener.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="terminate process without running destructors on FATAL

Summary:
For better or worse... I've seen this trace in the wild,
and its been lingering for 4 days!  Strangely, the process is almost
fully functional, except for flushing subscriptions.

I suspect that we have an uncaught exception in the client thread because the
logs look like this; these indicate that the terminating thread was a client
thread.  We can see that it handled a query 2 seconds prior to the fault:

```
2018-03-17T04:52:48,510: [client=0x7f7f39d3e1d0:stm=0x7f7f39c75840:pid=1819024] PERF: {&quot;system_time&quot;: 0.081978999999999996, &quot;user_time&quot;: 0.0055560000000000002, &quot;elapsed_time&quot;: 1.2319009999999999, &quot;description&quot;: &quot;que
ry_execute&quot;, &quot;meta&quot;: {&quot;query_execute&quot;: {&quot;query&quot;: {&quot;expression&quot;: [&quot;allof&quot;, [&quot;not&quot;, [&quot;anyof&quot;, [&quot;dirname&quot;, &quot;.hg&quot;], [&quot;dirname&quot;, &quot;.git&quot;], [&quot;dirname&quot;, &quot;.svn&quot;]]]], &quot;since&quot;: {&quot;drop&quot;: [&quot;hg.update&quot;], &quot;scm&quot;: {&quot;mergebase-with&quot;:
 &quot;master&quot;}}, &quot;relative_root&quot;: &quot;&quot;, &quot;empty_on_fresh_instance&quot;: true, &quot;fields&quot;: [&quot;name&quot;]}, &quot;fresh_instance&quot;: false, &quot;num_deduped&quot;: 0, &quot;num_results&quot;: 1, &quot;num_walked&quot;: 11}, &quot;root&quot;: {&quot;watcher&quot;: &quot;inotify&quot;, &quot;path&quot;: &quot;/data/u
sers/akramer/www-hg&quot;, &quot;case_sensitive&quot;: true, &quot;recrawl_count&quot;: 0}}, &quot;start_time&quot;: 1521287567.278764, &quot;pid&quot;: 3700551, &quot;version&quot;: &quot;4.9.0&quot;}
2018-03-17T04:52:50,116: [client=0x7f7f39d3e1d0:stm=0x7f7f39c75840:pid=1819024] std::terminate was called
Fatal error detected at:
/usr/local/bin/watchman() [0x411507]
/usr/local/bin/watchman() [0x6c12f6]
/usr/local/bin/watchman() [0x443620]
/usr/local/bin/watchman() [0x6c2525]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8cd95) [0x7f7f3b8ded95]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(_ZSt9terminatev+0x10) [0x7f7f3b8dede0]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0xc7227) [0x7f7f3b919227]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libpthread.so.0(+0x77a8) [0x7f7f3b0157a8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libc.so.6(clone+0x6c) [0x7f7f3a931a7c]
```

There was not a lot of useful additional information available from the process
(I captured a core file and poked around).  Here's the trace of the stuck
thread.  None of the other threads are waiting on locks; all threads appear to
be waiting for requests and operating reasonably; other requests for the same
root will succeed and so on.

```
Thread 75 (Thread 0x7f7f1ab7e700 (LWP 1819033)):
```

I've expanded our termination handler to attempt to print out the current
exception.  This seems to be present for the obvious cases; the trace doesn't
provide a huge amount of context but at least we can divine the thread name
from the existing logging, and can also resolve to the thread function when
attaching to the gdb core file.

```
2018-03-22T09:52:05,164: [perflog] std::terminate was called. Exception: boop.
Fatal error detected at:
./buck-out/gen/watchman/watchman() [0x69ccd4]
./buck-out/gen/watchman/watchman() [0x69e7fc]
./buck-out/gen/watchman/watchman() [0x443ee0]
./buck-out/gen/watchman/watchman() [0x6a062d]
./buck-out/gen/watchman/watchman() [0x6a07f8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8cd95) [0x7fc441cabd95]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8b9d8) [0x7fc441caa9d8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(__gxx_personality_v0+0x387) [0x7fc441cab357]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libgcc_s.so.1(+0xff0c) [0x7fc4404cdf0c]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libgcc_s.so.1(_Unwind_RaiseException+0x1ac) [0x7fc4404ce44c]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(__cxa_throw+0x63) [0x7fc441cac053]
./buck-out/gen/watchman/watchman() [0x488dad]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0xc7170) [0x7fc441ce6170]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libpthread.so.0(+0x77a8) [0x7fc4413e27a8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libc.so.6(clone+0x6c) [0x7fc440cfea7c]
[1]    1237117 abort (core dumped)  ./buck-out/gen/watchman/watchman --foreground --logfile=/dev/stdout
```

I also cleaned up the handling of the `send_ok` variable.  It appeared to be
possible for this to get set but then nothing would ever terminate the main
loop.  That code was added back before much of the supporting bits had been
converted to C++.

I've changed the `exit()` call to `_exit()` to avoid calling `atexit`
handlers and destructors.  We used to `abort()` here, but there are a number of
cases where we don't want that to generate a core file so it was recently
changed to exit.   I've added an explicit `ABORT` error level to accomodate
this class of problem.

Reviewed By: simpkins

Differential Revision: D7354472

fbshipit-source-id: 846f93b568beb1e7b00dc91f02e71c40678c86b6" class="message" href="https://github.com/facebook/watchman/commit/4232c70fdc11ba642311633ea38a3d5dd5506dcf">terminate process without running destructors on FATAL</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-22T18:18:53Z">Mar 23, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="log.cpp" id="866f2d37eb32ff031951c2bae292a65e-dbb8571ad3eb3a8dab2663c3f3345b49b5b756e4" href="https://github.com/facebook/watchman/blob/master/log.cpp">log.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="terminate process without running destructors on FATAL

Summary:
For better or worse... I've seen this trace in the wild,
and its been lingering for 4 days!  Strangely, the process is almost
fully functional, except for flushing subscriptions.

I suspect that we have an uncaught exception in the client thread because the
logs look like this; these indicate that the terminating thread was a client
thread.  We can see that it handled a query 2 seconds prior to the fault:

```
2018-03-17T04:52:48,510: [client=0x7f7f39d3e1d0:stm=0x7f7f39c75840:pid=1819024] PERF: {&quot;system_time&quot;: 0.081978999999999996, &quot;user_time&quot;: 0.0055560000000000002, &quot;elapsed_time&quot;: 1.2319009999999999, &quot;description&quot;: &quot;que
ry_execute&quot;, &quot;meta&quot;: {&quot;query_execute&quot;: {&quot;query&quot;: {&quot;expression&quot;: [&quot;allof&quot;, [&quot;not&quot;, [&quot;anyof&quot;, [&quot;dirname&quot;, &quot;.hg&quot;], [&quot;dirname&quot;, &quot;.git&quot;], [&quot;dirname&quot;, &quot;.svn&quot;]]]], &quot;since&quot;: {&quot;drop&quot;: [&quot;hg.update&quot;], &quot;scm&quot;: {&quot;mergebase-with&quot;:
 &quot;master&quot;}}, &quot;relative_root&quot;: &quot;&quot;, &quot;empty_on_fresh_instance&quot;: true, &quot;fields&quot;: [&quot;name&quot;]}, &quot;fresh_instance&quot;: false, &quot;num_deduped&quot;: 0, &quot;num_results&quot;: 1, &quot;num_walked&quot;: 11}, &quot;root&quot;: {&quot;watcher&quot;: &quot;inotify&quot;, &quot;path&quot;: &quot;/data/u
sers/akramer/www-hg&quot;, &quot;case_sensitive&quot;: true, &quot;recrawl_count&quot;: 0}}, &quot;start_time&quot;: 1521287567.278764, &quot;pid&quot;: 3700551, &quot;version&quot;: &quot;4.9.0&quot;}
2018-03-17T04:52:50,116: [client=0x7f7f39d3e1d0:stm=0x7f7f39c75840:pid=1819024] std::terminate was called
Fatal error detected at:
/usr/local/bin/watchman() [0x411507]
/usr/local/bin/watchman() [0x6c12f6]
/usr/local/bin/watchman() [0x443620]
/usr/local/bin/watchman() [0x6c2525]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8cd95) [0x7f7f3b8ded95]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(_ZSt9terminatev+0x10) [0x7f7f3b8dede0]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0xc7227) [0x7f7f3b919227]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libpthread.so.0(+0x77a8) [0x7f7f3b0157a8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libc.so.6(clone+0x6c) [0x7f7f3a931a7c]
```

There was not a lot of useful additional information available from the process
(I captured a core file and poked around).  Here's the trace of the stuck
thread.  None of the other threads are waiting on locks; all threads appear to
be waiting for requests and operating reasonably; other requests for the same
root will succeed and so on.

```
Thread 75 (Thread 0x7f7f1ab7e700 (LWP 1819033)):
```

I've expanded our termination handler to attempt to print out the current
exception.  This seems to be present for the obvious cases; the trace doesn't
provide a huge amount of context but at least we can divine the thread name
from the existing logging, and can also resolve to the thread function when
attaching to the gdb core file.

```
2018-03-22T09:52:05,164: [perflog] std::terminate was called. Exception: boop.
Fatal error detected at:
./buck-out/gen/watchman/watchman() [0x69ccd4]
./buck-out/gen/watchman/watchman() [0x69e7fc]
./buck-out/gen/watchman/watchman() [0x443ee0]
./buck-out/gen/watchman/watchman() [0x6a062d]
./buck-out/gen/watchman/watchman() [0x6a07f8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8cd95) [0x7fc441cabd95]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8b9d8) [0x7fc441caa9d8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(__gxx_personality_v0+0x387) [0x7fc441cab357]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libgcc_s.so.1(+0xff0c) [0x7fc4404cdf0c]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libgcc_s.so.1(_Unwind_RaiseException+0x1ac) [0x7fc4404ce44c]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(__cxa_throw+0x63) [0x7fc441cac053]
./buck-out/gen/watchman/watchman() [0x488dad]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0xc7170) [0x7fc441ce6170]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libpthread.so.0(+0x77a8) [0x7fc4413e27a8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libc.so.6(clone+0x6c) [0x7fc440cfea7c]
[1]    1237117 abort (core dumped)  ./buck-out/gen/watchman/watchman --foreground --logfile=/dev/stdout
```

I also cleaned up the handling of the `send_ok` variable.  It appeared to be
possible for this to get set but then nothing would ever terminate the main
loop.  That code was added back before much of the supporting bits had been
converted to C++.

I've changed the `exit()` call to `_exit()` to avoid calling `atexit`
handlers and destructors.  We used to `abort()` here, but there are a number of
cases where we don't want that to generate a core file so it was recently
changed to exit.   I've added an explicit `ABORT` error level to accomodate
this class of problem.

Reviewed By: simpkins

Differential Revision: D7354472

fbshipit-source-id: 846f93b568beb1e7b00dc91f02e71c40678c86b6" class="message" href="https://github.com/facebook/watchman/commit/4232c70fdc11ba642311633ea38a3d5dd5506dcf">terminate process without running destructors on FATAL</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-22T18:18:53Z">Mar 23, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="main.cpp" id="118fcbaaba162ba17933c7893247df3a-a8423b583f0673b44e59e3415ecf48f80f9dcae8" href="https://github.com/facebook/watchman/blob/master/main.cpp">main.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="improve error reporting if site spawner fails

Summary:
The stock behavior of watchman is to `daemonize` the server process if
needed, but some sites have more elaborate requirements; the site spawner
configuration allows the local administrator to deploy a policy for customizing
how watchman is launched.  We use this at FB to managed watchman instances for
users across our dev fleet via chef and systemd.

There were a couple of issues with how we surfaced errors:

1. In one possible spawn error case we were logging an error
   at `ERR` level instead of `FATAL`.  This meant that we'd
   return to the caller (the watchman CLI) without any hope
   of the server starting up and there is no fallback to
   daemonize when configured this way, so the CLI would sit
   and wait until its timeout was hit.

2. We'd attempt to log the site spawn failures to the log
   file rather than the current process stdio streams.  This
   made it rather difficult to diagnose problems with the
   site spawner.

This diff fixes up the missing `FATAL` and removes the stdio redirection so
that we report spawn errors more directly to the user.

Reviewed By: simpkins

Differential Revision: D7076476

fbshipit-source-id: 3f001e56fabea4c5c630d6110e19a671c9efbfb1" class="message" href="https://github.com/facebook/watchman/commit/3c7833c3b21a1d7279c06aff9153c9e71ed5da17">improve error reporting if site spawner fails</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-02-24T08:09:18Z">Feb 24, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="make.bat" id="235ef2d110efdb7789c7996bbed8ee78-38dc6314e818f2bdc3e1dafb7e05038bad873701" href="https://github.com/facebook/watchman/blob/master/make.bat">make.bat</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="add cmake build

Summary:
This is a reasonably functional cmake implementation
of the watchman build system.  Notably missing is support for
detecting pcre and linking it in; that can be done in a follow-up
diff.

This replaces the hand-rolled windows build bits completely,
but does not remove the autoconf bits.  I will likely remove
autoconf once we have parity.

The intent is that this is a stepping stone to adding a dependency
on folly.

When testing the windows build, I found that watchman was missing most of its
registered commands.

It appears as though the relatively tricky constructor attributes that we're
using (which were targeting the `C` compiler) no longer stick; the symbols are
not included in the build and the commands are missing.

The resolution is to use C++ constructor syntax for these instead.

I also tried this on Linux and Mac because it is appealing to
simplify everything, but various versions of gcc/clang on the OSS
CI failed to link in all the commands.

I've adjusted the configuration for the various CI systems so that
we run both autoconf and cmake based builds and tests.  In the longer
run I will remove the autoconf version of the build.

Reviewed By: simpkins

Differential Revision: D7363633

Pulled By: wez

fbshipit-source-id: ac00ae0cd7af5bc51cdcf72c0595c280a4a3f977" class="message" href="https://github.com/facebook/watchman/commit/e6350f9cf59cdce46cb25c2c78dddc11a0a0a1f6">add cmake build</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-29T18:58:14Z">Mar 30, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="make_unique.h" id="8db92170878f3d8712c8765914c4ac7c-58cee2e0688f369746a4da694a3ffe4a781b931b" href="https://github.com/facebook/watchman/blob/master/make_unique.h">make_unique.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="art: cut over to unique_ptr for nodes

Summary:
The storage is now all tracked via unique_ptr.

There's a little bit of fan out to the API; the `erase` method transfers
ownership to the caller via the return value.

Reviewed By: farnz

Differential Revision: D4076785

fbshipit-source-id: ddc372e413cd6d5f9bff4704b5cf8d111f35ddb9" class="message" href="https://github.com/facebook/watchman/commit/9036a273911ccb35ac8b7db6ed512140ef5476fc">art: cut over to unique_ptr for nodes</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-11-01T00:34:58Z">Nov 1, 2016</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="opendir.cpp" id="f7a388297f6cb134b6b815a52d5f0327-55299afe768673b788baf4b6b2d93b995d32d77b" href="https://github.com/facebook/watchman/blob/master/opendir.cpp">opendir.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="improve reporting around getattrlistbulk

Summary:
Welp, I should have done this in the earlier commit
because I was looking into a slow test and saw that the logging
output didn't have the right newlines and then I saw that we
were hitting the fallback path quite a lot.

This diff improves reporting in the case that not all of the
attributes are returned by printing the set that we got (using
a function borrowed from eden and slightly modified), and
makes the error path conditional on errno != 0.

I smell something fishy though; I was previously under the
assumption that we were in the wrong for acting based on
what appeared to be stack garbage in the error field, but
since that is confirmed to always be present, I don't think
my earlier diff really fixed anything aside from adding a
bit more logging and improving the chances that we would
fall back to something that basically worked.

Reviewed By: chadaustin

Differential Revision: D7008177

fbshipit-source-id: 00672f920c8dfa84c119bf3df23d1e6a557dc727" class="message" href="https://github.com/facebook/watchman/commit/00324b22d181bbd684f5527349d37749fa31076e">improve reporting around getattrlistbulk</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-02-20T17:44:47Z">Feb 21, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="opt.cpp" id="b402fc325e495b4aab147020ee4d12bd-986d4a8036110fdfdf6a6e4c64de49e665a1ab53" href="https://github.com/facebook/watchman/blob/master/opt.cpp">opt.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="avoid `abort` in a number of code paths

Summary:
We see this manifest most often in production in environments
that are nonsensical; for example, spawned by a client process whose
executable image has been deleted and who is running with a cwd that
has been deleted.

We'll abort when run in such an environment because we're not able
to spawn watchman because the site spawner script that has been
configured is a python script that fails to resolve the cwd and
exits.

These aborts are captured and reported across our production fleet
and make us look bad in the coredumper data set.

Rather than abort let's just `exit(1)`.

This diff replaces a number of `abort()` calls with `log(FATAL,...`)
and removes a hangover from our C/malloc days where we were left
checking the result of `new` against `nullptr`; this should always
throw `bad_alloc` and thus the conditional should now just be
deadcode.

Reviewed By: simpkins

Differential Revision: D7060727

fbshipit-source-id: 57483cae023631de899e3c0c04795abf259f6f85" class="message" href="https://github.com/facebook/watchman/commit/e0b9f4e6a0186806382f110e3ee3ae74081775de">avoid `abort` in a number of code paths</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-02-23T23:37:57Z">Feb 24, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="pending.cpp" id="bd5331a8c1738aa08b76d74b6942f835-aa56bf916ac63099e7a9c482545e2f9b0f696588" href="https://github.com/facebook/watchman/blob/master/pending.cpp">pending.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="refactor w_dir_path_cat_str -&gt; getFullPathToChild

Summary:
This removes the horrible C style name and clarifies
the comments.

Reviewed By: chadaustin

Differential Revision: D7209333

fbshipit-source-id: 9077f9422bb3ede7b4a4c80e8d05c58f2af66973" class="message" href="https://github.com/facebook/watchman/commit/085866203c94f1d1b38eefa6f047b2eb16dbcb0d">refactor w_dir_path_cat_str -&gt; getFullPathToChild</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-12T21:08:21Z">Mar 13, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="perf.cpp" id="a383692c4f764bd092c99d3e450b27d2-f359b89a697aa3bba7a167f5ce6895759d891989" href="https://github.com/facebook/watchman/blob/master/perf.cpp">perf.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="terminate process without running destructors on FATAL

Summary:
For better or worse... I've seen this trace in the wild,
and its been lingering for 4 days!  Strangely, the process is almost
fully functional, except for flushing subscriptions.

I suspect that we have an uncaught exception in the client thread because the
logs look like this; these indicate that the terminating thread was a client
thread.  We can see that it handled a query 2 seconds prior to the fault:

```
2018-03-17T04:52:48,510: [client=0x7f7f39d3e1d0:stm=0x7f7f39c75840:pid=1819024] PERF: {&quot;system_time&quot;: 0.081978999999999996, &quot;user_time&quot;: 0.0055560000000000002, &quot;elapsed_time&quot;: 1.2319009999999999, &quot;description&quot;: &quot;que
ry_execute&quot;, &quot;meta&quot;: {&quot;query_execute&quot;: {&quot;query&quot;: {&quot;expression&quot;: [&quot;allof&quot;, [&quot;not&quot;, [&quot;anyof&quot;, [&quot;dirname&quot;, &quot;.hg&quot;], [&quot;dirname&quot;, &quot;.git&quot;], [&quot;dirname&quot;, &quot;.svn&quot;]]]], &quot;since&quot;: {&quot;drop&quot;: [&quot;hg.update&quot;], &quot;scm&quot;: {&quot;mergebase-with&quot;:
 &quot;master&quot;}}, &quot;relative_root&quot;: &quot;&quot;, &quot;empty_on_fresh_instance&quot;: true, &quot;fields&quot;: [&quot;name&quot;]}, &quot;fresh_instance&quot;: false, &quot;num_deduped&quot;: 0, &quot;num_results&quot;: 1, &quot;num_walked&quot;: 11}, &quot;root&quot;: {&quot;watcher&quot;: &quot;inotify&quot;, &quot;path&quot;: &quot;/data/u
sers/akramer/www-hg&quot;, &quot;case_sensitive&quot;: true, &quot;recrawl_count&quot;: 0}}, &quot;start_time&quot;: 1521287567.278764, &quot;pid&quot;: 3700551, &quot;version&quot;: &quot;4.9.0&quot;}
2018-03-17T04:52:50,116: [client=0x7f7f39d3e1d0:stm=0x7f7f39c75840:pid=1819024] std::terminate was called
Fatal error detected at:
/usr/local/bin/watchman() [0x411507]
/usr/local/bin/watchman() [0x6c12f6]
/usr/local/bin/watchman() [0x443620]
/usr/local/bin/watchman() [0x6c2525]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8cd95) [0x7f7f3b8ded95]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(_ZSt9terminatev+0x10) [0x7f7f3b8dede0]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0xc7227) [0x7f7f3b919227]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libpthread.so.0(+0x77a8) [0x7f7f3b0157a8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libc.so.6(clone+0x6c) [0x7f7f3a931a7c]
```

There was not a lot of useful additional information available from the process
(I captured a core file and poked around).  Here's the trace of the stuck
thread.  None of the other threads are waiting on locks; all threads appear to
be waiting for requests and operating reasonably; other requests for the same
root will succeed and so on.

```
Thread 75 (Thread 0x7f7f1ab7e700 (LWP 1819033)):
```

I've expanded our termination handler to attempt to print out the current
exception.  This seems to be present for the obvious cases; the trace doesn't
provide a huge amount of context but at least we can divine the thread name
from the existing logging, and can also resolve to the thread function when
attaching to the gdb core file.

```
2018-03-22T09:52:05,164: [perflog] std::terminate was called. Exception: boop.
Fatal error detected at:
./buck-out/gen/watchman/watchman() [0x69ccd4]
./buck-out/gen/watchman/watchman() [0x69e7fc]
./buck-out/gen/watchman/watchman() [0x443ee0]
./buck-out/gen/watchman/watchman() [0x6a062d]
./buck-out/gen/watchman/watchman() [0x6a07f8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8cd95) [0x7fc441cabd95]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8b9d8) [0x7fc441caa9d8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(__gxx_personality_v0+0x387) [0x7fc441cab357]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libgcc_s.so.1(+0xff0c) [0x7fc4404cdf0c]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libgcc_s.so.1(_Unwind_RaiseException+0x1ac) [0x7fc4404ce44c]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(__cxa_throw+0x63) [0x7fc441cac053]
./buck-out/gen/watchman/watchman() [0x488dad]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0xc7170) [0x7fc441ce6170]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libpthread.so.0(+0x77a8) [0x7fc4413e27a8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libc.so.6(clone+0x6c) [0x7fc440cfea7c]
[1]    1237117 abort (core dumped)  ./buck-out/gen/watchman/watchman --foreground --logfile=/dev/stdout
```

I also cleaned up the handling of the `send_ok` variable.  It appeared to be
possible for this to get set but then nothing would ever terminate the main
loop.  That code was added back before much of the supporting bits had been
converted to C++.

I've changed the `exit()` call to `_exit()` to avoid calling `atexit`
handlers and destructors.  We used to `abort()` here, but there are a number of
cases where we don't want that to generate a core file so it was recently
changed to exit.   I've added an explicit `ABORT` error level to accomodate
this class of problem.

Reviewed By: simpkins

Differential Revision: D7354472

fbshipit-source-id: 846f93b568beb1e7b00dc91f02e71c40678c86b6" class="message" href="https://github.com/facebook/watchman/commit/4232c70fdc11ba642311633ea38a3d5dd5506dcf">terminate process without running destructors on FATAL</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-22T18:18:53Z">Mar 23, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="runtests.py" id="fdaa2edbb1e3772fb7c998d5324dee25-f6e83157bda2ff3d338bcbee372c705e26640db5" href="https://github.com/facebook/watchman/blob/master/runtests.py">runtests.py</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="add cmake build

Summary:
This is a reasonably functional cmake implementation
of the watchman build system.  Notably missing is support for
detecting pcre and linking it in; that can be done in a follow-up
diff.

This replaces the hand-rolled windows build bits completely,
but does not remove the autoconf bits.  I will likely remove
autoconf once we have parity.

The intent is that this is a stepping stone to adding a dependency
on folly.

When testing the windows build, I found that watchman was missing most of its
registered commands.

It appears as though the relatively tricky constructor attributes that we're
using (which were targeting the `C` compiler) no longer stick; the symbols are
not included in the build and the commands are missing.

The resolution is to use C++ constructor syntax for these instead.

I also tried this on Linux and Mac because it is appealing to
simplify everything, but various versions of gcc/clang on the OSS
CI failed to link in all the commands.

I've adjusted the configuration for the various CI systems so that
we run both autoconf and cmake based builds and tests.  In the longer
run I will remove the autoconf version of the build.

Reviewed By: simpkins

Differential Revision: D7363633

Pulled By: wez

fbshipit-source-id: ac00ae0cd7af5bc51cdcf72c0595c280a4a3f977" class="message" href="https://github.com/facebook/watchman/commit/e6350f9cf59cdce46cb25c2c78dddc11a0a0a1f6">add cmake build</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-29T18:58:14Z">Mar 30, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="spawn.cpp" id="844cf5ab9e7e6b7d2930baa1e43959c0-909f380dd8d3bbb360f527e121916d8cbb3b8fa7" href="https://github.com/facebook/watchman/blob/master/spawn.cpp">spawn.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="fix debug level for json input

Summary: Reported in https://github.com/facebook/watchman/issues/590

Reviewed By: simpkins

Differential Revision: D7403964

fbshipit-source-id: 849420ba1d3e58cec15dc371d60f4ad5a3c9b995" class="message" href="https://github.com/facebook/watchman/commit/06044416c96791460b4dabed6446565b0d02e569">fix debug level for json input</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-26T22:58:24Z">Mar 27, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="state.cpp" id="6bfe8e519061b88d03128cd611f7acc0-8c0b1cec8e8c2276519b81304887c2c705941b75" href="https://github.com/facebook/watchman/blob/master/state.cpp">state.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="terminate process without running destructors on FATAL

Summary:
For better or worse... I've seen this trace in the wild,
and its been lingering for 4 days!  Strangely, the process is almost
fully functional, except for flushing subscriptions.

I suspect that we have an uncaught exception in the client thread because the
logs look like this; these indicate that the terminating thread was a client
thread.  We can see that it handled a query 2 seconds prior to the fault:

```
2018-03-17T04:52:48,510: [client=0x7f7f39d3e1d0:stm=0x7f7f39c75840:pid=1819024] PERF: {&quot;system_time&quot;: 0.081978999999999996, &quot;user_time&quot;: 0.0055560000000000002, &quot;elapsed_time&quot;: 1.2319009999999999, &quot;description&quot;: &quot;que
ry_execute&quot;, &quot;meta&quot;: {&quot;query_execute&quot;: {&quot;query&quot;: {&quot;expression&quot;: [&quot;allof&quot;, [&quot;not&quot;, [&quot;anyof&quot;, [&quot;dirname&quot;, &quot;.hg&quot;], [&quot;dirname&quot;, &quot;.git&quot;], [&quot;dirname&quot;, &quot;.svn&quot;]]]], &quot;since&quot;: {&quot;drop&quot;: [&quot;hg.update&quot;], &quot;scm&quot;: {&quot;mergebase-with&quot;:
 &quot;master&quot;}}, &quot;relative_root&quot;: &quot;&quot;, &quot;empty_on_fresh_instance&quot;: true, &quot;fields&quot;: [&quot;name&quot;]}, &quot;fresh_instance&quot;: false, &quot;num_deduped&quot;: 0, &quot;num_results&quot;: 1, &quot;num_walked&quot;: 11}, &quot;root&quot;: {&quot;watcher&quot;: &quot;inotify&quot;, &quot;path&quot;: &quot;/data/u
sers/akramer/www-hg&quot;, &quot;case_sensitive&quot;: true, &quot;recrawl_count&quot;: 0}}, &quot;start_time&quot;: 1521287567.278764, &quot;pid&quot;: 3700551, &quot;version&quot;: &quot;4.9.0&quot;}
2018-03-17T04:52:50,116: [client=0x7f7f39d3e1d0:stm=0x7f7f39c75840:pid=1819024] std::terminate was called
Fatal error detected at:
/usr/local/bin/watchman() [0x411507]
/usr/local/bin/watchman() [0x6c12f6]
/usr/local/bin/watchman() [0x443620]
/usr/local/bin/watchman() [0x6c2525]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8cd95) [0x7f7f3b8ded95]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(_ZSt9terminatev+0x10) [0x7f7f3b8dede0]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0xc7227) [0x7f7f3b919227]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libpthread.so.0(+0x77a8) [0x7f7f3b0157a8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libc.so.6(clone+0x6c) [0x7f7f3a931a7c]
```

There was not a lot of useful additional information available from the process
(I captured a core file and poked around).  Here's the trace of the stuck
thread.  None of the other threads are waiting on locks; all threads appear to
be waiting for requests and operating reasonably; other requests for the same
root will succeed and so on.

```
Thread 75 (Thread 0x7f7f1ab7e700 (LWP 1819033)):
```

I've expanded our termination handler to attempt to print out the current
exception.  This seems to be present for the obvious cases; the trace doesn't
provide a huge amount of context but at least we can divine the thread name
from the existing logging, and can also resolve to the thread function when
attaching to the gdb core file.

```
2018-03-22T09:52:05,164: [perflog] std::terminate was called. Exception: boop.
Fatal error detected at:
./buck-out/gen/watchman/watchman() [0x69ccd4]
./buck-out/gen/watchman/watchman() [0x69e7fc]
./buck-out/gen/watchman/watchman() [0x443ee0]
./buck-out/gen/watchman/watchman() [0x6a062d]
./buck-out/gen/watchman/watchman() [0x6a07f8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8cd95) [0x7fc441cabd95]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8b9d8) [0x7fc441caa9d8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(__gxx_personality_v0+0x387) [0x7fc441cab357]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libgcc_s.so.1(+0xff0c) [0x7fc4404cdf0c]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libgcc_s.so.1(_Unwind_RaiseException+0x1ac) [0x7fc4404ce44c]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(__cxa_throw+0x63) [0x7fc441cac053]
./buck-out/gen/watchman/watchman() [0x488dad]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0xc7170) [0x7fc441ce6170]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libpthread.so.0(+0x77a8) [0x7fc4413e27a8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libc.so.6(clone+0x6c) [0x7fc440cfea7c]
[1]    1237117 abort (core dumped)  ./buck-out/gen/watchman/watchman --foreground --logfile=/dev/stdout
```

I also cleaned up the handling of the `send_ok` variable.  It appeared to be
possible for this to get set but then nothing would ever terminate the main
loop.  That code was added back before much of the supporting bits had been
converted to C++.

I've changed the `exit()` call to `_exit()` to avoid calling `atexit`
handlers and destructors.  We used to `abort()` here, but there are a number of
cases where we don't want that to generate a core file so it was recently
changed to exit.   I've added an explicit `ABORT` error level to accomodate
this class of problem.

Reviewed By: simpkins

Differential Revision: D7354472

fbshipit-source-id: 846f93b568beb1e7b00dc91f02e71c40678c86b6" class="message" href="https://github.com/facebook/watchman/commit/4232c70fdc11ba642311633ea38a3d5dd5506dcf">terminate process without running destructors on FATAL</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-22T18:18:53Z">Mar 23, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="stream.cpp" id="94c566661dfe45c9c130b053c0c99739-ec27a206734e2dfc66b505118f9cd99c3a3b9e6d" href="https://github.com/facebook/watchman/blob/master/stream.cpp">stream.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="remove w_stm_xxx accessor functions

Summary: Just call the methods on the stream instead.

Reviewed By: farnz

Differential Revision: D4183238

fbshipit-source-id: abf92e844ba8edb98c5c696b1bfb7a9ba0af321e" class="message" href="https://github.com/facebook/watchman/commit/23cc5072a7f74a65258143b53d8e537d6c028c22">remove w_stm_xxx accessor functions</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-11-29T23:19:21Z">Nov 30, 2016</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="stream_stdout.cpp" id="ed95ab64094968193ec9804d2ef19b93-cfb367a729bbb60d59446a33cd5828d38c10642e" href="https://github.com/facebook/watchman/blob/master/stream_stdout.cpp">stream_stdout.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="merge Win32Handle into FileDescriptor

Summary:
I've kept Win32Handle.cpp and some of the functions it
holds for the moment; since I have a number of modifications in
a stack of changes that is pending review, I'm anticipating that
resolving merge conflicts across a rename will be a PITA, so I'm
deferring moving those around until after the stack is landed.

This is a pretty straight forward change with just a little bit
of fan-out to the heavier weight stream layer.

Reviewed By: simpkins

Differential Revision: D5124899

fbshipit-source-id: 14b9cd76ec67881c5d26edc5ee98f31e75c453d4" class="message" href="https://github.com/facebook/watchman/commit/39742c4378b80fa1200f81e34091668037f96d63">merge Win32Handle into FileDescriptor</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-06-02T15:21:43Z">Jun 2, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="stream_unix.cpp" id="bf40a1a8135a86d351ee8dc7ed9ff509-db5af1c30c29195174aa27a9e10b460c5d3f37e9" href="https://github.com/facebook/watchman/blob/master/stream_unix.cpp">stream_unix.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="Re-worked replacement of memset with proper init to make it gcc 4.8 compliant.

Summary: Closes https://github.com/facebook/watchman/pull/565

Reviewed By: wez

Differential Revision: D6827004

Pulled By: zhupanov

fbshipit-source-id: 9515eebd7aa48528a10245030e46b6cb37a6d7c2" class="message" href="https://github.com/facebook/watchman/commit/a202311e948868ea2c81377a4a6889d8c97e8105">Re-worked replacement of memset with proper init to make it gcc 4.8 c…</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-01-27T03:52:49Z">Jan 27, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="stream_win.cpp" id="0c6673047a8ee731af6ce12c713c99be-19de8772aac72c24ee8bb4e7cfca97f771bf188a" href="https://github.com/facebook/watchman/blob/master/stream_win.cpp">stream_win.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="Re-worked replacement of memset with proper init to make it gcc 4.8 compliant.

Summary: Closes https://github.com/facebook/watchman/pull/565

Reviewed By: wez

Differential Revision: D6827004

Pulled By: zhupanov

fbshipit-source-id: 9515eebd7aa48528a10245030e46b6cb37a6d7c2" class="message" href="https://github.com/facebook/watchman/commit/a202311e948868ea2c81377a4a6889d8c97e8105">Re-worked replacement of memset with proper init to make it gcc 4.8 c…</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-01-27T03:52:49Z">Jan 27, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="string.cpp" id="ad1c56dc03ef5bf057c2966b80aa53c4-75ff80a58e06be64e7b60220d81d7aa1e04450bb" href="https://github.com/facebook/watchman/blob/master/string.cpp">string.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="remove more dead code

Summary: these functions are no longer called

Reviewed By: chadaustin

Differential Revision: D7209335

fbshipit-source-id: f4d159289b31c5b02bfcf7b8b84dd7e0426cca6b" class="message" href="https://github.com/facebook/watchman/commit/d636dfeb4cf641c95c908a705dac463d29707b4e">remove more dead code</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-12T21:08:21Z">Mar 13, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="time.cpp" id="54dd4bc3be369471d2ac1007e670e0db-d69462b74f11cd7f2429c6d07a14c49ae2772d89" href="https://github.com/facebook/watchman/blob/master/time.cpp">time.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="mostly rename .c -&gt; .cpp

Summary:
This is roughly speaking the minimal change required to get the
majority of the code building with a C++11 compiler.

It's still largely C code; a few type casts were needed to satisfy
the C++ compiler.

Reviewed By: sid0

fbshipit-source-id: dcbc61fdf8b455055db203c45633f723a8af4648" class="message" href="https://github.com/facebook/watchman/commit/bfb41aa61a9b9af752bcca315626df91e7e94700">mostly rename .c -&gt; .cpp</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-09-16T20:50:28Z">Sep 17, 2016</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="timedlock.cpp" id="5215376aea37bf7f1ed3786b54fe51fe-25ff4436936de0cef47b25688a7fe5e2d2b942cc" href="https://github.com/facebook/watchman/blob/master/timedlock.cpp">timedlock.cpp</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="remove MIN, MAX defines

Summary: We're using std::min, std::max

Reviewed By: farnz

Differential Revision: D4123733

fbshipit-source-id: 07b59e738808f61975b936a12f9699226a01a9f1" class="message" href="https://github.com/facebook/watchman/commit/fb88b403ed1506e48f59cd9105fcc6cf2ba88d69">remove MIN, MAX defines</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-11-04T15:04:23Z">Nov 4, 2016</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman.h" id="a56fa094c7dcf1ee9602b2ce328d133e-7970d6927f65e74e781b033902d6dc90d43909db" href="https://github.com/facebook/watchman/blob/master/watchman.h">watchman.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="make sanity check thread persistent

Summary:
When the sanity checking stuff was first added it
was called every minute to validate that the unix domain
socket still resolved to ourselves.  It was added as a detached
thread that was short lived and that terminated as soon as
the check was complete.

In D6804026 the scope of the checks was expanded and it is now
possible for systems under severe IO load to take longer than
1 minute to complete the sanity checks.  When that happens
we can end up stacking up instances of the sanity checking
thread and magnifying the number of clients that are blocked
waiting for progress.

To avoid that, this diff makes the sanity checking thread a
long lived thread that is responsible for timing and dispatching
the checks.   That means that we will never have multiple competing
sanity checking threads and a maximum of 1 outstanding sanity
checking session at a time.

Reviewed By: chadaustin

Differential Revision: D7220354

fbshipit-source-id: 83420c7ddeb9188518d046948b0dac645da6f156" class="message" href="https://github.com/facebook/watchman/commit/cd9adaf72fb2f0f2086ef6a0962d37d7af8ffcee">make sanity check thread persistent</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-12T21:48:14Z">Mar 13, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_client.h" id="7b7729eba9318534599cc394586dd3d3-30665de2eb09656e2384c5aad8cead2ce67e7f2b" href="https://github.com/facebook/watchman/blob/master/watchman_client.h">watchman_client.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="state-(enter|leave) are now non-blocking

Summary:
We're seeing some slowdowns in hg update operations; the blockage
appears to be waiting on state-enter and state-leave commands issue by the
fsmonitor extension.

This diff builds on the prior diff and makes use of the more generalized cookie
sync mechanism to arrange for the state assertion action to take place once the
cookie has been observed by the IO thread.

Note that this breaks state-enter/state-leave for the eden watcher, which
currently does not process cookies, however, the fsmonitor extension is not
even enabled for eden, so this is sort of a moot point; we'll need to resolve
that in a different way.

This diff complicates things a little; previously, we would not update the
client-&gt;states map until after synchronization had occurred.  This made it very
simple to understand who had made a state assertion and allowed for some strong
sanity checks.

With this diff, the visibility of the assertion is deferred until the cookie is
processed; a client may therefore be pending an enter or leave.  In the case
where mercurial is processing a series of updates (as part of a rebase), it is
possible that it may have issued a series of enter/leave events and for the
visibility of those to be queued up.  For example, there may be a pending
`[enter, leave, enter]` at the point where fsmonitor wants to issue the closing
`leave`.

Handling this is reasonably straight forward; when processing a leave request,
we look for the item with the smallest id number and check based on that.  The
id numbers are assigned in increasing values, so the smaller numbers imply the
earlier event.

Reviewed By: simpkins

Differential Revision: D5118348

fbshipit-source-id: b6f8aca6a25e61b1daf2d4e80fd6eea7544174a4" class="message" href="https://github.com/facebook/watchman/commit/8e1671ec59d0caf071de9158553635d6e1be2c4c">state-(enter|leave) are now non-blocking</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-21T02:40:24Z">Mar 21, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_clockspec.h" id="682a6afe23e04330a6c6a2e28b79e2b0-9ed321f53211c22e749f601f0ca5b0194f30c1da" href="https://github.com/facebook/watchman/blob/master/watchman_clockspec.h">watchman_clockspec.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="add basic Mercurial scm awareness to since queries

Summary:
This diff allows adding an `scm` constraint to a query.  This is implemented by
making the clockspec parser understand a &quot;fat&quot; clock, which is really just a
clock with more information inside it than just a string.

A fat clock is represented as a json object rather than just a string.  These
clocks are identical:

```
&quot;c:0:0&quot;
{}
{&quot;clock&quot;: &quot;c:0:0&quot;}
```

This also makes it more convenient to specify a &quot;null clock&quot; value; just pass an
empty object.

For SCM awareness we've allowed for the clock to contain an `scm` property with
some parameters to influence the query.  For example, the client can pass in
something like this on their initial query:

```
&quot;since&quot;: {
  &quot;scm&quot;: {
    &quot;mergebase-with&quot;: &quot;master&quot;
  }
}
```

this causes watchman to compute the mergebase with the specific commit.

If the mergebase is the same, then the query continues as a normal `since` query.

If the mergebase has changed, rather than computing a large list of everything
that got changed between the old revision and the new one, watchman will instead
just return the list of files that have been changed since the new mergebase,
filtered by the query expression.

The goal of this feature is to minimize the size of the resultset for clients
that are aware of source control.

In the query response for such a query, watchman will populate the scm information:

```
{
  files: [&quot;foo&quot;, &quot;bar&quot;],
  clock: {
    clock: 'c:123:123:123',
    scm: {
      'mergebase': 'HASH',
      'mergebase-with': 'master',
    }
  }
}
```

Note that the the clock value in the result set is a &quot;fat&quot; clock.  Generating the
fat clock value is handled by the `ClockSpec.toJson()` method; it will generate one
if the clockspec contains more than just a ClockPosition.  This can only happen
if the client initiated a query using a fat clock spec as an input, so we should
be good from a backwards compatibility standpoint.

On a subsequent query, the client will provide the `clock` parameter as the value
of the `since` field as they would do normally.  Passing back the fat clock value
causes the next query to continue to use the scm parameters:

```
since: {
  clock: 'c:123:123:123',
  scm: {
    'mergebase': 'HASH',
    'mergebase-with': 'master'
  }
}
```

To facilitate this, I've introduced a small SCM abstraction.  The interface requires
two methods to be implemented; one to return the current mergebase and another to
return the set of !ignored files changed since a specified mergebase.

The QueryableView is responsible for returning an instance of the SCM object.
Putting it at the view layer allows us to very specifically target Eden and
avoid running external commands for the eden watcher.

This diff only implements this functionality for Mercurial.  I plan to extend it
to handle git in a follow-on commit.

Similarly, I plan to add the equivalent functionality for subscriptions in another follow-on commit.

Reviewed By: bolinfest

Differential Revision: D4533545

fbshipit-source-id: 4093c30954da6be6f75a820577f6deed96156fdc" class="message" href="https://github.com/facebook/watchman/commit/cb949e93018040c76458375b40538d8c4733e689">add basic Mercurial scm awareness to since queries</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-03-01T23:47:43Z">Mar 2, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_cmd.h" id="36353bc36299694cfa843b6b9780f7e0-fb1274f36f5a93aa47918e87e1ae43c6a4509bb7" href="https://github.com/facebook/watchman/blob/master/watchman_cmd.h">watchman_cmd.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="Fix problem where watch implicitly created.

Summary:
A user that runs the following commands will implicitly create a watch:
- state-enter
- state-leave
- subscribe
- trigger
- watch
This change will limit the watch creation to the watch command (explicit).
This will make behaviors more intuitive and prevent future issues.
We separate commands for the resolve_root and resolve_root_create - as a defensive measure.

Reviewed By: wez

Differential Revision: D5829679

fbshipit-source-id: 06995044b48fdadde02dece1624322a6e8b160bc" class="message" href="https://github.com/facebook/watchman/commit/e02729e5e1ad8373d00a601d1ccfd0e1ea2b6fa8">Fix problem where watch implicitly created.</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-09-15T18:35:06Z">Sep 16, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_config.h" id="7c0b59b2f0f2a3a96ac0918a41c1a97e-470f6e97e7a60509eac5ba0c5c8419860f9b7f65" href="https://github.com/facebook/watchman/blob/master/watchman_config.h">watchman_config.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="fix error message in the watch case too

Summary:
I noticed from some logs in production that D6935592 overlooked this
other place with similar error messaging.  Factor out the fiddly bit and make
the error messages more similar, and test them.

Reviewed By: simpkins

Differential Revision: D7060027

fbshipit-source-id: 491beccd92161618a3cdafedaaff70b58779a118" class="message" href="https://github.com/facebook/watchman/commit/a606ff703697835faa25399c5d2a26b23c12f94e">fix error message in the watch case too</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-02-23T23:37:56Z">Feb 24, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_dir.h" id="8a3c8ed5e705d7f30d9fbc1bac734eef-25e8287c1077b7ea86ff972c26314c4d1861f5ba" href="https://github.com/facebook/watchman/blob/master/watchman_dir.h">watchman_dir.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="refactor w_dir_path_cat_str -&gt; getFullPathToChild

Summary:
This removes the horrible C style name and clarifies
the comments.

Reviewed By: chadaustin

Differential Revision: D7209333

fbshipit-source-id: 9077f9422bb3ede7b4a4c80e8d05c58f2af66973" class="message" href="https://github.com/facebook/watchman/commit/085866203c94f1d1b38eefa6f047b2eb16dbcb0d">refactor w_dir_path_cat_str -&gt; getFullPathToChild</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-12T21:08:21Z">Mar 13, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_error_category.h" id="f9bba3db845bed51efdd23f871f245af-0337743d6cfacc1591e3083c5d9c04c5ce369a9e" href="https://github.com/facebook/watchman/blob/master/watchman_error_category.h">watchman_error_category.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="enable watch_symlinks on win32

Summary:
Remove the preprocessor directive that restricted this to !win32
and fixup the code to use the new readSymbolicLink(path) function.

Fixup off by one in baseName, dirName.  Both of these functions would start
reading at the end pointer rather than just before it.  This typically worked
out OK, but if that end position contained a slash character, we might try to
construct a string with a bogus length.  This is deteted at runtime via the
checked_len function which throws an exception and cancels the watch.

Reviewed By: simpkins

Differential Revision: D5101087

fbshipit-source-id: eb77f731539328ced4ddd844715a5891304a30a3" class="message" href="https://github.com/facebook/watchman/commit/68ff0004d236241336d7c5197a8374f398adf244">enable watch_symlinks on win32</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-06-02T15:21:43Z">Jun 2, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_file.h" id="c31c379767a2f007f44036501639b17f-7c5b35e49899f5897f9842783164e51e166b103e" href="https://github.com/facebook/watchman/blob/master/watchman_file.h">watchman_file.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="defer reading of symlink targets

Summary:
I've seen a few problem reports where cold cache situations on laptops
take a very long time to perform an initial crawl.  This diff changes the
recording of symlink targets so that it is no performed eagerly and instead
changes things to use the LRU cache infrastructure that we added for content
hash caching.

Another nice side benefit of this diff is that we save some memory (1x
`w_string` instance per symlink).

Reviewed By: simpkins

Differential Revision: D7341642

fbshipit-source-id: 6c632da6b557667baece71837883567d7cd5abbf" class="message" href="https://github.com/facebook/watchman/commit/ff819f71762781339b2d6cbeb1531073241c1772">defer reading of symlink targets</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-21T05:44:35Z">Mar 21, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_getopt.h" id="3f492b4fbd60485ba99ecb7b14b77105-a6aff82d974dc230a2eb009d8bd1263409a86453" href="https://github.com/facebook/watchman/blob/master/watchman_getopt.h">watchman_getopt.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="refactor: break watchman.h into separate header files

Summary:
This is adding some more header files and moving some declarations
around.

Reviewed By: sid0

fbshipit-source-id: 9e760f1ff7ee3403fe2ce013abceca032c260060" class="message" href="https://github.com/facebook/watchman/commit/44fffe78c882cf6df56361fbacf8e20158c56205">refactor: break watchman.h into separate header files</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-09-16T20:50:29Z">Sep 17, 2016</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_hash.h" id="1ab2920d3e7749d2c03dabf5cc3ba7dd-bdb50b16a4456c63b469d093f47c8b70802428a1" href="https://github.com/facebook/watchman/blob/master/watchman_hash.h">watchman_hash.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="add content hash as an available field

Summary:
This uses the Future and LRUCache plumbing from earlier in the diff
stack to provide a cache for the computed content hash of files in the root.

This is implemented only for InMemoryView at the moment; a follow-on diff will
add the Eden equivalent.

This is purely a demand-fetched implementation at the moment; watchman will
only compute/cache content hashes when a query explicitly requests it.

We cache using the filename, size and mtime as the key to avoid having to think
too hard about invalidations if a given file is changing very rapidly.

A follow-on diff will add some heuristics for cache warming.

I've tried to avoid pulling in openssl on Windows and macOS.  On macOS there is
a SHA1_Init() interface compatible SHA1 library available.  On Windows we use
the crypto API.  On other systems, autoconf looks for libcrypto and adds it to
the linker parameters if present.  The autoconf checks are intentionally a bit
weak to avoid forming a strong dependency on macOS.  Let's see how they do in
the legocastle run.

Reviewed By: farnz

Differential Revision: D4500739

fbshipit-source-id: e5c3ff82cc217cdf55373b02ffc16089e6e897ce" class="message" href="https://github.com/facebook/watchman/commit/c884bba3eb4ca7f03b4d9cf06774f3b50481c79d">add content hash as an available field</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-02-03T03:33:35Z">Feb 3, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_ignore.h" id="13316ccc28869ef2534e7a014f78c031-75ef91942c4dd5d47b28d2c9bbc9a43c7b4d422a" href="https://github.com/facebook/watchman/blob/master/watchman_ignore.h">watchman_ignore.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="unordered_set and vector for ignore internals

Summary:
Remove w_ht_t usage from the ignore struct.  Promote some functions to
methods.

Reviewed By: farnz

Differential Revision: D4102088

fbshipit-source-id: cb56e8fe1536c265669f31409ec8a0e7315bc024" class="message" href="https://github.com/facebook/watchman/commit/294cbcf74be412d93f89fdd3a6e1b6960e466d29">unordered_set and vector for ignore internals</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-11-01T22:19:37Z">Nov 2, 2016</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_log.h" id="2273daf94cc9b119be72c1fea33513f5-862b1b9b268f5e2f54ac7b79fa77b08ece207e52" href="https://github.com/facebook/watchman/blob/master/watchman_log.h">watchman_log.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="terminate process without running destructors on FATAL

Summary:
For better or worse... I've seen this trace in the wild,
and its been lingering for 4 days!  Strangely, the process is almost
fully functional, except for flushing subscriptions.

I suspect that we have an uncaught exception in the client thread because the
logs look like this; these indicate that the terminating thread was a client
thread.  We can see that it handled a query 2 seconds prior to the fault:

```
2018-03-17T04:52:48,510: [client=0x7f7f39d3e1d0:stm=0x7f7f39c75840:pid=1819024] PERF: {&quot;system_time&quot;: 0.081978999999999996, &quot;user_time&quot;: 0.0055560000000000002, &quot;elapsed_time&quot;: 1.2319009999999999, &quot;description&quot;: &quot;que
ry_execute&quot;, &quot;meta&quot;: {&quot;query_execute&quot;: {&quot;query&quot;: {&quot;expression&quot;: [&quot;allof&quot;, [&quot;not&quot;, [&quot;anyof&quot;, [&quot;dirname&quot;, &quot;.hg&quot;], [&quot;dirname&quot;, &quot;.git&quot;], [&quot;dirname&quot;, &quot;.svn&quot;]]]], &quot;since&quot;: {&quot;drop&quot;: [&quot;hg.update&quot;], &quot;scm&quot;: {&quot;mergebase-with&quot;:
 &quot;master&quot;}}, &quot;relative_root&quot;: &quot;&quot;, &quot;empty_on_fresh_instance&quot;: true, &quot;fields&quot;: [&quot;name&quot;]}, &quot;fresh_instance&quot;: false, &quot;num_deduped&quot;: 0, &quot;num_results&quot;: 1, &quot;num_walked&quot;: 11}, &quot;root&quot;: {&quot;watcher&quot;: &quot;inotify&quot;, &quot;path&quot;: &quot;/data/u
sers/akramer/www-hg&quot;, &quot;case_sensitive&quot;: true, &quot;recrawl_count&quot;: 0}}, &quot;start_time&quot;: 1521287567.278764, &quot;pid&quot;: 3700551, &quot;version&quot;: &quot;4.9.0&quot;}
2018-03-17T04:52:50,116: [client=0x7f7f39d3e1d0:stm=0x7f7f39c75840:pid=1819024] std::terminate was called
Fatal error detected at:
/usr/local/bin/watchman() [0x411507]
/usr/local/bin/watchman() [0x6c12f6]
/usr/local/bin/watchman() [0x443620]
/usr/local/bin/watchman() [0x6c2525]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8cd95) [0x7f7f3b8ded95]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(_ZSt9terminatev+0x10) [0x7f7f3b8dede0]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0xc7227) [0x7f7f3b919227]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libpthread.so.0(+0x77a8) [0x7f7f3b0157a8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libc.so.6(clone+0x6c) [0x7f7f3a931a7c]
```

There was not a lot of useful additional information available from the process
(I captured a core file and poked around).  Here's the trace of the stuck
thread.  None of the other threads are waiting on locks; all threads appear to
be waiting for requests and operating reasonably; other requests for the same
root will succeed and so on.

```
Thread 75 (Thread 0x7f7f1ab7e700 (LWP 1819033)):
```

I've expanded our termination handler to attempt to print out the current
exception.  This seems to be present for the obvious cases; the trace doesn't
provide a huge amount of context but at least we can divine the thread name
from the existing logging, and can also resolve to the thread function when
attaching to the gdb core file.

```
2018-03-22T09:52:05,164: [perflog] std::terminate was called. Exception: boop.
Fatal error detected at:
./buck-out/gen/watchman/watchman() [0x69ccd4]
./buck-out/gen/watchman/watchman() [0x69e7fc]
./buck-out/gen/watchman/watchman() [0x443ee0]
./buck-out/gen/watchman/watchman() [0x6a062d]
./buck-out/gen/watchman/watchman() [0x6a07f8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8cd95) [0x7fc441cabd95]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0x8b9d8) [0x7fc441caa9d8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(__gxx_personality_v0+0x387) [0x7fc441cab357]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libgcc_s.so.1(+0xff0c) [0x7fc4404cdf0c]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libgcc_s.so.1(_Unwind_RaiseException+0x1ac) [0x7fc4404ce44c]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(__cxa_throw+0x63) [0x7fc441cac053]
./buck-out/gen/watchman/watchman() [0x488dad]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libstdc++.so.6(+0xc7170) [0x7fc441ce6170]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libpthread.so.0(+0x77a8) [0x7fc4413e27a8]
/usr/local/fbcode/gcc-5-glibc-2.23/lib/libc.so.6(clone+0x6c) [0x7fc440cfea7c]
[1]    1237117 abort (core dumped)  ./buck-out/gen/watchman/watchman --foreground --logfile=/dev/stdout
```

I also cleaned up the handling of the `send_ok` variable.  It appeared to be
possible for this to get set but then nothing would ever terminate the main
loop.  That code was added back before much of the supporting bits had been
converted to C++.

I've changed the `exit()` call to `_exit()` to avoid calling `atexit`
handlers and destructors.  We used to `abort()` here, but there are a number of
cases where we don't want that to generate a core file so it was recently
changed to exit.   I've added an explicit `ABORT` error level to accomodate
this class of problem.

Reviewed By: simpkins

Differential Revision: D7354472

fbshipit-source-id: 846f93b568beb1e7b00dc91f02e71c40678c86b6" class="message" href="https://github.com/facebook/watchman/commit/4232c70fdc11ba642311633ea38a3d5dd5506dcf">terminate process without running destructors on FATAL</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-22T18:18:53Z">Mar 23, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_opendir.h" id="fb2ba44757de57573015d2d415cfb9aa-f26b903859dd9ade314c6d5bffd41c87917b651d" href="https://github.com/facebook/watchman/blob/master/watchman_opendir.h">watchman_opendir.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="rename watchman_stat to FileInformation

Summary:
This is part of a series of diffs to improve our portability with
windows.  They also have the nice side effect of addressing some performance
and reliability issues that we're tracking on github.

An important part of this diff stack is removing our nasty stat() hacks; this
diff creates a FileInformation type for this purpose.

FileInformation holds a subset of the struct stat information as well as some
additional win32 specific information.

It introduces a handful of helper methods for testing whether the
FileInformation references a symlink, dir or regular file.  This is important
because the sys/stat.h that is provided by MSVCRT does not have any way to
indicate that the file is a symlink.

Reviewed By: simpkins

Differential Revision: D5091465

fbshipit-source-id: cbdbd9edc87fba005e79f492001be93abd344ac9" class="message" href="https://github.com/facebook/watchman/commit/ce40e8c174c6551769e95af4f434bce5478183b8">rename watchman_stat to FileInformation</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-05-22T18:23:14Z">May 23, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_pdu.h" id="da2821a39710d64bde4d160587294b96-98321fda5c770e2b418169159557d51b8fd1645a" href="https://github.com/facebook/watchman/blob/master/watchman_pdu.h">watchman_pdu.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="add some more tests for BSER decoding

Summary:
I noticed we had very few tests for BSERv2 string emitting, so I wrote some. More will be coming when I can get mixed strings working.

(I'm not sure I can C++ fully yet, so suggestions would be welcome.)

Reviewed By: wez

Differential Revision: D4325146

fbshipit-source-id: 611ec7d777f2913e0b4e5b9d09fa0719d2a17618" class="message" href="https://github.com/facebook/watchman/commit/fe8a9f6679a38539d9bb9bb5221a6c3d97689ea8">add some more tests for BSER decoding</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-12-15T17:04:27Z">Dec 16, 2016</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_pending.h" id="71dc38d5f35fd0fd33589d2df20dadb3-97938173ab09e0255ee8c673d97fff2fafe60113" href="https://github.com/facebook/watchman/blob/master/watchman_pending.h">watchman_pending.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="refactor errmsg -&gt; throw QueryXXXError

Summary:
Now that we have exceptions we can tidy this up, so here we are.

This replaces the nasty looking `ignore_result(asprintf(&amp;res-&gt;errmsg, &quot;foo %s&quot;, &quot;bar&quot;)))`
pattern with `throw QueryParseError(&quot;foo &quot;, &quot;bar&quot;);`

There were two of these `errmsg` fields in the query stuff; one for parse
errors and another for execution errors.  I've introduced a class for both of
these and adjusted the code to call the appropriate flavor.

Reviewed By: simpkins

Differential Revision: D4527192

fbshipit-source-id: 2e24b39c190cd7a4b055e563283a6713da346d38" class="message" href="https://github.com/facebook/watchman/commit/8bf1ef3ca65e2cf3e63ffb0f3c65a96f7a7c0ed0">refactor errmsg -&gt; throw QueryXXXError</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-02-10T18:11:18Z">Feb 11, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_perf.h" id="b85b2ab084ade25ff7ad7c6201b66d11-751b1dc6d91ee3d6ec17de55ed0f6ec927210f62" href="https://github.com/facebook/watchman/blob/master/watchman_perf.h">watchman_perf.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="refactor errmsg -&gt; throw QueryXXXError

Summary:
Now that we have exceptions we can tidy this up, so here we are.

This replaces the nasty looking `ignore_result(asprintf(&amp;res-&gt;errmsg, &quot;foo %s&quot;, &quot;bar&quot;)))`
pattern with `throw QueryParseError(&quot;foo &quot;, &quot;bar&quot;);`

There were two of these `errmsg` fields in the query stuff; one for parse
errors and another for execution errors.  I've introduced a class for both of
these and adjusted the code to call the appropriate flavor.

Reviewed By: simpkins

Differential Revision: D4527192

fbshipit-source-id: 2e24b39c190cd7a4b055e563283a6713da346d38" class="message" href="https://github.com/facebook/watchman/commit/8bf1ef3ca65e2cf3e63ffb0f3c65a96f7a7c0ed0">refactor errmsg -&gt; throw QueryXXXError</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-02-10T18:11:18Z">Feb 11, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_preprocessor.h" id="dc9c67e189425f53f84f99d997241e7c-6509deed1d18ccdc945717aaa75adc6eb39251db" href="https://github.com/facebook/watchman/blob/master/watchman_preprocessor.h">watchman_preprocessor.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="re-jigger log subscriptions

Summary:
while analyzing the TSAN output for the build, it became apparent that
we have some potential lock inversion code paths around how we inject data into
the client response streams.

This diff is the first part of resolving that issue.  There will be a follow-up
diff that changes the file change subscriber and state-enter plumbing to use
PubSub too.

Previously, if client had turned up debugging logging on their subscription, we
would discover this by locking the set of clients and walking them.  This opens
up to risk of lock inversion if we are running a command that locks the client
list and then takes some other action (or even just logs something).

To resolve this, this commit introduces a PubSub helper class.  The purpose of
this class is to record a stream of json objects to be consumed by some number
of subscribers.  If there are no subscribers, nothing needs to be recorded.

If there are subscribers, an immutable Item is logged to the stream and tagged
with a new serial number.

Each Subscriber remembers the last serial number that it has observed, allowing
the `getNext` method to return the next un-observed item on each subsequent
call.

Subscribers are registered along with a callback that is intended to &quot;wake up&quot;
the subscriber so that it can process the newly arrived items.

This diff cuts logging over to this new PubSub scheme.  The new Log class
maintains two separate Publishers; one for debug level events and another for
error level events.

It also establishes subscriber(s) for these dependent on the global log level
flag.  These subscribers have a &quot;notification&quot; callback that sorts and logs any
pending items to the stderr stream, optionally aborting the process if we saw a
FATAL level log.

Each connected watchman client also establishes subscribers for the debug and
error streams if the client issues a `log-level` command.  The notify callback
for these pings the client so that it can wake up and translate the log items
into its queue of responses to send to the peer.

There are a couple of important properties:

* wlocks are needed only to amend the subscriber list or to append a new item.
* rlocks are held when a subscriber consumes items from the stream.
* The critical sections are short, non-interleaved and non-recursive.

There are some bonus side effects:

* We can avoid formatting the bulk of the log string if there are no
  subscribers for a given level.

There's a bit of fan-out from these changes:

* We now track clients via shared_ptr so that we can safely manage
  the Subscriber -&gt; client flow that is required for the notify
  routine for the clients.  Without this we would hit a use-after-free
  each time that we tear down a client.
* To facilitate this, we need to use std::thread to spawn the client
  threads.  There's a slightly gross bit of code to capture
  pthread_self() at the start of the client thread to allow the
  pthread_kill(SIGUSR1) stuff to work.  I want to remove this
  at some point as it is not a portable way to wake up a thread.
* There's some circular log -&gt; json -&gt; string dependencies that mean
  that we can't use the logging functions in some lower level
  classes and helpers, so those had to be adjusted.

Reviewed By: farnz

Differential Revision: D4108737

fbshipit-source-id: e69bbfa13f42c28939855e7c19e84c0d4a5854e1" class="message" href="https://github.com/facebook/watchman/commit/43f3ff4c2cbca823ac0a2d15f9551b81872326b0">re-jigger log subscriptions</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-11-03T16:49:25Z">Nov 4, 2016</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_query.h" id="829abc8b6826c9aacb1612cce9c6b352-5955204ea40288012114b41a39335b5107c2c2cd" href="https://github.com/facebook/watchman/blob/master/watchman_query.h">watchman_query.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="defer reading of symlink targets

Summary:
I've seen a few problem reports where cold cache situations on laptops
take a very long time to perform an initial crawl.  This diff changes the
recording of symlink targets so that it is no performed eagerly and instead
changes things to use the LRU cache infrastructure that we added for content
hash caching.

Another nice side benefit of this diff is that we save some memory (1x
`w_string` instance per symlink).

Reviewed By: simpkins

Differential Revision: D7341642

fbshipit-source-id: 6c632da6b557667baece71837883567d7cd5abbf" class="message" href="https://github.com/facebook/watchman/commit/ff819f71762781339b2d6cbeb1531073241c1772">defer reading of symlink targets</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-21T05:44:35Z">Mar 21, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_root.h" id="421bd7c6ba2cb02075a2107d48b69808-dd1a5bd4400d76477ed90867b91cdeee61198155" href="https://github.com/facebook/watchman/blob/master/watchman_root.h">watchman_root.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="state-(enter|leave) are now non-blocking

Summary:
We're seeing some slowdowns in hg update operations; the blockage
appears to be waiting on state-enter and state-leave commands issue by the
fsmonitor extension.

This diff builds on the prior diff and makes use of the more generalized cookie
sync mechanism to arrange for the state assertion action to take place once the
cookie has been observed by the IO thread.

Note that this breaks state-enter/state-leave for the eden watcher, which
currently does not process cookies, however, the fsmonitor extension is not
even enabled for eden, so this is sort of a moot point; we'll need to resolve
that in a different way.

This diff complicates things a little; previously, we would not update the
client-&gt;states map until after synchronization had occurred.  This made it very
simple to understand who had made a state assertion and allowed for some strong
sanity checks.

With this diff, the visibility of the assertion is deferred until the cookie is
processed; a client may therefore be pending an enter or leave.  In the case
where mercurial is processing a series of updates (as part of a rebase), it is
possible that it may have issued a series of enter/leave events and for the
visibility of those to be queued up.  For example, there may be a pending
`[enter, leave, enter]` at the point where fsmonitor wants to issue the closing
`leave`.

Handling this is reasonably straight forward; when processing a leave request,
we look for the item with the smallest id number and check based on that.  The
id numbers are assigned in increasing values, so the smaller numbers imply the
earlier event.

Reviewed By: simpkins

Differential Revision: D5118348

fbshipit-source-id: b6f8aca6a25e61b1daf2d4e80fd6eea7544174a4" class="message" href="https://github.com/facebook/watchman/commit/8e1671ec59d0caf071de9158553635d6e1be2c4c">state-(enter|leave) are now non-blocking</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-21T02:40:24Z">Mar 21, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_scopeguard.h" id="c3b7d79f87e7547f858ca8a8eccd8ce4-a7425698ca447a7da456ba170f001955aa963991" href="https://github.com/facebook/watchman/blob/master/watchman_scopeguard.h">watchman_scopeguard.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="Cut the ScopeGuard alias now that we have auto

Summary:
[Folly] Cut the `ScopeGuard` alias now that we have `auto`.

This form works because of hidden lifetime extension:
```lang=c++
folly::ScopeGuard guard = folly::makeGuard([] { /*...*/ });
//  ...
//  guard falls out of scope
```
But this form would not work correctly:
```lang=c++
folly::ScopeGuard guard = folly::makeGuard([] { /*...*/ });
std::async(std::launch::async, [guard = std::move(guard)] {});
```
Because `folly::ScopeGuard` is an rvalue-reference-to-base.
We have `auto`, so just remove `folly::ScopeGuard`. This form works correctly:
```lang=c++
auto guard = folly::makeGuard([] { /*...*/ });
std::async(std::launch::async, [guard = std::move(guard)] {});
```

Reviewed By: igorsugak

Differential Revision: D6690070

fbshipit-source-id: 54e32b300d36fce4eb95a59f1828819afe312ec0" class="message" href="https://github.com/facebook/watchman/commit/ca53ab76c22dd0a9b7f7b6bcfd32a1ca226ed6ce">Cut the ScopeGuard alias now that we have auto</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-01-11T02:15:24Z">Jan 11, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_shared_mutex.h" id="c4e15b29a03c596ff78cf10e4413ea45-15b5e3201bffd926c00905119fe237f43ed1e710" href="https://github.com/facebook/watchman/blob/master/watchman_shared_mutex.h">watchman_shared_mutex.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="remove pthread port for win32

Summary:
We can just use C++14 features for everything on win32.
On Linux and macOS we continue to use pthread for the shared_mutex bits.

Reviewed By: farnz

Differential Revision: D4203965

fbshipit-source-id: 64c3bfbc485e5aa14ee781e3268f63b272c90954" class="message" href="https://github.com/facebook/watchman/commit/cbb7523863f9554ec3fec9ec0ff4e4a99f242d5c">remove pthread port for win32</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-11-30T19:18:26Z">Dec 1, 2016</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_stream.h" id="c9579f33cb57bc37da34c568932e02f7-ea671de463659712ac82d7c8b4b3d7bced551a64" href="https://github.com/facebook/watchman/blob/master/watchman_stream.h">watchman_stream.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="migrate the remains of Win32Handle.cpp -&gt; FileDescriptor.cpp

Summary:
As promised in an earlier diff, this completes the move of
Win32Handle into FileDescriptor.

I've also cleaned up a couple of of the higher level stream functions
so that that the prototypes of w_stm_open and w_stm_fdopen are less
repeaty.

Reviewed By: simpkins

Differential Revision: D5171647

fbshipit-source-id: 6fb92a93d5a2fc38d4815e8353318290c9df7ab8" class="message" href="https://github.com/facebook/watchman/commit/3efa30e766923e9cd0901c30803b43c98fe322a4">migrate the remains of Win32Handle.cpp -&gt; FileDescriptor.cpp</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-06-06T22:21:03Z">Jun 7, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_string.h" id="1f8c0bdd318483bcd24eca12285396f7-c0f5ab11f031717104664539c2fd26d09e480640" href="https://github.com/facebook/watchman/blob/master/watchman_string.h">watchman_string.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="remove more dead code

Summary: these functions are no longer called

Reviewed By: chadaustin

Differential Revision: D7209335

fbshipit-source-id: f4d159289b31c5b02bfcf7b8b84dd7e0426cca6b" class="message" href="https://github.com/facebook/watchman/commit/d636dfeb4cf641c95c908a705dac463d29707b4e">remove more dead code</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-12T21:08:21Z">Mar 13, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_synchronized.h" id="cd21967594a465db804475780994a6f5-4a7425c9b267e892e0e745eb72357b2fe3bbf4b3" href="https://github.com/facebook/watchman/blob/master/watchman_synchronized.h">watchman_synchronized.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="fix open source build

Summary: Closes https://github.com/facebook/watchman/pull/378

Reviewed By: wez

Differential Revision: D4055035

Pulled By: sid0

fbshipit-source-id: e317dcbcc48ed274c5b62e414b26ffe31f50a040" class="message" href="https://github.com/facebook/watchman/commit/4fdca25215fc923ddbeb29a0e74c62d17642b756">fix open source build</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-10-21T03:33:15Z">Oct 21, 2016</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_system.h" id="36dacef701272f2ac460555fe21dc90f-545ac43be870bd13da0b9cbd00cee0c9d7ea5f25" href="https://github.com/facebook/watchman/blob/master/watchman_system.h">watchman_system.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="add cmake build

Summary:
This is a reasonably functional cmake implementation
of the watchman build system.  Notably missing is support for
detecting pcre and linking it in; that can be done in a follow-up
diff.

This replaces the hand-rolled windows build bits completely,
but does not remove the autoconf bits.  I will likely remove
autoconf once we have parity.

The intent is that this is a stepping stone to adding a dependency
on folly.

When testing the windows build, I found that watchman was missing most of its
registered commands.

It appears as though the relatively tricky constructor attributes that we're
using (which were targeting the `C` compiler) no longer stick; the symbols are
not included in the build and the commands are missing.

The resolution is to use C++ constructor syntax for these instead.

I also tried this on Linux and Mac because it is appealing to
simplify everything, but various versions of gcc/clang on the OSS
CI failed to link in all the commands.

I've adjusted the configuration for the various CI systems so that
we run both autoconf and cmake based builds and tests.  In the longer
run I will remove the autoconf version of the build.

Reviewed By: simpkins

Differential Revision: D7363633

Pulled By: wez

fbshipit-source-id: ac00ae0cd7af5bc51cdcf72c0595c280a4a3f977" class="message" href="https://github.com/facebook/watchman/commit/e6350f9cf59cdce46cb25c2c78dddc11a0a0a1f6">add cmake build</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-03-29T18:58:14Z">Mar 30, 2018</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_time.h" id="642dcabba745571ef9f3db6766b3a0b4-b5a4eaea8218baf8268b37f42025e61718db315b" href="https://github.com/facebook/watchman/blob/master/watchman_time.h">watchman_time.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="add content hash as an available field

Summary:
This uses the Future and LRUCache plumbing from earlier in the diff
stack to provide a cache for the computed content hash of files in the root.

This is implemented only for InMemoryView at the moment; a follow-on diff will
add the Eden equivalent.

This is purely a demand-fetched implementation at the moment; watchman will
only compute/cache content hashes when a query explicitly requests it.

We cache using the filename, size and mtime as the key to avoid having to think
too hard about invalidations if a given file is changing very rapidly.

A follow-on diff will add some heuristics for cache warming.

I've tried to avoid pulling in openssl on Windows and macOS.  On macOS there is
a SHA1_Init() interface compatible SHA1 library available.  On Windows we use
the crypto API.  On other systems, autoconf looks for libcrypto and adds it to
the linker parameters if present.  The autoconf checks are intentionally a bit
weak to avoid forming a strong dependency on macOS.  Let's see how they do in
the legocastle run.

Reviewed By: farnz

Differential Revision: D4500739

fbshipit-source-id: e5c3ff82cc217cdf55373b02ffc16089e6e897ce" class="message" href="https://github.com/facebook/watchman/commit/c884bba3eb4ca7f03b4d9cf06774f3b50481c79d">add content hash as an available field</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-02-03T03:33:35Z">Feb 3, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_trigger.h" id="24bd9aa52522e6ba7680c40470618689-73a0e489ff1093dcdd66803ec0bc07b8efc65edd" href="https://github.com/facebook/watchman/blob/master/watchman_trigger.h">watchman_trigger.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="triggers now use ChildProcess::Environment rather than envht

Summary: Tidies up the code a bit and standardizes on the newer API for this stuff

Reviewed By: sid0

Differential Revision: D4424941

fbshipit-source-id: b3f117f73120a8a551cf4cf96414d5345582f1e8" class="message" href="https://github.com/facebook/watchman/commit/09bf45d0c919acc60ed73184e8d76b0b347306f6">triggers now use ChildProcess::Environment rather than envht</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-01-23T17:03:44Z">Jan 24, 2017</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg class="octicon octicon-file" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img class="spinner" alt="" src="octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a class="js-navigation-open" title="watchman_watcher.h" id="a3bba65f92104a6ceb50ab9b9ea612c5-290068c5ebabc74dcbfdd5f477e734d181b8a1d5" href="https://github.com/facebook/watchman/blob/master/watchman_watcher.h">watchman_watcher.h</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a data-pjax="true" title="connect crawl errors to the watch failure reason

Summary:
This is a bit of a clean up in preparation for sharing
and knowing more about the reasons behind a failure of this
and cookie sync timeouts.

During crawling with inotify, if we hit the inotify system limits,
we have logic to set us in a poisoned state and fail new requests
until we are restarted.

An external user reported a problem where the `watch` project
command would appear to succeed when it hit the limits rather
than surface the error.

https://github.com/facebook/watchman/issues/525

The root of this problem is that we weren't populating the
`failure_reason` field to bubble up the error and that is the
core of this diff; with that set, the error is reported in
the result of the `watch` command.

While looking at this I noticed that we had a couple of stale
bits that needed cleanup:

- inotify.cpp had legacy code for setting the poison state itself,
  rather than letting the logic in warnerr.cpp handle it.
- the error_category stuff needed to be educated about the system
  limit errnos that the legacy code above was using
- the code in warnerr.cpp is now responsible for setting the
  `failure_reason` if it wasn't already set, and it now will take
  the poison reason if it is set (it's a global variable).
- When we encountered an error on the root of the watch we had
  a notion of whether the issue was transient or not.  I don't
  recall why that matters there, and all the errors that we can
  experience in practice are sufficient that we should bail
  out on watching that root, so I've removed the transient flag
  and revised the error messaging.

Reviewed By: simpkins

Differential Revision: D7063735

fbshipit-source-id: 1da4ad5f53b8fb9eb8daeb4c36ab953a1a75f0b5" class="message" href="https://github.com/facebook/watchman/commit/77bb9e9d0d638899b1b50ebd78e2872f2b3ad96c">connect crawl errors to the watch failure reason</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2018-02-23T23:37:57Z">Feb 24, 2018</time-ago></span>
          </td>
        </tr>
    </tbody>
  </table>

</div>



  <div id="readme" class="readme boxed-group clearfix announce instapaper_body markdown">
    <h3>
      <svg class="octicon octicon-book" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M3 5h4v1H3V5zm0 3h4V7H3v1zm0 2h4V9H3v1zm11-5h-4v1h4V5zm0 2h-4v1h4V7zm0 2h-4v1h4V9zm2-6v9c0 .55-.45 1-1 1H9.5l-1 1-1-1H2c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h5.5l1 1 1-1H15c.55 0 1 .45 1 1zm-8 .5L7.5 3H2v9h6V3.5zm7-.5H9.5l-.5.5V12h6V3z"></path></svg>
      README.markdown
    </h3>

      <article class="markdown-body entry-content" itemprop="text"><h1><a href="#watchman" aria-hidden="true" class="anchor" id="user-content-watchman"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Watchman</h1>
<p>A file watching service.</p>
<h2><a href="#purpose" aria-hidden="true" class="anchor" id="user-content-purpose"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Purpose</h2>
<p>Watchman exists to watch files and record when they actually change.  It can
also trigger actions (such as rebuilding assets) when matching files change.</p>
<h2><a href="#documentation" aria-hidden="true" class="anchor" id="user-content-documentation"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Documentation</h2>
<p>Head on over to <a href="https://facebook.github.io/watchman/" rel="nofollow">https://facebook.github.io/watchman/</a></p>
<h2><a href="#build-status" aria-hidden="true" class="anchor" id="user-content-build-status"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Build Status</h2>
<p><a href="https://travis-ci.org/facebook/watchman" rel="nofollow"><img src="68747470733a2f2f7472617669732d63692e6f72672f66616365626f6f6b.svg" alt="Build Status" data-canonical-src="https://travis-ci.org/facebook/watchman.svg?branch=master" style="max-width:100%;">
</a></p>
<p><a href="https://ci.appveyor.com/project/wez/watchman/branch/master" rel="nofollow"><img src="68747470733a2f2f63692e6170707665796f722e636f6d2f6170692f7072.svg" alt="Build status" data-canonical-src="https://ci.appveyor.com/api/projects/status/uvafoyc550kg438h/branch/master?svg=true" style="max-width:100%;">
</a></p>
<h2><a href="#license" aria-hidden="true" class="anchor" id="user-content-license"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>License</h2>
<p>Watchman is made available under the terms of the Apache License 2.0.  See the
LICENSE file that accompanies this distribution for the full text of the
license.</p>
<h2><a href="#contributing" aria-hidden="true" class="anchor" id="user-content-contributing"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Contributing</h2>
<p>Please see the <a href="https://facebook.github.io/watchman/contributing.html" rel="nofollow">contributing guide</a>.</p>
</article>
  </div>


  </div>
  <div class="modal-backdrop js-touch-events"></div>
</div>

    </div>
  </div>

  </div>

      
<div class="footer container-lg px-3" role="contentinfo">
  <div class="position-relative d-flex flex-justify-between pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <ul class="list-style-none d-flex flex-wrap ">
      <li class="mr-3">© 2018 <span title="0.33966s from unicorn-1123942680-0cgr4">GitHub</span>, Inc.</li>
        <li class="mr-3"><a data-ga-click="Footer, go to terms, text:terms" href="https://github.com/site/terms">Terms</a></li>
        <li class="mr-3"><a data-ga-click="Footer, go to privacy, text:privacy" href="https://github.com/site/privacy">Privacy</a></li>
        <li class="mr-3"><a href="https://help.github.com/articles/github-security/" data-ga-click="Footer, go to security, text:security">Security</a></li>
        <li class="mr-3"><a href="https://status.github.com/" data-ga-click="Footer, go to status, text:status">Status</a></li>
        <li><a data-ga-click="Footer, go to help, text:help" href="https://help.github.com/">Help</a></li>
    </ul>

    <a aria-label="Homepage" title="GitHub" class="footer-octicon" href="https://github.com/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg>
</a>
   <ul class="list-style-none d-flex flex-wrap ">
        <li class="mr-3"><a data-ga-click="Footer, go to contact, text:contact" href="https://github.com/contact">Contact GitHub</a></li>
      <li class="mr-3"><a href="https://developer.github.com/" data-ga-click="Footer, go to api, text:api">API</a></li>
      <li class="mr-3"><a href="https://training.github.com/" data-ga-click="Footer, go to training, text:training">Training</a></li>
      <li class="mr-3"><a href="https://shop.github.com/" data-ga-click="Footer, go to shop, text:shop">Shop</a></li>
        <li class="mr-3"><a data-ga-click="Footer, go to blog, text:blog" href="https://github.com/blog">Blog</a></li>
        <li><a data-ga-click="Footer, go to about, text:about" href="https://github.com/about">About</a></li>

    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>
</div>



  <div id="ajax-error-message" class="ajax-error-message flash flash-error">
    <svg class="octicon octicon-alert" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8.865 1.52c-.18-.31-.51-.5-.87-.5s-.69.19-.87.5L.275 13.5c-.18.31-.18.69 0 1 .19.31.52.5.87.5h13.7c.36 0 .69-.19.86-.5.17-.31.18-.69.01-1L8.865 1.52zM8.995 13h-2v-2h2v2zm0-3h-2V6h2v4z"></path></svg>
    <button type="button" class="flash-close js-ajax-error-dismiss" aria-label="Dismiss error">
      <svg class="octicon octicon-x" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.48 8l3.75 3.75-1.48 1.48L6 9.48l-3.75 3.75-1.48-1.48L4.52 8 .77 4.25l1.48-1.48L6 6.52l3.75-3.75 1.48 1.48z"></path></svg>
    </button>
    You can't perform that action at this time.
  </div>


    <script crossorigin="anonymous" integrity="sha512-gEAdDZ4LgyEE51A6EiCI5F8hC2pELVwJzk9fcRYT6JKNg92wpQhso4uD1rML8kTVE8FFW4G1hKIm+eWgX+D5/g==" type="application/javascript" src="compat-432e5bb0f7cc942dbf63a7c74de5da3c.js"></script>
    <script crossorigin="anonymous" integrity="sha512-bDFUXMGHFddte8PoN8CW5xNr/0w/9Zrfsjun90gr7lJdc7w5+NLGNrJHTPFeaZa5ph1MzSTQg7fqTg/CI95fSw==" type="application/javascript" src="frameworks-c566e2adb34ea4706cec5d285e57dd1d.js"></script>
    
    <script crossorigin="anonymous" async="async" integrity="sha512-QKerAmbi8RFAfjUvkdjUZNeOk7x3IoYJhiCCTJbn/v17op8fggb0zxJw0denloKM0lPiHUKs2iE4+nUMj+Q7Yw==" type="application/javascript" src="github-12f0557a92f0fb40861429376cb054d5.js"></script>
    
    
    
    
  <div class="js-stale-session-flash stale-session-flash flash flash-warn flash-banner d-none">
    <svg class="octicon octicon-alert" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8.865 1.52c-.18-.31-.51-.5-.87-.5s-.69.19-.87.5L.275 13.5c-.18.31-.18.69 0 1 .19.31.52.5.87.5h13.7c.36 0 .69-.19.86-.5.17-.31.18-.69.01-1L8.865 1.52zM8.995 13h-2v-2h2v2zm0-3h-2V6h2v4z"></path></svg>
    <span class="signed-in-tab-flash">You signed in with another tab or window. <a href="">Reload</a> to refresh your session.</span>
    <span class="signed-out-tab-flash">You signed out in another tab or window. <a href="">Reload</a> to refresh your session.</span>
  </div>
  <div class="facebox" id="facebox" style="display:none;">
  <div class="facebox-popup">
    <div class="facebox-content" role="dialog" aria-labelledby="facebox-header" aria-describedby="facebox-description">
    </div>
    <button type="button" class="facebox-close js-facebox-close" aria-label="Close modal">
      <svg class="octicon octicon-x" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.48 8l3.75 3.75-1.48 1.48L6 9.48l-3.75 3.75-1.48-1.48L4.52 8 .77 4.25l1.48-1.48L6 6.52l3.75-3.75 1.48 1.48z"></path></svg>
    </button>
  </div>
</div>

  <div class="Popover js-hovercard-content position-absolute" style="display: none; outline: none;" tabindex="0">
  <div class="Popover-message Popover-message--bottom-left Popover-message--large Box box-shadow-large" style="width:360px;">
  </div>
</div>

<div id="hovercard-aria-description" class="sr-only">
  Press h to open a hovercard with more details.
</div>


  


</body></html>