<html style="min-height: 100%;"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link type="text/css" media="all" href="autoptimize_c144b6bd71dc810fc483a3b5a161a368.css" rel="stylesheet"><title>Facemark : Facial Landmark Detection using OpenCV | Learn OpenCV</title><link rel="author" href="https://plus.google.com/+SatyaMallick"><meta name="description" content="Tutorial for OpenCV's Facemark API that implements three different algorithms for Facial Landmark Detection - FacemarkAAM, FacemarkKazemi and FacemarkLBF. Code is shared for real-time facial landmark detection"><meta name="keywords" content="face alignment,facemark,facemarkaam,facemarkkazemi,facemarklbf,facial landmark detection"><link rel="canonical" href="https://www.learnopencv.com/facemark-facial-landmark-detection-using-opencv/"><link rel="amphtml" href="https://www.learnopencv.com/facemark-facial-landmark-detection-using-opencv/amp/"><link rel="dns-prefetch" href="https://fonts.googleapis.com/"><link rel="dns-prefetch" href="https://maxcdn.bootstrapcdn.com/"><link rel="dns-prefetch" href="https://s.w.org/"><link rel="alternate" type="application/rss+xml" title="Learn OpenCV » Feed" href="https://www.learnopencv.com/feed/"><link rel="alternate" type="application/rss+xml" title="Learn OpenCV » Comments Feed" href="https://www.learnopencv.com/comments/feed/"><link rel="alternate" type="application/rss+xml" title="Learn OpenCV » Facemark : Facial Landmark Detection using OpenCV Comments Feed" href="https://www.learnopencv.com/facemark-facial-landmark-detection-using-opencv/feed/"> <script type="text/javascript" async="" src="analytics.js"></script><script async="" src="fbevents.js"></script><script type="text/javascript" async="" src="analytics.js"></script><script async="" src="fbevents.js"></script><script type="text/javascript">window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/www.learnopencv.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);</script><script src="wp-emoji-release.js" type="text/javascript" defer="defer"></script><script src="wp-emoji-release.js" type="text/javascript" defer="defer"></script> <link rel="stylesheet" id="google-fonts-css" href="css.css" type="text/css" media="all"><link rel="stylesheet" id="dashicons-css" href="dashicons.css" type="text/css" media="all"><link rel="stylesheet" id="font-awesome-css" href="font-awesome.css" type="text/css" media="all"> <script>if (document.location.protocol != "https:") {document.location = document.URL.replace(/^http:/i, "https:");}</script><script type="text/javascript" src="jquery.js"></script> <!--[if lt IE 9]> <script type='text/javascript' src='https://www.learnopencv.com/wp-content/themes/genesis/lib/js/html5shiv.min.js?ver=3.7.3'></script> <![endif]--><link rel="https://api.w.org/" href="https://www.learnopencv.com/wp-json/"><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.learnopencv.com/xmlrpc.php?rsd"><link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.learnopencv.com/wp-includes/wlwmanifest.xml"><link rel="prev" title="Image Alignment (Feature Based) using OpenCV (C++/Python)" href="https://www.learnopencv.com/image-alignment-feature-based-using-opencv-c-python/"><link rel="next" title="CV4Faces : Best Project Award 2018" href="https://www.learnopencv.com/cv4faces-best-project-award-2018/"><link rel="shortlink" href="https://www.learnopencv.com/?p=7542"><link rel="alternate" type="application/json+oembed" href="https://www.learnopencv.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.learnopencv.com%2Ffacemark-facial-landmark-detection-using-opencv%2F"><link rel="alternate" type="text/xml+oembed" href="https://www.learnopencv.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.learnopencv.com%2Ffacemark-facial-landmark-detection-using-opencv%2F&amp;format=xml">  <script async="" src="js"></script> <script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments)};
  gtag('js', new Date());

  gtag('config', 'UA-50426860-2');</script>  <script>!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '193036094536652'); // Insert your pixel ID here.
fbq('track', 'PageView');</script> <noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=193036094536652&ev=PageView&noscript=1"
/></noscript><link rel="pingback" href="https://www.learnopencv.com/xmlrpc.php"><link rel="icon" href="https://www.learnopencv.com/wp-content/uploads/2017/04/cropped-favicon-512x512-32x32.png" sizes="32x32"><link rel="icon" href="https://www.learnopencv.com/wp-content/uploads/2017/04/cropped-favicon-512x512-192x192.png" sizes="192x192"><link rel="apple-touch-icon-precomposed" href="https://www.learnopencv.com/wp-content/uploads/2017/04/cropped-favicon-512x512-180x180.png"><meta name="msapplication-TileImage" content="https://www.learnopencv.com/wp-content/uploads/2017/04/cropped-favicon-512x512-270x270.png"><script src="can-i-show.js"></script><link rel="stylesheet" type="text/css" href="shCore.css"><link rel="stylesheet" type="text/css" href="shThemeDefault.css"><script async="" type="text/javascript" src="count.js"></script><script type="text/javascript" async="" src="embed.js"></script><script src="can-i-show.js"></script><link rel="stylesheet" type="text/css" href="shCore.css"><link rel="stylesheet" type="text/css" href="shThemeDefault.css"></head><body data-rsssl="1" class="post-template-default single single-post postid-7542 single-format-standard header-full-width content-sidebar" itemscope="" itemtype="https://schema.org/WebPage"><div class="site-container"><ul class="genesis-skip-link"><li><a href="#genesis-nav-primary" class="screen-reader-shortcut"> Skip to primary navigation</a></li><li><a href="#genesis-content" class="screen-reader-shortcut"> Skip to content</a></li><li><a href="#genesis-sidebar-primary" class="screen-reader-shortcut"> Skip to primary sidebar</a></li></ul><header class="site-header shrink fadeup-effect fadeInUp" itemscope="" itemtype="https://schema.org/WPHeader"><div class="wrap"><div class="title-area"><p class="site-title" itemprop="headline"><a href="https://www.learnopencv.com/">Learn OpenCV</a></p><p class="site-description" itemprop="description">OpenCV examples and tutorials ( C++ / Python )</p></div><nav class="nav-primary" aria-label="Main" itemscope="" itemtype="https://schema.org/SiteNavigationElement" id="genesis-nav-primary"><div class="wrap"><div class="responsive-menu-icon"></div><ul id="menu-top-bar" class="menu genesis-nav-menu menu-primary js-superfish responsive-menu sf-js-enabled sf-arrows" style="touch-action: pan-y;"><li id="menu-item-754" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-754"><a href="https://www.learnopencv.com/" itemprop="url"><span itemprop="name">Home</span></a></li><li id="menu-item-753" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-753"><a href="https://www.learnopencv.com/about/" itemprop="url"><span itemprop="name">About</span></a></li><li id="menu-item-859" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-859"><a href="https://www.learnopencv.com/computer-vision-resources" itemprop="url"><span itemprop="name">Resources</span></a></li><li id="menu-item-4009" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4009"><a href="https://www.learnopencv.com/computer-vision-machine-learning-artificial-intelligence-consulting/" itemprop="url"><span itemprop="name">AI Consulting</span></a></li><li id="menu-item-4153" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4153"><a href="http://courses.learnopencv.com/" itemprop="url"><span itemprop="name">Courses</span></a></li></ul></div></nav></div></header><div class="site-inner"><div class="content-sidebar-wrap"><main class="content" id="genesis-content"><article class="post-7542 post type-post status-publish format-standard has-post-thumbnail category-face category-how-to category-tutorial tag-face-alignment tag-facemark tag-facemarkaam tag-facemarkkazemi tag-facemarklbf tag-facial-landmark-detection entry" itemscope="" itemtype="https://schema.org/CreativeWork"><header class="entry-header"><h1 class="entry-title" itemprop="headline">Facemark : Facial Landmark Detection using OpenCV</h1><p class="entry-meta"><time class="entry-time" itemprop="datePublished" datetime="2018-03-19T07:49:17+00:00">March 19, 2018</time> By <span class="entry-author" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><a href="https://www.learnopencv.com/author/spmallick/" class="entry-author-link" itemprop="url" rel="author"><span class="entry-author-name" itemprop="name">Satya Mallick</span></a></span> <span class="entry-comments-link"><a href="https://www.learnopencv.com/facemark-facial-landmark-detection-using-opencv/#disqus_thread" data-disqus-identifier="7542 https://www.learnopencv.com/?p=7542"><span class="dsq-postid" data-dsqidentifier="7542 https://www.learnopencv.com/?p=7542">1 Comment</span></a></span></p></header><div class="entry-content" itemprop="text"><p><a href="https://www.learnopencv.com/wp-content/uploads/2018/03/OpenCV-Facemark.jpg"><img src="OpenCV-Facemark.jpg" alt="OpenCV Facemark : Facial Landmark Detection" class="aligncenter size-full wp-image-7575" srcset="https://www.learnopencv.com/wp-content/uploads/2018/03/OpenCV-Facemark.jpg 600w, https://www.learnopencv.com/wp-content/uploads/2018/03/OpenCV-Facemark-300x200.jpg 300w" sizes="(max-width: 600px) 100vw, 600px" width="600" height="400"></a></p><p>In this tutorial, we will learn about facial landmark detection using OpenCV with no external dependencies.</p><p>I have written several posts about <a href="https://www.learnopencv.com/facial-landmark-detection" target="_blank">Facial Landmark Detection</a> and its applications. You can use landmark detection for <a href="https://www.learnopencv.com/face-morph-using-opencv-cpp-python" target="_blank">face morphing</a>, <a href="https://www.learnopencv.com/average-face-opencv-c-python-tutorial" target="_blank">face averaging</a> and <a href="https://www.learnopencv.com/face-swap-using-opencv-c-python" target="_blank">face swapping</a>.
 Until now, we had used the landmark detection that comes with Dlib. It 
works great, but wouldn’t it be nice if we did not have to depend on any
 external library.</p><p>Well, the wait is over. Almost!</p><p>OpenCV 
now supports several algorithms for landmark detection natively. 
However, the implementation needs some more work before it is ready for 
two reasons</p><ol><li> <strong>Python support</strong>: It appears that there is still no python support yet as of OpenCV 3.4</li><li> <strong>Lack of trained models</strong>:
 Out of the three algorithms implemented for landmark detection, I could
 find only one trained model that works. This is not very hard to fix. 
In the worst case, we will try our own model and make it available for 
people to use.</li></ol><p>Because of the two limitations above, this post will be updated a few times in the next few months.</p><h2>Facemark API</h2><p>OpenCV’s facial landmark API is called <strong>Facemark</strong>. It has three different implementations of landmark detection based on three different papers</p><ol><li><a href="https://docs.opencv.org/trunk/dc/de0/classcv_1_1face_1_1FacemarkKazemi.html">FacemarkKazemi</a>: This implementation is based on a paper titled <a href="http://www.csc.kth.se/%7Evahidk/face_ert.html" target="_blank">“One Millisecond Face Alignment with an Ensemble of Regression Trees”</a> by V.Kazemi and J. Sullivan published in CVPR 2014. An alternative implementation of this algorithm can be found in <a href="http://dlib.net/">DLIB</a></li><li><a href="https://docs.opencv.org/trunk/d5/d7b/classcv_1_1face_1_1FacemarkAAM.html">FacemarkAAM</a>: This implementation uses an Active Appearance Model (AAM) and is based on an the paper titled <a href="https://ibug.doc.ic.ac.uk/media/uploads/documents/tzimiro_pantic_iccv2013.pdf" rel="noopener" target="_blank">“Optimization problems for fast AAM fitting in-the-wild”</a> by G. Tzimiropoulos and M. Pantic, published in ICCV 2013.</li><li> <a href="https://docs.opencv.org/trunk/dc/d63/classcv_1_1face_1_1FacemarkLBF.html">FacemarkLBF</a>: This implementation is based a paper titled <a href="http://www.jiansun.org/papers/CVPR14_FaceAlignment.pdf">“Face alignment at 3000 fps via regressing local binary features”</a> by S. Ren published in CVPR 2014.</li></ol><p>The
 three implementations follow similar patterns even though, at the time 
of writing this post, the FacemarkKazemi class does not seem to be 
derived from the base Facemark class, while the other two are.</p><h2> Facemark trained models</h2><p>Even
 though the Facemark API consists of three different implementations, a 
trained model is available for only FacemarkLBF. This post will be 
updated in future after we train our own model based on public datasets.</p><p>You can download the trained model from</p><ol><li> <a href="https://github.com/kurnianggoro/GSOC2017/blob/master/data/lbfmodel.yaml">lbfmodel.yaml</a>.</li><li> <a href="https://github.com/spmallick/GSOC2017/blob/master/data/lbfmodel.yaml">lbfmodel.yaml (Forked Repo)</a> ( in case the above link is taken down ).</li></ol><h2>Real-time facial landmark detection using OpenCV code</h2><p>In
 this section, we will share the code for real-time facial landmark 
detection. This post will be updated when Python bindings are supported 
for the Facemark API.</p><p>The <a href="#cpp-code">code</a> is shared <a href="#cpp-code">here</a>. You can also download the code using the link below.</p><div class="download-code"> <strong> Download Code</strong><br> To easily follow along this tutorial, please download code by clicking on the button below. It’s FREE!<p></p><div style="text-align: center;"><a class="button small loblue" style="text-decoration: none;" href="https://bigvisionllc.leadpages.net/leadbox/143948b73f72a2%3A173c9390c346dc/5649050225344512/" target="_blank" rel="noopener" data-leadbox="https://bigvisionllc.leadpages.net/leadbox/143948b73f72a2%3A173c9390c346dc/5649050225344512/" data-leadbox-id="143948b73f72a2:173c9390c346dc">Download Code </a></div></div><p>The steps involved in calling the Facemark API for real-time landmark detection are listed with references to the <a href="#cpp-code">code</a> below.</p><ol><li> <strong>Load face detector</strong>:
 All facial landmark detection algorithms take as input a cropped facial
 image. Therefore, our first step is to detect all faces in the image, 
and pass those face rectangles to the landmark detector. We load 
OpenCV’s HAAR face detector (haarcascade_frontalface_alt2.xml) in <strong>line 14</strong>.</li><li> <strong>Create Facemark Instance</strong> : In <strong>line 17</strong>
 we create an instance of the Facemark class. It is wrapped inside 
OpenCV smart pointer (PTR) so you do not have to worry about memory 
management.</li><li> <strong>Load landmark detector</strong>: Next, we load the landmark detector (lbfmodel.yaml) in <strong>line 20</strong>.
 This landmark detector was trained on a few thousand images of facial 
images and corresponding landmarks. Public datasets of facial images 
with annotated landmarks can be found <a href="https://ibug.doc.ic.ac.uk/resources/facial-point-annotations/">here</a>.</li><li> <strong>Capture frames from webcam</strong>: The next step is to grab a video frame and process it. <strong>Line 23</strong>
 sets up the video capture from the webcam connected to your machine. 
You can change it to read a video file instead by replacing line 23 with
 the code below.<p></p><div><div id="highlighter_735314" class="syntaxhighlighter  cpp"><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">VideoCapture cap(</code><code class="cpp string">"myvideo.mp4"</code><code class="cpp plain">); </code></div></div></td></tr></tbody></table></div></div><p>We then continuously grab frames from the video (<strong> line 29 </strong> ) until ESC is pressed ( <strong> line 62 </strong> ).</p></li><li> <strong>Detect faces</strong>: We run the face detector on every frame of the video in <strong>lines 33-39</strong>. The output of a face detector is a vector of rectangles that contain one or more faces in the image.</li><li><strong>Run facial landmark detector</strong>: We pass the original image and the detected face rectangles to the facial landmark detector in <strong>line 48</strong>.
 For every face, we get 68 landmarks which are stored in a vector of 
points. Because there can be multiple faces in a frame, we have to pass a
 vector of vector of points to store the landmarks ( see <strong>line 45</strong> ).</li><li><strong>Draw landmarks</strong>: Once we have obtained the landmarks, we can draw them on the frame for display. The code for drawing is inside <strong>drawLandmarks.hpp</strong> and is not shared here to keep things clean.</li></ol><h3 id="cpp-code"> C++ code for OpenCV Facemark</h3><div><div id="highlighter_655470" class="syntaxhighlighter  cpp"><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp preprocessor">#include &lt;opencv2/opencv.hpp&gt;</code></div><div class="line number2 index1 alt1"><code class="cpp preprocessor">#include &lt;opencv2/face.hpp&gt;</code></div><div class="line number3 index2 alt2"><code class="cpp preprocessor">#include "drawLandmarks.hpp"</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="cpp keyword bold">using</code> <code class="cpp keyword bold">namespace</code> <code class="cpp plain">std;</code></div><div class="line number7 index6 alt2"><code class="cpp keyword bold">using</code> <code class="cpp keyword bold">namespace</code> <code class="cpp plain">cv;</code></div><div class="line number8 index7 alt1"><code class="cpp keyword bold">using</code> <code class="cpp keyword bold">namespace</code> <code class="cpp plain">cv::face;</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="cpp color1 bold">int</code> <code class="cpp plain">main(</code><code class="cpp color1 bold">int</code> <code class="cpp plain">argc,</code><code class="cpp color1 bold">char</code><code class="cpp plain">** argv)</code></div><div class="line number12 index11 alt1"><code class="cpp plain">{</code></div><div class="line number13 index12 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// Load Face Detector</code></div><div class="line number14 index13 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">CascadeClassifier faceDetector(</code><code class="cpp string">"haarcascade_frontalface_alt2.xml"</code><code class="cpp plain">);</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// Create an instance of Facemark</code></div><div class="line number17 index16 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">Ptr&lt;Facemark&gt; facemark = FacemarkLBF::create();</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// Load landmark detector</code></div><div class="line number20 index19 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">facemark-&gt;loadModel(</code><code class="cpp string">"lbfmodel.yaml"</code><code class="cpp plain">);</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// Set up webcam for video capture</code></div><div class="line number23 index22 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">VideoCapture cam(0);</code></div><div class="line number24 index23 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number25 index24 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// Variable to store a video frame and its grayscale </code></div><div class="line number26 index25 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">Mat frame, gray;</code></div><div class="line number27 index26 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number28 index27 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// Read a frame</code></div><div class="line number29 index28 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">while</code><code class="cpp plain">(cam.read(frame))</code></div><div class="line number30 index29 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">{</code></div><div class="line number31 index30 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number32 index31 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// Find face</code></div><div class="line number33 index32 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">vector&lt;Rect&gt; faces;</code></div><div class="line number34 index33 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// Convert frame to grayscale because</code></div><div class="line number35 index34 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// faceDetector requires grayscale image.</code></div><div class="line number36 index35 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">cvtColor(frame, gray, COLOR_BGR2GRAY);</code></div><div class="line number37 index36 alt2">&nbsp;</div><div class="line number38 index37 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// Detect faces</code></div><div class="line number39 index38 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">faceDetector.detectMultiScale(gray, faces);</code></div><div class="line number40 index39 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number41 index40 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// Variable for landmarks. </code></div><div class="line number42 index41 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// Landmarks for one face is a vector of points</code></div><div class="line number43 index42 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// There can be more than one face in the image. Hence, we </code></div><div class="line number44 index43 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// use a vector of vector of points. </code></div><div class="line number45 index44 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">vector&lt; vector&lt;Point2f&gt; &gt; landmarks;</code></div><div class="line number46 index45 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number47 index46 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// Run landmark detector</code></div><div class="line number48 index47 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">bool</code> <code class="cpp plain">success = facemark-&gt;fit(frame,faces,landmarks);</code></div><div class="line number49 index48 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number50 index49 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code><code class="cpp plain">(success)</code></div><div class="line number51 index50 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">{</code></div><div class="line number52 index51 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// If successful, render the landmarks on the face</code></div><div class="line number53 index52 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">for</code><code class="cpp plain">(</code><code class="cpp color1 bold">int</code> <code class="cpp plain">i = 0; i &lt; landmarks.size(); i++)</code></div><div class="line number54 index53 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">{</code></div><div class="line number55 index54 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">drawLandmarks(frame, landmarks[i]);</code></div><div class="line number56 index55 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number57 index56 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number58 index57 alt1">&nbsp;</div><div class="line number59 index58 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// Display results </code></div><div class="line number60 index59 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">imshow(</code><code class="cpp string">"Facial Landmark Detection"</code><code class="cpp plain">, frame);</code></div><div class="line number61 index60 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// Exit loop if ESC is pressed</code></div><div class="line number62 index61 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">(waitKey(1) == 27) </code><code class="cpp keyword bold">break</code><code class="cpp plain">;</code></div><div class="line number63 index62 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number64 index63 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number65 index64 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">return</code> <code class="cpp plain">0;</code></div><div class="line number66 index65 alt1"><code class="cpp plain">}</code></div></div></td></tr></tbody></table></div></div><h2> Facemark Demo</h2><p>Here is a video demo of the above code.</p><div class="video-container"> <iframe src="https://www.youtube.com/embed/9XXIJ1EQwMc?feature=oembed" allow="autoplay; encrypted-media" allowfullscreen="" width="500" frameborder="0" height="281"></iframe></div><h2 id="download">Subscribe &amp; Download Code</h2><p>If you liked this article and would like to download code (C++ and Python) and example images used in this post, please <a href="https://bigvisionllc.leadpages.net/leadbox/143948b73f72a2%3A173c9390c346dc/5649050225344512/" target="_blank" data-leadbox="https://bigvisionllc.leadpages.net/leadbox/143948b73f72a2%3A173c9390c346dc/5649050225344512/" data-leadbox-id="143948b73f72a2:173c9390c346dc">subscribe</a> to our newsletter. You will also receive a free <a href="https://bigvisionllc.leadpages.net/leadbox/143948b73f72a2%3A173c9390c346dc/5649050225344512/" target="_blank" data-leadbox="https://bigvisionllc.leadpages.net/leadbox/143948b73f72a2%3A173c9390c346dc/5649050225344512/" data-leadbox-id="143948b73f72a2:173c9390c346dc">Computer Vision Resource</a>
 Guide. In our newsletter, we share OpenCV tutorials and examples 
written in C++/Python, and Computer Vision and Machine Learning 
algorithms and news.</p><p><a style="color: #ffffff; text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.247059) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.498039) 0px 1px 3px inset, rgba(0, 0, 0, 0.498039) 0px 1px 3px; background: #00aadd;" href="https://bigvisionllc.leadpages.net/leadbox/143948b73f72a2%3A173c9390c346dc/5649050225344512/" target="_blank" data-leadbox="https://bigvisionllc.leadpages.net/leadbox/143948b73f72a2%3A173c9390c346dc/5649050225344512/" data-leadbox-id="143948b73f72a2:173c9390c346dc">Subscribe Now</a></p></div><footer class="entry-footer"><p class="entry-meta"><span class="entry-categories">Filed Under: <a href="https://www.learnopencv.com/category/face/" rel="category tag">Face</a>, <a href="https://www.learnopencv.com/category/how-to/" rel="category tag">how-to</a>, <a href="https://www.learnopencv.com/category/tutorial/" rel="category tag">Tutorial</a></span> <span class="entry-tags">Tagged With: <a href="https://www.learnopencv.com/tag/face-alignment/" rel="tag">face alignment</a>, <a href="https://www.learnopencv.com/tag/facemark/" rel="tag">facemark</a>, <a href="https://www.learnopencv.com/tag/facemarkaam/" rel="tag">FacemarkAAM</a>, <a href="https://www.learnopencv.com/tag/facemarkkazemi/" rel="tag">FacemarkKazemi</a>, <a href="https://www.learnopencv.com/tag/facemarklbf/" rel="tag">FacemarkLBF</a>, <a href="https://www.learnopencv.com/tag/facial-landmark-detection/" rel="tag">facial landmark detection</a></span></p></footer></article><div id="disqus_thread"></div></main><aside class="sidebar sidebar-primary widget-area" role="complementary" aria-label="Primary Sidebar" itemscope="" itemtype="https://schema.org/WPSideBar" id="genesis-sidebar-primary"><section id="search-5" class="widget widget_search"><div class="widget-wrap"><form class="search-form" itemprop="potentialAction" itemscope="" itemtype="https://schema.org/SearchAction" method="get" action="https://www.learnopencv.com/" role="search"><meta itemprop="target" content="https://www.learnopencv.com/?s={s}"><label class="search-form-label screen-reader-text" for="searchform-5b846bf25041b8.49814602">Search this website</label><input itemprop="query-input" name="s" id="searchform-5b846bf25041b8.49814602" placeholder="Search this website …" type="search"><input value="Search" type="submit"></form></div></section><section id="custom_html-9" class="widget_text widget widget_custom_html"><div class="widget_text widget-wrap"><h4 class="widget-title widgettitle">Join Course</h4><div class="textwidget custom-html-widget"><a href="https://courses.learnopencv.com/p/computer-vision-for-faces"> <img alt="Computer Vision for Faces" src="computer-vision-for-faces.png"> </a></div></div></section><section id="custom_html-7" class="widget_text widget widget_custom_html"><div class="widget_text widget-wrap"><h4 class="widget-title widgettitle">Resources</h4><div class="textwidget custom-html-widget"><a href="https://bigvisionllc.lpages.co/leadbox/143044973f72a2%3A173c9390c346dc/5720147234914304/" target="_blank" style="background: #4FAEFD; color: rgb(255, 255, 255); text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: 
rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" data-leadbox="https://bigvisionllc.lpages.co/leadbox/143044973f72a2%3A173c9390c346dc/5720147234914304/" data-leadbox-id="143044973f72a2:173c9390c346dc">Download Code (C++ / Python)</a></div></div></section><section id="text-8" class="widget widget_text"><div class="widget-wrap"><h4 class="widget-title widgettitle">Disclaimer</h4><div class="textwidget"><p>This site is not affiliated with OpenCV.org</p></div></div></section><section id="user-profile-4" class="widget user-profile"><div class="widget-wrap"><p><span class="alignleft"><img alt="" src="708995cd13fb5756f6bc418aecb23b78.jpg" srcset="https://secure.gravatar.com/avatar/708995cd13fb5756f6bc418aecb23b78?s=250&amp;d=mm&amp;r=g 2x" class="avatar avatar-125 photo" width="125" height="125"></span>I
 am an entrepreneur with a love for Computer Vision and Machine Learning
 with a dozen years of experience (and a Ph.D.) in the field.</p><p>In 
2007, right after finishing my Ph.D.,  I co-founded TAAZ Inc. with my 
advisor Dr. David Kriegman and Kevin Barnes. The scalability, and 
robustness of our computer vision and machine learning algorithms have 
been put to rigorous test by more than 100M users who have tried our 
products. <a class="pagelink" href="https://www.learnopencv.com/about/">Read More…</a></p></div></section><section id="recent-posts-6" class="widget widget_recent_entries"><div class="widget-wrap"><h4 class="widget-title widgettitle">Recent Posts</h4><ul><li> <a href="https://www.learnopencv.com/deep-learning-based-object-detection-using-yolov3-with-opencv-python-c/">Deep Learning based Object Detection using YOLOv3 with OpenCV ( Python / C++ )</a></li><li> <a href="https://www.learnopencv.com/convex-hull-using-opencv-in-python-and-c/">Convex Hull using OpenCV in Python and C++</a></li><li> <a href="https://www.learnopencv.com/multitracker-multiple-object-tracking-using-opencv-c-python/">MultiTracker : Multiple Object Tracking using OpenCV (C++/Python)</a></li><li> <a href="https://www.learnopencv.com/convolutional-neural-network-based-image-colorization-using-opencv/">Convolutional Neural Network based Image Colorization using OpenCV</a></li><li> <a href="https://www.learnopencv.com/svm-using-scikit-learn-in-python/">SVM using Scikit-Learn in Python</a></li></ul></div></section></aside></div></div><footer class="site-footer" itemscope="" itemtype="https://schema.org/WPFooter"><div class="wrap"><nav class="nav-footer"></nav><p>Copyright ©&nbsp;2018 · Big Vision LLC</p></div></footer></div><script data-leadbox="143948b73f72a2:173c9390c346dc" data-url="https://bigvisionllc.lpages.co/leadbox/143948b73f72a2%3A173c9390c346dc/5649050225344512/" data-config="%7B%7D" type="text/javascript" src="leadbox-1497023128.js"></script><script>if (document.location.protocol != "https:") {document.location = document.URL.replace(/^http:/i, "https:");}</script><script type="text/javascript" src="shCore.js"></script> <script type="text/javascript" src="shBrushCpp.js"></script> <script type="text/javascript">(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "https://www.learnopencv.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "https://www.learnopencv.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();</script> <script type="text/javascript">var countVars = {"disqusShortname":"learnopencv"};</script> <script type="text/javascript">var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.16"},"disqusIdentifier":"7542 https:\/\/www.learnopencv.com\/?p=7542","disqusShortname":"learnopencv","disqusTitle":"Facemark : Facial Landmark Detection using OpenCV","disqusUrl":"https:\/\/www.learnopencv.com\/facemark-facial-landmark-detection-using-opencv\/","postId":"7542"};</script> <script type="text/javascript" defer="defer" src="autoptimize_723c71a9c267f271bca8f64b359dea62.js"></script>



<div style="position: absolute; right: 0px; left: 0px; bottom: 0px; top: 0px; z-index: 2147483646; background: black none repeat scroll 0% 0%; width: 100%; opacity: 0.5; display: none; height: 7484px;"></div><iframe src="https://bigvisionllc.leadpages.net/leadbox/143948b73f72a2%3A173c9390c346dc/5649050225344512/?lp-in-iframe=1&amp;__fromjs=1" style="position: absolute; left: 0px; top: 0px; width: 100%; display: none; border: medium none; z-index: 2147483647; height: 947px;"></iframe><iframe src="https://bigvisionllc.lpages.co/leadbox/143044973f72a2%3A173c9390c346dc/5720147234914304/?lp-in-iframe=1&amp;__fromjs=1" style="position: absolute; left: 0px; top: 0px; width: 100%; display: none; border: medium none; z-index: 2147483647; height: 947px;"></iframe><iframe src="https://bigvisionllc.lpages.co/leadbox/143948b73f72a2%3A173c9390c346dc/5649050225344512/?lp-in-iframe=1&amp;__fromjs=1" style="position: absolute; left: 0px; top: 0px; width: 100%; display: none; border: medium none; z-index: 2147483647; height: 947px;"></iframe><div style="position: absolute; right: 0px; left: 0px; bottom: 0px; top: 0px; z-index: 2147483646; background: black none repeat scroll 0% 0%; width: 100%; opacity: 0.5; display: none; height: 6320px;"></div><iframe src="https://bigvisionllc.leadpages.net/leadbox/143948b73f72a2%3A173c9390c346dc/5649050225344512/?lp-in-iframe=1&amp;__fromjs=1" style="position: absolute; left: 0px; top: 0px; width: 100%; display: none; border: medium none; z-index: 2147483647; height: 1055px;"></iframe><iframe src="https://bigvisionllc.lpages.co/leadbox/143044973f72a2%3A173c9390c346dc/5720147234914304/?lp-in-iframe=1&amp;__fromjs=1" style="position: absolute; left: 0px; top: 0px; width: 100%; display: none; border: medium none; z-index: 2147483647; height: 1055px;"></iframe><iframe src="https://bigvisionllc.lpages.co/leadbox/143948b73f72a2%3A173c9390c346dc/5649050225344512/?lp-in-iframe=1&amp;__fromjs=1" style="position: absolute; left: 0px; top: 0px; width: 100%; display: none; border: medium none; z-index: 2147483647; height: 1055px;"></iframe></body></html>