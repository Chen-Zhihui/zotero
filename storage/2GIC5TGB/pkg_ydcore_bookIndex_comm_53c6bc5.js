define("ydcore:widget/book_index/packbooks/packbooks.js",function(t,a,o){var i={};i.lang=t("ydcommon:widget/ui/lib/lang/lang.js");var e=t("ydcommon:widget/ui/lib/jquery/jquery.js"),c=t("ydcommon:widget/ui/js_core/util/util.js"),d=t("ydcommon:widget/ui/js_core/mvp/template/template.js").template,n=t("ydcommon:widget/ui/js_core/log/log.js"),r=(t("ydcommon:widget/ui/lib/browser/browser.js"),t("ydcommon:widget/ui/pay/cashier/cashier.js")),s=t("ydcommon:widget/ui/read/yui/dialog/dialog.js");packBooks=i.lang.createClass(function(t){var a=this;
a.docId=t.docId,a.tplId=t.tplId,a.opt=t,a.url=t.url||"/coupon/interface/unpackbooks?doc_id=#{docId}",a.init()}).extend({init:function(){{var t=this;t.getData().done(e.proxy(t.verify,t))}},getData:function(){var t=this,a=t.url.replace(/#{(\w+)}/g,function(a,o){return t.opt[o]});return a=a+"&t="+(new Date).getTime(),e.getJSON(a)},verify:function(t){var a=this;if(0===t.status.code&&t.data.data.length){var o=t.data.data[0].doc_id;a.render(t.data),n.xsend(2,200023,{doc_id:o})}},render:function(t){if(t){var a=this,o=e("#pack-tpl").html();
e("#pack-mod-holder").after(e(d(o,{data:t,util:c}))),a.bindEvent(t)}},bindEvent:function(t){var a=this,o=t.count;a.chooseBook(t),o>4&&a.controlBar(t),a.payBook(t),e(".doc-pack .packBooks").on("click",function(t){t.preventDefault();var a=e(this).attr("href");e.ajax({url:a,cache:!1,async:!1,dataType:"json"}).done(function(t){t.status&&0===+t.status.code?new r(t.data):s.alert({width:350,content:t.status.msg||"\u8d2d\u4e70\u5f53\u4e2d\u53d1\u751f\u672a\u77e5\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u8bd5",onClose:function(){window.location.reload(!0)
}})})})},controlBar:function(t){e(".open-pack").on("click",function(){var a=e(".control-txt").html(),o=t.count,i=o-1,c=t.data[0].doc_id;"\u6536\u8d77"==a?(e(".main-list").css("height","210px"),e(".main-list").css("overflow","hidden"),e(".main-list").css("zoom","2"),e(".main-list").css("zoom","1"),e(".control-txt").html('\u5c55\u5f00\u5168\u90e8<span class="control-num">'+i+"</span>\u672c\u56fe\u4e66"),e(".control-icon").removeClass("control-pack").addClass("control-open"),n.xsend(2,200295,{doc_id:c})):(e(".main-list").css("height","auto"),e(".main-list").css("overflow","visible"),e(".main-list").css("zoom","2"),e(".main-list").css("zoom","1"),e(".control-txt").html("\u6536\u8d77"),e(".control-icon").removeClass("control-open").addClass("control-pack"),n.xsend(2,200294,{doc_id:c}));
var d=e(".packbooks-title").offset().top;e("body, html").animate({scrollTop:d},400)})},getSum:function(t,a,o){var i,c,d,n,r,s,l,u=e(".default-item"),m=e(".original-price"),p=e(".save-price"),h=e(".pack-btn b"),f=e(".total-discount"),k=e(".book-num"),b=e(".discount-wrap"),y=e(".pack-way"),g=e(".pack-btn"),v=e(".pay-area .pay-btn"),x=e(".pay-area-title"),w=v.attr("data-query"),_=v.attr("data-sign"),j=e(".default-item").attr("init-id");i=Number(u.attr("init-price")),defaultConPrice=Number(u.attr("confirm-price")),packPrice=Number(u.attr("discount-price")),c=Math.ceil(o>1?packPrice:defaultConPrice),e(".book-item-picarea .sale-price").html((c/100).toFixed(2)),d=((i+t)/100).toFixed(2),n=((c+a)/100).toFixed(2),r=(d-n).toFixed(2),o>1?(s=(n/d*10).toFixed(1),f.html(s+"<span class='discount-txt'>\u6298</span>")):f.html(""),h.html(n),m.html(d),p.html(r),k.html(o),1==o?(b.hide(),h.html((defaultConPrice/100).toFixed(2)),m.html((i/100).toFixed(2)),p.html(((i/100).toFixed(2)-(defaultConPrice/100).toFixed(2)).toFixed(2)),y.html("\u8d2d\u4e70"),x.html("\u5355\u672c\u4f18\u60e0\u4ef7"),l="//yuedu.baidu.com/coupon/interface/bookwallet?id="+j+"&goods_type=3",e(".pay-btn").attr("href",l),g.removeClass("packBooks")):(b.show(),y.html("\u7ec4\u5408\u8d2d\u4e70"),x.html("\u7ec4\u5408\u4f18\u60e0\u4ef7"),l="//yuedu.baidu.com/coupon/interface/balewallet?id="+j+"&idlist="+w+"&sign="+_,e(".pay-btn").attr("href",l),g.hasClass("packBooks")||g.addClass("packBooks"))
},chooseBook:function(t){var a=this,o=t.data,i=(o.length,e(".choice-item")),c=e(".doc-pack .pay-btn"),d=Number(o[1].price),r=2;if(idList=o[1].doc_id,defaultId=o[0].doc_id,o[1].discount/10<=.7)var s=Number(o[1].confirm_price);else var s=.7*Number(o[1].price);var l=Math.ceil(s);e.each(i,function(t,o){e(o).on("click",function(){var t=e(o),i=Number(t.attr("data-price")),s=Number(t.attr("data-discount"))/10,u=Number(t.attr("data-confirmprice")),m=t.attr("data-id");_discountPrice=.7>=s?u:Math.ceil(.7*i),t.hasClass("checked")?(r--,t.removeClass("checked"),d-=i,l-=_discountPrice,a.getSum(d,l,r),a.deleteId(m),c.attr("data-query",idList),n.xsend(2,200293,{doc_id:defaultId})):(r++,t.addClass("checked"),d+=i,l+=_discountPrice,a.getSum(d,l,r),idList=idList?idList+","+m:m,c.attr("data-query",idList),n.xsend(2,200292,{doc_id:defaultId})),a.getSum(d,l,r)
})}),a.getSum(d,l,r)},deleteId:function(t){for(var a=idList.split(","),o=0;o<a.length;o++)t==a[o]&&a.splice(o,1);idList=a.join(",");var i=e(".doc-pack .pay-btn"),c=i.attr("data-sign"),t=e(".default-item").attr("init-id");i.attr("data-query",idList);var d=e(".pay-area-title");if("\u7ec4\u5408\u4f18\u60e0\u4ef7"==d.html()){var n="//yuedu.baidu.com/coupon/browse/buybale?id="+t+"&idlist="+idList+"&sign="+c+"&dqStatCode=31_23_43_65_66";e(".pay-btn").attr("href",n)}},payBook:function(t){var a=t.data[0].doc_id;
e(".pay-btn").on("click",function(){n.xsend(2,200024,{doc_id:a})})}}),o.exports.packBooks=packBooks});
;define("ydcore:widget/book_index/book_comment_merge/book_comment_merge.js",function(e,t,n){var o=e("ydcommon:widget/ui/lib/jquery/jquery.js"),r=e("ydcommon:widget/ui/js_core/widget/widget.js").widget,a=e("ydcommon:widget/lib/fis/data/data.js"),i=e("ydcommon:widget/ui/js_core/mvp/template/template.js"),c=e("ydcommon:widget/ui/lib/string/string.js"),l=e("ydcommon:widget/ui/lib/value/value.js"),s=e("ydcommon:widget/ui/js_core/login/login.js").login,d=e("ydcommon:widget/ui/js_core/log/log.js"),m=e("ydcommon:widget/ui/read/yui/pager/pager.js"),p=e("ydcommon:widget/ui/read/yui/dialog/dialog.js"),u=(e("ydcommon:widget/ui/js_core/dropDown/dropDown.js"),e("ydcore:widget/ui/vcode/vcode.js")),f=document.getElementById("comment-list-area").innerHTML,y=function(e){return e.replace(/\n/g,"<br>")
},h=r({_default:{el:"",pageEl:"",doc_id:"",pn:1,rn:10,total:0,sort:0,isSelf:0,type:3,author_uid:"",userImg:"",uname:"",is_followed:0,onFirstRender:function(){},onRender:function(){},autoRender:!0,commentType:""},_vsearchApi:"/vsearch/interface/getreview",_commentApi:"/customer/api/bookcomment",_init:function(e){var t=this;t._initDom(),e.yuedu_count&&e.other_count?(e.commentType="mix",t.$filter.show()):e.yuedu_count&&!e.other_count?(e.commentType="yuedu",t.$sort.show(),t.$filter.hide()):!e.yuedu_count&&e.other_count?(e.commentType="other",t.$sort.hide(),t.$filter.hide()):e.yuedu_count||e.other_count||t.$el.find(".comment-title-text").hide().parent().hide(),t.options=o.extend({},t._default,e),t._sortAction(),t._filterAction(),t._initEvent(),t._initPage(),t._isRender=!1,t.fire("init"),t.options.autoRender&&t.render()
},_initDom:function(){var e=this;e.el=o(e.options.el),e.pageEl=o(e.options.pageEl),e.$sort=e.options.$sort,e.$filter=e.options.$filter},_sortAction:function(){var e=this;e.$sort.find(".sort-by").click(function(t){t.preventDefault();var n=o(t.currentTarget),r=n.data("index");e.$sort.find(".sort-by").removeClass("current"),n.addClass("current"),e.render({pn:1,sort:r},function(){},!0)})},_filterAction:function(){var e=this;e.$filter.on("click",".filter-item",function(t){if(t.preventDefault(),$target=o(t.currentTarget),!$target.hasClass("current")){e.$filter.find(".filter-item").removeClass("current"),$target.addClass("current");
var n={};n.pn=1,n.rn=e.options.rn,n.commentType=$target.data("type"),"mix"==$target.data("type")?(n.total=e.options.total_count,e.$sort.hide()):"yuedu"==$target.data("type")?(n.total=e.options.yuedu_count,e.$sort.show()):"other"==$target.data("type")&&(n.total=e.options.other_count,e.$sort.hide()),e.$el.find(".comment-title-text").html("\u5171\u6709"+n.total+"\u6761\u8bc4\u8bba"),e.render(n)}})},_initEvent:function(){var e=this;e.$el.on("click",".comment-tab-control-item a",function(e){e.preventDefault()
}),u.register(o.proxy(e._changeVcode,e)),e.el.on("click",".j_comment-open",function(e){var t=o(e.currentTarget);t.parents("li.comment-list-item").addClass("show-comment-all")}),e.el.on("click",".j_comment-close",function(e){var t=o(e.currentTarget);t.parents("li.comment-list-item").removeClass("show-comment-all")}),e.el.on("mouseover",".j_comment-like",function(e){var t=o(e.currentTarget);t.hasClass("liked")||t.addClass("hovered")}),e.el.on("mouseout",".j_comment-like",function(e){var t=o(e.currentTarget);
t.removeClass("hovered")}),e.el.on("click",".j_comment-like",function(t){var n=o(t.currentTarget),r=n.data("id"),a=n.find(".like-num"),i=n.parent().find(".comment-like-error"),c=o("#token").text()||0;t.preventDefault(),n.hasClass("liked")||(d.xsend(2,200028),s.verlogin(function(){o.ajax({url:e._commentApi,cache:!1,dataType:"json",data:{act:"up",doc_id:e.options.doc_id,reply_id:r,type:e.options.type,token:c},success:function(e){var t=e.data.status;t?i.hasClass("showerror")||(i.addClass("showerror").fadeIn("fast"),setTimeout(function(){i.fadeOut("fast",function(){i.removeClass("showerror")
})},2e3)):(d.xsend(2,"200059"),n.addClass("liked"),a.html(parseInt(a.html())+1))}})}))}),e.el.on("click",".reply-content .follow-status",function(t){var n=o(t.currentTarget);e._handlerFollow(n)}),e.el.on("click",".comment-list-item .delete-comment",function(t){var n=o(t.currentTarget);p.confirm({content:"\u786e\u5b9a\u5220\u9664\u8be5\u8bc4\u8bba\u561b\uff1f",width:"376",height:"185",buttons:[{text:"\u786e\u8ba4",className:"yui-btn yui-btn-green",click:function(t,o){e._handlerDelReply(n),o.close()
}},{text:"\u53d6\u6d88",className:"yui-btn yui-btn-white3",click:function(e,t){t.close()}}]})}),e.el.on("click",".comment-list-item .btn-reply",function(t){{var n=o(t.currentTarget),r=n.children(".reply-change").html(),a=n.children(".reply-num").html(),i=n.parent().next(),c=n.parent().next().find(".reply-content");n.data("uname"),n.data("id")}e._handlerReply(n),u.refresh(),e._afterReplyShow(n);var l=0,s=n.parent().parent().find(".reply-items");if("\u56de\u590d"==r){if(i.css("display","block"),a||c.css("border-bottom","none"),a>5){for(var d=0;3>d;d++){var m=o(s[d]).find(".reply-title").outerHeight(!0),p=o(s[d]).find(".reply-content-txt").outerHeight(!0),f=o(s[d]).find(".reply-ft").outerHeight(!0);
totalheight=m+p+f+22,l+=totalheight}c.css("height",l),c.css("overflow","hidden"),c.css("border-bottom","none"),i.find(".show-all-reply").css("display","block"),n.parent().next().find(".reply-vcode-area").css("zoom","2"),n.parent().next().find(".reply-vcode-area").css("zoom","1")}n.children(".reply-change").html("\u6536\u8d77\u56de\u590d")}else"\u6536\u8d77\u56de\u590d"==r&&(n.children(".reply-change").html("\u56de\u590d"),n.parent().next().find(".reply-vcode-area").css("display","none"),i.css("display","none"),o(".comment-list").css("zoom","2"),o(".comment-list").css("zoom","1"))
}),e.el.on("click",".reply-comment-wrap .show-all-reply",function(e){var t=o(e.currentTarget),n=t.parent().find(".reply-content");n.css("overflow"," visible"),n.css("height","auto"),n.css("zoom","2"),n.css("zoom","1"),t.next().find(".reply-vcode-area").css("zoom","2"),t.next().find(".reply-vcode-area").css("zoom","1"),t.css("display","none")}),e.el.on("mouseenter",".comment-list-item .reply-items",function(e){o(e.currentTarget)}),e.el.on("mouseleave",".comment-list-item .reply-items",function(e){o(e.currentTarget)
}),e.el.on("click",".comment-list-item .reply-items .btn-subreply",function(e){var t=o(e.currentTarget),n=t.parents(".reply-comment-wrap");n.find(".show-all").trigger("click");var r=n.find(".reply-items"),a=o(r).filter(":last").offset().top-200;o("body, html").animate({scrollTop:a},400);var i=t.data("uname"),c=t.data("id"),l=t.parent().parent().parent().parent().find(".inputarea"),n=t.parent().parent().parent();l.prev().html('<span class="reply-to">\u56de\u590d</span>'+i+":");var s=l.prev().width()+10;
l.css("padding-left",s);var d=535-s;l.css("width",d),l.next().attr("data-replyid",c)}),e.el.on("keydown",".comment-list-item .reply-textarea .inputarea",function(e){var t=o(e.currentTarget),e=e||event,n=e.keyCode||e.which||e.charCode;8==n&&(t.val()||(t.prev().html(""),t.css("padding-left","0"),t.css("width","535"),t.next().attr("data-replyid","")))}),e.el.on("click",".comment-list-item .reply-textarea .do-reply-btn",function(t){var n=o(t.currentTarget);e._handlerSendMsg(n)}),e.el.on("mouseover",".comment-list-item .reply-content .reply-items",function(e){var t=o(e.currentTarget);
t.children(".delete-reply").css("visibility","visible")}),e.el.on("mouseout",".comment-list-item .reply-content .reply-items",function(e){var t=o(e.currentTarget);t.children(".delete-reply").css("visibility","hidden")}),e.el.on("click",".comment-list-item .reply-content .delete-reply",function(t){var n=o(t.currentTarget);p.confirm({content:"\u786e\u5b9a\u5220\u9664\u8be5\u56de\u590d\u561b\uff1f",width:"376",height:"185",buttons:[{text:"\u786e\u8ba4",className:"yui-btn yui-btn-green",click:function(t,o){e._handlerDelReply(n),o.close()
}},{text:"\u53d6\u6d88",className:"yui-btn yui-btn-white3",click:function(e,t){t.close()}}]})}),e.el.on("click",".reply-textarea .inputarea",function(e){e.preventDefault();var t=o(e.currentTarget);t.parent().find(".reply-vcode-area").css("display","block"),t.parent().find(".reply-vcode-area").css("zoom","2"),t.parent().find(".reply-vcode-area").css("zoom","1"),o(".comment-list").css("zoom","2"),o(".comment-list").css("zoom","1")}),e.el.on("click",".reply-vcode-area .change-testcode-tip",function(e){e.preventDefault();
o(e.currentTarget);u.refresh()}),e.el.on("click",".reply-vcode-area .change-testcode-area",function(e){e.preventDefault();o(e.currentTarget);u.refresh()})},_initPage:function(){var e=this;e.pager=m.pagerCreate({el:e.pageEl[0],total:Math.ceil(e.options.total/e.options.rn),onclick:function(t,n){"current"!=n&&(o(window).scrollTop(e.el.offset().top-90),e.render({pn:t}))}}),e.pager.show()},_getCommentData:function(e){var t=this,n=t.options;o.ajax({url:t._commentApi,type:"get",cache:!1,dataType:"json",data:{act:"get",doc_id:n.doc_id,pn:(n.pn-1)*n.rn,type:n.type,rn:n.rn,sort:n.sort},success:function(t){t.data&&e(t.data)
}})},_getInterData:function(){var e=this,t=e.options,n=(t.pn-1)*t.rn+1,r=((t.pn-1)*t.rn+t.rn,t.yuedu_count),a=o.Deferred();return"other"!=t.commentType&&0!=r&&r>=n?o.ajax({url:e._commentApi,type:"get",dataType:"json",cache:!1,data:{act:"get",doc_id:t.doc_id,type:t.type,pn:(t.pn-1)*t.rn,rn:t.rn,sort:t.sort}}).then(function(e){a.resolve(e.data&&e.data.comment?e.data:{comment:[]})}):a.resolve({comment:[]}),a},_getVsearchData:function(){var e=this,t=e.options,n=((t.pn-1)*t.rn+1,(t.pn-1)*t.rn+t.rn),r=t.other_count,a=o.Deferred();
if("yuedu"!=t.commentType&&0!=r&&t.gid&&("other"==t.commentType||n>t.yuedu_count)){if("mix"==t.commentType)var i=(t.pn-1)*t.rn-t.yuedu_count;else var i=(t.pn-1)*t.rn;o.ajax({url:e._vsearchApi,type:"get",dataType:"json",cache:!1,data:{act:"get",id:t.gid,pn:i>=0?i:0,rn:t.rn,sort:t.sort,yd:1}}).then(function(e){a.resolve(e.data&&e.data.comment?e.data:{comment:[]})})}else a.resolve({comment:[]});return a.promise()},render:function(e,t,n){var r=this;o.extend(r.options,e||{}),r.options.total>0?(r.pager.show({current:r.options.pn,total:Math.ceil(r.options.total/r.options.rn)}),o.when(r._getInterData(),r._getVsearchData()).then(function(e,a){var s,d={comment:[]};
o.merge(o.merge(d.comment,e.comment),a.comment),r._isRender||(r._isRender=!0,r.options.onFirstRender(d),r.fire("firstRender",d)),s=i.template(f,{comment:d.comment||[],cut:c.cut,value:l,n2br:y,isSelf:r.options.isSelf,userImg:r.options.userImg,uname:r.options.uname,is_followed:r.options.is_followed,author_uid:r.options.author_uid,getHeadImgUrl:r._getHeadImgUrl,commentType:r.options.commentType,util:{encodeHTML:c.encodeHTML}}),n?(r.el.css("opacity",0),r.el.get(0).innerHTML=s,r.el.animate({opacity:1},500)):r.el.get(0).innerHTML=s,o(".comment-list-item .open-reply").trigger("click"),r.options.onRender(d),t&&t(d)
})):r.el.html('<div class="no-comment">\u6682\u65e0\u8bc4\u8bba</div>')},_handlerFollow:function(e){var t=this;e.hasClass("followed")||s.verlogin(function(){o.ajax({url:"/user/api/followauthor",data:{author_id:t.options.author_uid,act:"follow"}}).done(function(e){(0==e.data.follow_status||3==e.data.follow_status)&&(t.options.is_followed=!0,o(".reply-content .follow-status").addClass("followed").html("\u5df2\u5173\u6ce8"))})})},_handlerReply:function(e){var t=this,n=e.parent().next();t._initTextarea(),n.hasClass("reply-comment-show-textarea")?n.removeClass("reply-comment-show-textarea"):n.addClass("reply-comment-show-textarea")
},_initTextarea:function(e){o(".inputarea",e).val(""),o(".reply-textarea-ft",e).css("display","none")},_afterReplyShow:function(e){var t=e.parent().next().find(".reply-vcode-area"),n=t.find(".reply-vcode"),r=t.find(".testcode-placeholder");n.focus(function(){r.hide()}),r.click(function(){n.focus()}),n.blur(function(){""==o.trim(o(this).val())&&r.show()})},_changeVcode:function(e){var t=o(".merge-comment .js-comment-vcode-img");0==e.status&&t.attr({src:__http2https(e.url)})},_handlerSendMsg:function(e){var t=this;
contentEl=e.prev(),reply_id=e.data("id"),sub_reply_id=e.data("replyid"),replycontent=e.parent().parent().find(".reply-content"),vcode=e.parent().find(".reply-vcode").val(),err=e.parent().find(".num-err-tips"),content=contentEl.val();var n=e.parent().parent().prev().find(".btn-reply"),r=a.get("isLogin");r?t._varify(content,e)&&o.ajax({url:t._commentApi,data:{act:"reply",type:t.options.type,doc_id:t.options.doc_id,content:content,reply_id:reply_id,sub_reply_id:sub_reply_id,vcode:vcode},type:"post",dataType:"json",cache:!1}).done(function(r){r.data&&0==r.data.status?(e.parent().find(".num-err-tips").html(""),d.xsend(2,"200058"),t.render({pn:1},function(){for(var e=o(".comment-list-item"),n=0;n<e.length;n++){var r=o(e[n]).find(".do-reply-btn").attr("data-id"),a=o(e[n]).find(".btn-reply");
if(r==reply_id){o(e[n]).find(".reply-comment-wrap").css("display","block");var i=o(e[n]).find(".reply-items");if(i.length>0){var c=o(i).filter(":last").offset().top-200;o(e[n]).find(".show-all").trigger("click"),o("body, html").animate({scrollTop:c},400)}else t._handlerReply(a),u.refresh(),t._afterReplyShow(a);break}}}),e.prev().val("")):(r.data&&3==r.data.status?e.parent().find(".num-err-tips").html("\u9a8c\u8bc1\u7801\u9519\u8bef"):t.showError(e.next().find(".error-tip"),"default"),t._afterReplyShow(n),u.refresh())
}).fail(function(){t.showError(e.next().find(".error-tip"),"default"),t._afterReplyShow(n),u.refresh()}):s.verlogin(function(){window.location.reload(!0)})},showError:function(e,t){var n={less:"\u6b63\u6587\u5fc5\u987b\u5927\u4e8e\u7b49\u4e8e5\u4e2a\u5b57\u7b26",more:"\u6b63\u6587\u957f\u5ea6\u8d85\u51fa1000\u4e2a\u5b57\u7b26","default":"\u56de\u590d\u5931\u8d25"};e.parent().css("display","block"),e.parent().next().css("zoom","2"),e.parent().next().css("zoom","1"),e.html(n[t])},_getDate:function(){var e=new Date;
return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()},_varify:function(e,t){var n=this,o=t.next().find(".error-tip");return e.length<5?(n.showError(o,"less"),!1):e.length>1e3?(n.showError(o,"more"),!1):(t.next().css("display","none"),!0)},_handlerDelReply:function(e){{var t=this,n=e.data("id"),r=e.data("token")||0,a=e.parent().parent();a.parent()}o.ajax({url:t._commentApi,data:{act:"del",doc_id:t.options.doc_id,reply_id:n,type:t.options.type,comment_token:r},dataType:"json",cache:!1}).done(function(e){e.data&&0==e.data.status&&window.location.reload()
})},_getHeadImgUrl:function(e){var t=parseInt(3*Math.random()),n={head0:"//wkstatic.bdimg.com/static/ydcore/widget/book_index/book_comment_merge/images/head0_d936a37.png",head1:"//wkstatic.bdimg.com/static/ydcore/widget/book_index/book_comment_merge/images/head1_cb8480c.png",head2:"//wkstatic.bdimg.com/static/ydcore/widget/book_index/book_comment_merge/images/head2_104ea0a.png"};return"number"==typeof e?e=n["head"+e]:e||(e=n["head"+t]),e}},{type:"MergeComment"});n.exports=h});
;define("ydcore:widget/book_index/comment/comment.js",function(t,o,n){var r=t("ydcommon:widget/ui/lib/jquery/jquery.js"),e=t("ydcommon:widget/ui/js_core/log/log.js"),i=t("ydcommon:widget/ui/js_core/login/login.js").login,c=t("ydcommon:widget/lib/fis/data/data.js"),s=function(){this._init.apply(this,arguments)};s.prototype={_options:{success:function(){},error:function(){}},_error:{defaults:"\u8bc4\u8bba\u5931\u8d25",no_score:"\u8bf7\u9009\u62e9\u8bc4\u5206",no_title:"\u8bf7\u586b\u5199\u6807\u9898",title_to_long:"\u6807\u9898\u957f\u5ea6\u8fc7\u957f\uff0c\u8d85\u51fa30\u4e2a\u5b57\u7b26",no_content:"\u8bf7\u586b\u5199\u6b63\u6587",content_to_short:"\u6b63\u6587\u5fc5\u987b\u5927\u4e8e5\u4e2a\u5b57",content_to_long:"\u6b63\u6587\u957f\u5ea6\u8d85\u51fa6000\u4e2a\u5b57\u7b26",vcode_length_error:"\u9a8c\u8bc1\u7801\u6709\u8bef\uff0c\u8bf7\u8f93\u5165\u6b63\u786e\u76844\u4f4d\u9a8c\u8bc1\u7801"},_getError:function(t){return this._error[t]?this._error[t]:this._error.defaults
},_init:function(){r(".not-login-tips").on("click",function(t){t.preventDefault(),i.verlogin(function(){window.location.reload(!0)})})},_varify:[function(t){var o=c.get("ispaied");return 1!=o||t.score?void 0:this._getError("no_score")},function(t){return t.title&&t.title.length>30?this._getError("title_to_long"):void 0},function(t){return t.content?void 0:this._getError("no_content")},function(t){return t.content&&t.content.length<5?this._getError("content_to_short"):void 0},function(t){return t.content&&t.content.length>6e3?this._getError("content_to_long"):void 0
},function(t){return 4!==t.vcode.length?this._getError("vcode_length_error"):void 0}],_varifyData:function(t){var o,n,r=this,e=0;if(!t)return r._getError();for(o=0;o<this._varify.length&&(n=this._varify[o],!(e=n.call(this,t)));o++);return e},submitComment:function(t){var o,n,s=this,a=c.get("isLogin");a?(t=r.extend({},this._options,t),o=r.extend({},t.data),n=s._varifyData(o),n?t.error(n,0):r.ajax({url:"/customer/api/bookcomment?act=add&t="+ +new Date,data:o,type:"post",dataType:"json",success:function(o){e.xsend(2,"200057"),o.data&&0==o.data.status?t.success():o.data&&3==o.data.status?(t.error("\u9a8c\u8bc1\u7801\u6709\u8bef\uff0c\u8bf7\u8f93\u5165\u6b63\u786e\u76844\u4f4d\u9a8c\u8bc1\u7801",1),r(".comment-vcode-img").trigger("click"),r(".comment-vcode-input").val("")):o.data&&4==o.data.status?t.error("\u8bc4\u8bba\u5185\u5bb9\u6d89\u5acc\u654f\u611f\u4fe1\u606f\uff0c\u8bf7\u4fee\u6539\u540e\u53d1\u5e03",1):t.error(s._getError(),1)
},error:function(){t.error(s._getError(),1)}})):i.verlogin(function(){window.location.reload(!0)})}},n.exports=new s});
;define("ydcore:widget/ui/scaling/scaling.js",function(e,n,t){var i=e("ydcommon:widget/ui/lib/jquery/jquery.js"),s=function(e){var n=i(e),t=n.children(".scaling-more-btn"),s=n.children(".scaling-content");if(!(n.length<=0||s.length<=0)){var c=s.height(),l=i(".expand",t),a=s.get(0).scrollHeight,o=function(){var e=!1;return function(n){e=n=n||!e,e?(i(".text",l).html("\u6536\u8d77"),l.removeClass("expand"),l.addClass("close"),s.css({height:a})):(i(".text",l).html("\u67e5\u770b\u5168\u90e8"),l.removeClass("close"),l.addClass("expand"),s.css({height:c}))
}}();a>c?(t.show(),t.parents(".scaling-content-wp").parent().removeClass("mb20"),i(".text",l).html("\u67e5\u770b\u5168\u90e8"),l.unbind("click").on("click",function(){o()})):(t.hide(),s.height("auto"))}};t.exports.scaling=t.exports.setScaling=s});
;define("ydcore:widget/ui/bdjson_preload/bdjson_preload.js",function(e){function o(){var e=this,o=new Date;if(!e.isPreview){var i=o.getMinutes(),t=5*Math.floor(i/5);o.setMinutes(t),o.setSeconds(0),o.setMilliseconds(0)}return Number(o.getTime()/1e3)}var i=e("ydcommon:widget/ui/lib/jquery/jquery.js"),t=e("ydcommon:widget/ui/js_core/preload/preload.js"),n=e("ydcommon:widget/lib/fis/data/data.js");i(window).load(function(){setTimeout(function(){var e="json",d=n.get("bdjsonUrl")||"",r=Number(n.get("ispaied")||0),s=o(),a=n.get("curPage")||0;
if(d&&a){var u=d+"&"+["type="+e,"cn="+a,"_="+(r?1:0),"t="+s,"callback=wenku"+a].join("&");t.preload(u,i.noop)}},100)})});