SNS.define(["sns/widget/like.css"],function(){var t=KISSY,i=t.DOM,n=t.Event,e="//t.taobao.com/cooperate/publish_favor.do",s={likes:[],KEY:"ZAN_27_{favor_type}_{favor_target_key}",KEY2:"ZAN_27_{favor_type}:{favor_sub_type}_{favor_target_key}",URI:"//count.taobao.com/counter3",generateRequestKey:function(i,n,e){var s=3;switch(n){case"webpage":s=3;break;case"shop":s=2;break;case"item":s=4}return arguments[2]?t.substitute(this.KEY2,{favor_target_key:i,favor_type:n,favor_sub_type:e}):t.substitute(this.KEY,{favor_target_key:i,favor_type:n})},initCount:function(i,n){var e=this,o=i.configs.favor_target_key||i.configs.key,a=i.configs.type;!i.configs.type&&i.configs.appId&&(a=12235881==i.configs.appId?5:1100028==i.configs.appId?6:1100018==i.configs.appId?11:12116314==i.configs.appId?12:12052609==i.configs.appId?13:i.configs.appId);var c=this.generateRequestKey(o,a,i.configs.subType);this.likes.push({key:c,ins:i}),this._timer&&(window.clearTimeout(this._timer),this._timer=null),this._timer=window.setTimeout(function(){for(var i=[],o=[],a=0;a<e.likes.length;a++)e.likes[a].ins.getCount()||i.push(e.likes[a].key);for(var c=function(i){s.fetchDataByKeys(i,function(i){t.each(i,function(t,i){for(var n=0;n<e.likes.length;n++)if(e.likes[n].key==i&&!e.likes[n].ins.getCount()){var s=e.likes[n].ins;if(!s)return;s.setCount(t)}}),n&&n()})};i.length>=20;)o=i.splice(0,20),c(o);0!=i.length&&c(i)},100)},fetchDataByKeys:function(i,n){t.isArray(i)||(i=[Keys]),i="keys="+i.join(",");var e=this.URI+"?"+i+"&t="+t.now();SNS.isDaily()&&(e="//count.daily.taobao.net/counter3?"+i+"&t="+t.now()),t.jsonp(e,function(t){n(t)})}},o=SNS.createWidget({configs:{text:"\u559c\u6b22",element:"",name:"like",ui:{trigger:".J_Trigger",counter:".J_Counter",width:85,height:30},callback:{countSuccess:function(){},fail:function(){},success:function(){}},subType:"",skinType:1,liked:!1,type:"",comment:"\u4eb2, \u8fd9\u4e2a\u5f88\u8d5e\u54df~~~\uff01",key:location.href||window.top.location.href},_create:function(){this._simpleLike();var n=this.element;this.trigger=i.get(this.configs.ui.trigger,n),this.trigger||(this.trigger=n),this.counter=i.get(this.configs.ui.counter,n),this.configs.key&&(3===this.configs.type&&(this.configs.key=this.generateTargetKey(this.configs.key)),("true"==this.configs.liked||1==this.configs.liked)&&t.one(".sns-like-wrap",this.element).addClass("sns-like-wrap-liked"),this.isBusy=!1,this.isLiked=!1,this._bindEvent(),this._initCount())},_sendLog:function(i,n){i&&((new Image).src="//gm.mmstat.com/"+i+"?"+t.param(n)+"&cache="+t.now())},_bindEvent:function(){var t=this;n.on(t.trigger,"click",function(i){i.preventDefault(),i.isFromIsv||SNS.login(function(){t._sendRequest()},!1,!0)})},_sendRequest:function(){var i=this;if(!i.isBusy){i.isBusy=!0;var n=t.mix({},{favor_type:i.configs.type,favor_target_key:i.configs.key,favor_sub_type:i.configs.subType,favor_app_id:i.configs.appId,comment:i.configs.comment});this.configs.shareparams&&(n=t.mix(n,this.configs.shareparams)),n=t.mix(n,i._getExtendConfigs()||{}),n.shareparams&&delete n.shareparams;var s=SNS.normalize(e+"?_input_charset=utf-8");SNS.ajax({url:s,data:n,type:"post",use:"jsonp",success:function(t){var n=t.status,e=t.result.content;i.isBusy=!1,1!=n&&e?i._trigger("fail",{code:t.result.code,status:n,msg:e}):t&&"-1"===n?SNS.login(function(){},!0,!0):(i.getCount()?i.setCount(i.getCount()+1):i._initCount(),i.isLiked=!0,i._trigger("success",{status:n,msg:e}))}})}},generateTargetKey:function(t){function i(t){var i=-2147483648;return t>i||i>t?t&=4294967295:t}for(var n=0,e=0,s=t.length;s>e;e++)n=31*n+t.charCodeAt(e),n=i(n);return n},setCount:function(t){var i=this;this.countValue=t,this.counter&&(this.counter.innerHTML=this._formatLikeCount(t)),i.configs.callback&&i.configs.callback.countSuccess&&i.configs.callback.countSuccess(t)},getCount:function(){return this.countValue},_formatLikeCount:function(t){return t>9999&&(t=parseInt(t/1e4),t>99&&(t=99),t+="\u4e07+"),t},_initCount:function(t){s.initCount(this,t)},_initSM:function(){window.UA_Opt&&window.ua||(window.ua="",window.UA_Opt={LogVal:"ua",MaxMCLog:2,MaxMPLog:2,MaxKSLog:2,Token:(new Date).getTime()+":"+Math.random(),SendMethod:8,Flag:14222},t.getScript("//acjstb.aliyun.com/actionlog/js/ua.js",function(){try{UA_Opt.reload()}catch(t){}},"GBK"))},_simpleLike:function(){var e=this.element,s=this;1==this.configs.skinType?i.addClass(e,"simple-like"):2==this.configs.skinType?i.addClass(e,"common-like"):i.addClass(e,"simple-like"),this.configs.type||this.configs.appId||(this.configs.type=3);var o='<div class="sns-like-wrap">   <a title="\u6211\u7684\u6dd8\u5b9d\uff0c\u5927\u5bb6\u4e00\u8d77\u8d5e\uff01" class="dig-button J_Trigger">       <span class="dig-icon"><s class="J_Icon"></s></span>       <span class="dig-button-title">'+s.configs.text+'</span>   </a>   <span class="dig-count">       <i class="c">(</i>       <span class="J_Counter">0</span>       <i class="c">)</i>   </span>   <div class="tb-dig-tip hide">       <div class="tip-content"></div>       <s class="arrow"></s>   </div></div>';i.html(e,o);var a=i.get(".tb-dig-tip",e),c=i.get(".tip-content",a);s.tipManager={tipContainer:a,tipContent:c,timer:null,isTipShowing:function(){return!i.hasClass(this.tipContainer,"hide")},show:function(){function e(){o.timer&&o.timer.cancel&&o.timer.cancel()}function s(){o.timer=t.later(function(){o.hide()},3e3,!1)}var o=this;e(),!o.isTipShowing()&&i.removeClass(o.tipContainer,"hide"),s(),n.on(o.tipContainer,"mouseover",e),n.on(o.tipContainer,"mouseout",function(t){var n=t.relatedTarget;i.contains(o.tipContainer,n)||s()})},hide:function(){this.isTipShowing()&&i.addClass(this.tipContainer,"hide")},setTipContent:function(t){this.tipContent.innerHTML=t}};var r=s.configs.callback.success,u=s.configs.callback.fail;s.configs.callback.success=function(n){icon=i.get(".J_Icon",e),Anim=t.Anim,Anim(icon,{marginTop:"1px"},.1,"easeOut",function(){Anim(icon,{marginTop:"3px"},.1,"easeIn",function(){Anim(icon,{marginTop:"1px"},.1,"easeOut",function(){t.one(".sns-like-wrap",s.element).addClass("sns-like-wrap-liked")}).run()}).run()}).run(),r&&r(n)},s.configs.callback.fail=function(i){if(window!=window.top&&"/go/act/sns/ui.php"===location.pathname)SNS.alert(i.msg);else{"-6"===i.code&&t.one(".sns-like-wrap",s.element).addClass("sns-like-wrap-liked");var n=s.tipManager;n.setTipContent(i.msg),n.show(),u&&u(i)}}},_defaultLike:function(){var t=this.element;i.addClass(t,"default-like");var n='<a title="\u6211\u7684\u6dd8\u5b9d\uff0c\u5927\u5bb6\u4e00\u8d77\u8d5e\uff01" class="J_Trigger"><span class="sns-like-title">\u8d5e</span></a><span class="J_Counter"> - </span>';t.innerHTML=n},_getExtendConfigs:function(){var t={};for(var i in this.configs)void 0===o.prototype.configs[i]&&(t[i]=this.configs[i]);return t}});return o});