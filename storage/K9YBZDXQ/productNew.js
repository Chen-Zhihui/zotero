define("ddbase",["jquery","underscore"],function(a,b){var c=c||{};return c.header_trim=function(a){return a.replace(/(\s*$)|(^\s*)/g,"")},c.getCookie=function(a){var b,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?decodeURIComponent(escape(b[2])):null},c.token=function(){var a=c.getCookie("sessionID");return null===a&&(a=""),a},c.setCookie=function(a,b,c,d){var e=new Date;e.setTime(e.getTime()+60*c*60*1e3),document.cookie=d?a+"="+escape(b)+";Domain="+d+";path=/;expires="+e.toGMTString():a+"="+escape(b)+";Domain=dangdang.com;path=/;expires="+e.toGMTString()},c.delCookie=function(a){var b=new Date;b.setTime(b.getTime()-1);var d=c.getCookie(a);null!=d&&(document.cookie=a+"="+d+";expires="+b.toGMTString()+"; path=/;Domain=dangdang.com")},c.setData=function(a,b,d){var b=encodeURIComponent(b);if(window.localStorage){window.localStorage.setItem(a,b)}else c.setCookie(a,b,d)},c.getData=function(a){if(window.localStorage){var b=window.localStorage;return b.getItem(a)?decodeURIComponent(b.getItem(a)):null}c.getCookie(a)},c.delData=function(a){if(window.localStorage){window.localStorage.removeItem(a)}else c.delCookie(a)},c.dateFormat=function(a,b){var c=b,d=new Date(a),e={"M+":d.getMonth()+1,"d+":d.getDate(),"h+":d.getHours(),"m+":d.getMinutes(),"s+":d.getSeconds(),"q+":Math.floor((d.getMonth()+3)/3),S:d.getMilliseconds()};/(y+)/.test(c)&&(c=c.replace(RegExp.$1,(d.getFullYear()+"").substr(4-RegExp.$1.length)));for(var f in e)new RegExp("("+f+")").test(c)&&(c=c.replace(RegExp.$1,1==RegExp.$1.length?e[f]:("00"+e[f]).substr((""+e[f]).length)));return c},c.randomNumeric=function(a){for(var b="",c=a,d=0;d<c;d++)b+=Math.floor(10*Math.random());return b},c.generateGuid=function(){var a="",b=(new Date).getTime();return b=b.substring(b.length()-3,b.length()),a=c.dateFormat(new Date,"yyyyMMddHHmmss")+b+c.randomNumeric(6)+c.randomNumeric(6)+c.randomNumeric(6),a.toString()},c.getQueryString=function(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i"),c=window.location.search.substr(1).match(b);return null!=c?decodeURIComponent(c[2]):null},c.loadJsFiles=function(a,b){var c=document.createElement("script");c.setAttribute("type","text/javascript"),c.setAttribute("src",b),a.append(c)},c.UUID=function(){this.id=this.createUUID()},c.UUID.prototype={valueOf:function(){return this.id},toString:function(){return this.id},createUUID:function(){var a=this,b=new Date(1582,10,15,0,0,0,0),c=new Date,d=c.getTime()-b.getTime();return a.getIntegerBits(d,0,31)+a.getIntegerBits(d,32,47)+(a.getIntegerBits(d,48,59)+"1")+a.getIntegerBits(a.rand(4095),0,7)+a.getIntegerBits(a.rand(4095),0,7)+(a.getIntegerBits(a.rand(8191),0,7)+a.getIntegerBits(a.rand(8191),8,15)+a.getIntegerBits(a.rand(8191),0,7)+a.getIntegerBits(a.rand(8191),8,15)+a.getIntegerBits(a.rand(8191),0,15))},getIntegerBits:function(a,b,c){var d=this.returnBase(a,16),e=new Array,f="",g=0;for(g=0;g<d.length;g++)e.push(d.substring(g,g+1));for(g=Math.floor(b/4);g<=Math.floor(c/4);g++)e[g]&&""!=e[g]?f+=e[g]:f+="0";return f},returnBase:function(a,b){return a.toString(b).toUpperCase()},rand:function(a){return Math.floor(Math.random()*(a+1))}},c.getUserName=function(){var b=c.getCookie("MDD_username");return null==b&&a.ajax({method:"GET",url:"/media/api2.go?action=getUser&selfType=0&pubId=5&rewardIcon="+c.setBaseApiParams(),async:!1,success:function(a){if(0==parseInt(a.status.code)){var d=a.data.userInfo;c.setCookie("MDD_username",d.nickName,8760),c.setCookie("MDD_custId",d.pubCustId,8760),b=d.nickName}}}),b},c.getCustId=function(){return!(!c.token()||null==c.token())&&(a.ajax({method:"GET",url:"/media/api2.go?action=getUser&selfType=0&pubId=5&rewardIcon="+c.setBaseApiParams(),async:!1,success:function(a){if(0==parseInt(a.status.code)){var b=a.data.userInfo;custId=decodeURIComponent(b.pubCustId)}}}),custId)},c.setBaseApiParams=function(){var a=c.getQueryString("channelId");null==a&&(a=7e4);var b=c.getCookie("__permanent_id");return null==b&&(b=""),"&deviceSerialNo=html5&macAddr=html5&channelType=html5&permanentId="+b+"&returnType=json&channelId="+a+"&clientVersionNo=5.8.4&platformSource=DDDS-P&fromPlatform=106&deviceType=pconline&token="+c.token()},c.baseApiParams=c.setBaseApiParams(),c.template=function(a,c){return b.template(a)(c)},c.dealTime=function(a){if(void 0==a)return"";var a=parseInt(a),b=(new Date).getTime()-a;if(b>0){if(b-864e5>0){var c=new Date(a);return c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate()}var d=b/1e3;if(parseInt(d/60)<60)return parseInt(d/60)+"分钟前";var e=Math.floor(d/3600);return e+"小时"+parseInt((d-3600*e)/60)+"分钟前"}return"0分钟前"},c.newDealTime=function(a){function b(a){return 1===(a+"").length?"0"+a:a}function c(){var a=new Date;return 1e3*(3600*a.getHours()+60*a.getMinutes()+a.getSeconds())}if(!a)return"";var d=parseInt(a),a=new Date(d),e=new Date,f=e.getTime(),g=a.getFullYear(),h=e.getFullYear(),i=a.getMonth()+1,j=a.getDate(),k=a.getHours(),l=a.getMinutes();if(g<h)return b(g)+"-"+b(i)+"-"+b(j);var m=c();return f-d<m?"今天 "+b(k)+":"+b(l):f-d>m&&f-d<m+864e5?"昨天"+b(k)+":"+b(l):b(i)+"-"+b(j)},c.leaveTime=function(a){var a=parseInt(a);if(isNaN(a)||!a)return 0;var b=a-(new Date).getTime();if(b<=0)return 0;var c=864e5,d=36e5,e=6e4,f=1e3;return b>=c?parseInt(b/c)+"天":b>=d?parseInt(b/d)+"小时":b>=e?parseInt(b/e)+"分钟":b>=f?parseInt(b/f)+"秒":void 0},c.getBookUrl=function(a){var b=a.mediaType||a.bookType;if(!b)return null;var c="";switch(b){case 1:case 2:case 4:a.saleId&&a.mediaId&&(c="./products/"+a.saleId+".html");break;case 3:a.productId&&(c="http://product.dangdang.com/"+a.productId+".html")}return c},c.joinBar=function(b){a.get("/media/api.go?action=barMember"+c.baseApiParams,{actionType:b.actionType||1,barId:b.barId,custId:b.custId||""},function(a){if(0!=a.status.code&&10003!=a.status.code&&25015!=a.status.code)return void c.setMessageTip("好像发生了什么事情，稍后再试试吧~");b.callback(a)})},c.onTime=function(b){var c=a(window).scrollTop(),d=a(document).height();return c+a(window).height()+b>=d},c.dealStar=function(a){return Math.round(a)},c.login=function(){location.href="https://login.dangdang.com/signin.aspx?returnurl="+encodeURIComponent(location.href)},c.setMessageTip=function(b){var c=this;c.msgTip=a(".message-tip"),0==c.msgTip.length&&(c.msgTip=a('<div class="message-tip"></div>'),a("body").append(c.msgTip)),clearTimeout(c.msgTipTime),c.msgTip.html(b).fadeIn(1e3),c.msgTipTime=setTimeout(function(){c.msgTip.fadeOut(1e3)},2500)},c.hideMessageTip=function(){var b=this;b.msgTip=a(".message-tip"),clearTimeout(b.msgTipTime),b.msgTip.hide()},c.getHost=function(){return"http://e.dangdang.com/"},window.productPostsNum=function(){window.productDetailReturn&&window.productBarReturn&&a("#postNum").length>0&&""==a("#postNum").html()&&a("#postNum").html("("+window.productComNum+"人评论)")},window.productComNum=0,window.productDetailReturn=!1,window.productBarReturn=!1,window.nofind=function(a,b){a.src=b||"img/book_def_180_260.png",a.onerror=null},document.ondragstart=function(){return!1},c}),define("loginModule",["jquery","ddbase"],function(a,b){return function(a){if(""==b.token()){var c,d="https://login.dangdang.com/signin.aspx";c=void 0!=a&&""!=a?a:window.location.href.toString(),window.location.href=d+"?returnurl="+encodeURIComponent(c)}}}),define("praise",["jquery","ddbase","loginModule"],function(a,b,c){var d={init:function(a){var d=this;d.getData(a);var e=b.token();""==e?c():d.prasieStart(e)},getData:function(a){var b=this;b.data={url:a.url,targetId:a.targetId,targetSource:a.targetSource,el:a.el},b.data.callback=a.callback||function(){}},prasieStart:function(a){var c=this;"true"==c.data.el.attr("data-praise")?b.setMessageTip("已经赞过了哦，亲。"):c.ajaxFn("GET",c.data.url,{targetId:c.data.targetId,token:a,targetSource:c.data.targetSource},c.praiseSuc,c.praiseFail,c.data.callback)},ajaxFn:function(c,d,e,f,g,h){a.ajax({type:c,url:d+b.setBaseApiParams(),data:e,timeout:1e4,success:function(a){f(a),0===a.status.code&&h()},error:function(){g()}})},praiseSuc:function(a){var c=d,e=a.status.code;if(0===e){b.setMessageTip("点赞成功"),c.data.el.attr("data-praise","true"),c.data.el.addClass("praise_suc");var f=c.data.el.find(".praise_num");f.length>0&&f.text(parseInt(f.text())+1)}else 40010===e?b.setMessageTip("已经赞过了哦，亲。"):b.setMessageTip("点赞失败!")},praiseFail:function(){b.setMessageTip("网络出错!")}};return d}),define("bar_newmodule",["jquery","underscore","ddbase","loginWindow","praise"],function(a,b,c,d,e){var f={barId:a("#barId").val(),mediaId:a("#mediaId").val()},g=g||{};return g.template='<% _.each(data.articleList,function(item,index){ %><div class="product_barposts_module new clearfix"><div class="pic"><img src="<%=item.userBaseInfo.custImg%>" alt=""><div class="name"><%=item.userBaseInfo.nickName%></div><div class="time"><%=new Date(item.lastModifiedDateMsec).getFullYear() + "-" + (new Date(item.lastModifiedDateMsec).getMonth() + 1) + "-" +new Date(item.lastModifiedDateMsec).getDate()%></div></div><div class="desc"><div class="post_con title"><a href="http://e.dangdang.com/post_detail_page.html?barId=<%=item.barId%>&amp;digestId=<%=item.mediaDigestId%>" target="_blank"><%=item.content%></a></div><div class="community clearfix"><a href="javascript:;" class="favor <% if(parseInt(item.isPraise) == 1){ %>praise_suc<% } %>" data-praise="<% if(parseInt(item.isPraise) == 1){ %>true<% }else{ %>false<% } %>" digestid="<%=item.mediaDigestId%>"><i class="icon icon_size_20"></i><em class="praise_num"><%=item.praiseNum%></em></a><a href="http://e.dangdang.com/post_detail_page.html?barId=<%=item.barId%>&amp;digestId=<%=item.mediaDigestId%>" target="_blank" class="comment"><i class="icon icon_size_20"></i><em><%=item.commentNum%></em></a></div></div></div><% }) %><div class="product_barmore_new_module"><a href="http://e.dangdang.com/bar_detail_page.html?barId=<%=data.barInfo.barId%>" target="_blank">更多评论，去书吧逛逛&nbsp;&nbsp;&gt;&gt;</a></div>',g.init=function(){a("#ueditorIframe").val(""),a("body").delegate("#star .icon","click",function(){var b=a(this);b.prevAll().removeClass("un_selected"),b.removeClass("un_selected"),b.nextAll().addClass("un_selected")}),a("body").delegate("#warnTip,#deliverFocus","click",function(){a("#warnTip").css("display","none"),a("#ueditorIframe").focus()}),a("body").delegate(".commentBtn","click",g.postComment),a("body").delegate(".product_barposts_module .favor","click",function(a){g.favor(this)}),g.getArticleList()},g.getArticleList=function(){a.get("/media/api.go?action=queryArticleListV2"+c.baseApiParams,{objectId:f.mediaId},function(c){if(0==c.status.code){if(!c.data.articleList)return void a("#postWrap").html('<div class="empty"><img src="img/empty_discuss.jpg">写感想，找到知心书友，还会获得奖励哦！</div>');if(0==c.data.articleList.length)a("#postWrap").html('<div class="empty"><img src="img/empty_discuss.jpg">写感想，找到知心书友，还会获得奖励哦！</div>');else{var d=b.template(g.template);a("#postWrap").html(d(c))}var e=c.data.barInfo.articleNum;a(".countBar span").html("("+e+"条)"),a("#barModule #newTitle").html("累计评论("+e+"条)"),a("#leaguer").html(c.data.barInfo.memberNum+"个书友正在讨论这本书")}})},g.favor=function(b){var c=a(b),d=c.attr("digestId");e.init({url:"/media/api2.go?action=praiseComment&commentType=1&isAnonymous=1",targetId:d,targetSource:1e3,el:c})},g.postComment=function(){var b=a("#ueditorIframe").val().replace(/<br>|<p>|<\/p>|\s+|(&nbsp;)+/g,"");return c.token()?""==b?void c.setMessageTip("请填写评论内容"):(a.ajax({url:"/media/api.go?action=publishArticle"+c.setBaseApiParams(),type:"post",data:{barId:f.barId,content:b,cardType:0,actionType:"1"},success:function(b){return 10003==b.status.code?void showMsgBox("postContent","","",""):0!=b.status.code?void c.setMessageTip(b.status.message+",发帖失败，请修改后重试！"):(a("#ueditorIframe").val(""),c.setMessageTip("发帖成功"),void g.getArticleList())}}),void a.ajax({url:"/media/api.go?action=addUserStarComment"+c.setBaseApiParams(),type:"post",data:{mediaId:f.mediaId,starLevel:a("#star span").not(".un_selected").length},success:function(a){}})):void showMsgBox("postContent","","","")},g}),define("publicHeaderNav",["jquery"],function(a){return{itHover:function(){var b=a(".public_headernav_module .nav li");b.bind("mouseenter",function(){clearTimeout(c),a(this).hasClass("chubannav")||a(this).hasClass("yuanchuangnav")?(a(".chuban").css({display:"none"}),a(".yuanchuang").css({display:"none"}),a(this).hasClass("chubannav")?(a(".chuban").css({display:"block"}),a(".public_child_nav").css({display:"block"})):a(this).hasClass("yuanchuangnav")&&(a(".yuanchuang").css({display:"block"}),a(".public_child_nav").css({display:"block"}))):(a(".chuban").css({display:"none"}),a(".yuanchuang").css({display:"none"}),a(".public_child_nav").css({display:"none"}))});var c=null;b.bind("mouseleave",function(){c=setTimeout(function(){a(".chuban").css({display:"none"}),a(".yuanchuang").css({display:"none"}),a(".public_child_nav").css({display:"none"})},1e3)});var d=a(".public_headerchildnav_module");d.bind("mouseenter",function(){clearTimeout(c)}),d.bind("mouseleave",function(){a(".chuban").css({display:"none"}),a(".yuanchuang").css({display:"none"}),a(".public_child_nav").css({display:"none"})})}}}),define("publicHeaderChildnavModule",["jquery"],function(a){return{itHover:function(){a(".yuanchuang .inner a").bind("mouseenter",function(){a(".yuanchuang .inner a i").removeClass("on"),a(this).find("i").addClass("on")})}}}),define("publicSideCodeModule",["jquery"],function(a){return{toTop:function(){a(".public_totop_module, .back_to_top").on("click",function(){a(window).scrollTop(0)}),a(window).bind("scroll",function(){0===a(window).scrollTop()?a(".public_totop_module").hide():a(".public_totop_module").show()})},closeCode:function(){a(".public_sideecode_module .close").on("click",function(){a(".public_sideecode_module").css({display:"none"})})}}}),define("signOutModule",["jquery","ddbase"],function(a,b){return function(c){if(""!=b.token()){var d="/media/api2.go?action=loginOutV2"+b.setBaseApiParams();a.ajax({method:"POST",url:d,success:function(a){0==parseInt(a.status.code)&&(b.delCookie("sessionID"),b.delCookie("MDD_username"),b.delCookie("MDD_custId"),b.delCookie("login.dangdang.com"),void 0!=c&&c())}})}}}),define("headerChildNav",["jquery","ddbase"],function(a,b){return{init:function(a){var c=this;"original_index"==c.judgePage()&&("man"==b.getQueryString("originalSex")||null==b.getQueryString("originalSex")?c.initPage(a,0):"woman"==b.getQueryString("originalSex")&&c.initPage(a,1)),c.change(a)},change:function(b){a("#originLeftMenuMan").click(function(){window.location.href="original_index_page.html?originalSex=man"}),a("#originLeftMenuWoman").click(function(){window.location.href="original_index_page.html?originalSex=woman"})},clickfn:function(a,b){this.initPage(a,b)},judgePage:function(){var a=window.location.pathname,b=a.lastIndexOf("/");return a=a.substr(b+1,a.length-b),a=a.split("_page")[0]},initPage:function(b,c){for(key in b)"#focusPic"!=b[key]?(a(b[key]).find(".sexContent").hide().eq(c).show(),a(b[key]).find(".more li").hide().eq(c).show(),a(b[key]).find(".nav li").hide().eq(c).show(),a(window).scroll()):(a(b[key]).find(".sexContent").css({opacity:0,"z-index":1}).eq(c).css({opacity:1,"z-index":10}),0==c&&window.originWomanPic&&window.originManPic?(originWomanPic.timer=setTimeout(function(){window.originWomanPic.stop()},0),window.originManPic.stop(),window.originManPic.play()):1==c&&window.originWomanPic&&window.originManPic&&(originManPic.timer=setTimeout(function(){window.originManPic.stop()},0),window.originWomanPic.stop(),window.originWomanPic.play()))}}}),define("publicMethodNew",["jquery","publicHeaderNav","publicHeaderChildnavModule","publicSideCodeModule","loginModule","signOutModule","ddbase","headerChildNav"],function(a,b,c,d,e,f,g,h){var i={init:function(){b.itHover(),d.toTop(),d.closeCode(),c.itHover(),this.checkReadingCenterLogin(),this.jumpToRecharge(),this.jumpToMyShelf(),this.headerNavHover(),h.init({el1:"#originHotArticle",el2:"#originRecommend",el3:"#originLimitedFree",el4:"#originRightRecomend",el5:"#originBigAds",el6:"#hotWholeBook",el7:"#originalHotTopic",el8:"#focusPic",el9:"#rewardsListBySe",el10:"#rewardsListBySex"}),i.setHeaderImg(),a("#loginBtn").click(function(){e()}),a("#signOutBtn").on("click",function(){f(i.setLoginHtml())}),a("#headerMyOrder").on("click",function(){if(""==g.token()){var a=window.location.href;a=a.split("/"),a[a.length-1]="http://orderb.dangdang.com/myallorders.aspx",a=a.join("/"),e(a)}else window.location="http://orderb.dangdang.com/myallorders.aspx"});var j=g.getQueryString("channelId");null==j&&(j=7e4),g.setCookie("MDD_channelId",j,8760),g.setCookie("MDD_fromPlatform","307",8760),this.readcenterRedpoint()},setHeaderImg:function(){if(""!=g.token()){var b=g.getUserName(),c='<img class="header_img" src="img/payment/head_img.png">'+b;a("#loginBtn").html(c),a("#loginBtn").after('<span id="signOutBtn">[退出]</span>'),a("#registerBtn").html("")}},headerNavHover:function(){a("#bookClass,#bookClassBox").mouseout(function(){a("#bookClass .upDown").removeClass("isSlide"),a("#bookClassBox").removeClass("showMenu")}),a("#bookClass,#bookClassBox").mouseover(function(){a("#bookClass .upDown").addClass("isSlide"),a("#bookClassBox").addClass("showMenu")})},setLoginHtml:function(){a("#signOutBtn").remove(),a("#loginBtn").html("你好，请登录"),a("#registerBtn").html('<a target="_blank" href="https://login.dangdang.com/Register.aspx?returnurl=http://e.dangdang.com/">免费注册</a>|')},setProductTotalCount:function(b){parseInt(b)>0&&a(".public_headersearch_module .shopcar_num").html("("+b+")"),0==parseInt(b)&&a(".public_headersearch_module .shopcar_num").html("")},checkReadingCenterLogin:function(){a("#readingCenterBtn").on("click",function(a){if(a.preventDefault(),g.token()&&""!=g.token())window.location.href="http://e.dangdang.com/reading_center_page.html";else{var b=window.location.href;e(b)}})},jumpToRecharge:function(){a(".public_headernav_module .want_to_recharge").on("click",function(a){a.preventDefault(),g.token()&&""!=g.token()?window.location.href="http://e.dangdang.com/recharge_methord_page.html?fromPlatform=309":e()})},readcenterRedpoint:function(){var b=this;g.token()&&a.get("/media/api.go?action=getCustomerSubscription"+g.baseApiParams,{start:0,end:10},function(a){0==a.status.code&&0!=a.data.allUpdateChapter&&0!=a.data.allUpdateMedia&&(g.getCookie("showzhuigengredpointer")||b.zhuigengNotice(a.data))})},jumpToMyShelf:function(){a("#toMyBookShelf").on("click",function(a){a.preventDefault();var b="http://e.dangdang.com/booksshelf_page.html";g.token()&&""!=g.token()?window.location.href=b:e(b)})},getMedia:function(a){for(var b={},c=0;c<a.mediaList.length;c++)if(a.mediaList[c].subscriptionCount>0){b=a.mediaList[c];break}return 1==a.allUpdateMedia?'<span class="title">'+b.title+'</span>已经更新至<span class="lastChapt">'+b.lastUpdateChapter+"</span>":'<span class="title">'+b.title+"</span>等已经有了更新"},zhuigengNotice:function(b){var c=window.location.href;if(-1!=c.indexOf("index_page")||-1!=c.indexOf("publish_index_page")||-1!=c.indexOf("original_index_page.html")){var d='<div class="zhuigengNotice"><div class="title">更新通知<div class="closeBtn"></div></div><div class="content"><div>'+this.getMedia(b)+'</div><a class="gotoRead" href="booksshelf_page.html?tab=read">去书架</a></div></div>';a("body").append(d),a("body").delegate(".zhuigengNotice .closeBtn","click",function(){a(".zhuigengNotice").hide()})}}};return i}),define("indexSearch",["jquery","underscore","ddbase"],function(a,b,c){var d={data:{url:"/media/api2.go?action=searchSug&type=1&keyword=",hotWordUrl:"/media/api.go?action=block&code=search_words"},getCookieValue:function(a){if(""==a||"null"==a)return"";var b=a.split(","),c="";if(b.length>0){for(var d=0;d<b.length;d++)""==b[d]?b.splice(d,1):c+=b[d]+",";return c}return""},uniquelCookie:function(a,b){b=b.split(",");for(var c=0;c<b.length;c++)if(b[c]==a)return!0;return!1},searchBtn:function(b,e,f){if(a(".delAll").remove(),d.uniquelCookie(b,e)||(""!=e?""!=b&&b.length<15?(e=b+","+e,e=e.substring(0,e.length-1),c.setCookie("bookName",e,24,"e.dangdang.com")):c.setCookie("bookName",e,24,"e.dangdang.com"):""!=b&&b.length<15&&(e=b,c.setCookie("bookName",e,24,"e.dangdang.com"))),!f){if(""!=b){var g=a(".new_searchtext").attr("default");g!=b&&(g=b),window.open("/newsearchresult_page.html?keyword="+encodeURIComponent(g))}return!1}var g=a(".new_searchtext").attr("default");g!=b&&(g=b),window.location.href="/newsearchresult_page.html?keyword="+encodeURIComponent(g)},history:function(b){if("null"!=b&&""!=b&&void 0!=b){var c=b.split(",");c=c.length>10?c.slice(0,10):c.slice(0);var e={},f={};f.sugs=[];for(var g=0;g<c.length;g++)if(""!=c[g]){var h={};h.freq=0,h.sug=c[g],f.sugs.push(h)}e.data=f,a(".delAll")&&a(".delAll").remove(),d.setHisDate(a(".new_list"),a(".new_list li"),e),a(".new_list li").css("color","#42abff"),a(".new_list li").hover(function(){"搜索历史"==a(this).find("em").text()?a(this).find("em").html("删除").css("color","#009cff"):a(this).find("em").html("搜索历史").css("color","#a1a1a1")})}},setData:function(a,c,d,e){var f=b.template(a.html());d.remove(),c.append(f(e))},setHisDate:function(c,d,e){var f="<%_.each(data.sugs,function(item,i){%><li><%=item.sug%><em>搜索历史</em></li><%})%>",g=b.template(f);d.remove(),c.append(g(e)),a(".new_list").append("<p class='delAll'>删除全部</p>")},hotWordSuccess:function(b){if(0==b.status.code){b=JSON.parse(b.data.block.replace(/\r\n/gi,""));var e=b.hotwords,f=b.defult;a(".new_search input").attr("default",f);-1==window.location.href.indexOf("keyword")&&a(".new_search input").val(f);var g=new RegExp("[;]","g");e=e.replace(g," ");var h=/\s+/g;e=e.replace(h,",").split(",");for(var i="",j=0;j<e.length;j++){var k=e[j].match(/\<[^\}]+\>/);k?(k=k[0],k=k.slice(1,k.length),k=k.slice(0,k.length-1),i+='<a data-href="'+k+'">'):i+="<a>",i+=e[j],i+="</a>"}a(".hotword").html("<em>搜索热词：</em>"+i),a(".hotword a").click(function(){var b=unescape(c.getCookie("bookName")),e=d.getCookieValue(b),f=a(this).text();d.uniquelCookie(f,e)||(e=f+","+e,e=e.substring(0,e.length-1),c.setCookie("bookName",e,24,"e.dangdang.com")),a(this).attr("data-href")?window.open(a(this).attr("data-href")):window.open("/newsearchresult_page.html?keyword="+encodeURIComponent(a(this).text()))})}},init:function(b){var e=this;if(b)var f=b.freshCurPage;var g=-1,h="";e.ajaxFn("Get",e.data.hotWordUrl,e.hotWordSuccess,e.hotWordError),a(".new_search").click(function(b){if(b.target=b.target||b.srcElement,"LI"==b.target.nodeName){var e=a.trim(a(b.target).text().replace("搜索历史","").replace("删除",""));a(this).find("input").val(e);var g=unescape(c.getCookie("bookName"));l=d.getCookieValue(g),d.searchBtn(e,l,f),a(this).find("ul li").css("display","none")}else if("SPAN"==b.target.nodeName){var g=unescape(c.getCookie("bookName"));l=d.getCookieValue(g);var h=a(".new_searchtext").val();d.searchBtn(h,l,f)}else if("EM"==b.target.nodeName&&"删除"==b.target.innerText){var i=a.trim(a(b.target).parent().text().replace("搜索历史","").replace("删除",""));a(b.target).parents("ul").css("display","block");var g=unescape(c.getCookie("bookName")),j=g.split(",");if(null!=g&&""!=g&&void 0!=g){j=j.length>10?j.slice(0,10):j.slice(0);for(var k=0;k<j.length;k++)i==j[k]&&(j.splice(k,1),k--);for(var l="",k=0;k<j.length;k++)l+=j[k]+",";l=l.substring(0,l.length-1),c.setCookie("bookName",l,24,"e.dangdang.com")}a(b.target).parent().remove(),0==a(".new_list li").length&&a(".delAll").remove()}else"P"==b.target.nodeName&&(c.setCookie("bookName","",24,"e.dangdang.com"),a(".new_list")[0].style.display="none")}).mouseout(function(b){var c=a(".new_searchtext").attr("default");c==a(".new_searchtext").val()&&a(".new_searchtext").val(c),b=b||window.event;var d=b.toElement||b.relatedTarget;this.contains(d)||(a(".new_list")[0].style.display="none")}),a(".new_searchtext").bind("input propertychange",function(){a(".new_list li").remove(),a(".delAll").remove(),a(".new_list")[0].style.display="block";var b=a(this).val(),f=unescape(c.getCookie("bookName"));""==b?""==f||"null"==f||void 0==f?(a(".new_list li").remove(),a(".delAll").remove()):d.history(f):e.showDetail(b)}).keyup(function(a){a=a||window.event,38==a.keyCode&&-1==g&&a.preventDefault()}).keydown(function(b){var e=b.keyCode;if(38==e){g-=1,g<=-1&&(g=a(".new_list li").length-1),a(".new_list li").eq(g).addClass("cur").siblings().removeClass("cur");var i=a.trim(a(".new_list li").eq(g).text()).replace("搜索历史","").replace("删除","");a(this).val(i)}else if(40==e)g+=1,g==a(".new_list li").length&&(g=0),a(".new_list li").eq(g).addClass("cur").siblings().removeClass("cur"),i=a.trim(a(".new_list li").eq(g).text()).replace("搜索历史","").replace("删除",""),a(this).val(i);else if(13==e){b.stopPropagation(),a(".new_list li").hasClass("cur")?(i=a.trim(a(".new_list li").eq(g).text()).replace("搜索历史","").replace("删除",""),a(this).val(i)):i=a(this).val();var j=unescape(c.getCookie("bookName"));h=d.getCookieValue(j),d.searchBtn(i,h,f)}}).focus(function(){a(".new_list")[0].style.display="block";var b=a(this).val(),f=a(this).attr("default");f==b&&(a(this).val(""),b=f);var g=unescape(c.getCookie("bookName"));h=d.getCookieValue(g),""==b?""==g||"null"==g||void 0==g?(a(".new_list li").remove(),a(".delAll").remove()):d.history(g):e.showDetail(b)})},showDetail:function(a){var b=this;b.ajaxFn("Get",b.data.url+a,b.showDetialSuc,b.showDetialError)},ajaxFn:function(b,c,d,e){a.ajax({url:c,type:b,dataType:"json",success:function(a){d(a)},error:function(a){e()}})},showDetialSuc:function(c){var d="<%_.each(data.sugs,function(item,i){%><li><%=item.sug%> </li><%})%>",e=b.template(d);a(".new_list li").remove(),a(".new_list").append(e(c))},showDetialError:function(){console.log("接口错误")}};return d}),define("indexTime",["jquery"],function(a){return{timer:function(b){var c=window.setInterval(function(){var d=0,e=0,f=0;b>0&&(d=Math.floor(b/3600),e=Math.floor(b/60-60*d),f=Math.floor(b-60*d*60-60*e)),d<=9&&(d="0"+d),e<=9&&(e="0"+e),f<=9&&(f="0"+f),a("#hour_show").html(d),a("#minute_show").html(e),a("#second_show").html(f),--b<0&&clearInterval(c)},1e3)},init:function(b){var c=this;a(b.el);a.ajax({url:"/media/api2.go?action=column&isFull=1&columnType=all_yuhuitaozhuang&end=0&start=0 ",type:"get",success:function(a){var b=null;a.data.saleList[0].mediaList.length>0&&"102"==a.data.saleList[0].mediaList[0].promotionList[0].promotionType&&(b=a.data.saleList[0].mediaList[0].promotionList[0].promotionEndTime);var b=parseInt(b),d=new Date(a.data.currentDate.replace(/-/g,"/"));d=d.getTime();var e=(b-d)/1e3;c.timer(e)}})}}}),define("carouselPlugin",["jquery"],function(a){var b=function(b,c){function d(b,c){if("dot"==b){c='<ol class="dots" style="position:absolute">';for(var d=1;d<=f.li.length-2;d++)c+='<li class="'+(d===f.i?b+" active":b)+'"></li>';c+="</ol>"}else c='<div class="',c=c+b+'s">'+c+b+' prev">'+f.o.prev+"</div>"+c+b+' next">'+f.o.next+"</div></div>";if(f.con.addClass("has-"+b+"s").append(c).find("."+b).click(function(){var b=a(this);b.hasClass("dot")?f.stop().to(b.index()+1):b.hasClass("prev")?f.prev():f.next()}),"dot"==b){var e=f.con.find(".dots"),g=e.width();e.css("margin-left",-g/2)}}function e(){var a=f.ul.find("li");f.ul.append(a.eq(0).clone(!0,!0)),f.ul.prepend(a.eq(a.length-1).clone(!0,!0))}var f=this;f.o={speed:500,delay:3e3,init:0,pause:!0,loop:!0,keys:!1,dots:!0,arrows:!0,prev:"",next:"",fluid:!1,starting:!1,complete:!1,easing:"swing",autoplay:!1,outside:!1},f.init=function(b,c){arguments.length>=2?f.o=a.extend(f.o,c):f.o=c,f.el=b,f.con=f.el.find(".carousel-plugin-model"),f.ul=f.con.find(".carousel-list-con .carousel-list"),f.o.loop&&e(),f.max=[0|b.outerWidth(),0|b.outerHeight()],f.li=f.ul.find(".carousel-item"),f.len=f.li.length;var c=f.o,g=f.con,h=f.ul,i=f.li,j=f.len;f.i=1,g.css({width:f.max[0],height:i.first().outerHeight(),overflow:"hidden"}),c.dots&&d("dot"),c.arrows&&d("arrow");var k=g.find(".arrow").width();return c.arrows&&c.outside&&g.find(".carousel-list-con").css({width:f.max[0]-2*k+"px",height:"100%",margin:"0 auto"}),h.css({position:"relative",left:"-100%",width:100*j+"%",height:"100%"}),c.fluid?i.css({float:"left",width:100/j+"%"}):c.arrows&&c.outside?i.css({float:"left",width:f.max[0]-2*k+"px"}):i.css({float:"left",width:f.max[0]+"px"}),c.autoplay&&setTimeout(function(){0|c.delay&&(f.play(),c.pause&&b.on("mouseover mouseout",function(a){f.stop(),"mouseout"===a.type&&f.play()}))},0|c.init),c.keys&&a(document).keydown(function(a){switch(a.which){case 37:f.prev();break;case 39:f.next();break;case 27:f.stop()}}),f},f.to=function(b,c){f.t&&(f.stop(),f.play());var d=f.o,e=f.el,g=f.ul,h=f.li,i=f.i;h.eq(b);a.isFunction(d.starting)&&!c&&d.starting(e,h.eq(i)),h.eq(b);var j=c?5:0|d.speed,k=d.easing;g.queue("fx").length||g.animate({left:"-"+b+"00%"},j,k,function(a){b==h.length-1?(b=1,g.css({left:"-"+b+"00%"})):0==b&&(b=h.length-2,g.css({left:"-"+b+"00%"})),f.i=b,e.find(".dot").eq(b-1).addClass("active").siblings().removeClass("active")})},f.play=function(){f.t=setInterval(function(){f.to(f.i+1)},0|f.o.delay)},f.stop=function(){return f.t=clearInterval(f.t),f},f.next=function(){return f.stop().to(f.i+1)},f.prev=function(){return f.stop().to(f.i-1)},f.init(b,c)},c={carousel:function(c,d){arguments.length>=2?new b(a(d),c):new b(a(c))}};return b.version="1.0.0",c}),define("indexFloorScroll",["jquery","ddbase"],function(a,b){var c={};return c.init=function(){c.jump(),c.hoverQRCode();var b=(a("body").outerHeight(),a(window).height());a(window).scroll(function(){a(".floor_level").eq(0).offset().top<a(window).scrollTop()+b/2?a(".go_to_floor").show():a(".go_to_floor").hide(),a(".go_to_floor").is(":visible")&&a(".floor_level").each(function(c,d){var e=(a(".floor_level").eq(c).offset().top,a(window).scrollTop());a(".floor_level").eq(c).offset().top<e+b/2&&a(".floor_level").eq(c).offset().top+a(".floor_level").outerHeight()>e+b/2?a(".go_to_floor li").eq(c).find(".floor_num").hide().end().find(".floor_title").addClass("changeScroll").show():a(".go_to_floor li").eq(c).find(".floor_num").css({display:"block"}).end().find(".floor_title").removeClass("changeScroll").hide()})})},c.hoverQRCode=function(){a(".side_bar_code").hover(function(){a(".side_bar_code_hover").css("display","block")},function(){a(".side_bar_code_hover").css("display","none")})},c.jump=function(){a(".go_to_floor li").click(function(){var b=a(this).index();a("html,body").animate({scrollTop:a(".floor_level").eq(b).offset().top},500)})},c}),define("detailIsShow",["jquery"],function(a){var b={};return b.init=function(a){var b=this;b.el=a.el,b.show(b.el)},b.show=function(b){var c=a(b),d=c.find("#isshow"),e=c.find("p"),f=c.find("img");e.each(function(b,c){b>9?a(this).css("display","none"):a(this).css("display","block")}),d.click(function(){"展开"==a(this).find("i").text()?(a(this).find("i").text("收起"),f.attr("src","img/up.png"),e.each(function(b,c){a(this).css("display","block")})):(a(this).find("i").text("展开"),f.attr("src","img/down.png"),e.each(function(b,c){b>9?a(this).css("display","none"):a(this).css("display","block")}))})},b}),define("productHistory",["jquery","underscore","ddbase"],function(a,b,c){var d=d||{};return d.template='<p class="title">浏览历史</p><div class="history_listing"><% _.each(data.saleList,function(item,index){ %><%if(null != item){%><a href="<%=item.mediaList[0].mediaId%>.html" target="_blank"><div class="book_listing"><p class="left"><img class="book_size" src="<%=item.mediaList[0].coverPic%>"/><%if(item.mediaList[0].promotionList.length>0){ %><%if(item.mediaList[0].promotionList[0].promotionType==102){ %><img class="discuss_icon" src="http://img61.ddimg.cn/web/pcbookstore/xsq1x.png"/><%}else if(item.mediaList[0].promotionList[0].promotionType==20){ %><img class="saleoff_icon" src="http://img60.ddimg.cn/web/pcbookstore/mej1x.png"/><%}else if(item.mediaList[0].promotionList[0].promotionType==23) { %><img class="saleoff_icon" src="http://img61.ddimg.cn/web/pcbookstore/mez1x.png"/><%}else if(item.mediaList[0].promotionList[0].promotionType==206) { %><img class="saleoff_icon" src="http://img63.ddimg.cn/web/pcbookstore/nyc1x.png"/><%}else if(item.mediaList[0].promotionList[0].promotionType==207) { %><img class="saleoff_icon" src="http://img61.ddimg.cn/web/pcbookstore/njz1x.png"/><% } %><% } %></p><div class="right"><h3><%=item.mediaList[0].title%></h3><p class="writer"><%=item.mediaList[0].authorPenname%></p><p class="money"><%if(item.mediaList[0].promotionId == 3){%><span>免费</span><%}else if(item.mediaList[0].promotionList.length>0){ %><%if(item.mediaList[0].promotionList[0].promotionType==102){ %><span>￥<%=item.mediaList[0].promotionList[0].promotionPrice.toFixed(2)%></span><del>￥<%=item.mediaList[0].salePrice.toFixed(2)%></del><%}else if(item.mediaList[0].promotionList[0].promotionType==10000){ %><span>￥<%=item.mediaList[0].salePrice.toFixed(2)%></span><%}else{ %><span>￥<%=item.mediaList[0].salePrice.toFixed(2)%></span><% } %><% } %></p></div></div></a><%}%><% }) %></div>',d.init=function(e){var f=unescape(c.getCookie("producthistoryid")),g=e.id,h=[],i=/^19\d{8}$/;if("null"!=f){var j=f.split(",");h=b.without(j,g)}h.unshift(g),h.length>10&&h.splice(10,h.length-10),c.setCookie("producthistoryid",h.join(","),24);for(var k=[],l=0,m=1;m<h.length;m++)if(null!=h[m].match(i)&&l<4){var n={};n.mediaId=h[m],n.saleId=h[m],n.productId=0,n.mediaType=2,k.push(n),l++}a.ajax({url:"/media/api2.go?action=getMediaPrice&isReturnAllFields=false&promotionType=1"+c.baseApiParams,type:"POST",data:{mediaMsg:JSON.stringify(k)},success:function(c){if(c.data.saleList){var f=b.template(d.template);a(e.el).html(f(c))}}})},d}),define("collect",["jquery","underscore","ddbase","loginModule"],function(a,b,c,d){var e={},f=function(){var b='<div class="collection" data-isStore ="<%=isStore %>"><i class="icon collect"></i><a class="text" dd_name="收藏" id="collect"><%= isStore == "1" ? "取消收藏" : "收藏" %></a></div>',d=c.template(b,{isStore:e.isStore});a(e.el).append(d),g()},g=function(){a(e.el).delegate(".collection","click",function(){if(!c.token())return void d();var b=a(this),f="/media/api2.go?action=dDReaderStoreUpSave&type=media";"1"==e.isStore&&(f="/media/api2.go?action=dDReaderStoreUpCancel&type=media"),f=f+"&targetIds="+e.collectId+c.baseApiParams,a.get(f,function(a){0!=a.status.code?c.setMessageTip(a.status.message):"1"===e.isStore?(e.isStore="0",b.find(".text").text("收藏"),c.setMessageTip("取消收藏成功")):(e.isStore="1",b.find(".text").text("取消收藏"),c.setMessageTip("收藏成功！已收藏的书籍，可以在【阅读中心】-【我的阅读】-【我的收藏】内找到哦~"))})})};return{render:function(a){a.el&&a.collectId&&(a.isStore=a.isStore||"0",e=a,f())}}}),define("qrcode",["jquery"],function(a){return function(b){b.fn.qrcode=function(c){function d(a){this.mode=i,this.data=a}function e(a,b){this.typeNumber=a,this.errorCorrectLevel=b,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function f(a,b){if(void 0==a.length)throw Error(a.length+"/"+b);for(var c=0;c<a.length&&0==a[c];)c++;this.num=Array(a.length-c+b);for(var d=0;d<a.length-c;d++)this.num[d]=a[d+c]}function g(a,b){this.totalCount=a,this.dataCount=b}function h(){this.buffer=[],this.length=0}var i;d.prototype={getLength:function(){return this.data.length},write:function(a){for(var b=0;b<this.data.length;b++)a.put(this.data.charCodeAt(b),8)}},e.prototype={addData:function(a){this.dataList.push(new d(a)),this.dataCache=null},isDark:function(a,b){if(0>a||this.moduleCount<=a||0>b||this.moduleCount<=b)throw Error(a+","+b);return this.modules[a][b]},getModuleCount:function(){return this.moduleCount},make:function(){if(1>this.typeNumber){for(var a=1,a=1;40>a;a++){for(var b=g.getRSBlocks(a,this.errorCorrectLevel),c=new h,d=0,e=0;e<b.length;e++)d+=b[e].dataCount;for(e=0;e<this.dataList.length;e++)b=this.dataList[e],c.put(b.mode,4),c.put(b.getLength(),j.getLengthInBits(b.mode,a)),b.write(c);if(c.getLengthInBits()<=8*d)break}this.typeNumber=a}this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(a,b){this.moduleCount=4*this.typeNumber+17,this.modules=Array(this.moduleCount);for(var c=0;c<this.moduleCount;c++){this.modules[c]=Array(this.moduleCount);for(var d=0;d<this.moduleCount;d++)this.modules[c][d]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(a,b),7<=this.typeNumber&&this.setupTypeNumber(a),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,b)},setupPositionProbePattern:function(a,b){for(var c=-1;7>=c;c++)if(!(-1>=a+c||this.moduleCount<=a+c))for(var d=-1;7>=d;d++)-1>=b+d||this.moduleCount<=b+d||(this.modules[a+c][b+d]=0<=c&&6>=c&&(0==d||6==d)||0<=d&&6>=d&&(0==c||6==c)||2<=c&&4>=c&&2<=d&&4>=d)},getBestMaskPattern:function(){for(var a=0,b=0,c=0;8>c;c++){this.makeImpl(!0,c);var d=j.getLostPoint(this);(0==c||a>d)&&(a=d,b=c)}return b},createMovieClip:function(a,b,c){for(a=a.createEmptyMovieClip(b,c),this.make(),b=0;b<this.modules.length;b++)for(var c=1*b,d=0;d<this.modules[b].length;d++){var e=1*d;this.modules[b][d]&&(a.beginFill(0,100),a.moveTo(e,c),a.lineTo(e+1,c),a.lineTo(e+1,c+1),a.lineTo(e,c+1),a.endFill())}return a},setupTimingPattern:function(){for(var a=8;a<this.moduleCount-8;a++)null==this.modules[a][6]&&(this.modules[a][6]=0==a%2);for(a=8;a<this.moduleCount-8;a++)null==this.modules[6][a]&&(this.modules[6][a]=0==a%2)},setupPositionAdjustPattern:function(){for(var a=j.getPatternPosition(this.typeNumber),b=0;b<a.length;b++)for(var c=0;c<a.length;c++){var d=a[b],e=a[c];if(null==this.modules[d][e])for(var f=-2;2>=f;f++)for(var g=-2;2>=g;g++)this.modules[d+f][e+g]=-2==f||2==f||-2==g||2==g||0==f&&0==g}},setupTypeNumber:function(a){for(var b=j.getBCHTypeNumber(this.typeNumber),c=0;18>c;c++){var d=!a&&1==(b>>c&1);this.modules[Math.floor(c/3)][c%3+this.moduleCount-8-3]=d}for(c=0;18>c;c++)d=!a&&1==(b>>c&1),this.modules[c%3+this.moduleCount-8-3][Math.floor(c/3)]=d},setupTypeInfo:function(a,b){for(var c=j.getBCHTypeInfo(this.errorCorrectLevel<<3|b),d=0;15>d;d++){var e=!a&&1==(c>>d&1);6>d?this.modules[d][8]=e:8>d?this.modules[d+1][8]=e:this.modules[this.moduleCount-15+d][8]=e}for(d=0;15>d;d++)e=!a&&1==(c>>d&1),8>d?this.modules[8][this.moduleCount-d-1]=e:9>d?this.modules[8][15-d-1+1]=e:this.modules[8][15-d-1]=e;this.modules[this.moduleCount-8][8]=!a},mapData:function(a,b){for(var c=-1,d=this.moduleCount-1,e=7,f=0,g=this.moduleCount-1;0<g;g-=2)for(6==g&&g--;;){for(var h=0;2>h;h++)if(null==this.modules[d][g-h]){var i=!1;f<a.length&&(i=1==(a[f]>>>e&1)),j.getMask(b,d,g-h)&&(i=!i),this.modules[d][g-h]=i,e--,-1==e&&(f++,e=7)}if(0>(d+=c)||this.moduleCount<=d){d-=c,c=-c;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(a,b,c){for(var b=g.getRSBlocks(a,b),d=new h,f=0;f<c.length;f++){var i=c[f];d.put(i.mode,4),d.put(i.getLength(),j.getLengthInBits(i.mode,a)),i.write(d)}for(f=a=0;f<b.length;f++)a+=b[f].dataCount;if(d.getLengthInBits()>8*a)throw Error("code length overflow. ("+d.getLengthInBits()+">"+8*a+")");for(d.getLengthInBits()+4<=8*a&&d.put(0,4);0!=d.getLengthInBits()%8;)d.putBit(!1);for(;!(d.getLengthInBits()>=8*a)&&(d.put(e.PAD0,8),!(d.getLengthInBits()>=8*a));)d.put(e.PAD1,8);return e.createBytes(d,b)},e.createBytes=function(a,b){for(var c=0,d=0,e=0,g=Array(b.length),h=Array(b.length),i=0;i<b.length;i++){var k=b[i].dataCount,l=b[i].totalCount-k,d=Math.max(d,k),e=Math.max(e,l);g[i]=Array(k);for(var m=0;m<g[i].length;m++)g[i][m]=255&a.buffer[m+c];for(c+=k,m=j.getErrorCorrectPolynomial(l),k=new f(g[i],m.getLength()-1).mod(m),h[i]=Array(m.getLength()-1),m=0;m<h[i].length;m++)l=m+k.getLength()-h[i].length,h[i][m]=0<=l?k.get(l):0}for(m=i=0;m<b.length;m++)i+=b[m].totalCount;for(c=Array(i),m=k=0;m<d;m++)for(i=0;i<b.length;i++)m<g[i].length&&(c[k++]=g[i][m]);for(m=0;m<e;m++)for(i=0;i<b.length;i++)m<h[i].length&&(c[k++]=h[i][m]);return c},i=4;for(var j={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(a){for(var b=a<<10;0<=j.getBCHDigit(b)-j.getBCHDigit(j.G15);)b^=j.G15<<j.getBCHDigit(b)-j.getBCHDigit(j.G15);return(a<<10|b)^j.G15_MASK},getBCHTypeNumber:function(a){for(var b=a<<12;0<=j.getBCHDigit(b)-j.getBCHDigit(j.G18);)b^=j.G18<<j.getBCHDigit(b)-j.getBCHDigit(j.G18);return a<<12|b},getBCHDigit:function(a){for(var b=0;0!=a;)b++,a>>>=1;return b},getPatternPosition:function(a){return j.PATTERN_POSITION_TABLE[a-1]},getMask:function(a,b,c){switch(a){case 0:return 0==(b+c)%2;case 1:return 0==b%2;case 2:return 0==c%3;case 3:return 0==(b+c)%3;case 4:return 0==(Math.floor(b/2)+Math.floor(c/3))%2;case 5:return 0==b*c%2+b*c%3;case 6:return 0==(b*c%2+b*c%3)%2;case 7:return 0==(b*c%3+(b+c)%2)%2;default:throw Error("bad maskPattern:"+a)}},getErrorCorrectPolynomial:function(a){for(var b=new f([1],0),c=0;c<a;c++)b=b.multiply(new f([1,k.gexp(c)],0));return b},getLengthInBits:function(a,b){if(1<=b&&10>b)switch(a){case 1:return 10;case 2:return 9;case i:case 8:return 8;default:throw Error("mode:"+a)}else if(27>b)switch(a){case 1:return 12;case 2:return 11;case i:return 16;case 8:return 10;default:throw Error("mode:"+a)}else{if(!(41>b))throw Error("type:"+b);switch(a){case 1:return 14;case 2:return 13;case i:return 16;case 8:return 12;default:throw Error("mode:"+a)}}},getLostPoint:function(a){for(var b=a.getModuleCount(),c=0,d=0;d<b;d++)for(var e=0;e<b;e++){for(var f=0,g=a.isDark(d,e),h=-1;1>=h;h++)if(!(0>d+h||b<=d+h))for(var i=-1;1>=i;i++)0>e+i||b<=e+i||0==h&&0==i||g==a.isDark(d+h,e+i)&&f++;5<f&&(c+=3+f-5)}for(d=0;d<b-1;d++)for(e=0;e<b-1;e++)f=0,a.isDark(d,e)&&f++,a.isDark(d+1,e)&&f++,a.isDark(d,e+1)&&f++,a.isDark(d+1,e+1)&&f++,(0==f||4==f)&&(c+=3);for(d=0;d<b;d++)for(e=0;e<b-6;e++)a.isDark(d,e)&&!a.isDark(d,e+1)&&a.isDark(d,e+2)&&a.isDark(d,e+3)&&a.isDark(d,e+4)&&!a.isDark(d,e+5)&&a.isDark(d,e+6)&&(c+=40);for(e=0;e<b;e++)for(d=0;d<b-6;d++)a.isDark(d,e)&&!a.isDark(d+1,e)&&a.isDark(d+2,e)&&a.isDark(d+3,e)&&a.isDark(d+4,e)&&!a.isDark(d+5,e)&&a.isDark(d+6,e)&&(c+=40);for(e=f=0;e<b;e++)for(d=0;d<b;d++)a.isDark(d,e)&&f++;return a=Math.abs(100*f/b/b-50)/5,c+10*a}},k={glog:function(a){if(1>a)throw Error("glog("+a+")");return k.LOG_TABLE[a]},gexp:function(a){for(;0>a;)a+=255;for(;256<=a;)a-=255;return k.EXP_TABLE[a]},EXP_TABLE:Array(256),LOG_TABLE:Array(256)},l=0;8>l;l++)k.EXP_TABLE[l]=1<<l;for(l=8;256>l;l++)k.EXP_TABLE[l]=k.EXP_TABLE[l-4]^k.EXP_TABLE[l-5]^k.EXP_TABLE[l-6]^k.EXP_TABLE[l-8];for(l=0;255>l;l++)k.LOG_TABLE[k.EXP_TABLE[l]]=l;return f.prototype={get:function(a){return this.num[a]},getLength:function(){return this.num.length},multiply:function(a){for(var b=Array(this.getLength()+a.getLength()-1),c=0;c<this.getLength();c++)for(var d=0;d<a.getLength();d++)b[c+d]^=k.gexp(k.glog(this.get(c))+k.glog(a.get(d)));return new f(b,0)},mod:function(a){if(0>this.getLength()-a.getLength())return this;for(var b=k.glog(this.get(0))-k.glog(a.get(0)),c=Array(this.getLength()),d=0;d<this.getLength();d++)c[d]=this.get(d);for(d=0;d<a.getLength();d++)c[d]^=k.gexp(k.glog(a.get(d))+b);return new f(c,0).mod(a)}},g.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],g.getRSBlocks=function(a,b){var c=g.getRsBlockTable(a,b);if(void 0==c)throw Error("bad rs block @ typeNumber:"+a+"/errorCorrectLevel:"+b);for(var d=c.length/3,e=[],f=0;f<d;f++)for(var h=c[3*f+0],i=c[3*f+1],j=c[3*f+2],k=0;k<h;k++)e.push(new g(i,j));return e},g.getRsBlockTable=function(a,b){switch(b){case 1:return g.RS_BLOCK_TABLE[4*(a-1)+0];case 0:return g.RS_BLOCK_TABLE[4*(a-1)+1];case 3:return g.RS_BLOCK_TABLE[4*(a-1)+2];case 2:return g.RS_BLOCK_TABLE[4*(a-1)+3]}},h.prototype={get:function(a){return 1==(this.buffer[Math.floor(a/8)]>>>7-a%8&1)},put:function(a,b){for(var c=0;c<b;c++)this.putBit(1==(a>>>b-c-1&1))},getLengthInBits:function(){return this.length},putBit:function(a){var b=Math.floor(this.length/8);this.buffer.length<=b&&this.buffer.push(0),a&&(this.buffer[b]|=128>>>this.length%8),this.length++}},"string"==typeof c&&(c={text:c}),c=b.extend({},{render:"canvas",width:256,height:256,typeNumber:-1,correctLevel:2,background:"#ffffff",foreground:"#000000"},c),this.each(function(){var d;if("canvas"==c.render){d=new e(c.typeNumber,c.correctLevel),d.addData(c.text),d.make();var f=document.createElement("canvas");f.width=c.width,f.height=c.height;for(var g=f.getContext("2d"),h=c.width/d.getModuleCount(),i=c.height/d.getModuleCount(),j=0;j<d.getModuleCount();j++)for(var k=0;k<d.getModuleCount();k++){g.fillStyle=d.isDark(j,k)?c.foreground:c.background;var l=Math.ceil((k+1)*h)-Math.floor(k*h),m=Math.ceil((j+1)*h)-Math.floor(j*h);g.fillRect(Math.round(k*h),Math.round(j*i),l,m)}}else for(d=new e(c.typeNumber,c.correctLevel),d.addData(c.text),d.make(),f=b("<table></table>").css("width",c.width+"px").css("height",c.height+"px").css("border","0px").css("border-collapse","collapse").css("background-color",c.background),g=c.width/d.getModuleCount(),h=c.height/d.getModuleCount(),i=0;i<d.getModuleCount();i++)for(j=b("<tr></tr>").css("height",h+"px").appendTo(f),k=0;k<d.getModuleCount();k++)b("<td></td>").css("width",g+"px").css("background-color",d.isDark(i,k)?c.foreground:c.background).appendTo(j);d=f,a(d).appendTo(this)})}}(a),a}),define("share",["qrcode","underscore"],function(a,b){var c=function(a){for(key in a)e.module[key]=a[key]},d=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c+"="+encodeURIComponent(a[c]||""));return b.join("&")},e={module:{title:"PC书城",desc:"",pic:"http://img62.ddimg.cn/digital/product/42/84/1960064284_ii_cover.jpg?version=9b5b3b6a-6357-4c70-bf01-1f4d37709e26",url:document.location.href},openurl:{sina:"http://service.weibo.com/share/share.php?",qzone:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?",qq:"http://connect.qq.com/widget/shareqq/index.html?",qqweibo:"http://share.v.t.qq.com/index.php?c=share&a=index&"}},f=function(){a(e.module.el).delegate(".shareC","mouseover",function(){a(this).addClass("focus"),a(this).find(".sharelist").show()}),a(e.module.el).delegate(".shareC","mouseout",function(){a(this).removeClass("focus"),a(this).find(".sharelist").hide(),a(this).find(".weixinC").hide()}),a(e.module.el).delegate(".icon.clicked","click",function(){var b=a(this).attr("data-type");window.open(e.openurl[b]+d(e.params[b]))}),a(e.module.el).delegate(".icon.weixin","mouseover",function(){var b=a(this).attr("data-type");if(0===a(this).find("table,canvas").length){var b=document.createElement("canvas").getContext?"canvas":"table";a(this).find(".weixinC").qrcode({render:b,width:100,height:110,correctLevel:0,text:e.module.url})}a(this).find(".weixinC").show()}),a(e.module.el).delegate(".icon.weixin","mouseout",function(){a(this).find(".weixinC").hide()})},g=function(a){c(a),e.params={sina:{url:e.module.url,title:e.module.title+"（摘要："+e.module.desc.substr(0,80)+"...）",pic:e.module.pic,language:"zh_cn",searchPic:!1,appkey:1315955721,ralateUid:1647263235},qzone:{url:e.module.url,title:e.module.title,pics:e.module.pic,summary:e.module.desc.substr(0,200)},qq:{url:e.module.url,title:e.module.title,pics:e.module.pic,summary:e.module.desc.substr(0,200)}},f()};return{render:function(b){if(b.el){a(b.el).append('<div class="shareC"><i class="icon share"></i>分享<div class="sharelist clearfix hide"><i class="weibo icon clicked" data-type="sina"></i><i class="weixin icon" data-type="weixin"><div class="weixinC hide"></div></i><i class="qq icon clicked" data-type="qzone"></i></div></div>'),g(b)}}}}),define("appendCartV2",["jquery","ddbase","fly"],function(a,b,c){return function(c){var d=c.cId,e=c.productId,f=(c.saleId,c.event),g=b.getCookie("cart_items_count")||"0";if(""!=b.token()){var h=function(){a.ajax({method:"POST",url:"/media/api2.go?action=appendCartV2&productIds="+e+"&cId="+d+b.setBaseApiParams().replace("fromPlatform=106","fromPlatform=307"),success:function(d){if(0!=parseInt(d.status.code))return b.setMessageTip(d.status.message),showMsgBox("buy_now_button","","",""),!1;var e=d.data.cartAllProductCnt;b.setCookie("cart_items_count",e,24,"dangdang.com"),a("#cart_items_count").html(e),o(),void 0!=c.callback&&c.callback(),b.setMessageTip("成功加入购物车！")}})};if(c.fly){var i=a(".shoppingCartWrap").offset(),j=a(this),k=a(".newbook_left").find("img").eq(0).attr("src"),l=a('<img class="u-flyer" src="'+k+'">'),m=document.body.scrollTop||document.documentElement.scrollTop,n=document.body.scrollLeft||document.documentElement.scrollLeft;l.fly({start:{left:n+f.clientX,top:m+f.clientY-20},end:{left:i.left+10,top:i.top+10,width:0,height:0},onEnd:function(){j.off(),h(),a(".u-flyer").remove()}})}else h();var o=function(){a("<b class='cart_goods_count' style='z-index:500,opacity:0.8'>"+g+"</b>").appendTo(a(".shoppingCartWrap")).animate({top:"-40px",opacity:"0"},500,function(){a(".cart_goods_count:gt(0)").remove()})}}}}),define("productDetail",["jquery","underscore","ddbase","collect","share","appendCartV2","fly"],function(a,b,c,d,e,f,g){var h={init:function(b){var d=this;d.data.id=b,d.productHandler(b),a("body").delegate("#productBookDetail .btn_line .btn","click",function(){d.btnFn(this)}),a("body").delegate("#addShopCartBtn","click",function(a){d.addShopCart(a)}),a("body").delegate("#buy_now_button","click",function(){""==c.token()?showMsgBox("buy_now_button","","",h.oneKeyPay):h.oneKeyPay()}),a("body").delegate("#catalog_btn","click",function(){var a=this;d.catalogSlide(a)}),a("body").delegate(".notice_box .clost_btn","click",function(){d.hideNotice()})},data:{id:0,isStore:0},url:{freeUrl:"/media/api.go?action=freeObtainMedia",borrowUrl:"/media/api.go?action=addAuthorizeEbook"},productHandler:function(b){a.get("/media/api.go?action=getMedia"+c.baseApiParams,{refAction:"browse",saleId:b,promotionType:1},function(b){if(0==b.status.code){var c=b.data.mediaSale,d=c.mediaList[0];h.data.isStore=d.isStore;var e="",f="",g="",i="",j="",k=0;if(f=1==d.freeBook?"免费":(d.price/100).toFixed(2),d.lowestPrice?g=(d.lowestPrice/100).toFixed(2):d.originalPrice&&(g=d.originalPrice.toFixed(2)),d.promotionList&&d.promotionList.length>0){var l=d.promotionList[0].promotionType;if(l)if("102"==l){var m=h.limitIimeHandler(d.promotionList[0].promotionLeftTime);k=d.promotionList[0].promotionLeftTime,i='<img class="promotion_icon" src="img/product/xsq.png">',j='<div class="promo_box"><span class="icon_bg">抢购</span><span class="promo_price"><i>¥</i>'+f+' </span><span class="limit_time">仅剩<i class="red_bg">'+m.H+'</i>:<i class="red_bg">'+m.M+'</i>:<i class="red_bg">'+m.S+"</i></span></div>",a("#productBookDetail .price_box").before(j),e=e+"<p>售&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;价：<del>¥"+d.salePrice.toFixed(2)+"</del></p>";var n=setInterval(function(){(k-=1e3)<=0&&clearInterval(n);var b=h.limitIimeHandler(k);a(".promo_box .limit_time").html('仅剩<i class="red_bg">'+b.H+'</i>:<i class="red_bg">'+b.M+'</i>:<i class="red_bg">'+b.S+"</i>")},1e3)}else{var o=d.promotionList[0].promotionName;i='<img class="promotion_icon" src="'+d.promotionList[0].promotionPicPC+'?2">',e=e+'<p>售&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;价：<span class="normal_price">¥<i>'+f+"</i></span></p>",j="<p>促&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;销：<em>"+d.promotionList[0].promotionAlias+"</em>"+o,d.promotionList[0].ddPromotionPcURL&&""!=d.promotionList[0].ddPromotionPcURL&&(j+='<a href="'+d.promotionList[0].ddPromotionPcURL+'" target="_blank">详情&gt;</a>'),j+="</p>",a(".price_box .more_promo").prepend(j)}else e=e+'<p>售&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;价：<span class="normal_price">'+("免费"==f?"":"¥")+"<i>"+f+"</i></span></p>";a(".shop_detail_box .newbook_left .bookCover_area").append(i)}else e=e+'<p>售&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;价：<span class="normal_price">'+("免费"==f?"":"¥")+"<i>"+f+"</i></span></p>";if(d.paperMediaProductId&&""!=d.paperMediaProductId&&(e+='<p class="paper_price">',""!=g&&(e=e+"纸质售价：¥"+g),e=e+'<a href="http://product.dangdang.com/'+d.paperMediaProductId+'.html" target="_blank" dd_name="购买纸书" id="paperBook_link">购买纸书</a>',e+="</p>"),a("#productBookDetail .cost_box").html(e),1!=c.shelfStatus)return location.href="http://e.dangdang.com/off_shelf_page.html",!1;var p="http://e.dangdang.com/ebook/read.do?productId="+h.data.id,q="";if(1==d.freeBook)1==d.isWholeAuthority?q=q+'<a href="'+p+'" class="green_btn_2 btn" status="readNow" target="_blank" id="readNow" dd_name="立即阅读">立即阅读</a>':q+='<a href="javascript:;" class="green_btn_2 btn" status="free" id="freeGet" dd_name="免费获取">免费获取</a>';else{var r=d.borrowEndTime;if(1==d.canBorrow&&1!=d.isWholeAuthority){var s=d.borrowDuration,t=s/1e3/60/60/24;void 0==r?q=q+'<a href="javascript:void(0)" class="green_btn_2 btn" id="addShopCartBtn" dd_name="加入购物车">加入购物车</a><a href="javascript:void(0)" class="green_btn btn" status="buy" dd_name="立即购买" id="buy_now_button">立即购买</a><a href="javascript:;" class="btn_orange" status="borrow" dur ='+s+' id="borrowBtn" dd_name="免费借阅">免费借阅('+t+"天)</a>":new Date(r).getTime()-(new Date).getTime()>0?q=q+'<a href="'+p+'" class="normal_btn btn" status="readNow" target="_blank" id="readNowBtn" dd_name="立即阅读">立即阅读</a>':q+='<a href="javascript:void(0)" class="green_btn_2 btn" id="addShopCartBtn" dd_name="加入购物车">加入购物车</a><a href="javascript:void(0)" class="green_btn btn" status="buy" dd_name="立即购买" id="buy_now_button">立即购买</a><a href="javascript:;" class="btn_orange" status="reborrow" id="reborrowBtn" dd_name="续借" >续借</a>'}else 1==d.isWholeAuthority?q=q+'<a href="'+p+'" class="normal_btn btn" status="readNow" target="_blank" id="readNowBtn" dd_name="立即阅读">立即阅读</a>':(q+='<a href="javascript:void(0)" class="green_btn_2 btn" id="addShopCartBtn" dd_name="加入购物车">加入购物车</a><a href="javascript:void(0)" class="green_btn btn" status="buy" dd_name="立即购买" id="buy_now_button">立即购买</a>',q=q+'<a href="'+p+'" class="normal_btn btn" status="try" target="_blank" id="tryBtn" dd_name="试读">试读</a>')}a("#productBookDetail .btn_line").prepend(q),h.afterRender()}}),a.get("/media/api.go?action=getCouponList"+c.baseApiParams,{mediaId:b},function(c){if(0==c.status.code&&c.data.couponList&&c.data.couponList.length>0){for(var d=c.data.couponList,e="<p>领&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;券：",f=0,g=d.length;f<g;f++){var h=d[f],i=h.activityDisplayPlatform;0!=i&&2!=i||(e+='<span class="quan" id="activity-'+h.activitySerialNum+'" data-coupon-activity="'+h.activitySerialNum+"|http://e.dangdang.com/products/"+b+'.html|activityCallback|awardCallback"><i class="left_side"></i>满'+h.couponDesc+'<i class="right_side"></i></span>')}e+="</p>",e+='<p class="margin_left last">注：购物车结算才能使用礼券。铃铛结算可在当当云阅读APP使用，PC端暂不支持。</p>',a(".price_box .more_promo").append(e),a("body").append('<script type="text/javascript" src="http://static.ddimg.cn/js/coupon/autoActivity.js"><\/script>')}})},oneKeyPay:function(){a.get("/media/api.go?action=doOneKeyPay"+c.setBaseApiParams(),{productId:h.data.id},function(b){0==b.status.code?a("body").append(b.data.returnForm):h.showNotice({title:"购买提示",content:b.status.message})})},afterRender:function(){var b=this;d.render({el:"#collect_area",isStore:b.data.isStore,collectId:b.data.id}),e.render({el:"#share_area",title:a("#product_title").val(),desc:a("#product_desc").val(),pic:a("#product_coverPic").val()})},btnFn:function(b){var d=this,e=a(b),f=e.attr("status");if("free"==f){if(""==c.token())return void showMsgBox("freeGet","","",h.getFreeBook);h.getFreeBook()}else if("try"==f);else if("borrow"==f){""==c.token()&&loginModule();var g=parseInt(e.attr("dur"));d.ajax("Get",d.url.borrowUrl,{mediaId:d.data.id,deviceType:"iphone",platformSource:"1002",borrowDuration:g},d.btnSuc,d.error,e)}else if("reborrow"==f){var i=d.data.id,j=d.data.id;renew.show({productArray:[{productId:i,saleId:j,cid:""}],callback:function(b){a(this).html(a("#bookTemplate").html(),b)}})}},getFreeBook:function(){h.ajax("Get",h.url.freeUrl,{mediaId:h.data.id,platform:"ds_android"},h.btnSuc,h.error,a("#freeGet"))},addShopCart:function(a){if(""==c.token())return showMsgBox("buy_now_button","","",h.appendCart),!1;h.appendCart(a)},btnSuc:function(a,b){0==a.status.code?(b.text("立即阅读").attr({href:"http://e.dangdang.com/ebook/read.do?productId="+this.data.id,target:"_blank",status:"readNow"}),h.showNotice({title:"授权提示",content:"获取成功",buttonLink:"http://e.dangdang.com/ebook/read.do?productId="+this.data.id,buttonText:"立即阅读"})):h.showNotice({title:"授权提示",content:a.status.message})},error:function(){},ajax:function(b,d,e,f,g,h){var i=this;a.ajax({type:b,url:d+c.setBaseApiParams(),data:e,timeout:1e4,success:function(a){f.call(i,a,h)},error:function(){g(i)}})},catalogSlide:function(b){var c=a(b),d=a(b).find(".icon"),e=c.parents(".product_catalog").find(".catalog_ul");d.hasClass("show")?(d.removeClass("show").addClass("hide"),c.find("em").text("收起"),e.find(".hide").addClass("show").removeClass("hide")):(d.removeClass("hide").addClass("show"),c.find("em").text("展开"),e.find(".show").addClass("hide").removeClass("show"))},limitIimeHandler:function(a){var b={};return b.H=parseInt(a/36e5),b.M=parseInt(a/6e4)-60*b.H,b.S=parseInt(a/1e3)-60*b.H*60-60*b.M,{H:b.H>=10?b.H:"0"+b.H,M:b.M>=10?b.M:"0"+b.M,S:b.S>=10?b.S:"0"+b.S}},appendCart:function(b){var d=c.getQueryString("cId")||"";f({productId:a("#mediaId").val(),saleId:a("#saleId").val(),cId:d,event:b,fly:!0})},showNotice:function(b){var c='<div class="notice_bg"></div><div class="notice_box"><div class="notice_title">'+b.title+'<span class="clost_btn">X</span></div><div class="notice_content">'+b.content+"</div>";b.buttonLink&&(c+='<div class="notice_btn"><a href="'+b.buttonLink+'" target="_blank">'+b.buttonText+"</a></div>"),c+="</div>",a("body").append(c)},hideNotice:function(){a(".notice_bg,.notice_box").remove()}};return h}),require(["jquery","ddbase","bar_newmodule","publicMethodNew","underscore","indexSearch","indexTime","carouselPlugin","publicSideCodeModule","indexFloorScroll","detailIsShow","productHistory","productDetail"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){if(a(".newTab_box").not(".fixedToolBar").offset().top<=a(window).scrollTop()){if(a(".fixedToolBar").show(),a("#barModule").offset().top<=a(window).scrollTop()+38)return void a(".fixedToolBar li").eq(2).addClass("cur").siblings().removeClass("cur");if(a("#catalogModule").offset().top<=a(window).scrollTop()+38)return void a(".fixedToolBar li").eq(1).addClass("cur").siblings().removeClass("cur");if(a("#newEditModule").offset().top<=a(window).scrollTop()+38)return void a(".fixedToolBar li").eq(0).addClass("cur").siblings().removeClass("cur")}else a(".fixedToolBar").hide()}!function(){for(var a=0,b=["webkit","moz"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}();var o=a("#mediaId").val();a("#saleId").val();f.init(),d.init(),g.init({el:".spare_box"}),l.init({el:".history_wrap",id:o}),h.carousel({outside:!0},"#commendTabCon"),h.carousel({outside:!0},"#readTabCon"),h.carousel({outside:!0},"#buyedTabCon"),j.init(),i.toTop(),i.closeCode(),n(),a(window).scroll(function(){n()}),a(".newTab_box li").click(function(){var b=a(this);if(!b.hasClass("cur"))return b.addClass("cur").siblings().removeClass("cur"),a("html,body").animate({scrollTop:a("#"+a(b).attr("data-role")).offset().top-35},800),!1}),k.init({el:".catalog"}),a(".new_rank_list .nopic").hover(function(){var b=a(this);b.hasClass("current")||b.addClass("current").siblings().removeClass("current")}),c.init(),m.init(o),a(".ad1 .close_btn").click(function(){a(".ad1").slideUp()})}),define("productNew",function(){});